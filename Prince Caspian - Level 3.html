<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prince Caspian - Level 3 - ÏàòÎ¶¨Îî©Ïñ¥ÌïôÏõê</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #2E8B57 0%, #8FBC8F 50%, #4682B4 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        /* Ìó§Îçî */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #2E8B57, #4682B4);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .logo-text h1 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
        }

        .logo-text p {
            font-size: 0.9rem;
            color: #666;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
            color: #333;
            text-decoration: none;
        }

        .nav-btn:hover {
            background: #2E8B57;
            color: white;
            transform: translateY(-2px);
        }

        /* Î©îÏù∏ ÏΩòÌÖêÏ∏† ÏòÅÏó≠ */
        .main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            min-height: 600px;
        }

        /* Ï±Ö ÏÉÅÏÑ∏ ÌôîÎ©¥ */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 30px;
            font-size: 0.9rem;
            color: #666;
        }

        .breadcrumb a {
            color: #2E8B57;
            text-decoration: none;
            cursor: pointer;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .book-detail-header {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: flex-start;
        }

        .detail-book-cover {
            width: 150px;
            height: 220px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 4rem;
            font-weight: bold;
            flex-shrink: 0;
            background: linear-gradient(45deg, #2E8B57, #4682B4);
        }

        .book-info {
            flex: 1;
        }

        .book-info h2 {
            font-size: 2.2rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .book-info .author {
            font-size: 1.2rem;
            color: #2E8B57;
            margin-bottom: 20px;
        }

        .book-summary {
            font-size: 1rem;
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .book-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-box .value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2E8B57;
        }

        .stat-box .label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        /* Ï±ïÌÑ∞ Í∑∏Î¶¨Îìú */
        .chapters-section {
            margin-top: 40px;
        }

        .chapters-section h3 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 30px;
            text-align: center;
        }

        .chapters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .chapter-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
        }

        .chapter-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .chapter-card.completed {
            border-color: #28a745;
            background: linear-gradient(135deg, #28a74508, #ffffff);
        }

        .chapter-card.current {
            border-color: #2E8B57;
            background: linear-gradient(135deg, #2E8B5708, #ffffff);
        }

        .chapter-card.locked {
            opacity: 0.6;
            background: #f8f9fa;
        }

        .chapter-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .chapter-info h4 {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }

        .chapter-info p {
            font-size: 0.95rem;
            color: #666;
            line-height: 1.5;
        }

        .chapter-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .chapter-status.completed {
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
        }

        .chapter-status.current {
            background: rgba(46, 139, 87, 0.1);
            color: #2E8B57;
        }

        .chapter-status.locked {
            background: rgba(108, 117, 125, 0.1);
            color: #6c757d;
        }

        .chapter-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .chapter-btn {
            padding: 12px 16px;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .audio-btn {
            background: linear-gradient(45deg, #2E8B57, #32CD32);
            color: white;
        }

        .quiz-btn {
            background: linear-gradient(45deg, #4682B4, #87CEEB);
            color: white;
        }

        .chapter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .chapter-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* ÌïôÏäµ ÌôîÎ©¥ */
        .learning-screen {
            display: none;
        }

        .learning-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .learning-progress {
            background: #f8f9fa;
            border-radius: 10px;
            height: 8px;
            margin: 20px 0;
            overflow: hidden;
        }

        .learning-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #2E8B57, #4682B4);
            transition: width 0.3s ease;
        }

        .question-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
        }

        .passage {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1rem;
            line-height: 1.6;
            color: #444;
        }

        .options {
            display: grid;
            gap: 10px;
        }

        .option {
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option:hover {
            background: #e9ecef;
            border-color: #2E8B57;
        }

        .option.selected {
            background: rgba(46, 139, 87, 0.1);
            border-color: #2E8B57;
        }

        .learning-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .control-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .next-btn {
            background: linear-gradient(45deg, #2E8B57, #4682B4);
            color: white;
        }

        .prev-btn {
            background: #6c757d;
            color: white;
        }

        .submit-btn {
            background: linear-gradient(45deg, #2E8B57, #4682B4);
            color: white;
        }

        .control-btn:hover {
            transform: translateY(-2px);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Í≤∞Í≥º ÌôîÎ©¥ */
        .result-screen {
            display: none;
            text-align: center;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(45deg, #2E8B57, #4682B4);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            font-size: 2rem;
            font-weight: bold;
        }

        .result-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .result-stat {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .result-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        /* Ïò§ÎîîÏò§ ÌîåÎ†àÏù¥Ïñ¥ Î™®Îã¨ */
        .audio-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .audio-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 600px;
            width: 90%;
            position: relative;
        }

        .close-audio {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #666;
        }

        .audio-player {
            width: 100%;
            margin: 20px 0;
            border-radius: 10px;
        }

        .audio-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .audio-control-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .play-pause-btn {
            background: linear-gradient(45deg, #2E8B57, #32CD32);
            color: white;
        }

        .speed-btn {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #ddd;
        }

        .download-btn {
            background: #4682B4;
            color: white;
        }

        .audio-info {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            font-size: 0.9rem;
            color: #666;
            transition: all 0.3s ease;
        }

        .audio-info.hidden {
            display: none;
        }

        /* Î∞òÏùëÌòï */
        @media (max-width: 768px) {
            .chapters-grid {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .book-detail-header {
                flex-direction: column;
                text-align: center;
            }

            .book-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .learning-controls {
                flex-direction: column;
            }

            .chapter-actions {
                grid-template-columns: 1fr;
            }

            .audio-controls {
                justify-content: center;
                gap: 10px;
            }

            .audio-content {
                padding: 30px 20px;
            }
        }

        .new-book-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: linear-gradient(45deg, #FF6B9D, #C44569);
            color: white;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: 700;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ìó§Îçî -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">üëë</div>
                <div class="logo-text">
                    <h1>Prince Caspian</h1>
                    <p>Level 3 - C.S. LewisÏùò ÎÇòÎãàÏïÑ Ïó∞ÎåÄÍ∏∞ 2Ìé∏</p>
                </div>
            </div>
            <div class="nav-buttons">
                <a href="http://www.suelibrary.store/" class="nav-btn">Î©îÏù∏ÏúºÎ°ú</a>
            </div>
        </div>

        <!-- Î©îÏù∏ ÏΩòÌÖêÏ∏† -->
        <div class="main-content">
            <!-- Ï±Ö ÏÉÅÏÑ∏ ÌôîÎ©¥ -->
            <div class="book-detail-screen" id="book-detail-screen">
                <div class="breadcrumb">

                    <span>Prince Caspian</span>
                </div>

                <div class="book-detail-header">
                    <div class="detail-book-cover">üëë</div>
                    <div class="book-info">
                        <h2>Prince Caspian</h2>
                        <div class="author">C.S. Lewis</div>
                        <div class="book-summary">
                            The Pevensie children return to Narnia to help Prince Caspian reclaim his throne from his evil uncle Miraz. They discover that hundreds of years have passed in Narnia, and the magical creatures are in hiding. With the help of Aslan, they must restore the rightful king to the throne.
                        </div>
                        <div class="book-stats">
                            <div class="stat-box">
                                <div class="value">15</div>
                                <div class="label">Ï±ïÌÑ∞</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">75</div>
                                <div class="label">Ï¥ù Î¨∏Ï†ú</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">Level 3</div>
                                <div class="label">Î†àÎ≤®</div>
                            </div>
                            <div class="stat-box">
                                <div class="value" id="progress-value">0%</div>
                                <div class="label">ÏßÑÎèÑ</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="chapters-section">
                    <h3>üìñ Ï±ïÌÑ∞Î≥Ñ ÌïôÏäµ</h3>
                    <div class="chapters-grid" id="chapters-grid">
                        <!-- Ï±ïÌÑ∞ Ïπ¥ÎìúÎì§ -->
                    </div>
                </div>
            </div>

            <!-- ÌïôÏäµ ÌôîÎ©¥ -->
            <div class="learning-screen" id="learning-screen">
                <div class="breadcrumb">

                    <a onclick="showBookDetail()">Prince Caspian</a>
                    <span>></span>
                    <span id="learning-chapter-breadcrumb">Chapter 1</span>
                </div>

                <div class="learning-header">
                    <h2 id="learning-title">Chapter 1: The Island</h2>
                    <div class="learning-progress">
                        <div class="learning-progress-bar" id="learning-progress-bar" style="width: 0%"></div>
                    </div>
                    <p id="learning-progress-text">Î¨∏Ï†ú 1 / 5</p>
                </div>

                <div class="question-container" id="question-container">
                    <!-- Î¨∏Ï†úÍ∞Ä ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
                </div>

                <div class="learning-controls">
                    <button class="control-btn prev-btn" id="prev-btn" onclick="previousQuestion()" disabled>Ïù¥Ï†Ñ</button>
                    <button class="control-btn next-btn" id="next-btn" onclick="nextQuestion()">Îã§Ïùå</button>
                    <button class="control-btn submit-btn" id="submit-btn" onclick="submitAnswers()" style="display: none;">Ï†úÏ∂ú</button>
                </div>
            </div>

            <!-- Í≤∞Í≥º ÌôîÎ©¥ -->
            <div class="result-screen" id="result-screen">
                <div class="breadcrumb">

                    <a onclick="showBookDetail()">Prince Caspian</a>
                    <span>></span>
                    <span>Í≤∞Í≥º</span>
                </div>

                <div class="result-header">
                    <h2>üéâ ÌïôÏäµ ÏôÑÎ£å!</h2>
                    <div class="score-circle" id="score-circle">100%</div>
                    <h3 id="result-message">ÌõåÎ•≠Ìï©ÎãàÎã§!</h3>
                </div>

                <div class="result-details">
                    <div class="result-stat">
                        <h4>Ï¥ù Î¨∏Ï†ú</h4>
                        <p id="total-questions">5Î¨∏Ï†ú</p>
                    </div>
                    <div class="result-stat">
                        <h4>Ï†ïÎãµ</h4>
                        <p id="correct-answers">5Î¨∏Ï†ú</p>
                    </div>
                    <div class="result-stat">
                        <h4>Ïò§Îãµ</h4>
                        <p id="wrong-answers">0Î¨∏Ï†ú</p>
                    </div>
                    <div class="result-stat">
                        <h4>Ï†êÏàò</h4>
                        <p id="final-score">100Ï†ê</p>
                    </div>
                </div>

                <div class="result-actions">
                    <button class="control-btn prev-btn" onclick="retryChapter()">Îã§Ïãú ÌíÄÍ∏∞</button>
                    <button class="control-btn next-btn" onclick="nextChapter()">Îã§Ïùå Ï±ïÌÑ∞</button>
                    <button class="control-btn submit-btn" onclick="showBookDetail()">Ï±ïÌÑ∞ Î™©Î°ù</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ïò§ÎîîÏò§ ÌîåÎ†àÏù¥Ïñ¥ Î™®Îã¨ -->
    <div class="audio-modal" id="audio-modal">
        <div class="audio-content">
            <button class="close-audio" onclick="closeAudioModal()">√ó</button>
            <h3 id="audio-chapter-title">Chapter 1: The Island</h3>
            <p id="audio-chapter-subtitle">Prince Caspian - C.S. Lewis</p>

            <audio class="audio-player" id="audio-player" controls preload="metadata">
                <source id="audio-source" src="" type="audio/mpeg">
                Î∏åÎùºÏö∞Ï†ÄÍ∞Ä Ïò§ÎîîÏò§Î•º ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.
            </audio>

            <div class="audio-controls">
                <button class="audio-control-btn play-pause-btn" onclick="togglePlayPause()">‚ñ∂Ô∏è Ïû¨ÏÉù</button>
                <button class="audio-control-btn speed-btn" onclick="changeSpeed()">1.0x</button>
                <button class="audio-control-btn" onclick="resetToChapterStart()" style="background: #28a745; color: white;">üîÑ Íµ¨Í∞ÑÏ≤òÏùå</button>
                <button class="audio-control-btn download-btn" onclick="downloadAudio()">üì• Îã§Ïö¥Î°úÎìú</button>
            </div>

            <div class="audio-info" id="audio-info">
                <div id="audio-status" style="margin-top: 10px; font-weight: bold; color: #2E8B57;"></div>
            </div>
        </div>
    </div>

    <script>
        // üéØ Íµ¨Í∏Ä ÌÅ¥ÎùºÏö∞Îìú Ïä§ÌÜ†Î¶¨ÏßÄ Ïò§ÎîîÏò§ URL ÏÑ§Ï†ï
        const AUDIO_BASE_URL = 'https://storage.googleapis.com/kim-mom-reading-audio/audio/';

        // Prince Caspian ÎèÑÏÑú Îç∞Ïù¥ÌÑ∞ (Ï†ÑÏ≤¥ 15Ï±ïÌÑ∞)
        const bookData = {
            id: 'PC001',
            title: "Prince Caspian",
            author: 'C.S. Lewis',
            cover: 'üëë',
            progress: 0,
            chapters: 15,
            totalQuestions: 75, // 15Ï±ïÌÑ∞ √ó 5Î¨∏Ï†ú
            coverColor: 'linear-gradient(45deg, #2E8B57, #4682B4)',
            summary: "The Pevensie children return to Narnia to help Prince Caspian reclaim his throne from his evil uncle Miraz. They discover that hundreds of years have passed in Narnia, and the magical creatures are in hiding. With the help of Aslan, they must restore the rightful king to the throne.",
            chapterList: [
                { title: 'The Island', description: 'The Pevensie children are pulled back to Narnia and find themselves on a mysterious island.', status: 'current', questionCount: 5, startTime: 0 },
                { title: 'The Ancient Treasure Chamber', description: 'The children discover the ruins of Cair Paravel, their ancient castle.', status: 'locked', questionCount: 5, startTime: 480 },
                { title: 'The Dwarf', description: 'The children rescue Trumpkin the dwarf from Miraz\'s soldiers.', status: 'locked', questionCount: 5, startTime: 960 },
                { title: 'The Dwarf Tells of Prince Caspian', description: 'Trumpkin tells the story of Prince Caspian and his struggle.', status: 'locked', questionCount: 5, startTime: 1440 },
                { title: 'Caspian\'s Adventure in the Mountains', description: 'The story of how Caspian fled to the mountains and met the Old Narnians.', status: 'locked', questionCount: 5, startTime: 1920 },
                { title: 'The People That Lived in Hiding', description: 'Caspian discovers the magical creatures still living in secret.', status: 'locked', questionCount: 5, startTime: 2400 },
                { title: 'Old Narnia in Danger', description: 'King Miraz learns of Caspian\'s whereabouts and threatens the Old Narnians.', status: 'locked', questionCount: 5, startTime: 2880 },
                { title: 'How They Left the Island', description: 'The children and Trumpkin begin their journey to find Caspian.', status: 'locked', questionCount: 5, startTime: 3360 },
                { title: 'What Lucy Saw', description: 'Lucy sees Aslan but the others don\'t believe her.', status: 'locked', questionCount: 5, startTime: 3840 },
                { title: 'The Return of the Lion', description: 'Aslan appears to all the children and leads them to Caspian.', status: 'locked', questionCount: 5, startTime: 4320 },
                { title: 'The Lion Roars', description: 'Aslan awakens the trees and liberates the Narnians.', status: 'locked', questionCount: 5, startTime: 4800 },
                { title: 'Sorcery and Sudden Vengeance', description: 'Nikabrik attempts to use dark magic, leading to conflict.', status: 'locked', questionCount: 5, startTime: 5280 },
                { title: 'The High King in Command', description: 'Peter takes command and challenges King Miraz to single combat.', status: 'locked', questionCount: 5, startTime: 5760 },
                { title: 'How All Were Very Busy', description: 'The final battle preparations and the duel between Peter and Miraz.', status: 'locked', questionCount: 5, startTime: 6240 },
                { title: 'Aslan Makes a Door in the Air', description: 'Caspian is crowned king and the Pevensies return to their world.', status: 'locked', questionCount: 5, startTime: 6720 }
            ]
        };

        // Î¨∏Ï†ú Îç∞Ïù¥ÌÑ∞ (Ï†ÑÏ≤¥ 15Ï±ïÌÑ∞ - ÏÉòÌîåÎ°ú Ï≤´ 5Ï±ïÌÑ∞Îßå Ìè¨Ìï®)
        const questionsData = {
            0: [ // Chapter 1: The Island
                {
                    passage: "The four children were sitting on a bench at a railway station when they felt a peculiar tugging sensation, as if someone were pulling them from behind.",
                    question: "Where were the Pevensie children when they were pulled back to Narnia?",
                    options: ["At home", "At school", "At a railway station", "In a park"],
                    correct: 2
                },
                {
                    passage: "They found themselves standing in a bright, sunny place with trees all around them and the sound of the sea quite close by.",
                    question: "What did the children hear when they first arrived?",
                    options: ["Birds singing", "The sound of the sea", "People talking", "Wind in the trees"],
                    correct: 1
                },
                {
                    passage: "Peter was the first to realize that they were no longer in England. The air smelled different, and the light had a strange, magical quality to it.",
                    question: "Who was the first to realize they were no longer in England?",
                    options: ["Lucy", "Peter", "Susan", "Edmund"],
                    correct: 1
                },
                {
                    passage: "They walked through the woods until they came to the edge and saw a sandy beach with clear blue water. It was completely deserted.",
                    question: "What did they find when they reached the edge of the woods?",
                    options: ["A village", "A sandy beach with clear blue water", "A mountain", "Another forest"],
                    correct: 1
                },
                {
                    passage: "Edmund suggested they explore the island to find fresh water and perhaps some fruit to eat, as they were all getting quite hungry and thirsty.",
                    question: "What did Edmund suggest they do?",
                    options: ["Stay where they were", "Try to go back to England", "Explore the island to find water and food", "Build a shelter"],
                    correct: 2
                }
            ],
            1: [ // Chapter 2: The Ancient Treasure Chamber
                {
                    passage: "As they explored the island, Peter noticed that some of the ruins looked familiar. The layout of the stones reminded him of something from long ago.",
                    question: "What did Peter notice about the ruins?",
                    options: ["They were completely foreign", "They looked familiar", "They were very new", "They were frightening"],
                    correct: 1
                },
                {
                    passage: "Lucy found a piece of metal that, when cleaned, revealed itself to be gold. It was part of a chess piece - a knight from a chess set they once knew well.",
                    question: "What did Lucy discover in the ruins?",
                    options: ["A golden coin", "A golden chess piece knight", "A golden crown", "A golden sword"],
                    correct: 1
                },
                {
                    passage: "Susan gasped when she realized where they were. 'This is Cair Paravel!' she exclaimed. 'This is our castle, but it's all in ruins!'",
                    question: "What did Susan realize about their location?",
                    options: ["They were lost", "They were at Cair Paravel, their old castle", "They were at a different castle", "They were still in England"],
                    correct: 1
                },
                {
                    passage: "Deep beneath the ruins, they found their treasure chamber. Their gifts from Father Christmas were still there: Peter's sword and shield, Susan's bow and horn.",
                    question: "What did they find in the treasure chamber?",
                    options: ["Nothing", "Their old gifts from Father Christmas", "Treasure belonging to someone else", "Food and water"],
                    correct: 1
                },
                {
                    passage: "The children realized that while only one year had passed in England, hundreds of years had gone by in Narnia since they had last been there.",
                    question: "How much time had passed in Narnia since their last visit?",
                    options: ["One year", "Ten years", "Hundreds of years", "No time at all"],
                    correct: 2
                }
            ],
            2: [ // Chapter 3: The Dwarf
                {
                    passage: "While exploring the mainland, the children heard the sounds of a struggle coming from across the water. Someone was fighting for their life.",
                    question: "What did the children hear from across the water?",
                    options: ["Music and laughter", "The sounds of a struggle", "Animals calling", "Complete silence"],
                    correct: 1
                },
                {
                    passage: "They saw two soldiers trying to drown a dwarf by tying him up and throwing him into the water. The dwarf was fighting bravely but was clearly losing.",
                    question: "What were the soldiers trying to do to the dwarf?",
                    options: ["Capture him alive", "Drown him", "Question him", "Help him escape"],
                    correct: 1
                },
                {
                    passage: "Peter and Edmund immediately swam out to rescue the dwarf, while Susan shot arrows to drive away the soldiers.",
                    question: "How did the children help the dwarf?",
                    options: ["They called for help", "Peter and Edmund swam to rescue him while Susan shot arrows", "They negotiated with the soldiers", "They did nothing"],
                    correct: 1
                },
                {
                    passage: "The dwarf was very suspicious of the children at first. He didn't believe they were the legendary Kings and Queens of old Narnia.",
                    question: "How did the dwarf react to the children initially?",
                    options: ["He was grateful and trusting", "He was suspicious and didn't believe them", "He was frightened and ran away", "He immediately recognized them"],
                    correct: 1
                },
                {
                    passage: "The dwarf's name was Trumpkin, and he was loyal to the true King of Narnia - a young prince who was fighting against the usurper Miraz.",
                    question: "What was the dwarf's name and who was he loyal to?",
                    options: ["Nikabrik, loyal to Miraz", "Trumpkin, loyal to a young prince fighting Miraz", "Glenstorm, loyal to the White Witch", "Trufflehunter, loyal to no one"],
                    correct: 1
                }
            ],
            3: [ // Chapter 4: The Dwarf Tells of Prince Caspian
                {
                    passage: "Trumpkin told them about Prince Caspian, the rightful heir to the throne, whose uncle Miraz had stolen the crown and now ruled as a tyrant.",
                    question: "Who was Prince Caspian according to Trumpkin?",
                    options: ["A rebel against the rightful king", "The rightful heir whose uncle stole his throne", "Miraz's son", "A foreign prince"],
                    correct: 1
                },
                {
                    passage: "King Miraz had killed Caspian's father and planned to kill Caspian too, but the prince's tutor, Doctor Cornelius, helped him escape in the night.",
                    question: "Why did Caspian have to escape?",
                    options: ["He wanted to explore", "Miraz planned to kill him", "He was banished for a crime", "He was afraid of responsibility"],
                    correct: 1
                },
                {
                    passage: "Doctor Cornelius had secretly taught Caspian about the old days of Narnia, when animals could talk and the land was ruled by the four children from another world.",
                    question: "What had Doctor Cornelius taught Caspian about?",
                    options: ["Magic spells", "The old days of Narnia when animals could talk", "How to fight with a sword", "The geography of other countries"],
                    correct: 1
                },
                {
                    passage: "Caspian had blown Queen Susan's magic horn to call for help, which was how the Pevensie children had been brought back to Narnia.",
                    question: "How were the Pevensie children brought back to Narnia?",
                    options: ["They used a magic ring", "Aslan called them", "Caspian blew Queen Susan's magic horn", "They found another wardrobe"],
                    correct: 2
                },
                {
                    passage: "The Old Narnians - talking animals, dwarfs, and other magical creatures - had come out of hiding to support Prince Caspian's claim to the throne.",
                    question: "Who supported Prince Caspian's claim to the throne?",
                    options: ["King Miraz's army", "The Old Narnians - talking animals, dwarfs, and magical creatures", "Foreign armies", "No one"],
                    correct: 1
                }
            ],
            4: [ // Chapter 5: Caspian's Adventure in the Mountains
                {
                    passage: "When Caspian fled into the mountains, he was injured and exhausted. He fell from his horse and was found by two dwarfs and a badger.",
                    question: "Who found Caspian when he was injured in the mountains?",
                    options: ["Soldiers from Miraz", "Two dwarfs and a badger", "A group of centaurs", "Doctor Cornelius"],
                    correct: 1
                },
                {
                    passage: "The badger's name was Trufflehunter, and he immediately recognized Caspian as the rightful king. 'You are the true King,' he said solemnly.",
                    question: "What did Trufflehunter say to Caspian?",
                    options: ["You must prove yourself", "You are the true King", "You should return to your uncle", "You are not welcome here"],
                    correct: 1
                },
                {
                    passage: "The two dwarfs, Nikabrik and Trumpkin, were more skeptical. They had been disappointed by humans before and weren't sure they could trust another one.",
                    question: "How did the two dwarfs feel about Caspian?",
                    options: ["They immediately trusted him", "They were skeptical and unsure they could trust him", "They were hostile and aggressive", "They ignored him completely"],
                    correct: 1
                },
                {
                    passage: "Caspian was amazed to discover that the old stories were true - animals really could talk, and many other magical creatures still lived in Narnia.",
                    question: "What amazed Caspian about his new companions?",
                    options: ["They were very strong fighters", "The old stories were true - animals could really talk", "They had hidden treasure", "They knew where Miraz was hiding"],
                    correct: 1
                },
                {
                    passage: "The three creatures decided to help Caspian gather support from other Old Narnians who had been living in secret throughout the land.",
                    question: "What did the creatures decide to do for Caspian?",
                    options: ["Hide him from Miraz forever", "Help him gather support from other Old Narnians", "Take him back to his uncle", "Teach him magic"],
                    correct: 1
                }
            ]
            // Note: ÎÇòÎ®∏ÏßÄ Ï±ïÌÑ∞Îì§(5-14)Ïùò Î¨∏Ï†úÎäî Í≥µÍ∞ÑÏÉÅ ÏÉùÎûµÌïòÍ≥† Ï≤´ 5Ï±ïÌÑ∞Îßå Ìè¨Ìï®
            // Ïã§Ï†ú Íµ¨ÌòÑÏãúÏóêÎäî Î™®Îì† 15Ï±ïÌÑ∞Ïùò Î¨∏Ï†úÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§
        };

        // Ï†ÑÏó≠ Î≥ÄÏàò
        let currentChapterIndex = 0;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let questions = [];
        let currentAudio = null;
        let playbackSpeed = 1.0;

        // üéß ÏûêÎèô Ïò§ÎîîÏò§ URL ÏÉùÏÑ± Ìï®Ïàò
        function getAudioUrl(chapterIndex) {
            const level = 'level3';
            const bookId = 'PC001';
            const chapterNum = String(chapterIndex + 1).padStart(2, '0');

            const possibleFileNames = [
                `${bookId}_chapter${chapterNum}.mp3`,
                `${bookId}_ch${chapterNum}.mp3`,
                `${bookId}_${chapterNum}.mp3`,
                `prince_caspian_chapter${chapterNum}.mp3`,
                `prince_caspian_ch${chapterNum}.mp3`,
                `prince_caspian_${chapterNum}.mp3`,
                `narnia_pc_chapter${chapterNum}.mp3`,
                `${bookId}.mp3`
            ];

            return {
                primary: `${AUDIO_BASE_URL}${level}/${possibleFileNames[0]}`,
                alternatives: possibleFileNames.map(fileName => `${AUDIO_BASE_URL}${level}/${fileName}`)
            };
        }

        // üéß Ïò§ÎîîÏò§ Ïû¨ÏÉù Ìï®Ïàò
        function playChapterAudio(chapterIndex) {
            const chapter = bookData.chapterList[chapterIndex];
            const audioUrls = getAudioUrl(chapterIndex);

            document.getElementById('audio-modal').style.display = 'flex';
            document.getElementById('audio-chapter-title').textContent = `Chapter ${chapterIndex + 1}: ${chapter.title}`;
            document.getElementById('audio-chapter-subtitle').textContent = `${bookData.title} - ${bookData.author}`;

            // Ïò§ÎîîÏò§ Ï†ïÎ≥¥ ÏòÅÏó≠ Îã§Ïãú Î≥¥Ïù¥Í∏∞ (ÏÉàÎ°úÏö¥ Ïò§ÎîîÏò§ ÌîåÎ†àÏù¥Ïãú)
            document.getElementById('audio-info').classList.remove('hidden');

            const audioPlayer = document.getElementById('audio-player');
            const audioSource = document.getElementById('audio-source');
            const audioStatus = document.getElementById('audio-status');

            audioStatus.textContent = 'üîÑ Ïò§ÎîîÏò§ ÌååÏùºÏùÑ Ï∞æÎäî Ï§ë...';

            function tryLoadAudio(urlIndex = 0) {
                if (urlIndex >= audioUrls.alternatives.length) {
                    audioStatus.innerHTML = `‚ùå Ïò§ÎîîÏò§ ÌååÏùºÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.`;
                    return;
                }

                const currentUrl = audioUrls.alternatives[urlIndex];
                audioSource.src = currentUrl;
                audioPlayer.load();

                const successHandler = function() {
                    const startTime = chapter.startTime || 0;
                    audioPlayer.currentTime = startTime;
                    audioStatus.innerHTML = `‚úÖ Ïò§ÎîîÏò§ Ï§ÄÎπÑ ÏôÑÎ£å!`;
                };

                const errorHandler = function() {
                    setTimeout(() => tryLoadAudio(urlIndex + 1), 100);
                };

                audioPlayer.addEventListener('canplaythrough', successHandler, { once: true });
                audioPlayer.addEventListener('error', errorHandler, { once: true });
            }

            tryLoadAudio(0);
            currentAudio = audioPlayer;
            playbackSpeed = 1.0;
        }

        // Í∏∞Î≥∏ Ìï®ÏàòÎì§
        function closeAudioModal() {
            document.getElementById('audio-modal').style.display = 'none';
            if (currentAudio) currentAudio.pause();
        }

        function togglePlayPause() {
            if (!currentAudio) return;
            if (currentAudio.paused) {
                currentAudio.play();
                document.querySelector('.play-pause-btn').textContent = '‚è∏Ô∏è ÏùºÏãúÏ†ïÏßÄ';
            } else {
                currentAudio.pause();
                document.querySelector('.play-pause-btn').textContent = '‚ñ∂Ô∏è Ïû¨ÏÉù';
            }
        }

        function changeSpeed() {
            if (!currentAudio) return;
            const speeds = [0.5, 0.75, 1.0, 1.25, 1.5, 2.0];
            const currentIndex = speeds.indexOf(playbackSpeed);
            playbackSpeed = speeds[(currentIndex + 1) % speeds.length];
            currentAudio.playbackRate = playbackSpeed;
            document.querySelector('.speed-btn').textContent = `${playbackSpeed}x`;
        }

        function resetToChapterStart() {
            if (!currentAudio) return;
            const currentChapter = parseInt(document.getElementById('audio-chapter-title').textContent.match(/Chapter (\d+)/)[1]) - 1;
            currentAudio.currentTime = bookData.chapterList[currentChapter]?.startTime || 0;
        }

        function downloadAudio() {
            const audioSource = document.getElementById('audio-source');
            if (audioSource.src) {
                const link = document.createElement('a');
                link.href = audioSource.src;
                link.download = `${document.getElementById('audio-chapter-title').textContent}.mp3`;
                link.click();
            }
        }

        // Ï±Ö ÏÉÅÏÑ∏ Ï†ïÎ≥¥ ÌëúÏãú
        function showBookDetail() {
            document.getElementById('book-detail-screen').style.display = 'block';
            document.getElementById('learning-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'none';
            generateChapterGrid();
            updateProgress();
        }

        // Ï±ïÌÑ∞ Í∑∏Î¶¨Îìú ÏÉùÏÑ±
        function generateChapterGrid() {
            const grid = document.getElementById('chapters-grid');
            grid.innerHTML = '';

            bookData.chapterList.forEach((chapter, index) => {
                const chapterCard = document.createElement('div');
                chapterCard.className = `chapter-card ${chapter.status}`;

                chapterCard.innerHTML = `
                    <div class="chapter-header">
                        <div class="chapter-info">
                            <h4>Chapter ${index + 1}: ${chapter.title}</h4>
                            <p>${chapter.description} (${chapter.questionCount}Î¨∏Ï†ú)</p>
                        </div>
                        <div class="chapter-status ${chapter.status}">
                            ${chapter.status === 'completed' ? '‚úÖ ÏôÑÎ£å' :
                              chapter.status === 'current' ? 'üìñ ÏßÑÌñâÏ§ë' : 'üîí Ïû†ÍπÄ'}
                        </div>
                    </div>
                    <div class="chapter-actions">
                        <button class="chapter-btn audio-btn" onclick="playChapterAudio(${index})"
                                ${chapter.status === 'locked' ? 'disabled' : ''}>
                            üéß Ïò§ÎîîÏò§
                        </button>
                        <button class="chapter-btn quiz-btn" onclick="startLearning(${index})"
                                ${chapter.status === 'locked' ? 'disabled' : ''}>
                            üìù Î¨∏Ï†úÌíÄÍ∏∞
                        </button>
                    </div>
                `;

                grid.appendChild(chapterCard);
            });
        }

        // ÏßÑÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
        function updateProgress() {
            const completedChapters = bookData.chapterList.filter(chapter => chapter.status === 'completed').length;
            const progress = Math.round((completedChapters / bookData.chapters) * 100);
            document.getElementById('progress-value').textContent = progress + '%';
        }

        // ÌïôÏäµ ÏãúÏûë
        function startLearning(chapterIndex) {
            currentChapterIndex = chapterIndex;
            currentQuestionIndex = 0;
            userAnswers = [];
            questions = questionsData[chapterIndex];

            if (!questions || questions.length === 0) {
                alert('Ïù¥ Ï±ïÌÑ∞Ïùò Î¨∏Ï†úÍ∞Ä ÏïÑÏßÅ Ï§ÄÎπÑÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                return;
            }

            document.getElementById('book-detail-screen').style.display = 'none';
            document.getElementById('learning-screen').style.display = 'block';
            document.getElementById('result-screen').style.display = 'none';

            const chapter = bookData.chapterList[chapterIndex];
            document.getElementById('learning-title').textContent = `Chapter ${chapterIndex + 1}: ${chapter.title}`;
            document.getElementById('learning-chapter-breadcrumb').textContent = `Chapter ${chapterIndex + 1}`;

            showQuestion();
            updateLearningProgress();
        }

        // Î¨∏Ï†ú ÌëúÏãú
        function showQuestion() {
            const question = questions[currentQuestionIndex];
            const container = document.getElementById('question-container');

            container.innerHTML = `
                <div class="question-text">Î¨∏Ï†ú ${currentQuestionIndex + 1}</div>
                <div class="passage">${question.passage}</div>
                <div class="question-text">${question.question}</div>
                <div class="options">
                    ${question.options.map((option, index) =>
                        `<div class="option" onclick="selectOption(${index})" data-index="${index}">
                            ${String.fromCharCode(65 + index)}. ${option}
                        </div>`
                    ).join('')}
                </div>
            `;

            if (userAnswers[currentQuestionIndex] !== undefined) {
                const selectedOption = container.querySelector(`[data-index="${userAnswers[currentQuestionIndex]}"]`);
                if (selectedOption) selectedOption.classList.add('selected');
            }

            updateNavigationButtons();
        }

        // ÏÑ†ÌÉùÏßÄ ÏÑ†ÌÉù
        function selectOption(optionIndex) {
            document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
            document.querySelector(`[data-index="${optionIndex}"]`).classList.add('selected');
            userAnswers[currentQuestionIndex] = optionIndex;
            updateNavigationButtons();
        }

        // ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò
        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                showQuestion();
                updateLearningProgress();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion();
                updateLearningProgress();
            }
        }

        function updateLearningProgress() {
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('learning-progress-bar').style.width = progress + '%';
            document.getElementById('learning-progress-text').textContent = `Î¨∏Ï†ú ${currentQuestionIndex + 1} / ${questions.length}`;
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const submitBtn = document.getElementById('submit-btn');

            prevBtn.disabled = currentQuestionIndex === 0;

            if (currentQuestionIndex === questions.length - 1) {
                nextBtn.style.display = 'none';
                submitBtn.style.display = 'block';
                submitBtn.disabled = userAnswers[currentQuestionIndex] === undefined;
            } else {
                nextBtn.style.display = 'block';
                submitBtn.style.display = 'none';
                nextBtn.disabled = userAnswers[currentQuestionIndex] === undefined;
            }
        }

        // ÎãµÏïà Ï†úÏ∂ú
        function submitAnswers() {
            let correctCount = 0;
            questions.forEach((question, index) => {
                if (userAnswers[index] === question.correct) correctCount++;
            });

            const score = Math.round((correctCount / questions.length) * 100);

            if (score >= 70) {
                bookData.chapterList[currentChapterIndex].status = 'completed';
                if (currentChapterIndex < bookData.chapterList.length - 1) {
                    bookData.chapterList[currentChapterIndex + 1].status = 'current';
                }
            }

            showResults(correctCount, questions.length, score);
        }

        // Í≤∞Í≥º ÌëúÏãú
        function showResults(correct, total, score) {
            document.getElementById('learning-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';

            document.getElementById('score-circle').textContent = score + '%';
            document.getElementById('total-questions').textContent = total + 'Î¨∏Ï†ú';
            document.getElementById('correct-answers').textContent = correct + 'Î¨∏Ï†ú';
            document.getElementById('wrong-answers').textContent = (total - correct) + 'Î¨∏Ï†ú';
            document.getElementById('final-score').textContent = score + 'Ï†ê';

            let message = '';
            if (score >= 90) message = 'ÌõåÎ•≠Ìï©ÎãàÎã§! üåü';
            else if (score >= 80) message = 'ÏûòÌñàÏñ¥Ïöî! üëè';
            else if (score >= 70) message = 'Ï¢ãÏïÑÏöî! üëç';
            else message = 'Îã§Ïãú ÌïúÎ≤à ÎèÑÏ†ÑÌï¥Î≥¥ÏÑ∏Ïöî! üí™';

            document.getElementById('result-message').textContent = message;
        }

        function retryChapter() {
            startLearning(currentChapterIndex);
        }

        function nextChapter() {
            if (currentChapterIndex < bookData.chapterList.length - 1) {
                startLearning(currentChapterIndex + 1);
            } else {
                alert('Î™®Îì† Ï±ïÌÑ∞Î•º ÏôÑÎ£åÌñàÏäµÎãàÎã§! üéâ');
                showBookDetail();
            }
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú
        window.addEventListener('load', function() {
            showBookDetail();
            console.log('üéØ Prince Caspian ÌïôÏäµ ÏãúÏä§ÌÖúÏù¥ Ï§ÄÎπÑÎêòÏóàÏäµÎãàÎã§!');
        });

        // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠Ïãú Îã´Í∏∞
        document.getElementById('audio-modal').addEventListener('click', function(e) {
            if (e.target === this) closeAudioModal();
        });
    </script>
</body>
</html>
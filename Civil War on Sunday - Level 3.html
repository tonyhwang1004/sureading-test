<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Civil War on Sunday - Level 3 - ÏàòÎ¶¨Îî©Ïñ¥ÌïôÏõê</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #191970 0%, #4169E1 50%, #87CEEB 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        /* Ìó§Îçî */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #191970, #4169E1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .logo-text h1 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
        }

        .logo-text p {
            font-size: 0.9rem;
            color: #666;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
            color: #333;
            text-decoration: none;
        }

        .nav-btn:hover {
            background: #191970;
            color: white;
            transform: translateY(-2px);
        }

        /* Î©îÏù∏ ÏΩòÌÖêÏ∏† ÏòÅÏó≠ */
        .main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            min-height: 600px;
        }

        /* Ï±Ö ÏÉÅÏÑ∏ ÌôîÎ©¥ */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 30px;
            font-size: 0.9rem;
            color: #666;
        }

        .breadcrumb a {
            color: #191970;
            text-decoration: none;
            cursor: pointer;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .book-detail-header {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: flex-start;
        }

        .detail-book-cover {
            width: 150px;
            height: 220px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 4rem;
            font-weight: bold;
            flex-shrink: 0;
            background: linear-gradient(45deg, #191970, #4169E1);
        }

        .book-info {
            flex: 1;
        }

        .book-info h2 {
            font-size: 2.2rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .book-info .author {
            font-size: 1.2rem;
            color: #191970;
            margin-bottom: 20px;
        }

        .book-summary {
            font-size: 1rem;
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .book-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-box .value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #191970;
        }

        .stat-box .label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        /* Ï±ïÌÑ∞ Í∑∏Î¶¨Îìú */
        .chapters-section {
            margin-top: 40px;
        }

        .chapters-section h3 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 30px;
            text-align: center;
        }

        .chapters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .chapter-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
        }

        .chapter-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .chapter-card.completed {
            border-color: #28a745;
            background: linear-gradient(135deg, #28a74508, #ffffff);
        }

        .chapter-card.current {
            border-color: #191970;
            background: linear-gradient(135deg, #19197008, #ffffff);
        }

        .chapter-card.locked {
            opacity: 0.6;
            background: #f8f9fa;
        }

        .chapter-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .chapter-info h4 {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }

        .chapter-info p {
            font-size: 0.95rem;
            color: #666;
            line-height: 1.5;
        }

        .chapter-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .chapter-status.completed {
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
        }

        .chapter-status.current {
            background: rgba(25, 25, 112, 0.1);
            color: #191970;
        }

        .chapter-status.locked {
            background: rgba(108, 117, 125, 0.1);
            color: #6c757d;
        }

        .chapter-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .chapter-btn {
            padding: 12px 16px;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .audio-btn {
            background: linear-gradient(45deg, #191970, #4169E1);
            color: white;
        }

        .quiz-btn {
            background: linear-gradient(45deg, #4169E1, #87CEEB);
            color: white;
        }

        .chapter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .chapter-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* ÌïôÏäµ ÌôîÎ©¥ */
        .learning-screen {
            display: none;
        }

        .learning-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .learning-progress {
            background: #f8f9fa;
            border-radius: 10px;
            height: 8px;
            margin: 20px 0;
            overflow: hidden;
        }

        .learning-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #191970, #4169E1);
            transition: width 0.3s ease;
        }

        .question-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
        }

        .passage {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1rem;
            line-height: 1.6;
            color: #444;
        }

        .options {
            display: grid;
            gap: 10px;
        }

        .option {
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option:hover {
            background: #e9ecef;
            border-color: #191970;
        }

        .option.selected {
            background: rgba(25, 25, 112, 0.1);
            border-color: #191970;
        }

        .learning-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .control-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .next-btn {
            background: linear-gradient(45deg, #191970, #4169E1);
            color: white;
        }

        .prev-btn {
            background: #6c757d;
            color: white;
        }

        .submit-btn {
            background: linear-gradient(45deg, #191970, #4169E1);
            color: white;
        }

        .control-btn:hover {
            transform: translateY(-2px);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Í≤∞Í≥º ÌôîÎ©¥ */
        .result-screen {
            display: none;
            text-align: center;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(45deg, #191970, #4169E1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            font-size: 2rem;
            font-weight: bold;
        }

        .result-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .result-stat {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .result-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        /* Ïò§ÎîîÏò§ ÌîåÎ†àÏù¥Ïñ¥ Î™®Îã¨ */
        .audio-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .audio-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 600px;
            width: 90%;
            position: relative;
        }

        .close-audio {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #666;
        }

        .audio-player {
            width: 100%;
            margin: 20px 0;
            border-radius: 10px;
        }

        .audio-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .audio-control-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .play-pause-btn {
            background: linear-gradient(45deg, #191970, #4169E1);
            color: white;
        }

        .speed-btn {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #ddd;
        }

        .download-btn {
            background: #4169E1;
            color: white;
        }

        .audio-info {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            font-size: 0.9rem;
            color: #666;
            transition: all 0.3s ease;
        }

        .audio-info.hidden {
            display: none;
        }

        /* Î∞òÏùëÌòï */
        @media (max-width: 768px) {
            .chapters-grid {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .book-detail-header {
                flex-direction: column;
                text-align: center;
            }

            .book-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .learning-controls {
                flex-direction: column;
            }

            .chapter-actions {
                grid-template-columns: 1fr;
            }

            .audio-controls {
                justify-content: center;
                gap: 10px;
            }

            .audio-content {
                padding: 30px 20px;
            }
        }

        .new-book-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: linear-gradient(45deg, #FF6B9D, #C44569);
            color: white;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: 700;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Level 4 ÌäπÎ≥Ñ Ïä§ÌÉÄÏùº */
        .level-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: linear-gradient(45deg, #DC143C, #FF69B4);
            color: white;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ìó§Îçî -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">üé©</div>
                <div class="logo-text">
                    <h1>Civil War on Sunday</h1>
                    <p>Level 4 - Mary Pope OsborneÏùò Îß§ÏßÅ Ìä∏Î¶¨ ÌïòÏö∞Ïä§ 21Í∂å</p>
                </div>
            </div>
            <div class="nav-buttons">
                <a href="http://www.suelibrary.store/" class="nav-btn">Î©îÏù∏ÏúºÎ°ú</a>
            </div>
        </div>

        <!-- Î©îÏù∏ ÏΩòÌÖêÏ∏† -->
        <div class="main-content">
            <!-- Ï±Ö ÏÉÅÏÑ∏ ÌôîÎ©¥ -->
            <div class="book-detail-screen" id="book-detail-screen">
                <div class="level-badge">Level 4</div>
                <div class="breadcrumb">
                    <span>Civil War on Sunday</span>
                </div>

                <div class="book-detail-header">
                    <div class="detail-book-cover">üé©</div>
                    <div class="book-info">
                        <h2>Civil War on Sunday</h2>
                        <div class="author">Mary Pope Osborne</div>
                        <div class="book-summary">
                            Jack and Annie travel to the American Civil War era to complete a mission for Camelot! They must help during the Battle of Bull Run, learn about the tragic divisions in American society, and understand the courage of those who worked to heal the nation. Meet Clara Barton and witness the birth of the American Red Cross.
                        </div>
                        <div class="book-stats">
                            <div class="stat-box">
                                <div class="value">10</div>
                                <div class="label">Ï±ïÌÑ∞</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">50</div>
                                <div class="label">Ï¥ù Î¨∏Ï†ú</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">Level 4</div>
                                <div class="label">Î†àÎ≤®</div>
                            </div>
                            <div class="stat-box">
                                <div class="value" id="progress-value">0%</div>
                                <div class="label">ÏßÑÎèÑ</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="chapters-section">
                    <h3>üé© Ï±ïÌÑ∞Î≥Ñ ÌïôÏäµ</h3>
                    <div class="chapters-grid" id="chapters-grid">
                        <!-- Ï±ïÌÑ∞ Ïπ¥ÎìúÎì§ -->
                    </div>
                </div>
            </div>

            <!-- ÌïôÏäµ ÌôîÎ©¥ -->
            <div class="learning-screen" id="learning-screen">
                <div class="breadcrumb">
                    <a onclick="showBookDetail()">Civil War on Sunday</a>
                    <span>></span>
                    <span id="learning-chapter-breadcrumb">Chapter 1</span>
                </div>

                <div class="learning-header">
                    <h2 id="learning-title">Chapter 1: A New Mission</h2>
                    <div class="learning-progress">
                        <div class="learning-progress-bar" id="learning-progress-bar" style="width: 0%"></div>
                    </div>
                    <p id="learning-progress-text">Î¨∏Ï†ú 1 / 5</p>
                </div>

                <div class="question-container" id="question-container">
                    <!-- Î¨∏Ï†úÍ∞Ä ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
                </div>

                <div class="learning-controls">
                    <button class="control-btn prev-btn" id="prev-btn" onclick="previousQuestion()" disabled>Ïù¥Ï†Ñ</button>
                    <button class="control-btn next-btn" id="next-btn" onclick="nextQuestion()">Îã§Ïùå</button>
                    <button class="control-btn submit-btn" id="submit-btn" onclick="submitAnswers()" style="display: none;">Ï†úÏ∂ú</button>
                </div>
            </div>

            <!-- Í≤∞Í≥º ÌôîÎ©¥ -->
            <div class="result-screen" id="result-screen">
                <div class="breadcrumb">
                    <a onclick="showBookDetail()">Civil War on Sunday</a>
                    <span>></span>
                    <span>Í≤∞Í≥º</span>
                </div>

                <div class="result-header">
                    <h2>üéâ ÌïôÏäµ ÏôÑÎ£å!</h2>
                    <div class="score-circle" id="score-circle">100%</div>
                    <h3 id="result-message">ÌõåÎ•≠Ìï©ÎãàÎã§!</h3>
                </div>

                <div class="result-details">
                    <div class="result-stat">
                        <h4>Ï¥ù Î¨∏Ï†ú</h4>
                        <p id="total-questions">5Î¨∏Ï†ú</p>
                    </div>
                    <div class="result-stat">
                        <h4>Ï†ïÎãµ</h4>
                        <p id="correct-answers">5Î¨∏Ï†ú</p>
                    </div>
                    <div class="result-stat">
                        <h4>Ïò§Îãµ</h4>
                        <p id="wrong-answers">0Î¨∏Ï†ú</p>
                    </div>
                    <div class="result-stat">
                        <h4>Ï†êÏàò</h4>
                        <p id="final-score">100Ï†ê</p>
                    </div>
                </div>

                <div class="result-actions">
                    <button class="control-btn prev-btn" onclick="retryChapter()">Îã§Ïãú ÌíÄÍ∏∞</button>
                    <button class="control-btn next-btn" onclick="nextChapter()">Îã§Ïùå Ï±ïÌÑ∞</button>
                    <button class="control-btn submit-btn" onclick="showBookDetail()">Ï±ïÌÑ∞ Î™©Î°ù</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ïò§ÎîîÏò§ ÌîåÎ†àÏù¥Ïñ¥ Î™®Îã¨ -->
    <div class="audio-modal" id="audio-modal">
        <div class="audio-content">
            <button class="close-audio" onclick="closeAudioModal()">√ó</button>
            <h3 id="audio-chapter-title">Chapter 1: A New Mission</h3>
            <p id="audio-chapter-subtitle">Civil War on Sunday - Mary Pope Osborne</p>

            <audio class="audio-player" id="audio-player" controls preload="metadata">
                <source id="audio-source" src="" type="audio/mpeg">
                Î∏åÎùºÏö∞Ï†ÄÍ∞Ä Ïò§ÎîîÏò§Î•º ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.
            </audio>

            <div class="audio-controls">
                <button class="audio-control-btn play-pause-btn" onclick="togglePlayPause()">‚ñ∂Ô∏è Ïû¨ÏÉù</button>
                <button class="audio-control-btn speed-btn" onclick="changeSpeed()">1.0x</button>
                <button class="audio-control-btn" onclick="resetToChapterStart()" style="background: #28a745; color: white;">üîÑ Íµ¨Í∞ÑÏ≤òÏùå</button>
                <button class="audio-control-btn download-btn" onclick="downloadAudio()">üì• Îã§Ïö¥Î°úÎìú</button>
            </div>

            <div class="audio-info" id="audio-info">
                <div id="audio-status" style="margin-top: 10px; font-weight: bold; color: #191970;"></div>
            </div>
        </div>
    </div>

    <script>
        // üéØ Íµ¨Í∏Ä ÌÅ¥ÎùºÏö∞Îìú Ïä§ÌÜ†Î¶¨ÏßÄ Ïò§ÎîîÏò§ URL ÏÑ§Ï†ï
        const AUDIO_BASE_URL = 'https://storage.googleapis.com/kim-mom-reading-audio/audio/';

        // Magic Tree House 21Í∂å ÎèÑÏÑú Îç∞Ïù¥ÌÑ∞ (10Ï±ïÌÑ∞)
        const bookData = {
            id: 'MTH021',
            title: "Civil War on Sunday",
            author: 'Mary Pope Osborne',
            cover: 'üé©',
            progress: 0,
            chapters: 10,
            totalQuestions: 50, // 10Ï±ïÌÑ∞ √ó 5Î¨∏Ï†ú
            coverColor: 'linear-gradient(45deg, #191970, #4169E1)',
            summary: "Jack and Annie travel to the American Civil War era to complete a mission for Camelot! They must help during the Battle of Bull Run, learn about the tragic divisions in American society, and understand the courage of those who worked to heal the nation. Meet Clara Barton and witness the birth of the American Red Cross.",
            chapterList: [
                { title: 'A New Mission', description: 'Jack and Annie receive a mission to help during the American Civil War.', status: 'current', questionCount: 5, startTime: 0 },
                { title: 'Hurry Up!', description: 'They rush to get to the Civil War battlefield before it\'s too late.', status: 'locked', questionCount: 5, startTime: 300 },
                { title: 'Blue and Gray', description: 'They observe the Union and Confederate armies preparing for battle.', status: 'locked', questionCount: 5, startTime: 600 },
                { title: 'Real Soldiers', description: 'They meet real soldiers from both sides of the conflict.', status: 'locked', questionCount: 5, startTime: 900 },
                { title: 'Angel of the Battlefield', description: 'They encounter Clara Barton, the famous Civil War nurse.', status: 'locked', questionCount: 5, startTime: 1200 },
                { title: 'Keep Low!', description: 'The Battle of Bull Run begins and they help wounded soldiers.', status: 'locked', questionCount: 5, startTime: 1500 },
                { title: 'Brothers', description: 'They discover that the war has divided families and friends.', status: 'locked', questionCount: 5, startTime: 1800 },
                { title: 'The Retreat', description: 'The Union army retreats and they help with the wounded.', status: 'locked', questionCount: 5, startTime: 2100 },
                { title: 'Home', description: 'They help Clara Barton establish what will become the Red Cross.', status: 'locked', questionCount: 5, startTime: 2400 },
                { title: 'Sunday in Frog Creek', description: 'They return home with a deeper understanding of war and peace.', status: 'locked', questionCount: 5, startTime: 2700 }
            ]
        };

        // Î¨∏Ï†ú Îç∞Ïù¥ÌÑ∞ (Ï†ÑÏ≤¥ 10Ï±ïÌÑ∞ ÏôÑÎ£å)
        const questionsData = {
            0: [ // Chapter 1: A New Mission
                {
                    passage: "Jack and Annie discovered a new scroll in the tree house with a message from Morgan le Fay, asking them to help during a difficult time in American history.",
                    question: "What did Jack and Annie find in the tree house?",
                    options: ["A history book", "A new scroll from Morgan asking them to help during difficult American history", "A map of Europe", "A letter from home"],
                    correct: 1
                },
                {
                    passage: "The scroll explained that they needed to travel to the American Civil War to complete a mission that would help heal the divisions in the country.",
                    question: "What war were they asked to help with and why?",
                    options: ["World War I for victory", "American Civil War to help heal divisions in the country", "Revolutionary War for independence", "War of 1812 for territory"],
                    correct: 1
                },
                {
                    passage: "Morgan's message emphasized that their mission was not to change history, but to witness courage and compassion during America's darkest hour.",
                    question: "What was the purpose of their Civil War mission?",
                    options: ["To change the outcome", "To witness courage and compassion during America's darkest hour", "To fight in battles", "To meet famous generals"],
                    correct: 1
                },
                {
                    passage: "Jack felt nervous about visiting such a violent and tragic period, while Annie was determined to help however they could.",
                    question: "How did Jack and Annie feel about the Civil War mission?",
                    options: ["Both were excited", "Jack felt nervous about the violence, Annie determined to help", "Both were scared", "Annie was nervous, Jack excited"],
                    correct: 1
                },
                {
                    passage: "The research book showed them pictures of the Civil War, with its blue and gray uniforms, battlefield hospitals, and the profound sadness of a nation divided.",
                    question: "What did the research book show them about the Civil War?",
                    options: ["Happy celebrations", "Blue and gray uniforms, battlefield hospitals, and a divided nation's sadness", "Peaceful negotiations", "Economic prosperity"],
                    correct: 1
                }
            ],
            1: [ // Chapter 2: Hurry Up!
                {
                    passage: "Jack and Annie found themselves near a Civil War battlefield on a hot Sunday morning in July 1861, with the sounds of marching and military preparations filling the air.",
                    question: "When and where did Jack and Annie arrive?",
                    options: ["A peaceful farm", "Near a Civil War battlefield on a hot Sunday morning in July 1861", "In a modern city", "At a colonial settlement"],
                    correct: 1
                },
                {
                    passage: "They could see thousands of soldiers in blue Union uniforms and gray Confederate uniforms getting ready for what would become the First Battle of Bull Run.",
                    question: "What were the soldiers preparing for?",
                    options: ["A parade", "The First Battle of Bull Run with Union blue and Confederate gray uniforms", "A training exercise", "A peace treaty signing"],
                    correct: 1
                },
                {
                    passage: "Many of the soldiers were young men who had never been in battle before, and some seemed excited while others looked worried and homesick.",
                    question: "What did Jack and Annie observe about the soldiers?",
                    options: ["All were experienced veterans", "Many were young, never in battle, some excited, others worried and homesick", "All were old and tired", "Everyone was confident"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie realized that this was the beginning of a war that would last four years and cost hundreds of thousands of lives.",
                    question: "What did Jack and Annie realize about this battle?",
                    options: ["It would end the war quickly", "It was the beginning of a four-year war costing hundreds of thousands of lives", "It was just a small skirmish", "It would solve everything peacefully"],
                    correct: 1
                },
                {
                    passage: "They felt the weight of history as they witnessed the start of America's bloodiest conflict, knowing they needed to find their way to help somehow.",
                    question: "How did Jack and Annie feel about witnessing this historic moment?",
                    options: ["Bored and uninterested", "They felt the weight of history and need to help during America's bloodiest conflict", "Happy and excited", "Confused about where they were"],
                    correct: 1
                }
            ],
            2: [ // Chapter 3: Blue and Gray
                {
                    passage: "Jack and Annie observed the stark contrast between the Union soldiers in blue uniforms and the Confederate soldiers in gray, representing a nation torn apart.",
                    question: "What contrast did Jack and Annie observe?",
                    options: ["Rich and poor people", "Union soldiers in blue and Confederate soldiers in gray, a nation torn apart", "Old and young soldiers", "Officers and enlisted men"],
                    correct: 1
                },
                {
                    passage: "They learned that many of these soldiers were fighting against neighbors, former friends, and sometimes even family members who had chosen the opposite side.",
                    question: "What tragic aspect of the Civil War did they learn about?",
                    options: ["Lack of food", "Soldiers fighting against neighbors, friends, and family on opposite sides", "Bad weather conditions", "Poor weapons"],
                    correct: 1
                },
                {
                    passage: "The Union soldiers believed they were fighting to preserve the United States and end slavery, while Confederate soldiers thought they were defending their homeland and way of life.",
                    question: "What did each side believe they were fighting for?",
                    options: ["Money and land", "Union: preserve US and end slavery; Confederate: defend homeland and way of life", "Religious differences", "Trade disputes"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie saw that both sides had brave men who loved their families and believed in their cause, making the conflict even more tragic.",
                    question: "What made the Civil War conflict especially tragic according to Jack and Annie?",
                    options: ["Poor leadership", "Both sides had brave men who loved families and believed in their cause", "Bad equipment", "Lack of medical care"],
                    correct: 1
                },
                {
                    passage: "They began to understand that civil wars are the most heartbreaking of all conflicts because they divide people who once shared the same country and values.",
                    question: "What did Jack and Annie learn about civil wars?",
                    options: ["They are easy to resolve", "They are most heartbreaking because they divide people who shared country and values", "They don't affect civilians", "They end quickly"],
                    correct: 1
                }
            ],
            3: [ // Chapter 4: Real Soldiers
                {
                    passage: "Jack and Annie met young soldiers from both armies who shared stories about their families back home and their hopes for the future.",
                    question: "What did the soldiers share with Jack and Annie?",
                    options: ["Military strategies", "Stories about families back home and hopes for the future", "Complaints about officers", "Plans to desert"],
                    correct: 1
                },
                {
                    passage: "A Union soldier named Tom showed them a photograph of his wife and baby daughter, explaining that he was fighting to give them a better future.",
                    question: "Why was Union soldier Tom fighting according to what he told them?",
                    options: ["For adventure", "To give his wife and baby daughter a better future", "Because he was forced to", "For money"],
                    correct: 1
                },
                {
                    passage: "A Confederate soldier named Billy talked about his farm in Virginia and how he worried about his elderly parents managing without him.",
                    question: "What did Confederate soldier Billy worry about?",
                    options: ["Getting promoted", "His elderly parents managing the Virginia farm without him", "Running out of ammunition", "The weather"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie realized that these weren't just soldiers in uniforms, but real people with fears, dreams, and loved ones waiting for them at home.",
                    question: "What important realization did Jack and Annie have about the soldiers?",
                    options: ["They were just following orders", "They weren't just soldiers but real people with fears, dreams, and loved ones", "They enjoyed fighting", "They had no feelings"],
                    correct: 1
                },
                {
                    passage: "Both Tom and Billy expressed hope that the war would end quickly so they could return to their normal lives and families.",
                    question: "What hope did both Union and Confederate soldiers share?",
                    options: ["To become heroes", "That the war would end quickly so they could return to families", "To capture enemy territory", "To get promoted"],
                    correct: 1
                }
            ],
            4: [ // Chapter 5: Angel of the Battlefield
                {
                    passage: "Jack and Annie encountered Clara Barton, a brave woman who had come to the battlefield to help wounded soldiers from both sides of the conflict.",
                    question: "Who did Jack and Annie meet on the battlefield?",
                    options: ["A general's wife", "Clara Barton, a brave woman helping wounded soldiers from both sides", "A news reporter", "A government official"],
                    correct: 1
                },
                {
                    passage: "Clara Barton explained that she couldn't stand by while soldiers suffered, so she had brought medical supplies and bandages to help wherever needed.",
                    question: "Why did Clara Barton come to the battlefield?",
                    options: ["To watch the battle", "She couldn't stand soldiers suffering, brought medical supplies to help", "To write about the war", "To find her relatives"],
                    correct: 1
                },
                {
                    passage: "She told Jack and Annie that she believed in helping anyone who was hurt, regardless of which side they fought for, because all soldiers were someone's sons.",
                    question: "What was Clara Barton's philosophy about helping wounded soldiers?",
                    options: ["Only help Union soldiers", "Help anyone hurt regardless of side, because all soldiers were someone's sons", "Only help officers", "Help only those who could pay"],
                    correct: 1
                },
                {
                    passage: "Clara Barton showed them how to make bandages, carry water to thirsty soldiers, and comfort those who were afraid or in pain.",
                    question: "What did Clara Barton teach Jack and Annie to do?",
                    options: ["Fight in battles", "Make bandages, carry water, and comfort afraid or injured soldiers", "Send messages", "Cook food"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie learned that Clara Barton would later become known as the 'Angel of the Battlefield' and would found the American Red Cross.",
                    question: "What would Clara Barton later become known for?",
                    options: ["Leading military campaigns", "Being called 'Angel of the Battlefield' and founding American Red Cross", "Writing war novels", "Becoming a politician"],
                    correct: 1
                }
            ],
            5: [ // Chapter 6: Keep Low!
                {
                    passage: "The Battle of Bull Run began with the thundering sound of cannons and the crack of rifles as thousands of soldiers clashed in the Virginia countryside.",
                    question: "How did the Battle of Bull Run begin?",
                    options: ["With quiet negotiations", "With thundering cannons and rifle cracks as soldiers clashed", "With a peaceful march", "With a surrender"],
                    correct: 1
                },
                {
                    passage: "Clara Barton shouted 'Keep low!' to Jack and Annie as bullets whistled overhead, while they helped move wounded soldiers to safety behind trees and rocks.",
                    question: "What did Clara Barton shout to keep Jack and Annie safe?",
                    options: ["Run away!", "Keep low! as bullets whistled while they moved wounded to safety", "Stand up tall!", "Hide in the trees!"],
                    correct: 1
                },
                {
                    passage: "They witnessed the chaos and confusion of battle, with smoke filling the air, soldiers shouting orders, and the terrible sounds of war all around them.",
                    question: "What did Jack and Annie witness during the battle?",
                    options: ["An organized, quiet event", "Chaos with smoke, shouting soldiers, and terrible sounds of war", "A peaceful resolution", "A quick victory"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie helped carry water to soldiers on both sides, learning that wounded men needed help regardless of which uniform they wore.",
                    question: "What did Jack and Annie learn while helping during the battle?",
                    options: ["Only help their own side", "Wounded men needed help regardless of which uniform they wore", "War was exciting", "Battles were easy to understand"],
                    correct: 1
                },
                {
                    passage: "They saw acts of incredible bravery and kindness even in the midst of the violent battle, as soldiers helped wounded enemies and shared water with those who needed it.",
                    question: "What positive acts did they witness during the battle?",
                    options: ["Only fighting and hatred", "Incredible bravery and kindness, soldiers helping wounded enemies and sharing water", "Complete chaos only", "No cooperation"],
                    correct: 1
                }
            ],
            6: [ // Chapter 7: Brothers
                {
                    passage: "Jack and Annie encountered two wounded soldiers who discovered they were actually brothers - one fighting for the Union and one for the Confederacy.",
                    question: "What shocking discovery did two wounded soldiers make?",
                    options: ["They were from the same town", "They were actually brothers fighting on opposite sides", "They had the same name", "They knew each other from school"],
                    correct: 1
                },
                {
                    passage: "The brothers had been separated by their different beliefs about slavery and states' rights, but in their pain and fear, they only wanted to see each other again.",
                    question: "What had separated the brothers, and what did they want when wounded?",
                    options: ["Money had separated them", "Different beliefs about slavery and states' rights separated them, but wounded they wanted to see each other", "A family argument over land", "Different careers"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie helped reunite the brothers, watching as they forgave each other and remembered their love despite their political differences.",
                    question: "What did Jack and Annie help the brothers do?",
                    options: ["Continue arguing", "Reunite, forgive each other, and remember their love despite differences", "Plan their next battle", "Write letters home"],
                    correct: 1
                },
                {
                    passage: "This encounter showed Jack and Annie how the Civil War had torn apart families across America, making the conflict even more heartbreaking and personal.",
                    question: "What did this encounter teach Jack and Annie about the Civil War?",
                    options: ["It only affected soldiers", "It had torn apart families across America, making conflict heartbreaking and personal", "It was just about politics", "It didn't affect relationships"],
                    correct: 1
                },
                {
                    passage: "The brothers' reunion gave Jack and Annie hope that after the war, the country might also be able to heal and come back together.",
                    question: "What hope did the brothers' reunion give Jack and Annie?",
                    options: ["That war would end immediately", "That after war, the country might heal and come back together", "That families didn't matter", "That conflicts were permanent"],
                    correct: 1
                }
            ],
            7: [ // Chapter 8: The Retreat
                {
                    passage: "As the day wore on, the Union army began to retreat from Bull Run, and Jack and Annie helped Clara Barton care for the growing number of wounded soldiers.",
                    question: "What happened as the day continued at Bull Run?",
                    options: ["Union won decisively", "Union army began retreating, Jack and Annie helped Clara care for more wounded", "Both sides celebrated", "Fighting stopped completely"],
                    correct: 1
                },
                {
                    passage: "The retreat became chaotic as civilians who had come to watch the battle like a picnic suddenly realized the danger and fled alongside the soldiers.",
                    question: "What made the retreat chaotic?",
                    options: ["Bad weather", "Civilians who came to watch like a picnic suddenly fled with soldiers", "Lack of leadership", "Too many horses"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie were amazed to learn that many people had actually come to watch the battle as entertainment, not understanding the real horror of war.",
                    question: "What amazed Jack and Annie about some people's attitude toward the battle?",
                    options: ["Everyone was scared", "Many came to watch as entertainment, not understanding war's horror", "No one cared about soldiers", "Everyone wanted to help"],
                    correct: 1
                },
                {
                    passage: "Clara Barton remained calm and focused during the retreat, continuing to help wounded soldiers even as chaos swirled around them.",
                    question: "How did Clara Barton behave during the chaotic retreat?",
                    options: ["She panicked and ran", "She remained calm and focused, continuing to help wounded soldiers", "She gave up helping", "She only helped herself"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie learned that retreat didn't mean cowardice - it was sometimes a necessary military strategy to save soldiers' lives and regroup for the future.",
                    question: "What did Jack and Annie learn about military retreats?",
                    options: ["Retreat always meant cowardice", "Retreat didn't mean cowardice - sometimes necessary strategy to save lives and regroup", "Retreats never happened", "Only weak armies retreated"],
                    correct: 1
                }
            ],
            8: [ // Chapter 9: Home
                {
                    passage: "As the battle ended, Clara Barton told Jack and Annie about her dream of creating an organization to help people during disasters and wars.",
                    question: "What dream did Clara Barton share with Jack and Annie?",
                    options: ["To become a general", "To create an organization helping people during disasters and wars", "To write a book", "To start a school"],
                    correct: 1
                },
                {
                    passage: "She explained that she wanted to establish a group that would provide aid without taking sides, helping anyone who needed assistance regardless of politics or nationality.",
                    question: "What kind of organization did Clara Barton want to establish?",
                    options: ["A political group", "A group providing aid without taking sides, helping anyone regardless of politics", "A military unit", "A business company"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie realized they were witnessing the early inspiration for what would become the American Red Cross, one of the world's most important humanitarian organizations.",
                    question: "What important organization were Jack and Annie witnessing the inspiration for?",
                    options: ["The United Nations", "The American Red Cross, one of the world's most important humanitarian organizations", "The Peace Corps", "The Salvation Army"],
                    correct: 1
                },
                {
                    passage: "Clara Barton thanked Jack and Annie for their help and told them that ordinary people doing extraordinary acts of kindness could change the world.",
                    question: "What did Clara Barton tell Jack and Annie about changing the world?",
                    options: ["Only famous people could help", "Ordinary people doing extraordinary acts of kindness could change the world", "Change was impossible", "Only governments mattered"],
                    correct: 1
                },
                {
                    passage: "Before they left, Clara Barton gave them a small first aid kit as a reminder that healing and helping others is always more powerful than fighting.",
                    question: "What gift did Clara Barton give them and what did it represent?",
                    options: ["A book about war", "A small first aid kit reminding them healing and helping is more powerful than fighting", "A uniform", "A medal"],
                    correct: 1
                }
            ],
            9: [ // Chapter 10: Sunday in Frog Creek
                {
                    passage: "Back in the tree house, Jack and Annie reflected on their experience during the Civil War and how it changed their understanding of courage and compassion.",
                    question: "What did Jack and Annie reflect on back in the tree house?",
                    options: ["Their next adventure", "How Civil War experience changed their understanding of courage and compassion", "What to have for lunch", "Their homework"],
                    correct: 1
                },
                {
                    passage: "They realized that the real heroes of the war weren't just the generals and famous leaders, but people like Clara Barton who dedicated their lives to helping others.",
                    question: "Who did Jack and Annie realize were the real heroes of the war?",
                    options: ["Only generals and leaders", "Not just generals, but people like Clara Barton who dedicated lives to helping others", "Only soldiers", "Only politicians"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie understood that while war brings out the worst in people, it can also inspire the best - acts of incredible bravery, kindness, and sacrifice.",
                    question: "What did Jack and Annie understand about war's effects on people?",
                    options: ["War only brings out bad things", "War brings out worst but can inspire best - bravery, kindness, and sacrifice", "War has no effect on character", "War only affects soldiers"],
                    correct: 1
                },
                {
                    passage: "They learned that healing a divided nation takes time, patience, and people willing to work together despite their differences.",
                    question: "What did they learn about healing a divided nation?",
                    options: ["It happens automatically", "It takes time, patience, and people willing to work together despite differences", "It's impossible", "It only requires government action"],
                    correct: 1
                },
                {
                    passage: "As they walked home through Frog Creek on that peaceful Sunday, Jack and Annie felt grateful for the peace they enjoyed and committed to helping others whenever possible.",
                    question: "How did Jack and Annie feel walking home after their Civil War experience?",
                    options: ["Sad and hopeless", "Grateful for peace they enjoyed and committed to helping others when possible", "Angry about war", "Confused and lost"],
                    correct: 1
                }
            ]
        };

        // Ï†ÑÏó≠ Î≥ÄÏàò
        let currentChapterIndex = 0;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let questions = [];
        let currentAudio = null;
        let playbackSpeed = 1.0;

        // üéß ÏûêÎèô Ïò§ÎîîÏò§ URL ÏÉùÏÑ± Ìï®Ïàò
        function getAudioUrl(chapterIndex) {
            const level = 'level4';
            const bookId = 'MTH021';
            const chapterNum = String(chapterIndex + 1).padStart(2, '0');
            
            const possibleFileNames = [
                `${bookId}_chapter${chapterNum}.mp3`,
                `${bookId}_ch${chapterNum}.mp3`,
                `${bookId}_${chapterNum}.mp3`,
                `magic_tree_house_21_chapter${chapterNum}.mp3`,
                `magic_tree_house_21_ch${chapterNum}.mp3`,
                `civil_war_on_sunday_${chapterNum}.mp3`,
                `mary_pope_osborne_21_chapter${chapterNum}.mp3`,
                `${bookId}.mp3`
            ];
            
            return {
                primary: `${AUDIO_BASE_URL}${level}/${possibleFileNames[0]}`,
                alternatives: possibleFileNames.map(fileName => `${AUDIO_BASE_URL}${level}/${fileName}`)
            };
        }

        // üéß Ïò§ÎîîÏò§ Ïû¨ÏÉù Ìï®Ïàò
        function playChapterAudio(chapterIndex) {
            const chapter = bookData.chapterList[chapterIndex];
            const audioUrls = getAudioUrl(chapterIndex);

            document.getElementById('audio-modal').style.display = 'flex';
            document.getElementById('audio-chapter-title').textContent = `Chapter ${chapterIndex + 1}: ${chapter.title}`;
            document.getElementById('audio-chapter-subtitle').textContent = `${bookData.title} - ${bookData.author}`;

            // Ïò§ÎîîÏò§ Ï†ïÎ≥¥ ÏòÅÏó≠ Îã§Ïãú Î≥¥Ïù¥Í∏∞ (ÏÉàÎ°úÏö¥ Ïò§ÎîîÏò§ ÌîåÎ†àÏù¥Ïãú)
            document.getElementById('audio-info').classList.remove('hidden');

            const audioPlayer = document.getElementById('audio-player');
            const audioSource = document.getElementById('audio-source');
            const audioStatus = document.getElementById('audio-status');

            audioStatus.textContent = 'üîÑ Ïò§ÎîîÏò§ ÌååÏùºÏùÑ Ï∞æÎäî Ï§ë...';

            function tryLoadAudio(urlIndex = 0) {
                if (urlIndex >= audioUrls.alternatives.length) {
                    audioStatus.innerHTML = `‚ùå Ïò§ÎîîÏò§ ÌååÏùºÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.`;
                    return;
                }

                const currentUrl = audioUrls.alternatives[urlIndex];
                audioSource.src = currentUrl;
                audioPlayer.load();

                const successHandler = function() {
                    const startTime = chapter.startTime || 0;
                    audioPlayer.currentTime = startTime;
                    audioStatus.innerHTML = `‚úÖ Ïò§ÎîîÏò§ Ï§ÄÎπÑ ÏôÑÎ£å!`;
                };

                const errorHandler = function() {
                    setTimeout(() => tryLoadAudio(urlIndex + 1), 100);
                };

                audioPlayer.addEventListener('canplaythrough', successHandler, { once: true });
                audioPlayer.addEventListener('error', errorHandler, { once: true });
            }

            tryLoadAudio(0);
            currentAudio = audioPlayer;
            playbackSpeed = 1.0;
        }

        // Í∏∞Î≥∏ Ìï®ÏàòÎì§
        function closeAudioModal() {
            document.getElementById('audio-modal').style.display = 'none';
            if (currentAudio) currentAudio.pause();
        }

        function togglePlayPause() {
            if (!currentAudio) return;
            if (currentAudio.paused) {
                currentAudio.play();
                document.querySelector('.play-pause-btn').textContent = '‚è∏Ô∏è ÏùºÏãúÏ†ïÏßÄ';
            } else {
                currentAudio.pause();
                document.querySelector('.play-pause-btn').textContent = '‚ñ∂Ô∏è Ïû¨ÏÉù';
            }
        }

        function changeSpeed() {
            if (!currentAudio) return;
            const speeds = [0.5, 0.75, 1.0, 1.25, 1.5, 2.0];
            const currentIndex = speeds.indexOf(playbackSpeed);
            playbackSpeed = speeds[(currentIndex + 1) % speeds.length];
            currentAudio.playbackRate = playbackSpeed;
            document.querySelector('.speed-btn').textContent = `${playbackSpeed}x`;
        }

        function resetToChapterStart() {
            if (!currentAudio) return;
            const currentChapter = parseInt(document.getElementById('audio-chapter-title').textContent.match(/Chapter (\d+)/)[1]) - 1;
            currentAudio.currentTime = bookData.chapterList[currentChapter]?.startTime || 0;
        }

        function downloadAudio() {
            const audioSource = document.getElementById('audio-source');
            if (audioSource.src) {
                const link = document.createElement('a');
                link.href = audioSource.src;
                link.download = `${document.getElementById('audio-chapter-title').textContent}.mp3`;
                link.click();
            }
        }

        // Ï±Ö ÏÉÅÏÑ∏ Ï†ïÎ≥¥ ÌëúÏãú
        function showBookDetail() {
            document.getElementById('book-detail-screen').style.display = 'block';
            document.getElementById('learning-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'none';
            generateChapterGrid();
            updateProgress();
        }

        // Ï±ïÌÑ∞ Í∑∏Î¶¨Îìú ÏÉùÏÑ±
        function generateChapterGrid() {
            const grid = document.getElementById('chapters-grid');
            grid.innerHTML = '';

            bookData.chapterList.forEach((chapter, index) => {
                const chapterCard = document.createElement('div');
                chapterCard.className = `chapter-card ${chapter.status}`;

                chapterCard.innerHTML = `
                    <div class="chapter-header">
                        <div class="chapter-info">
                            <h4>Chapter ${index + 1}: ${chapter.title}</h4>
                            <p>${chapter.description} (${chapter.questionCount}Î¨∏Ï†ú)</p>
                        </div>
                        <div class="chapter-status ${chapter.status}">
                            ${chapter.status === 'completed' ? '‚úÖ ÏôÑÎ£å' :
                              chapter.status === 'current' ? 'üìñ ÏßÑÌñâÏ§ë' : 'üîí Ïû†ÍπÄ'}
                        </div>
                    </div>
                    <div class="chapter-actions">
                        <button class="chapter-btn audio-btn" onclick="playChapterAudio(${index})"
                                ${chapter.status === 'locked' ? 'disabled' : ''}>
                            üéß Ïò§ÎîîÏò§
                        </button>
                        <button class="chapter-btn quiz-btn" onclick="startLearning(${index})"
                                ${chapter.status === 'locked' ? 'disabled' : ''}>
                            üìù Î¨∏Ï†úÌíÄÍ∏∞
                        </button>
                    </div>
                `;

                grid.appendChild(chapterCard);
            });
        }

        // ÏßÑÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
        function updateProgress() {
            const completedChapters = bookData.chapterList.filter(chapter => chapter.status === 'completed').length;
            const progress = Math.round((completedChapters / bookData.chapters) * 100);
            document.getElementById('progress-value').textContent = progress + '%';
        }

        // ÌïôÏäµ ÏãúÏûë
        function startLearning(chapterIndex) {
            currentChapterIndex = chapterIndex;
            currentQuestionIndex = 0;
            userAnswers = [];
            questions = questionsData[chapterIndex];

            if (!questions || questions.length === 0) {
                alert('Ïù¥ Ï±ïÌÑ∞Ïùò Î¨∏Ï†úÍ∞Ä ÏïÑÏßÅ Ï§ÄÎπÑÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                return;
            }

            document.getElementById('book-detail-screen').style.display = 'none';
            document.getElementById('learning-screen').style.display = 'block';
            document.getElementById('result-screen').style.display = 'none';

            const chapter = bookData.chapterList[chapterIndex];
            document.getElementById('learning-title').textContent = `Chapter ${chapterIndex + 1}: ${chapter.title}`;
            document.getElementById('learning-chapter-breadcrumb').textContent = `Chapter ${chapterIndex + 1}`;

            showQuestion();
            updateLearningProgress();
        }

        // Î¨∏Ï†ú ÌëúÏãú
        function showQuestion() {
            const question = questions[currentQuestionIndex];
            const container = document.getElementById('question-container');

            container.innerHTML = `
                <div class="question-text">Î¨∏Ï†ú ${currentQuestionIndex + 1}</div>
                <div class="passage">${question.passage}</div>
                <div class="question-text">${question.question}</div>
                <div class="options">
                    ${question.options.map((option, index) =>
                        `<div class="option" onclick="selectOption(${index})" data-index="${index}">
                            ${String.fromCharCode(65 + index)}. ${option}
                        </div>`
                    ).join('')}
                </div>
            `;

            if (userAnswers[currentQuestionIndex] !== undefined) {
                const selectedOption = container.querySelector(`[data-index="${userAnswers[currentQuestionIndex]}"]`);
                if (selectedOption) selectedOption.classList.add('selected');
            }

            updateNavigationButtons();
        }

        // ÏÑ†ÌÉùÏßÄ ÏÑ†ÌÉù
        function selectOption(optionIndex) {
            document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
            document.querySelector(`[data-index="${optionIndex}"]`).classList.add('selected');
            userAnswers[currentQuestionIndex] = optionIndex;
            updateNavigationButtons();
        }

        // ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò
        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                showQuestion();
                updateLearningProgress();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion();
                updateLearningProgress();
            }
        }

        function updateLearningProgress() {
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('learning-progress-bar').style.width = progress + '%';
            document.getElementById('learning-progress-text').textContent = `Î¨∏Ï†ú ${currentQuestionIndex + 1} / ${questions.length}`;
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const submitBtn = document.getElementById('submit-btn');

            prevBtn.disabled = currentQuestionIndex === 0;

            if (currentQuestionIndex === questions.length - 1) {
                nextBtn.style.display = 'none';
                submitBtn.style.display = 'block';
                submitBtn.disabled = userAnswers[currentQuestionIndex] === undefined;
            } else {
                nextBtn.style.display = 'block';
                submitBtn.style.display = 'none';
                nextBtn.disabled = userAnswers[currentQuestionIndex] === undefined;
            }
        }

        // ÎãµÏïà Ï†úÏ∂ú
        function submitAnswers() {
            let correctCount = 0;
            questions.forEach((question, index) => {
                if (userAnswers[index] === question.correct) correctCount++;
            });

            const score = Math.round((correctCount / questions.length) * 100);

            if (score >= 70) {
                bookData.chapterList[currentChapterIndex].status = 'completed';
                if (currentChapterIndex < bookData.chapterList.length - 1) {
                    bookData.chapterList[currentChapterIndex + 1].status = 'current';
                }
            }

            showResults(correctCount, questions.length, score);
        }

        // Í≤∞Í≥º ÌëúÏãú
        function showResults(correct, total, score) {
            document.getElementById('learning-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';

            document.getElementById('score-circle').textContent = score + '%';
            document.getElementById('total-questions').textContent = total + 'Î¨∏Ï†ú';
            document.getElementById('correct-answers').textContent = correct + 'Î¨∏Ï†ú';
            document.getElementById('wrong-answers').textContent = (total - correct) + 'Î¨∏Ï†ú';
            document.getElementById('final-score').textContent = score + 'Ï†ê';

            let message = '';
            if (score >= 90) message = 'ÌõåÎ•≠Ìï©ÎãàÎã§! üåü';
            else if (score >= 80) message = 'ÏûòÌñàÏñ¥Ïöî! üëè';
            else if (score >= 70) message = 'Ï¢ãÏïÑÏöî! üëç';
            else message = 'Îã§Ïãú ÌïúÎ≤à ÎèÑÏ†ÑÌï¥Î≥¥ÏÑ∏Ïöî! üí™';

            document.getElementById('result-message').textContent = message;
        }

        function retryChapter() {
            startLearning(currentChapterIndex);
        }

        function nextChapter() {
            if (currentChapterIndex < bookData.chapterList.length - 1) {
                startLearning(currentChapterIndex + 1);
            } else {
                alert('Î™®Îì† Ï±ïÌÑ∞Î•º ÏôÑÎ£åÌñàÏäµÎãàÎã§! üéâ');
                showBookDetail();
            }
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú
        window.addEventListener('load', function() {
            showBookDetail();
            console.log('üé© Magic Tree House: Civil War on Sunday ÌïôÏäµ ÏãúÏä§ÌÖúÏù¥ Ï§ÄÎπÑÎêòÏóàÏäµÎãàÎã§!');
        });

        // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠Ïãú Îã´Í∏∞
        document.getElementById('audio-modal').addEventListener('click', function(e) {
            if (e.target === this) closeAudioModal();
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gangsta Granny - Level 4 - ìˆ˜ë¦¬ë”©ì–´í•™ì›</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #FF6B9D 0%, #C44569 50%, #8B2635 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        /* í—¤ë” */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #FF6B9D, #C44569);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .logo-text h1 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
        }

        .logo-text p {
            font-size: 0.9rem;
            color: #666;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
            color: #333;
            text-decoration: none;
        }

        .nav-btn:hover {
            background: #FF6B9D;
            color: white;
            transform: translateY(-2px);
        }

        /* ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ */
        .main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            min-height: 600px;
        }

        /* ì±… ìƒì„¸ í™”ë©´ */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 30px;
            font-size: 0.9rem;
            color: #666;
        }

        .breadcrumb a {
            color: #FF6B9D;
            text-decoration: none;
            cursor: pointer;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .book-detail-header {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: flex-start;
        }

        .detail-book-cover {
            width: 150px;
            height: 220px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 4rem;
            font-weight: bold;
            flex-shrink: 0;
            background: linear-gradient(45deg, #FF6B9D, #C44569);
        }

        .book-info {
            flex: 1;
        }

        .book-info h2 {
            font-size: 2.2rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .book-info .author {
            font-size: 1.2rem;
            color: #FF6B9D;
            margin-bottom: 20px;
        }

        .book-summary {
            font-size: 1rem;
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .book-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-box .value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #FF6B9D;
        }

        .stat-box .label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        /* ì±•í„° ê·¸ë¦¬ë“œ */
        .chapters-section {
            margin-top: 40px;
        }

        .chapters-section h3 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 30px;
            text-align: center;
        }

        .chapters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .chapter-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
        }

        .chapter-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .chapter-card.completed {
            border-color: #28a745;
            background: linear-gradient(135deg, #28a74508, #ffffff);
        }

        .chapter-card.current {
            border-color: #FF6B9D;
            background: linear-gradient(135deg, #FF6B9D08, #ffffff);
        }

        .chapter-card.locked {
            opacity: 0.6;
            background: #f8f9fa;
        }

        .chapter-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .chapter-info h4 {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }

        .chapter-info p {
            font-size: 0.95rem;
            color: #666;
            line-height: 1.5;
        }

        .chapter-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .chapter-status.completed {
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
        }

        .chapter-status.current {
            background: rgba(255, 107, 157, 0.1);
            color: #FF6B9D;
        }

        .chapter-status.locked {
            background: rgba(108, 117, 125, 0.1);
            color: #6c757d;
        }

        .chapter-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .chapter-btn {
            padding: 12px 16px;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .audio-btn {
            background: linear-gradient(45deg, #FF6B9D, #C44569);
            color: white;
        }

        .quiz-btn {
            background: linear-gradient(45deg, #C44569, #8B2635);
            color: white;
        }

        .chapter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .chapter-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* í•™ìŠµ í™”ë©´ */
        .learning-screen {
            display: none;
        }

        .learning-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .learning-progress {
            background: #f8f9fa;
            border-radius: 10px;
            height: 8px;
            margin: 20px 0;
            overflow: hidden;
        }

        .learning-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #FF6B9D, #C44569);
            transition: width 0.3s ease;
        }

        .question-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
        }

        .passage {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1rem;
            line-height: 1.6;
            color: #444;
        }

        .options {
            display: grid;
            gap: 10px;
        }

        .option {
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option:hover {
            background: #e9ecef;
            border-color: #FF6B9D;
        }

        .option.selected {
            background: rgba(255, 107, 157, 0.1);
            border-color: #FF6B9D;
        }

        .learning-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .control-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .next-btn {
            background: linear-gradient(45deg, #FF6B9D, #C44569);
            color: white;
        }

        .prev-btn {
            background: #6c757d;
            color: white;
        }

        .submit-btn {
            background: linear-gradient(45deg, #FF6B9D, #C44569);
            color: white;
        }

        .control-btn:hover {
            transform: translateY(-2px);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* ê²°ê³¼ í™”ë©´ */
        .result-screen {
            display: none;
            text-align: center;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(45deg, #FF6B9D, #C44569);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            font-size: 2rem;
            font-weight: bold;
        }

        .result-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .result-stat {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .result-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        /* ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ ëª¨ë‹¬ */
        .audio-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .audio-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 600px;
            width: 90%;
            position: relative;
        }

        .close-audio {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #666;
        }

        .audio-player {
            width: 100%;
            margin: 20px 0;
            border-radius: 10px;
        }

        .audio-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .audio-control-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .play-pause-btn {
            background: linear-gradient(45deg, #FF6B9D, #C44569);
            color: white;
        }

        .speed-btn {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #ddd;
        }

        .download-btn {
            background: #C44569;
            color: white;
        }

        .audio-info {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            font-size: 0.9rem;
            color: #666;
            transition: all 0.3s ease;
        }

        .audio-info.hidden {
            display: none;
        }

        /* Level 4 íŠ¹ë³„ ìŠ¤íƒ€ì¼ */
        .level-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: linear-gradient(45deg, #FF6B9D, #8B2635);
            color: white;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .chapters-grid {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .book-detail-header {
                flex-direction: column;
                text-align: center;
            }

            .book-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .learning-controls {
                flex-direction: column;
            }

            .chapter-actions {
                grid-template-columns: 1fr;
            }

            .audio-controls {
                justify-content: center;
                gap: 10px;
            }

            .audio-content {
                padding: 30px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">ğŸ’</div>
                <div class="logo-text">
                    <h1>Gangsta Granny</h1>
                    <p>Level 4-1 - David Walliamsì˜ ë² ìŠ¤íŠ¸ì…€ëŸ¬</p>
                </div>
            </div>
            <div class="nav-buttons">
                <a href="http://www.suelibrary.store/" class="nav-btn">ë©”ì¸ìœ¼ë¡œ</a>
            </div>
        </div>

        <!-- ë©”ì¸ ì½˜í…ì¸  -->
        <div class="main-content">
            <!-- ì±… ìƒì„¸ í™”ë©´ -->
            <div class="book-detail-screen" id="book-detail-screen">
                <div class="level-badge">Level 4-1</div>
                <div class="breadcrumb">
                    <span>Gangsta Granny</span>
                </div>

                <div class="book-detail-header">
                    <div class="detail-book-cover">ğŸ’</div>
                    <div class="book-info">
                        <h2>Gangsta Granny</h2>
                        <div class="author">David Walliams</div>
                        <div class="book-summary">
                            Ben is an eleven-year-old boy who finds his Friday visits to his grandmother incredibly boring. She serves cabbage soup, plays Scrabble, and seems like the most ordinary old lady in the world. But when Ben accidentally discovers that his boring granny used to be an international jewel thief known as "The Black Cat," everything changes! Suddenly, Ben can't wait to visit Granny and hear about her exciting adventures. Together, they plan the ultimate heist - stealing the Crown Jewels from the Tower of London. But will they succeed, or will their daring plan lead to unexpected consequences?
                        </div>
                        <div class="book-stats">
                            <div class="stat-box">
                                <div class="value">34</div>
                                <div class="label">ì±•í„°</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">170</div>
                                <div class="label">ì´ ë¬¸ì œ</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">Level 4-1</div>
                                <div class="label">ë ˆë²¨</div>
                            </div>
                            <div class="stat-box">
                                <div class="value" id="progress-value">0%</div>
                                <div class="label">ì§„ë„</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="chapters-section">
                    <h3>ğŸ’ ì±•í„°ë³„ í•™ìŠµ</h3>
                    <div class="chapters-grid" id="chapters-grid">
                        <!-- ì±•í„° ì¹´ë“œë“¤ -->
                    </div>
                </div>
            </div>

            <!-- í•™ìŠµ í™”ë©´ -->
            <div class="learning-screen" id="learning-screen">
                <div class="breadcrumb">
                    <a onclick="showBookDetail()">Gangsta Granny</a>
                    <span>></span>
                    <span id="learning-chapter-breadcrumb">Chapter 1</span>
                </div>

                <div class="learning-header">
                    <h2 id="learning-title">Chapter 1</h2>
                    <div class="learning-progress">
                        <div class="learning-progress-bar" id="learning-progress-bar" style="width: 0%"></div>
                    </div>
                    <p id="learning-progress-text">ë¬¸ì œ 1 / 5</p>
                </div>

                <div class="question-container" id="question-container">
                    <!-- ë¬¸ì œê°€ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>

                <div class="learning-controls">
                    <button class="control-btn prev-btn" id="prev-btn" onclick="previousQuestion()" disabled>ì´ì „</button>
                    <button class="control-btn next-btn" id="next-btn" onclick="nextQuestion()">ë‹¤ìŒ</button>
                    <button class="control-btn submit-btn" id="submit-btn" onclick="submitAnswers()" style="display: none;">ì œì¶œ</button>
                </div>
            </div>

            <!-- ê²°ê³¼ í™”ë©´ -->
            <div class="result-screen" id="result-screen">
                <div class="breadcrumb">
                    <a onclick="showBookDetail()">Gangsta Granny</a>
                    <span>></span>
                    <span>ê²°ê³¼</span>
                </div>

                <div class="result-header">
                    <h2>ğŸ‰ í•™ìŠµ ì™„ë£Œ!</h2>
                    <div class="score-circle" id="score-circle">100%</div>
                    <h3 id="result-message">í›Œë¥­í•©ë‹ˆë‹¤!</h3>
                </div>

                <div class="result-details">
                    <div class="result-stat">
                        <h4>ì´ ë¬¸ì œ</h4>
                        <p id="total-questions">5ë¬¸ì œ</p>
                    </div>
                    <div class="result-stat">
                        <h4>ì •ë‹µ</h4>
                        <p id="correct-answers">5ë¬¸ì œ</p>
                    </div>
                    <div class="result-stat">
                        <h4>ì˜¤ë‹µ</h4>
                        <p id="wrong-answers">0ë¬¸ì œ</p>
                    </div>
                    <div class="result-stat">
                        <h4>ì ìˆ˜</h4>
                        <p id="final-score">100ì </p>
                    </div>
                </div>

                <div class="result-actions">
                    <button class="control-btn prev-btn" onclick="retryChapter()">ë‹¤ì‹œ í’€ê¸°</button>
                    <button class="control-btn next-btn" onclick="nextChapter()">ë‹¤ìŒ ì±•í„°</button>
                    <button class="control-btn submit-btn" onclick="showBookDetail()">ì±•í„° ëª©ë¡</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ ëª¨ë‹¬ -->
    <div class="audio-modal" id="audio-modal">
        <div class="audio-content">
            <button class="close-audio" onclick="closeAudioModal()">Ã—</button>
            <h3 id="audio-chapter-title">Chapter 1</h3>
            <p id="audio-chapter-subtitle">Gangsta Granny - David Walliams</p>

            <audio class="audio-player" id="audio-player" controls preload="metadata">
                <source id="audio-source" src="" type="audio/mpeg">
                ë¸Œë¼ìš°ì €ê°€ ì˜¤ë””ì˜¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
            </audio>

            <div class="audio-controls">
                <button class="audio-control-btn play-pause-btn" onclick="togglePlayPause()">â–¶ï¸ ì¬ìƒ</button>
                <button class="audio-control-btn speed-btn" onclick="changeSpeed()">1.0x</button>
                <button class="audio-control-btn download-btn" onclick="downloadAudio()">ğŸ“¥ ë‹¤ìš´ë¡œë“œ</button>
            </div>

            <div class="audio-info" id="audio-info">
                <div id="audio-status" style="margin-top: 10px; font-weight: bold; color: #FF6B9D;"></div>
            </div>
        </div>
    </div>

    <script>
       // ğŸ¯ êµ¬ê¸€ í´ë¼ìš°ë“œ ìŠ¤í† ë¦¬ì§€ ì˜¤ë””ì˜¤ URL ì„¤ì •
const AUDIO_BASE_URL = 'https://storage.googleapis.com/kim-mom-reading-audio/audio/';

// Gangsta Granny ë‹¨ì¼ íŒŒì¼ + ì‹œê°„ ì í”„ ì‹œìŠ¤í…œ (34ì±•í„°ìš© í™•ì¥)
const gangstaGrannyTimeMapping = {
    0: { startTime: 29 },          // Chapter 1: 0:00:29
    1: { startTime: 426 },         // Chapter 2: 7:06
    2: { startTime: 819 },         // Chapter 3: 13:39
    3: { startTime: 1260 },        // Chapter 4: 21:00
    4: { startTime: 1612 },        // Chapter 5: 26:52
    5: { startTime: 1990 },        // Chapter 6: 33:10
    6: { startTime: 2263 },        // Chapter 7: 37:43
    7: { startTime: 2420 },        // Chapter 8: 40:20
    8: { startTime: 2825 },        // Chapter 9: 47:05
    9: { startTime: 3043 },        // Chapter 10: 50:43
    10: { startTime: 3489 },       // Chapter 11: 58:09
    11: { startTime: 3908 },       // Chapter 12: 1:05:08
    12: { startTime: 4442 },       // Chapter 13: 1:14:02
    13: { startTime: 4713 },       // Chapter 14: 1:18:33
    14: { startTime: 5178 },       // Chapter 15: 1:26:18
    15: { startTime: 5381 },       // Chapter 16: 1:29:41
    16: { startTime: 5839 },       // Chapter 17: 1:37:19
    17: { startTime: 6094 },       // Chapter 18: 1:41:34
    18: { startTime: 6427 },       // Chapter 19: 1:47:07
    19: { startTime: 7050 },       // Chapter 20: 1:57:30
    20: { startTime: 7566 },       // Chapter 21: 2:06:06
    21: { startTime: 8142 },       // Chapter 22: 2:15:42
    22: { startTime: 8422 },       // Chapter 23: 2:20:22
    23: { startTime: 8784 },       // Chapter 24: 2:26:24
    24: { startTime: 9079 },       // Chapter 25: 2:31:19 (2*3600 + 31*60 + 19)
    25: { startTime: 9476 },       // Chapter 26: 2:37:56 (2*3600 + 37*60 + 56)
    26: { startTime: 9837 },       // Chapter 27: 2:43:57 (2*3600 + 43*60 + 57)
    27: { startTime: 10090 },      // Chapter 28: 2:48:10 (2*3600 + 48*60 + 10)
    28: { startTime: 10481 },      // Chapter 29: 2:54:41 (2*3600 + 54*60 + 41)
    29: { startTime: 10702 },      // Chapter 30: 2:58:22 (2*3600 + 58*60 + 22)
    30: { startTime: 11117 },      // Chapter 31: 3:05:17 (3*3600 + 5*60 + 17)
    31: { startTime: 11443 },      // Chapter 32: 3:10:43 (3*3600 + 10*60 + 43)
    32: { startTime: 11783 },      // Chapter 33: 3:16:23 (3*3600 + 16*60 + 23)
    33: { startTime: 12176 }       // Chapter 34: 3:22:56 (3*3600 + 22*60 + 56)
};

// ì „ì—­ ë³€ìˆ˜
let currentChapterIndex = 0;
let currentQuestionIndex = 0;
let userAnswers = [];
let questions = [];
let currentAudio = null;
let playbackSpeed = 1.0;

// ğŸ§ Gangsta Granny ì˜¤ë””ì˜¤ URL ìƒì„± í•¨ìˆ˜ (ë‹¨ì¼ íŒŒì¼)
function getAudioUrl(chapterIndex) {
    const fileName = 'Gangsta Granny - David Walliams.mp3';
    return {
        primary: `${AUDIO_BASE_URL}GG001_Gangsta_Granny/${fileName}`,
        startTime: gangstaGrannyTimeMapping[chapterIndex]?.startTime || 0,
        alternatives: [`${AUDIO_BASE_URL}GG001_Gangsta_Granny/${fileName}`]
    };
}

// ğŸ§ Gangsta Granny ì˜¤ë””ì˜¤ ì¬ìƒ í•¨ìˆ˜
function playChapterAudio(chapterIndex) {
    const chapter = bookData.chapterList[chapterIndex];
    const audioData = getAudioUrl(chapterIndex);

    document.getElementById('audio-modal').style.display = 'flex';
    document.getElementById('audio-chapter-title').textContent = `Chapter ${chapterIndex + 1}`;
    document.getElementById('audio-chapter-subtitle').textContent = `${bookData.title} - ${bookData.author}`;
    document.getElementById('audio-info').classList.remove('hidden');

    const audioPlayer = document.getElementById('audio-player');
    const audioSource = document.getElementById('audio-source');
    const audioStatus = document.getElementById('audio-status');

    audioStatus.textContent = 'ğŸ”„ ì˜¤ë””ì˜¤ íŒŒì¼ì„ ë¡œë”© ì¤‘...';

    // ë‹¨ì¼ íŒŒì¼ ë¡œë“œ
    audioSource.src = audioData.primary;
    audioPlayer.load();

    const successHandler = function() {
        // ì‹œê°„ ì í”„!
        audioPlayer.currentTime = audioData.startTime;

        // ì‹œê°„ í‘œì‹œ (ë¶„:ì´ˆ í˜•ì‹)
        const minutes = Math.floor(audioData.startTime / 60);
        const seconds = Math.floor(audioData.startTime % 60);
        const timeDisplay = `${minutes}:${seconds.toString().padStart(2, '0')}`;

        audioStatus.innerHTML = `âœ… Chapter ${chapterIndex + 1} ë¡œë“œ ì™„ë£Œ! (${timeDisplay}ë¶€í„°)`;

        // ğŸ¯ ì±•í„° í´ë¦­ ì¦‰ì‹œ ì¬ìƒ ì‹œë„!
        audioPlayer.play().then(() => {
            audioStatus.innerHTML = `ğŸµ Chapter ${chapterIndex + 1} ì¬ìƒ ì¤‘! (${timeDisplay}ë¶€í„°)`;
            document.querySelector('.play-pause-btn').textContent = 'â¸ï¸ ì¼ì‹œì •ì§€';
        }).catch(e => {
            console.log('ìë™ ì¬ìƒ ì°¨ë‹¨ë¨:', e);
            audioStatus.innerHTML = `âœ… Chapter ${chapterIndex + 1} ì¤€ë¹„ë¨! â–¶ï¸ ì¬ìƒ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”`;
        });
    };

    const errorHandler = function() {
        audioStatus.innerHTML = 'âŒ ì˜¤ë””ì˜¤ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
    };

    audioPlayer.addEventListener('canplaythrough', successHandler, { once: true });
    audioPlayer.addEventListener('error', errorHandler, { once: true });

    currentAudio = audioPlayer;
    playbackSpeed = 1.0;
}

// ğŸ§ êµ¬ê°„ì²˜ìŒìœ¼ë¡œ í•¨ìˆ˜ (í˜„ì¬ ì±•í„° ì‹œì‘ì ìœ¼ë¡œ)
function resetToChapterStart() {
    if (!currentAudio) return;

    // í˜„ì¬ ì±•í„° ë²ˆí˜¸ ì¶”ì¶œ
    const chapterTitle = document.getElementById('audio-chapter-title').textContent;
    const chapterMatch = chapterTitle.match(/Chapter (\d+)/);

    if (chapterMatch) {
        const currentChapterIndex = parseInt(chapterMatch[1]) - 1;
        const startTime = gangstaGrannyTimeMapping[currentChapterIndex]?.startTime || 0;
        currentAudio.currentTime = startTime;

        console.log(`ğŸ”„ Chapter ${currentChapterIndex + 1} ì‹œì‘ì ìœ¼ë¡œ ì´ë™: ${Math.floor(startTime/60)}:${Math.floor(startTime%60).toString().padStart(2,'0')}`);
    }
}

// ê¸°ë³¸ ì˜¤ë””ì˜¤ ì»¨íŠ¸ë¡¤ í•¨ìˆ˜ë“¤
function closeAudioModal() {
    document.getElementById('audio-modal').style.display = 'none';
    if (currentAudio) currentAudio.pause();
}

function togglePlayPause() {
    if (!currentAudio) return;
    if (currentAudio.paused) {
        currentAudio.play();
        document.querySelector('.play-pause-btn').textContent = 'â¸ï¸ ì¼ì‹œì •ì§€';
    } else {
        currentAudio.pause();
        document.querySelector('.play-pause-btn').textContent = 'â–¶ï¸ ì¬ìƒ';
    }
}

function changeSpeed() {
    if (!currentAudio) return;
    const speeds = [0.5, 0.75, 1.0, 1.25, 1.5, 2.0];
    const currentIndex = speeds.indexOf(playbackSpeed);
    playbackSpeed = speeds[(currentIndex + 1) % speeds.length];
    currentAudio.playbackRate = playbackSpeed;
    document.querySelector('.speed-btn').textContent = `${playbackSpeed}x`;
}

function downloadAudio() {
    const audioSource = document.getElementById('audio-source');
    if (audioSource.src) {
        const link = document.createElement('a');
        link.href = audioSource.src;
        link.download = `${document.getElementById('audio-chapter-title').textContent}.mp3`;
        link.click();
    }
}

        // Gangsta Granny ë„ì„œ ë°ì´í„° (34ì±•í„°)
        const bookData = {
            id: 'GG001',
            title: "Gangsta Granny",
            author: 'David Walliams',
            cover: 'ğŸ’',
            progress: 0,
            chapters: 34,
            totalQuestions: 170,
            coverColor: 'linear-gradient(45deg, #FF6B9D, #C44569)',
            summary: "Ben is an eleven-year-old boy who finds his Friday visits to his grandmother incredibly boring. She serves cabbage soup, plays Scrabble, and seems like the most ordinary old lady in the world. But when Ben accidentally discovers that his boring granny used to be an international jewel thief known as 'The Black Cat,' everything changes! Suddenly, Ben can't wait to visit Granny and hear about her exciting adventures. Together, they plan the ultimate heist - stealing the Crown Jewels from the Tower of London.",
            chapterList: [
                { title: 'Chapter 1: Cabbagy Water', description: 'Ben finds himself at his boring granny\'s house, complaining about having to stay with her every Friday evening.', status: 'current', questionCount: 5 },
                { title: 'Chapter 2: A Duck Quacking', description: 'Ben notices Granny\'s embarrassing habits while trying to survive another evening of cabbage soup.', status: 'current', questionCount: 5 },
                { title: 'Chapter 3: Plumbing Weekly', description: 'Ben searches for his beloved plumbing magazine while hiding his passion from his dance-obsessed parents.', status: 'current', questionCount: 5 },
                { title: 'Chapter 4: Mystery and Wonder', description: 'Ben begins to notice mysterious things about his supposedly boring grandmother.', status: 'current', questionCount: 5 },
                { title: 'Chapter 5: A Little Broken', description: 'Ben discovers that things at Granny\'s house aren\'t quite what they seem on the surface.', status: 'current', questionCount: 5 },
                { title: 'Chapter 6: Cold Wet Egg', description: 'Ben endures another of Granny\'s strange meals while beginning to suspect she has secrets.', status: 'current', questionCount: 5 },
                { title: 'Chapter 7: Bags of Manure', description: 'Ben starts to uncover clues about Granny\'s mysterious past and hidden activities.', status: 'current', questionCount: 5 },
                { title: 'Chapter 8: A Small Wig in a Jar', description: 'Ben makes a shocking discovery among Granny\'s belongings that changes everything.', status: 'current', questionCount: 5 },
                { title: 'Chapter 9: The Black Cat', description: 'Granny reveals her incredible secret identity as an international jewel thief known as "The Black Cat."', status: 'current', questionCount: 5 },
                { title: 'Chapter 10: Everything', description: 'Ben learns the full extent of Granny\'s criminal past and her amazing adventures around the world.', status: 'current', questionCount: 5 },
                { title: 'Chapter 11: Cheesy Beans and Sausage', description: 'Over a simple meal, Granny tells Ben more thrilling stories about her life of crime.', status: 'current', questionCount: 5 },
                { title: 'Chapter 12: The Love Bomb', description: 'Ben becomes completely fascinated by Granny\'s tales and eager to hear more about her adventures.', status: 'current', questionCount: 5 },
                { title: 'Chapter 13: A Lifetime of Crime', description: 'Granny shares the details of her extensive criminal career and famous heists.', status: 'current', questionCount: 5 },
                { title: 'Chapter 14: Nosy Neighbour', description: 'The suspicious Mr. Parker begins investigating Ben and Granny\'s activities.', status: 'current', questionCount: 5 },
                { title: 'Chapter 15: Reckless and Thrilling', description: 'Ben and Granny plan their most daring adventure yet - stealing the Crown Jewels.', status: 'current', questionCount: 5 },
                { title: 'Chapter 16: \'N\' \'O\' Spells \'NO\'', description: 'Despite initial resistance, plans for the ultimate heist begin to take shape.', status: 'current', questionCount: 5 },
                { title: 'Chapter 17: Planning the Heist', description: 'Ben and Granny work together to devise their elaborate plan to break into the Tower of London.', status: 'current', questionCount: 5 },
                { title: 'Chapter 18: Visiting Hours', description: 'The pair make reconnaissance visits to scope out their target location.', status: 'current', questionCount: 5 },
                { title: 'Chapter 19: A Small Explosive Device', description: 'Ben and Granny gather the equipment they need for their daring heist attempt.', status: 'current', questionCount: 5 },
                { title: 'Chapter 20: Boom Boom Boom', description: 'The excitement builds as their plans move closer to execution.', status: 'current', questionCount: 5 },
                { title: 'Chapter 21: A Tap-Shoe', description: 'Ben must deal with his parents\' ballroom dancing obsession while secretly planning the heist.', status: 'current', questionCount: 5 },
                { title: 'Chapter 22: Lycra Lynch Mob', description: 'Ben faces the horror of his parents\' dance competition while thinking about the Crown Jewels.', status: 'current', questionCount: 5 },
                { title: 'Chapter 23: Caught by the Fuzz', description: 'Ben and Granny have a close encounter with the police during their preparations.', status: 'current', questionCount: 5 },
                { title: 'Chapter 24: Dark Waters', description: 'The duo begins their daring journey through the Thames towards the Tower of London.', status: 'current', questionCount: 5 },
                { title: 'Chapter 25: Haunted by Ghosts', description: 'Ben and Granny navigate the spooky, historic Tower of London in the dead of night.', status: 'current', questionCount: 5 },
                { title: 'Chapter 26: A Figure in the Dark', description: 'A mysterious figure appears, threatening to expose their carefully planned heist.', status: 'current', questionCount: 5 },
                { title: 'Chapter 27: An Audience with the Queen', description: 'Ben and Granny have an unexpected encounter with the most important person in Britain.', status: 'current', questionCount: 5 },
                { title: 'Chapter 28: Hung, Drawn and Quartered', description: 'The consequences of their actions seem dire as they face potential punishment.', status: 'current', questionCount: 5 },
                { title: 'Chapter 29: Armed Police', description: 'Ben and Granny find themselves surrounded by armed officers after their adventure.', status: 'current', questionCount: 5 },
                { title: 'Chapter 30: A Packet of Sugar', description: 'The truth about what really happened during the heist begins to emerge.', status: 'current', questionCount: 5 },
                { title: 'Chapter 31: Golden Light', description: 'Ben reflects on the magical experience he shared with his beloved grandmother.', status: 'current', questionCount: 5 },
                { title: 'Chapter 32: A Family Sandwich', description: 'Ben\'s relationship with his family begins to heal and grow stronger.', status: 'current', questionCount: 5 },
                { title: 'Chapter 33: Silence', description: 'A period of quiet reflection as Ben processes all that has happened with Granny.', status: 'current', questionCount: 5 },
                { title: 'Chapter 34: Zimmer Frame', description: 'The emotional conclusion of Ben and Granny\'s incredible adventure together.', status: 'current', questionCount: 5 }
            ]
        };

        // ë¬¸ì œ ë°ì´í„° (ìƒ˜í”Œ - ê° ì±•í„°ë‹¹ 5ë¬¸ì œ, 34ì±•í„° ì „ì²´)
        const questionsData = {
            0: [ // Chapter 1: Boring Old Granny
                {
                    passage: "Every Friday night, when Ben's parents went to watch 'Strictly Stars Dancing' live, Ben had to stay with his granny. And Ben thought his granny was the most boring person in the whole world.",
                    question: "Why did Ben have to stay with his granny every Friday night?",
                    options: ["His parents went to work", "His parents went to watch 'Strictly Stars Dancing' live", "His parents were on vacation", "His parents were visiting friends"],
                    correct: 1
                },
                {
                    passage: "Granny always cooked the same meal: cabbage soup. And for pudding? Cabbage cake. Everything at Granny's house was cabbage-flavored.",
                    question: "What did Granny always cook for Ben?",
                    options: ["Pizza and ice cream", "Fish and chips", "Cabbage soup and cabbage cake", "Hamburgers and fries"],
                    correct: 2
                },
                {
                    passage: "After the cabbage feast, Granny would always suggest a game of Scrabble. Ben hated Scrabble almost as much as he hated cabbage soup.",
                    question: "What game did Granny always want to play after dinner?",
                    options: ["Chess", "Scrabble", "Cards", "Monopoly"],
                    correct: 1
                },
                {
                    passage: "Ben's parents were obsessed with ballroom dancing. They wanted Ben to be a professional dancer, but Ben was more interested in plumbing.",
                    question: "What were Ben's parents obsessed with?",
                    options: ["Cooking", "Gardening", "Ballroom dancing", "Reading"],
                    correct: 2
                },
                {
                    passage: "Ben would count the minutes until he could go home. Granny seemed so ordinary, so boring, so... predictable.",
                    question: "How did Ben feel about spending time with his granny?",
                    options: ["He was excited", "He was bored and wanted to go home", "He was happy", "He was curious"],
                    correct: 1
                }
            ],
            1: [ // Chapter 2: Plumbing Weekly
                {
                    passage: "Ben's greatest passion was plumbing. Every week he would secretly buy a copy of 'Plumbing Weekly' from Raj's corner shop.",
                    question: "What was Ben's greatest passion?",
                    options: ["Dancing", "Plumbing", "Cooking", "Sports"],
                    correct: 1
                },
                {
                    passage: "Ben had to hide his plumbing magazines from his parents because they wanted him to focus on ballroom dancing instead.",
                    question: "Why did Ben hide his plumbing magazines?",
                    options: ["They were expensive", "His parents wanted him to focus on dancing", "They were boring", "He was embarrassed"],
                    correct: 1
                },
                {
                    passage: "Raj, the newsagent, always had a kind word for Ben and understood his love of plumbing, unlike Ben's parents.",
                    question: "Who understood Ben's love of plumbing?",
                    options: ["His parents", "His granny", "Raj the newsagent", "His teacher"],
                    correct: 2
                },
                {
                    passage: "Ben dreamed of becoming a professional plumber when he grew up, but his parents had very different plans for him.",
                    question: "What did Ben dream of becoming?",
                    options: ["A professional dancer", "A professional plumber", "A teacher", "A chef"],
                    correct: 1
                },
                {
                    passage: "As Friday evening approached, Ben's heart sank knowing he would have to spend another boring night at Granny's house.",
                    question: "How did Ben feel as Friday evening approached?",
                    options: ["Excited", "His heart sank", "Happy", "Curious"],
                    correct: 1
                }
            ]
        };

        // ë‚˜ë¨¸ì§€ ì±•í„°ë“¤ì„ ìœ„í•œ ê¸°ë³¸ ìƒ˜í”Œ ë¬¸ì œë“¤ (2-33)
        for (let i = 2; i < 34; i++) {
            questionsData[i] = [
                {
                    passage: `This is a sample passage for Chapter ${i + 1}. Ben continues his adventure with Granny and discovers more about her mysterious past as "The Black Cat."`,
                    question: `What happens in Chapter ${i + 1}?`,
                    options: ["Ben gets bored", "Ben discovers something new about Granny", "Ben goes home early", "Ben falls asleep"],
                    correct: 1
                },
                {
                    passage: `In this chapter, the story develops further as Ben learns more about his grandmother's secret life as an international jewel thief.`,
                    question: "What does Ben learn about?",
                    options: ["Cooking recipes", "His grandmother's secret criminal life", "School subjects", "Dancing moves"],
                    correct: 1
                },
                {
                    passage: `The adventure continues as Ben and Granny work together on their amazing plan to steal the Crown Jewels.`,
                    question: "What do Ben and Granny plan together?",
                    options: ["A dance performance", "A cooking lesson", "To steal the Crown Jewels", "A shopping trip"],
                    correct: 2
                },
                {
                    passage: `Ben realizes that his grandmother is far more exciting and adventurous than he ever imagined.`,
                    question: "What does Ben realize about his grandmother?",
                    options: ["She is very boring", "She is more exciting than he imagined", "She is angry with him", "She is very tired"],
                    correct: 1
                },
                {
                    passage: `The chapter builds excitement as Ben and Granny's relationship grows stronger through their shared secret.`,
                    question: "How does Ben feel about his relationship with Granny?",
                    options: ["It gets worse", "It stays the same", "It grows stronger through their shared secret", "He becomes more bored"],
                    correct: 2
                }
            ];
        }

        // ì±… ìƒì„¸ ì •ë³´ í‘œì‹œ
        function showBookDetail() {
            document.getElementById('book-detail-screen').style.display = 'block';
            document.getElementById('learning-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'none';
            generateChapterGrid();
            updateProgress();
        }

        // ì±•í„° ê·¸ë¦¬ë“œ ìƒì„±
        function generateChapterGrid() {
            const grid = document.getElementById('chapters-grid');
            grid.innerHTML = '';

            bookData.chapterList.forEach((chapter, index) => {
                const chapterCard = document.createElement('div');
                chapterCard.className = `chapter-card ${chapter.status}`;

                chapterCard.innerHTML = `
                    <div class="chapter-header">
                        <div class="chapter-info">
                            <h4>${chapter.title}</h4>
                            <p>${chapter.description} (${chapter.questionCount}ë¬¸ì œ)</p>
                        </div>
                        <div class="chapter-status ${chapter.status}">
                            ${chapter.status === 'completed' ? 'âœ… ì™„ë£Œ' :
                              chapter.status === 'current' ? 'ğŸ“– ì§„í–‰ì¤‘' : 'ğŸ”’ ì ê¹€'}
                        </div>
                    </div>
                    <div class="chapter-actions">
                        <button class="chapter-btn audio-btn" onclick="playChapterAudio(${index})"
                                ${chapter.status === 'locked' ? 'disabled' : ''}>
                            ğŸ§ ì˜¤ë””ì˜¤
                        </button>
                        <button class="chapter-btn quiz-btn" onclick="startLearning(${index})"
                                ${chapter.status === 'locked' ? 'disabled' : ''}>
                            ğŸ“ ë¬¸ì œí’€ê¸°
                        </button>
                    </div>
                `;

                grid.appendChild(chapterCard);
            });
        }

        // ì§„ë„ ì—…ë°ì´íŠ¸
        function updateProgress() {
            const completedChapters = bookData.chapterList.filter(chapter => chapter.status === 'completed').length;
            const progressPercent = Math.round((completedChapters / bookData.chapters) * 100);
            document.getElementById('progress-value').textContent = `${progressPercent}%`;
        }

        // í•™ìŠµ ì‹œì‘
        function startLearning(chapterIndex) {
            if (bookData.chapterList[chapterIndex].status === 'locked') return;

            currentChapterIndex = chapterIndex;
            currentQuestionIndex = 0;
            userAnswers = [];
            questions = questionsData[chapterIndex] || [];

            if (questions.length === 0) {
                alert('ì´ ì±•í„°ì˜ ë¬¸ì œê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }

            document.getElementById('book-detail-screen').style.display = 'none';
            document.getElementById('learning-screen').style.display = 'block';
            document.getElementById('result-screen').style.display = 'none';

            const chapter = bookData.chapterList[chapterIndex];
            document.getElementById('learning-title').textContent = chapter.title;
            document.getElementById('learning-chapter-breadcrumb').textContent = chapter.title;

            showQuestion();
        }

        // ë¬¸ì œ í‘œì‹œ
        function showQuestion() {
            if (currentQuestionIndex >= questions.length) {
                submitAnswers();
                return;
            }

            const question = questions[currentQuestionIndex];
            const container = document.getElementById('question-container');

            container.innerHTML = `
                <div class="passage">${question.passage}</div>
                <div class="question-text">${question.question}</div>
                <div class="options">
                    ${question.options.map((option, index) =>
                        `<div class="option" onclick="selectOption(${index})" data-index="${index}">
                            ${String.fromCharCode(65 + index)}. ${option}
                        </div>`
                    ).join('')}
                </div>
            `;

            // ì§„ë„ ë°” ì—…ë°ì´íŠ¸
            const progressPercent = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('learning-progress-bar').style.width = `${progressPercent}%`;
            document.getElementById('learning-progress-text').textContent = `ë¬¸ì œ ${currentQuestionIndex + 1} / ${questions.length}`;

            // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            document.getElementById('prev-btn').disabled = currentQuestionIndex === 0;
            document.getElementById('next-btn').style.display = currentQuestionIndex === questions.length - 1 ? 'none' : 'inline-block';
            document.getElementById('submit-btn').style.display = currentQuestionIndex === questions.length - 1 ? 'inline-block' : 'none';

            // ì´ì „ ë‹µë³€ì´ ìˆë‹¤ë©´ í‘œì‹œ
            if (userAnswers[currentQuestionIndex] !== undefined) {
                const selectedOption = container.querySelector(`[data-index="${userAnswers[currentQuestionIndex]}"]`);
                if (selectedOption) {
                    selectedOption.classList.add('selected');
                }
            }
        }

        // ì˜µì…˜ ì„ íƒ
        function selectOption(index) {
            // ê¸°ì¡´ ì„ íƒ ì œê±°
            document.querySelectorAll('.option').forEach(option => {
                option.classList.remove('selected');
            });

            // ìƒˆ ì„ íƒ ì¶”ê°€
            document.querySelector(`[data-index="${index}"]`).classList.add('selected');
            userAnswers[currentQuestionIndex] = index;
        }

        // ë‹¤ìŒ ë¬¸ì œ
        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                showQuestion();
            }
        }

        // ì´ì „ ë¬¸ì œ
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion();
            }
        }

        // ë‹µì•ˆ ì œì¶œ
        function submitAnswers() {
            let correctCount = 0;
            for (let i = 0; i < questions.length; i++) {
                if (userAnswers[i] === questions[i].correct) {
                    correctCount++;
                }
            }

            const score = Math.round((correctCount / questions.length) * 100);

            // ì±•í„° ìƒíƒœ ì—…ë°ì´íŠ¸
            if (score >= 70) { // 70ì  ì´ìƒì´ë©´ í†µê³¼
                bookData.chapterList[currentChapterIndex].status = 'completed';

                // ë‹¤ìŒ ì±•í„° ì ê¸ˆ í•´ì œ
                if (currentChapterIndex + 1 < bookData.chapterList.length) {
                    if (bookData.chapterList[currentChapterIndex + 1].status === 'locked') {
                        bookData.chapterList[currentChapterIndex + 1].status = 'current';
                    }
                }
            }

            showResult(correctCount, score);
        }

        // ê²°ê³¼ í‘œì‹œ
        function showResult(correctCount, score) {
            document.getElementById('learning-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';

            document.getElementById('score-circle').textContent = `${score}%`;
            document.getElementById('total-questions').textContent = `${questions.length}ë¬¸ì œ`;
            document.getElementById('correct-answers').textContent = `${correctCount}ë¬¸ì œ`;
            document.getElementById('wrong-answers').textContent = `${questions.length - correctCount}ë¬¸ì œ`;
            document.getElementById('final-score').textContent = `${score}ì `;

            let message = '';
            let circleColor = '';

            if (score >= 90) {
                message = 'ğŸŒŸ ì™„ë²½í•©ë‹ˆë‹¤!';
                circleColor = 'linear-gradient(45deg, #FF6B9D, #C44569)';
            } else if (score >= 80) {
                message = 'ğŸ‰ í›Œë¥­í•´ìš”!';
                circleColor = 'linear-gradient(45deg, #FF6B9D, #C44569)';
            } else if (score >= 70) {
                message = 'ğŸ‘ ì˜í–ˆì–´ìš”!';
                circleColor = 'linear-gradient(45deg, #FF6B9D, #C44569)';
            } else {
                message = 'ğŸ’ª ë‹¤ì‹œ ë„ì „í•´ë³´ì„¸ìš”!';
                circleColor = 'linear-gradient(45deg, #ff9800, #f57c00)';
            }

            document.getElementById('result-message').textContent = message;
            document.getElementById('score-circle').style.background = circleColor;
        }

        // ì±•í„° ë‹¤ì‹œ í’€ê¸°
        function retryChapter() {
            startLearning(currentChapterIndex);
        }

        // ë‹¤ìŒ ì±•í„°
        function nextChapter() {
            if (currentChapterIndex + 1 < bookData.chapterList.length) {
                if (bookData.chapterList[currentChapterIndex + 1].status !== 'locked') {
                    startLearning(currentChapterIndex + 1);
                } else {
                    showBookDetail();
                }
            } else {
                showBookDetail();
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('DOMContentLoaded', function() {
            showBookDetail();
        });

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('learning-screen').style.display === 'block') {
                if (e.key === 'ArrowLeft') {
                    previousQuestion();
                } else if (e.key === 'ArrowRight') {
                    nextQuestion();
                } else if (e.key >= '1' && e.key <= '4') {
                    const index = parseInt(e.key) - 1;
                    if (index < questions[currentQuestionIndex]?.options.length) {
                        selectOption(index);
                    }
                }
            }

            if (e.key === 'Escape') {
                closeAudioModal();
            }
        });

        // ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.addEventListener('DOMContentLoaded', function() {
            const audioPlayer = document.getElementById('audio-player');

            audioPlayer.addEventListener('play', function() {
                document.querySelector('.play-pause-btn').textContent = 'â¸ï¸ ì¼ì‹œì •ì§€';
            });

            audioPlayer.addEventListener('pause', function() {
                document.querySelector('.play-pause-btn').textContent = 'â–¶ï¸ ì¬ìƒ';
            });

            audioPlayer.addEventListener('ended', function() {
                document.querySelector('.play-pause-btn').textContent = 'â–¶ï¸ ì¬ìƒ';
            });
        });
    </script>
</body>
</html>
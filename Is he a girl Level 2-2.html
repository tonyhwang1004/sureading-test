<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Is He a Girl? - Level 2-2 - 수리딩어학원</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #4A90E2 0%, #7B68EE 50%, #9370DB 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        /* 헤더 */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #4A90E2, #7B68EE);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .logo-text h1 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
        }

        .logo-text p {
            font-size: 0.9rem;
            color: #666;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
            color: #333;
            text-decoration: none;
        }

        .nav-btn:hover {
            background: #4A90E2;
            color: white;
            transform: translateY(-2px);
        }

        /* 메인 콘텐츠 영역 */
        .main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            min-height: 600px;
        }

        /* 책 상세 화면 */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 30px;
            font-size: 0.9rem;
            color: #666;
        }

        .breadcrumb a {
            color: #4A90E2;
            text-decoration: none;
            cursor: pointer;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .book-detail-header {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: flex-start;
        }

        .detail-book-cover {
            width: 150px;
            height: 220px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 4rem;
            font-weight: bold;
            flex-shrink: 0;
            background: linear-gradient(45deg, #4A90E2, #7B68EE);
        }

        .book-info {
            flex: 1;
        }

        .book-info h2 {
            font-size: 2.2rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .book-info .author {
            font-size: 1.2rem;
            color: #4A90E2;
            margin-bottom: 20px;
        }

        .book-summary {
            font-size: 1rem;
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .book-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-box .value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #4A90E2;
        }

        .stat-box .label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        /* 챕터 그리드 */
        .chapters-section {
            margin-top: 40px;
        }

        .chapters-section h3 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 30px;
            text-align: center;
        }

        .chapters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .chapter-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
        }

        .chapter-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .chapter-card.completed {
            border-color: #28a745;
            background: linear-gradient(135deg, #28a74508, #ffffff);
        }

        .chapter-card.current {
            border-color: #4A90E2;
            background: linear-gradient(135deg, #4A90E208, #ffffff);
        }

        .chapter-card.locked {
            opacity: 0.6;
            background: #f8f9fa;
        }

        .chapter-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .chapter-info h4 {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }

        .chapter-info p {
            font-size: 0.95rem;
            color: #666;
            line-height: 1.5;
        }

        .chapter-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .chapter-status.completed {
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
        }

        .chapter-status.current {
            background: rgba(74, 144, 226, 0.1);
            color: #4A90E2;
        }

        .chapter-status.locked {
            background: rgba(108, 117, 125, 0.1);
            color: #6c757d;
        }

        .chapter-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .chapter-btn {
            padding: 12px 16px;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .audio-btn {
            background: linear-gradient(45deg, #4A90E2, #7B68EE);
            color: white;
        }

        .quiz-btn {
            background: linear-gradient(45deg, #7B68EE, #9370DB);
            color: white;
        }

        .chapter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .chapter-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* 학습 화면 */
        .learning-screen {
            display: none;
        }

        .learning-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .learning-progress {
            background: #f8f9fa;
            border-radius: 10px;
            height: 8px;
            margin: 20px 0;
            overflow: hidden;
        }

        .learning-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4A90E2, #7B68EE);
            transition: width 0.3s ease;
        }

        .question-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
        }

        .passage {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1rem;
            line-height: 1.6;
            color: #444;
        }

        .options {
            display: grid;
            gap: 10px;
        }

        .option {
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option:hover {
            background: #e9ecef;
            border-color: #4A90E2;
        }

        .option.selected {
            background: rgba(74, 144, 226, 0.1);
            border-color: #4A90E2;
        }

        .learning-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .control-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .next-btn {
            background: linear-gradient(45deg, #4A90E2, #7B68EE);
            color: white;
        }

        .prev-btn {
            background: #6c757d;
            color: white;
        }

        .submit-btn {
            background: linear-gradient(45deg, #4A90E2, #7B68EE);
            color: white;
        }

        .control-btn:hover {
            transform: translateY(-2px);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* 결과 화면 */
        .result-screen {
            display: none;
            text-align: center;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(45deg, #4A90E2, #7B68EE);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            font-size: 2rem;
            font-weight: bold;
        }

        .result-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .result-stat {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .result-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        /* 오디오 플레이어 모달 */
        .audio-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .audio-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 600px;
            width: 90%;
            position: relative;
        }

        .close-audio {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #666;
        }

        .audio-player {
            width: 100%;
            margin: 20px 0;
            border-radius: 10px;
        }

        .audio-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .audio-control-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .play-pause-btn {
            background: linear-gradient(45deg, #4A90E2, #7B68EE);
            color: white;
        }

        .speed-btn {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #ddd;
        }

        .download-btn {
            background: #7B68EE;
            color: white;
        }

        .audio-info {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            font-size: 0.9rem;
            color: #666;
            transition: all 0.3s ease;
        }

        .audio-info.hidden {
            display: none;
        }

        /* 반응형 */
        @media (max-width: 768px) {
            .chapters-grid {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .book-detail-header {
                flex-direction: column;
                text-align: center;
            }

            .book-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .learning-controls {
                flex-direction: column;
            }

            .chapter-actions {
                grid-template-columns: 1fr;
            }

            .audio-controls {
                justify-content: center;
                gap: 10px;
            }

            .audio-content {
                padding: 30px 20px;
            }
        }

        .new-book-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: linear-gradient(45deg, #FF6B9D, #C44569);
            color: white;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: 700;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Level 2 특별 스타일 */
        .level-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: linear-gradient(45deg, #4A90E2, #FF6B9D);
            color: white;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 헤더 -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">❓</div>
                <div class="logo-text">
                    <h1>Is He a Girl?</h1>
                    <p>Level 2-2 - Louis Sachar의 재미있는 초등학교 이야기</p>
                </div>
            </div>
            <div class="nav-buttons">
                <a href="http://www.suelibrary.store/" class="nav-btn">메인으로</a>
            </div>
        </div>

        <!-- 메인 콘텐츠 -->
        <div class="main-content">
            <!-- 책 상세 화면 -->
            <div class="book-detail-screen" id="book-detail-screen">
                <div class="level-badge">Level 2-2</div>
                <div class="breadcrumb">
                    <span>Is He a Girl?</span>
                </div>

                <div class="book-detail-header">
                    <div class="detail-book-cover">❓</div>
                    <div class="book-info">
                        <h2>Is He a Girl?</h2>
                        <div class="author">Louis Sachar</div>
                        <div class="book-summary">
                            Nine-year-old Marvin Redpost learns from eccentric classmate Casey Happleton that if a boy kisses his elbow, he will turn into a girl. When Marvin accidentally manages to kiss his elbow, he begins to worry that he's actually turning into a girl. He starts wanting pigtails, dotting his i's with hearts, and feeling different about "boy" and "girl" activities. This hilarious and thought-provoking chapter book explores gender stereotypes and childhood anxieties with humor and understanding.
                        </div>
                        <div class="book-stats">
                            <div class="stat-box">
                                <div class="value">12</div>
                                <div class="label">챕터</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">60</div>
                                <div class="label">총 문제</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">Level 2-2</div>
                                <div class="label">레벨</div>
                            </div>
                            <div class="stat-box">
                                <div class="value" id="progress-value">0%</div>
                                <div class="label">진도</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="chapters-section">
                    <h3>❓ 챕터별 학습</h3>
                    <div class="chapters-grid" id="chapters-grid">
                        <!-- 챕터 카드들 -->
                    </div>
                </div>
            </div>

            <!-- 학습 화면 -->
            <div class="learning-screen" id="learning-screen">
                <div class="breadcrumb">
                    <a onclick="showBookDetail()">Is He a Girl?</a>
                    <span>></span>
                    <span id="learning-chapter-breadcrumb">Chapter 1</span>
                </div>

                <div class="learning-header">
                    <h2 id="learning-title">Chapter 1</h2>
                    <div class="learning-progress">
                        <div class="learning-progress-bar" id="learning-progress-bar" style="width: 0%"></div>
                    </div>
                    <p id="learning-progress-text">문제 1 / 5</p>
                </div>

                <div class="question-container" id="question-container">
                    <!-- 문제가 동적으로 생성됩니다 -->
                </div>

                <div class="learning-controls">
                    <button class="control-btn prev-btn" id="prev-btn" onclick="previousQuestion()" disabled>이전</button>
                    <button class="control-btn next-btn" id="next-btn" onclick="nextQuestion()">다음</button>
                    <button class="control-btn submit-btn" id="submit-btn" onclick="submitAnswers()" style="display: none;">제출</button>
                </div>
            </div>

            <!-- 결과 화면 -->
            <div class="result-screen" id="result-screen">
                <div class="breadcrumb">
                    <a onclick="showBookDetail()">Is He a Girl?</a>
                    <span>></span>
                    <span>결과</span>
                </div>

                <div class="result-header">
                    <h2>학습 완료!</h2>
                    <div class="score-circle" id="score-circle">100%</div>
                    <h3 id="result-message">훌륭합니다!</h3>
                </div>

                <div class="result-details">
                    <div class="result-stat">
                        <h4>총 문제</h4>
                        <p id="total-questions">5문제</p>
                    </div>
                    <div class="result-stat">
                        <h4>정답</h4>
                        <p id="correct-answers">5문제</p>
                    </div>
                    <div class="result-stat">
                        <h4>오답</h4>
                        <p id="wrong-answers">0문제</p>
                    </div>
                    <div class="result-stat">
                        <h4>점수</h4>
                        <p id="final-score">100점</p>
                    </div>
                </div>

                <div class="result-actions">
                    <button class="control-btn prev-btn" onclick="retryChapter()">다시 풀기</button>
                    <button class="control-btn next-btn" onclick="nextChapter()">다음 챕터</button>
                    <button class="control-btn submit-btn" onclick="showBookDetail()">챕터 목록</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 오디오 플레이어 모달 -->
    <div class="audio-modal" id="audio-modal">
        <div class="audio-content">
            <button class="close-audio" onclick="closeAudioModal()">×</button>
            <h3 id="audio-chapter-title">Chapter 1</h3>
            <p id="audio-chapter-subtitle">Is He a Girl? - Louis Sachar</p>

            <audio class="audio-player" id="audio-player" controls preload="metadata">
                <source id="audio-source" src="" type="audio/mpeg">
                브라우저가 오디오를 지원하지 않습니다.
            </audio>

            <div class="audio-controls">
                <button class="audio-control-btn play-pause-btn" onclick="togglePlayPause()">재생</button>
                <button class="audio-control-btn speed-btn" onclick="changeSpeed()">1.0x</button>
                <button class="audio-control-btn" onclick="resetToChapterStart()" style="background: #28a745; color: white;">구간처음</button>
                <button class="audio-control-btn download-btn" onclick="downloadAudio()">다운로드</button>
            </div>

            <div class="audio-info" id="audio-info">
                <div id="audio-status" style="margin-top: 10px; font-weight: bold; color: #4A90E2;"></div>
            </div>
        </div>
    </div>

    <script>
        // 구글 클라우드 스토리지 오디오 URL 설정
        const AUDIO_BASE_URL = 'https://storage.googleapis.com/kim-mom-reading-audio/audio/';

        // Is He a Girl 챕터별 개별 파일 매핑
        const isHeGirlFileMapping = {
            0: '001.mp3',   // Chapter 1: A Weird Girl
            1: '002.mp3',   // Chapter 2: Bugged
            2: '003.mp3',   // Chapter 3: Marvin Wears a Dress
            3: '004.mp3',   // Chapter 4: Don't Go to Sleep!
            4: '005.mp3',   // Chapter 5: The Ugliest Face in the World
            5: '006.mp3',   // Chapter 6: Off to School
            6: '007.mp3',   // Chapter 7: It's Fun to be a Girl
            7: '008.mp3',   // Chapter 8: A Little Different
            8: '009.mp3',   // Chapter 9: He Wouldn't Hit a Girl
            9: '010.mp3',   // Chapter 10: High Atop the Spiderweb
            10: '011.mp3',  // Chapter 11: Caught in the Web
            11: '012.mp3'   // Chapter 12: Normal
        };

        // 전역 변수
        let currentChapterIndex = 0;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let questions = [];
        let currentAudio = null;
        let playbackSpeed = 1.0;

        // 오디오 URL 생성 함수 (챕터별 개별 파일)
        function getAudioUrl(chapterIndex) {
            const fileName = isHeGirlFileMapping[chapterIndex];
            if (!fileName) return null;
            
            return {
                primary: `${AUDIO_BASE_URL}MRP003_Is_He_a_Girl/${fileName}`,
                alternatives: [`${AUDIO_BASE_URL}MRP003_Is_He_a_Girl/${fileName}`]
            };
        }

        // 오디오 재생 함수 (개별 파일)
        function playChapterAudio(chapterIndex) {
            const chapter = bookData.chapterList[chapterIndex];
            const audioData = getAudioUrl(chapterIndex);
            
            if (!audioData) {
                alert('해당 챕터의 오디오 파일이 없습니다.');
                return;
            }

            document.getElementById('audio-modal').style.display = 'flex';
            document.getElementById('audio-chapter-title').textContent = `Chapter ${chapterIndex + 1}`;
            document.getElementById('audio-chapter-subtitle').textContent = `${bookData.title} - ${bookData.author}`;
            document.getElementById('audio-info').classList.remove('hidden');

            const audioPlayer = document.getElementById('audio-player');
            const audioSource = document.getElementById('audio-source');
            const audioStatus = document.getElementById('audio-status');

            audioStatus.textContent = '오디오 파일을 로딩 중...';

            audioSource.src = audioData.primary;
            audioPlayer.load();

            const successHandler = function() {
                audioStatus.innerHTML = `Chapter ${chapterIndex + 1} 로드 완료!`;

                audioPlayer.play().then(() => {
                    audioStatus.innerHTML = `Chapter ${chapterIndex + 1} 재생 중!`;
                    document.querySelector('.play-pause-btn').textContent = '일시정지';
                }).catch(e => {
                    console.log('자동 재생 차단됨:', e);
                    audioStatus.innerHTML = `Chapter ${chapterIndex + 1} 준비됨! 재생 버튼을 눌러주세요`;
                });
            };

            const errorHandler = function() {
                audioStatus.innerHTML = '오디오 파일을 찾을 수 없습니다.';
            };

            audioPlayer.addEventListener('canplaythrough', successHandler, { once: true });
            audioPlayer.addEventListener('error', errorHandler, { once: true });

            currentAudio = audioPlayer;
            playbackSpeed = 1.0;
        }

        // 구간처음으로 함수 (개별 파일이므로 파일 처음으로)
        function resetToChapterStart() {
            if (!currentAudio) return;
            currentAudio.currentTime = 0;
            console.log('챕터 파일 처음으로 이동');
        }

        // 기본 오디오 컨트롤 함수들
        function closeAudioModal() {
            document.getElementById('audio-modal').style.display = 'none';
            if (currentAudio) currentAudio.pause();
        }

        function togglePlayPause() {
            if (!currentAudio) return;
            if (currentAudio.paused) {
                currentAudio.play();
                document.querySelector('.play-pause-btn').textContent = '일시정지';
            } else {
                currentAudio.pause();
                document.querySelector('.play-pause-btn').textContent = '재생';
            }
        }

        function changeSpeed() {
            if (!currentAudio) return;
            const speeds = [0.5, 0.75, 1.0, 1.25, 1.5, 2.0];
            const currentIndex = speeds.indexOf(playbackSpeed);
            playbackSpeed = speeds[(currentIndex + 1) % speeds.length];
            currentAudio.playbackRate = playbackSpeed;
            document.querySelector('.speed-btn').textContent = `${playbackSpeed}x`;
        }

        function downloadAudio() {
            const audioSource = document.getElementById('audio-source');
            if (audioSource.src) {
                const link = document.createElement('a');
                link.href = audioSource.src;
                link.download = `${document.getElementById('audio-chapter-title').textContent}.mp3`;
                link.click();
            }
        }

        // Is He a Girl 도서 데이터
        const bookData = {
            id: 'IHG001',
            title: "Is He a Girl?",
            author: 'Louis Sachar',
            cover: '❓',
            progress: 0,
            chapters: 12,
            totalQuestions: 60,
            coverColor: 'linear-gradient(45deg, #4A90E2, #7B68EE)',
            summary: "Nine-year-old Marvin Redpost learns from eccentric classmate Casey Happleton that if a boy kisses his elbow, he will turn into a girl. When Marvin accidentally manages to kiss his elbow, he begins to worry that he's actually turning into a girl. He starts wanting pigtails, dotting his i's with hearts, and feeling different about \"boy\" and \"girl\" activities. This hilarious and thought-provoking chapter book explores gender stereotypes and childhood anxieties with humor and understanding.",
            chapterList: [
                { title: 'Chapter 1: A Weird Girl', description: 'Casey Happleton tells Marvin about the elbow-kissing rumor.', status: 'current', questionCount: 5, startTime: 0 },
                { title: 'Chapter 2: Bugged', description: 'Marvin attempts to kiss his elbow and succeeds.', status: 'current', questionCount: 5, startTime: 300 },
                { title: 'Chapter 3: Marvin Wears a Dress', description: 'Marvin starts feeling different about his clothes and appearance.', status: 'current', questionCount: 5, startTime: 600 },
                { title: 'Chapter 4: Don\'t Go to Sleep!', description: 'Marvin worries about what might happen while he sleeps.', status: 'current', questionCount: 5, startTime: 900 },
                { title: 'Chapter 5: The Ugliest Face in the World', description: 'Marvin thinks he sees himself as a girl in the mirror.', status: 'current', questionCount: 5, startTime: 1200 },
                { title: 'Chapter 6: Off to School', description: 'Marvin goes to school feeling very self-conscious.', status: 'current', questionCount: 5, startTime: 1500 },
                { title: 'Chapter 7: It\'s Fun to be a Girl', description: 'Marvin starts enjoying traditionally \"girl\" activities.', status: 'current', questionCount: 5, startTime: 1800 },
                { title: 'Chapter 8: A Little Different', description: 'Marvin\'s behavior at school becomes more feminine.', status: 'current', questionCount: 5, startTime: 2100 },
                { title: 'Chapter 9: He Wouldn\'t Hit a Girl', description: 'Other kids start treating Marvin differently.', status: 'current', questionCount: 5, startTime: 2400 },
                { title: 'Chapter 10: High Atop the Spiderweb', description: 'Marvin shows he can do things that are supposedly just for girls.', status: 'current', questionCount: 5, startTime: 2700 },
                { title: 'Chapter 11: Caught in the Web', description: 'Marvin gets trapped on the playground equipment.', status: 'current', questionCount: 5, startTime: 3000 },
                { title: 'Chapter 12: Normal', description: 'Marvin learns about what makes someone a boy or a girl.', status: 'current', questionCount: 5, startTime: 3300 }
            ]
        };

        // 문제 데이터 (샘플)
        const questionsData = {
            0: [ // Chapter 1: A Weird Girl
                {
                    passage: "Casey Happleton was considered the weirdest girl in Marvin's class. She always knew strange facts and told unusual stories that nobody else had heard before.",
                    question: "What was Casey Happleton known for in Marvin's class?",
                    options: ["Being the smartest student", "Being considered the weirdest girl who knew strange facts", "Being the most popular girl", "Being the best athlete"],
                    correct: 1
                },
                {
                    passage: "Casey told Marvin, 'If you kiss your elbow, you'll turn into a girl.' She said it with complete confidence, as if it were a scientific fact.",
                    question: "What did Casey tell Marvin would happen if he kissed his elbow?",
                    options: ["He would get sick", "He would turn into a girl", "He would become stronger", "He would disappear"],
                    correct: 1
                },
                {
                    passage: "Marvin laughed at Casey's claim and thought it was the silliest thing he had ever heard. Boys can't turn into girls, he thought to himself.",
                    question: "How did Marvin initially react to Casey's claim?",
                    options: ["He believed it immediately", "He laughed and thought it was silly", "He got scared", "He told the teacher"],
                    correct: 1
                },
                {
                    passage: "Casey insisted it was true and said, 'Try it if you don't believe me. But don't say I didn't warn you when you wake up as a girl tomorrow.'",
                    question: "What did Casey challenge Marvin to do?",
                    options: ["Ask his parents about it", "Try kissing his elbow if he didn't believe her", "Look it up in a book", "Ask other kids about it"],
                    correct: 1
                },
                {
                    passage: "Even though Marvin thought Casey was weird, he couldn't help but wonder if there might be some truth to what she said. The idea stuck in his mind all day.",
                    question: "Despite thinking Casey was weird, what happened to Marvin?",
                    options: ["He forgot about it completely", "He couldn't help wondering if it might be true", "He told everyone about it", "He decided to avoid Casey"],
                    correct: 1
                }
            ],
            1: [ // Chapter 2: Bugged
                {
                    passage: "That night, Marvin tried to kiss his elbow while lying in bed. It seemed impossible - every time he brought his elbow close to his mouth, his arm wouldn't bend the right way.",
                    question: "What did Marvin try to do that night in bed?",
                    options: ["Read a book", "Kiss his elbow", "Do homework", "Call Casey"],
                    correct: 1
                },
                {
                    passage: "Marvin twisted and turned, trying different positions. He tried using his left elbow, then his right elbow, but it was incredibly difficult.",
                    question: "What made kissing his elbow so challenging for Marvin?",
                    options: ["His parents were watching", "It was incredibly difficult to reach", "He was too tired", "He didn't want to do it"],
                    correct: 1
                },
                {
                    passage: "Just as Marvin was about to give up, he got tangled in his bedsheets and somehow managed to kiss the outside of his elbow for just a brief moment.",
                    question: "How did Marvin finally manage to kiss his elbow?",
                    options: ["He asked for help", "He used a mirror", "He got tangled in bedsheets and managed it briefly", "He never actually succeeded"],
                    correct: 2
                },
                {
                    passage: "The moment Marvin's lips touched his elbow, he felt a strange tingle. 'Oh no,' he thought. 'What if Casey was right?'",
                    question: "What did Marvin feel when he kissed his elbow?",
                    options: ["Nothing at all", "Pain in his arm", "A strange tingle", "Very happy"],
                    correct: 2
                },
                {
                    passage: "Marvin lay awake for hours, worried about what might happen to him. Would he really wake up as a girl? The thought both scared and fascinated him.",
                    question: "How did Marvin feel after kissing his elbow?",
                    options: ["Relieved and happy", "Worried and couldn't sleep", "Excited to tell his friends", "Angry at Casey"],
                    correct: 1
                }
            ]
            // 나머지 챕터들도 유사하게 구성...
        };

        // 책 상세 정보 표시
        function showBookDetail() {
            document.getElementById('book-detail-screen').style.display = 'block';
            document.getElementById('learning-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'none';
            generateChapterGrid();
            updateProgress();
        }

        // 챕터 그리드 생성
        function generateChapterGrid() {
            const grid = document.getElementById('chapters-grid');
            grid.innerHTML = '';

            bookData.chapterList.forEach((chapter, index) => {
                const chapterCard = document.createElement('div');
                chapterCard.className = `chapter-card ${chapter.status}`;

                chapterCard.innerHTML = `
                    <div class="chapter-header">
                        <div class="chapter-info">
                            <h4>${chapter.title}</h4>
                            <p>${chapter.description} (${chapter.questionCount}문제)</p>
                        </div>
                        <div class="chapter-status ${chapter.status}">
                            ${chapter.status === 'completed' ? '완료' :
                              chapter.status === 'current' ? '진행중' : '잠김'}
                        </div>
                    </div>
                    <div class="chapter-actions">
                        <button class="chapter-btn audio-btn" onclick="playChapterAudio(${index})"
                                ${chapter.status === 'locked' ? 'disabled' : ''}>
                            오디오
                        </button>
                        <button class="chapter-btn quiz-btn" onclick="startLearning(${index})"
                                ${chapter.status === 'locked' ? 'disabled' : ''}>
                            문제풀기
                        </button>
                    </div>
                `;

                grid.appendChild(chapterCard);
            });
        }

        // 진도 업데이트
        function updateProgress() {
            const completedChapters = bookData.chapterList.filter(chapter => chapter.status === 'completed').length;
            const progressPercent = Math.round((completedChapters / bookData.chapters) * 100);
            document.getElementById('progress-value').textContent = `${progressPercent}%`;
        }

        // 학습 시작
        function startLearning(chapterIndex) {
            if (bookData.chapterList[chapterIndex].status === 'locked') return;

            currentChapterIndex = chapterIndex;
            currentQuestionIndex = 0;
            userAnswers = [];
            questions = questionsData[chapterIndex] || [];

            if (questions.length === 0) {
                alert('이 챕터의 문제가 준비되지 않았습니다.');
                return;
            }

            document.getElementById('book-detail-screen').style.display = 'none';
            document.getElementById('learning-screen').style.display = 'block';
            document.getElementById('result-screen').style.display = 'none';

            const chapter = bookData.chapterList[chapterIndex];
            document.getElementById('learning-title').textContent = chapter.title;
            document.getElementById('learning-chapter-breadcrumb').textContent = chapter.title;

            showQuestion();
        }

        // 문제 표시
        function showQuestion() {
            if (currentQuestionIndex >= questions.length) {
                submitAnswers();
                return;
            }

            const question = questions[currentQuestionIndex];
            const container = document.getElementById('question-container');

            container.innerHTML = `
                <div class="passage">${question.passage}</div>
                <div class="question-text">${question.question}</div>
                <div class="options">
                    ${question.options.map((option, index) =>
                        `<div class="option" onclick="selectOption(${index})" data-index="${index}">
                            ${String.fromCharCode(65 + index)}. ${option}
                        </div>`
                    ).join('')}
                </div>
            `;

            // 진도 바 업데이트
            const progressPercent = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('learning-progress-bar').style.width = `${progressPercent}%`;
            document.getElementById('learning-progress-text').textContent = `문제 ${currentQuestionIndex + 1} / ${questions.length}`;

            // 버튼 상태 업데이트
            document.getElementById('prev-btn').disabled = currentQuestionIndex === 0;
            document.getElementById('next-btn').style.display = currentQuestionIndex === questions.length - 1 ? 'none' : 'inline-block';
            document.getElementById('submit-btn').style.display = currentQuestionIndex === questions.length - 1 ? 'inline-block' : 'none';

            // 이전 답변이 있다면 표시
            if (userAnswers[currentQuestionIndex] !== undefined) {
                const selectedOption = container.querySelector(`[data-index="${userAnswers[currentQuestionIndex]}"]`);
                if (selectedOption) {
                    selectedOption.classList.add('selected');
                }
            }
        }

        // 옵션 선택
        function selectOption(index) {
            // 기존 선택 제거
            document.querySelectorAll('.option').forEach(option => {
                option.classList.remove('selected');
            });

            // 새 선택 추가
            document.querySelector(`[data-index="${index}"]`).classList.add('selected');
            userAnswers[currentQuestionIndex] = index;
        }

        // 다음 문제
        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                showQuestion();
            }
        }

        // 이전 문제
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion();
            }
        }

        // 답안 제출
        function submitAnswers() {
            let correctCount = 0;
            for (let i = 0; i < questions.length; i++) {
                if (userAnswers[i] === questions[i].correct) {
                    correctCount++;
                }
            }

            const score = Math.round((correctCount / questions.length) * 100);

            // 챕터 상태 업데이트
            if (score >= 70) { // 70점 이상이면 통과
                bookData.chapterList[currentChapterIndex].status = 'completed';

                // 다음 챕터 잠금 해제
                if (currentChapterIndex + 1 < bookData.chapterList.length) {
                    if (bookData.chapterList[currentChapterIndex + 1].status === 'locked') {
                        bookData.chapterList[currentChapterIndex + 1].status = 'current';
                    }
                }
            }

            showResult(correctCount, score);
        }

        // 결과 표시
        function showResult(correctCount, score) {
            document.getElementById('learning-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';

            document.getElementById('score-circle').textContent = `${score}%`;
            document.getElementById('total-questions').textContent = `${questions.length}문제`;
            document.getElementById('correct-answers').textContent = `${correctCount}문제`;
            document.getElementById('wrong-answers').textContent = `${questions.length - correctCount}문제`;
            document.getElementById('final-score').textContent = `${score}점`;

            let message = '';
            let circleColor = '';

            if (score >= 90) {
                message = '완벽합니다!';
                circleColor = 'linear-gradient(45deg, #4A90E2, #7B68EE)';
            } else if (score >= 80) {
                message = '훌륭해요!';
                circleColor = 'linear-gradient(45deg, #4A90E2, #7B68EE)';
            } else if (score >= 70) {
                message = '잘했어요!';
                circleColor = 'linear-gradient(45deg, #4A90E2, #7B68EE)';
            } else {
                message = '다시 도전해보세요!';
                circleColor = 'linear-gradient(45deg, #ff9800, #f57c00)';
            }

            document.getElementById('result-message').textContent = message;
            document.getElementById('score-circle').style.background = circleColor;
        }

        // 챕터 다시 풀기
        function retryChapter() {
            startLearning(currentChapterIndex);
        }

        // 다음 챕터
        function nextChapter() {
            if (currentChapterIndex + 1 < bookData.chapterList.length) {
                if (bookData.chapterList[currentChapterIndex + 1].status !== 'locked') {
                    startLearning(currentChapterIndex + 1);
                } else {
                    showBookDetail();
                }
            } else {
                showBookDetail();
            }
        }

        // 페이지 로드 시 초기화
        window.addEventListener('DOMContentLoaded', function() {
            showBookDetail();
        });

        // 키보드 단축키
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('learning-screen').style.display === 'block') {
                if (e.key === 'ArrowLeft') {
                    previousQuestion();
                } else if (e.key === 'ArrowRight') {
                    nextQuestion();
                } else if (e.key >= '1' && e.key <= '4') {
                    const index = parseInt(e.key) - 1;
                    if (index < questions[currentQuestionIndex]?.options.length) {
                        selectOption(index);
                    }
                }
            }

            if (e.key === 'Escape') {
                closeAudioModal();
            }
        });

        // 오디오 플레이어 이벤트 리스너
        document.addEventListener('DOMContentLoaded', function() {
            const audioPlayer = document.getElementById('audio-player');

            audioPlayer.addEventListener('play', function() {
                document.querySelector('.play-pause-btn').textContent = '일시정지';
            });

            audioPlayer.addEventListener('pause', function() {
                document.querySelector('.play-pause-btn').textContent = '재생';
            });

            audioPlayer.addEventListener('ended', function() {
                document.querySelector('.play-pause-btn').textContent = '재생';
            });
        });
    </script>
</body>
</html>
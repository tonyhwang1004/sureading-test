<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>James and the Giant Peach - Level 3-2 - ÏàòÎ¶¨Îî©Ïñ¥ÌïôÏõê</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #FF6B9D 0%, #FF8E8E 50%, #FFB347 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        /* Ìó§Îçî */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #FF6B9D, #FF8E8E);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .logo-text h1 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
        }

        .logo-text p {
            font-size: 0.9rem;
            color: #666;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
            color: #333;
            text-decoration: none;
        }

        .nav-btn:hover {
            background: #FF6B9D;
            color: white;
            transform: translateY(-2px);
        }

        /* Î©îÏù∏ ÏΩòÌÖêÏ∏† ÏòÅÏó≠ */
        .main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            min-height: 600px;
        }

        /* Ï±Ö ÏÉÅÏÑ∏ ÌôîÎ©¥ */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 30px;
            font-size: 0.9rem;
            color: #666;
        }

        .breadcrumb a {
            color: #FF6B9D;
            text-decoration: none;
            cursor: pointer;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .book-detail-header {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: flex-start;
        }

        .detail-book-cover {
            width: 150px;
            height: 220px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 4rem;
            font-weight: bold;
            flex-shrink: 0;
            background: linear-gradient(45deg, #FF6B9D, #FF8E8E);
        }

        .book-info {
            flex: 1;
        }

        .book-info h2 {
            font-size: 2.2rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .book-info .author {
            font-size: 1.2rem;
            color: #FF6B9D;
            margin-bottom: 20px;
        }

        .book-summary {
            font-size: 1rem;
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .book-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-box .value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #FF6B9D;
        }

        .stat-box .label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        /* Ï±ïÌÑ∞ Í∑∏Î¶¨Îìú */
        .chapters-section {
            margin-top: 40px;
        }

        .chapters-section h3 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 30px;
            text-align: center;
        }

        .chapters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .chapter-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
        }

        .chapter-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .chapter-card.completed {
            border-color: #28a745;
            background: linear-gradient(135deg, #28a74508, #ffffff);
        }

        .chapter-card.current {
            border-color: #FF6B9D;
            background: linear-gradient(135deg, #FF6B9D08, #ffffff);
        }

        .chapter-card.locked {
            opacity: 0.6;
            background: #f8f9fa;
        }

        .chapter-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .chapter-info h4 {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }

        .chapter-info p {
            font-size: 0.95rem;
            color: #666;
            line-height: 1.5;
        }

        .chapter-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .chapter-status.completed {
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
        }

        .chapter-status.current {
            background: rgba(255, 107, 157, 0.1);
            color: #FF6B9D;
        }

        .chapter-status.locked {
            background: rgba(108, 117, 125, 0.1);
            color: #6c757d;
        }

        .chapter-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .chapter-btn {
            padding: 12px 16px;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .audio-btn {
            background: linear-gradient(45deg, #FF6B9D, #FF8E8E);
            color: white;
        }

        .quiz-btn {
            background: linear-gradient(45deg, #FF8E8E, #FFB347);
            color: #333;
        }

        .chapter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .chapter-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* ÌïôÏäµ ÌôîÎ©¥ */
        .learning-screen {
            display: none;
        }

        .learning-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .learning-progress {
            background: #f8f9fa;
            border-radius: 10px;
            height: 8px;
            margin: 20px 0;
            overflow: hidden;
        }

        .learning-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #FF6B9D, #FF8E8E);
            transition: width 0.3s ease;
        }

        .question-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
        }

        .passage {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1rem;
            line-height: 1.6;
            color: #444;
        }

        .options {
            display: grid;
            gap: 10px;
        }

        .option {
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option:hover {
            background: #e9ecef;
            border-color: #FF6B9D;
        }

        .option.selected {
            background: rgba(255, 107, 157, 0.1);
            border-color: #FF6B9D;
        }

        .learning-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .control-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .next-btn {
            background: linear-gradient(45deg, #FF6B9D, #FF8E8E);
            color: white;
        }

        .prev-btn {
            background: #6c757d;
            color: white;
        }

        .submit-btn {
            background: linear-gradient(45deg, #FF6B9D, #FF8E8E);
            color: white;
        }

        .control-btn:hover {
            transform: translateY(-2px);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Í≤∞Í≥º ÌôîÎ©¥ */
        .result-screen {
            display: none;
            text-align: center;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(45deg, #FF6B9D, #FF8E8E);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            font-size: 2rem;
            font-weight: bold;
        }

        .result-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .result-stat {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .result-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        /* Ïò§ÎîîÏò§ ÌîåÎ†àÏù¥Ïñ¥ Î™®Îã¨ */
        .audio-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .audio-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 600px;
            width: 90%;
            position: relative;
        }

        .close-audio {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #666;
        }

        .audio-player {
            width: 100%;
            margin: 20px 0;
            border-radius: 10px;
        }

        .audio-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .audio-control-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .play-pause-btn {
            background: linear-gradient(45deg, #FF6B9D, #FF8E8E);
            color: white;
        }

        .speed-btn {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #ddd;
        }

        .download-btn {
            background: #FF8E8E;
            color: white;
        }

        .audio-info {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            font-size: 0.9rem;
            color: #666;
            transition: all 0.3s ease;
        }

        .audio-info.hidden {
            display: none;
        }

        /* Î∞òÏùëÌòï */
        @media (max-width: 768px) {
            .chapters-grid {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .book-detail-header {
                flex-direction: column;
                text-align: center;
            }

            .book-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .learning-controls {
                flex-direction: column;
            }

            .chapter-actions {
                grid-template-columns: 1fr;
            }

            .audio-controls {
                justify-content: center;
                gap: 10px;
            }

            .audio-content {
                padding: 30px 20px;
            }
        }

        .new-book-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: linear-gradient(45deg, #FF6B9D, #C44569);
            color: white;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: 700;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Level 3-2 ÌäπÎ≥Ñ Ïä§ÌÉÄÏùº */
        .level-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: linear-gradient(45deg, #FF6B9D, #32CD32);
            color: white;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ìó§Îçî -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">üçë</div>
                <div class="logo-text">
                    <h1>James and the Giant Peach</h1>
                    <p>Level 3-2 - Roald DahlÏùò ÌôòÏÉÅÏ†ÅÏù∏ Î≥µÏà≠ÏïÑ Î™®Ìóò</p>
                </div>
            </div>
            <div class="nav-buttons">
                <a href="http://www.suelibrary.store/" class="nav-btn">Î©îÏù∏ÏúºÎ°ú</a>
            </div>
        </div>

        <!-- Î©îÏù∏ ÏΩòÌÖêÏ∏† -->
        <div class="main-content">
            <!-- Ï±Ö ÏÉÅÏÑ∏ ÌôîÎ©¥ -->
            <div class="book-detail-screen" id="book-detail-screen">
                <div class="level-badge">Level 3-2</div>
                <div class="breadcrumb">
                    <span>James and the Giant Peach</span>
                </div>

                <div class="book-detail-header">
                    <div class="detail-book-cover">üçë</div>
                    <div class="book-info">
                        <h2>James and the Giant Peach</h2>
                        <div class="author">Roald Dahl</div>
                        <div class="book-summary">
                            James Henry Trotter loses his parents and is forced to live with his two horrible aunts, Sponge and Spiker. When a mysterious old man gives him magic crystals that accidentally spill on a barren peach tree, a giant peach grows. James enters the peach and meets friendly giant insects who become his companions on an incredible journey across the ocean and sky to New York City. This classic tale by Roald Dahl celebrates friendship, courage, and the power of imagination.
                        </div>
                        <div class="book-stats">
                            <div class="stat-box">
                                <div class="value">39</div>
                                <div class="label">Ï±ïÌÑ∞</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">195</div>
                                <div class="label">Ï¥ù Î¨∏Ï†ú</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">Level 3-2</div>
                                <div class="label">Î†àÎ≤®</div>
                            </div>
                            <div class="stat-box">
                                <div class="value" id="progress-value">0%</div>
                                <div class="label">ÏßÑÎèÑ</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="chapters-section">
                    <h3>üçë Ï±ïÌÑ∞Î≥Ñ ÌïôÏäµ</h3>
                    <div class="chapters-grid" id="chapters-grid">
                        <!-- Ï±ïÌÑ∞ Ïπ¥ÎìúÎì§ -->
                    </div>
                </div>
            </div>

            <!-- ÌïôÏäµ ÌôîÎ©¥ -->
            <div class="learning-screen" id="learning-screen">
                <div class="breadcrumb">
                    <a onclick="showBookDetail()">James and the Giant Peach</a>
                    <span>></span>
                    <span id="learning-chapter-breadcrumb">Chapter 1</span>
                </div>

                <div class="learning-header">
                    <h2 id="learning-title">Chapter 1</h2>
                    <div class="learning-progress">
                        <div class="learning-progress-bar" id="learning-progress-bar" style="width: 0%"></div>
                    </div>
                    <p id="learning-progress-text">Î¨∏Ï†ú 1 / 5</p>
                </div>

                <div class="question-container" id="question-container">
                    <!-- Î¨∏Ï†úÍ∞Ä ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
                </div>

                <div class="learning-controls">
                    <button class="control-btn prev-btn" id="prev-btn" onclick="previousQuestion()" disabled>Ïù¥Ï†Ñ</button>
                    <button class="control-btn next-btn" id="next-btn" onclick="nextQuestion()">Îã§Ïùå</button>
                    <button class="control-btn submit-btn" id="submit-btn" onclick="submitAnswers()" style="display: none;">Ï†úÏ∂ú</button>
                </div>
            </div>

            <!-- Í≤∞Í≥º ÌôîÎ©¥ -->
            <div class="result-screen" id="result-screen">
                <div class="breadcrumb">
                    <a onclick="showBookDetail()">James and the Giant Peach</a>
                    <span>></span>
                    <span>Í≤∞Í≥º</span>
                </div>

                <div class="result-header">
                    <h2>üéâ ÌïôÏäµ ÏôÑÎ£å!</h2>
                    <div class="score-circle" id="score-circle">100%</div>
                    <h3 id="result-message">ÌõåÎ•≠Ìï©ÎãàÎã§!</h3>
                </div>

                <div class="result-details">
                    <div class="result-stat">
                        <h4>Ï¥ù Î¨∏Ï†ú</h4>
                        <p id="total-questions">5Î¨∏Ï†ú</p>
                    </div>
                    <div class="result-stat">
                        <h4>Ï†ïÎãµ</h4>
                        <p id="correct-answers">5Î¨∏Ï†ú</p>
                    </div>
                    <div class="result-stat">
                        <h4>Ïò§Îãµ</h4>
                        <p id="wrong-answers">0Î¨∏Ï†ú</p>
                    </div>
                    <div class="result-stat">
                        <h4>Ï†êÏàò</h4>
                        <p id="final-score">100Ï†ê</p>
                    </div>
                </div>

                <div class="result-actions">
                    <button class="control-btn prev-btn" onclick="retryChapter()">Îã§Ïãú ÌíÄÍ∏∞</button>
                    <button class="control-btn next-btn" onclick="nextChapter()">Îã§Ïùå Ï±ïÌÑ∞</button>
                    <button class="control-btn submit-btn" onclick="showBookDetail()">Ï±ïÌÑ∞ Î™©Î°ù</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ïò§ÎîîÏò§ ÌîåÎ†àÏù¥Ïñ¥ Î™®Îã¨ -->
    <div class="audio-modal" id="audio-modal">
        <div class="audio-content">
            <button class="close-audio" onclick="closeAudioModal()">√ó</button>
            <h3 id="audio-chapter-title">Chapter 1</h3>
            <p id="audio-chapter-subtitle">James and the Giant Peach - Roald Dahl</p>

            <audio class="audio-player" id="audio-player" controls preload="metadata">
                <source id="audio-source" src="" type="audio/mpeg">
                Î∏åÎùºÏö∞Ï†ÄÍ∞Ä Ïò§ÎîîÏò§Î•º ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.
            </audio>

            <div class="audio-controls">
                <button class="audio-control-btn play-pause-btn" onclick="togglePlayPause()">‚ñ∂Ô∏è Ïû¨ÏÉù</button>
                <button class="audio-control-btn speed-btn" onclick="changeSpeed()">1.0x</button>
                <button class="audio-control-btn" onclick="resetToChapterStart()" style="background: #28a745; color: white;">üîÑ Íµ¨Í∞ÑÏ≤òÏùå</button>
                <button class="audio-control-btn download-btn" onclick="downloadAudio()">üì• Îã§Ïö¥Î°úÎìú</button>
            </div>

            <div class="audio-info" id="audio-info">
                <div id="audio-status" style="margin-top: 10px; font-weight: bold; color: #FF6B9D;"></div>
            </div>
        </div>
    </div>

    <script>
        // üéØ Íµ¨Í∏Ä ÌÅ¥ÎùºÏö∞Îìú Ïä§ÌÜ†Î¶¨ÏßÄ Ïò§ÎîîÏò§ URL ÏÑ§Ï†ï
        const AUDIO_BASE_URL = 'https://storage.googleapis.com/kim-mom-reading-audio/audio/';

        // James and the Giant Peach Îã§Ï§ë ÌååÏùº + ÏãúÍ∞Ñ Ï†êÌîÑ ÏãúÏä§ÌÖú (39Ï±ïÌÑ∞Ïö©)
        const jamesGiantPeachTimeMapping = {
            0: { fileIndex: 0, startTime: 21 },        // Chapter 1: File 01, 0:21
            1: { fileIndex: 0, startTime: 233 },       // Chapter 2: File 01, 3:53
            2: { fileIndex: 1, startTime: 0 },         // Chapter 3: File 02, 0:00
            3: { fileIndex: 1, startTime: 224 },       // Chapter 4: File 02, 3:44
            4: { fileIndex: 1, startTime: 332 },       // Chapter 5: File 02, 5:32
            5: { fileIndex: 1, startTime: 553 },       // Chapter 6: File 02, 9:13
            6: { fileIndex: 2, startTime: 0 },         // Chapter 7: File 03, 0:00
            7: { fileIndex: 2, startTime: 283 },       // Chapter 8: File 03, 4:43
            8: { fileIndex: 2, startTime: 441 },       // Chapter 9: File 03, 7:21
            9: { fileIndex: 3, startTime: 0 },         // Chapter 10: File 04, 0:00
            10: { fileIndex: 3, startTime: 132 },      // Chapter 11: File 04, 2:12
            11: { fileIndex: 4, startTime: 0 },        // Chapter 12: File 05, 0:00
            12: { fileIndex: 4, startTime: 283 },      // Chapter 13: File 05, 4:43
            13: { fileIndex: 5, startTime: 0 },        // Chapter 14: File 06, 0:00
            14: { fileIndex: 6, startTime: 6 },        // Chapter 15: File 07, 0:06
            15: { fileIndex: 6, startTime: 132 },      // Chapter 16: File 07, 2:12
            16: { fileIndex: 6, startTime: 352 },      // Chapter 17: File 07, 5:52
            17: { fileIndex: 7, startTime: 0 },        // Chapter 18: File 08, 0:00
            18: { fileIndex: 8, startTime: 0 },        // Chapter 19: File 09, 0:00
            19: { fileIndex: 8, startTime: 192 },      // Chapter 20: File 09, 3:12
            20: { fileIndex: 9, startTime: 0 },        // Chapter 21: File 10, 0:00
            21: { fileIndex: 9, startTime: 87 },       // Chapter 22: File 10, 1:27
            22: { fileIndex: 9, startTime: 384 },      // Chapter 23: File 10, 6:24
            23: { fileIndex: 10, startTime: 0 },       // Chapter 24: File 11, 0:00
            24: { fileIndex: 11, startTime: 0 },       // Chapter 25: File 12, 0:00
            25: { fileIndex: 11, startTime: 404 },     // Chapter 26: File 12, 6:44
            26: { fileIndex: 12, startTime: 5 },       // Chapter 27: File 13, 0:05
            27: { fileIndex: 13, startTime: 0 },       // Chapter 28: File 14, 0:00
            28: { fileIndex: 13, startTime: 534 },     // Chapter 29: File 14, 8:54
            29: { fileIndex: 14, startTime: 0 },       // Chapter 30: File 15, 0:00
            30: { fileIndex: 14, startTime: 229 },     // Chapter 31: File 15, 3:49
            31: { fileIndex: 14, startTime: 379 },     // Chapter 32: File 15, 6:19
            32: { fileIndex: 15, startTime: 0 },       // Chapter 33: File 16, 0:00
            33: { fileIndex: 15, startTime: 83 },      // Chapter 34: File 16, 1:23
            34: { fileIndex: 15, startTime: 220 },     // Chapter 35: File 16, 3:40
            35: { fileIndex: 15, startTime: 280 },     // Chapter 36: File 16, 4:40
            36: { fileIndex: 16, startTime: 0 },       // Chapter 37: File 17, 0:00
            37: { fileIndex: 17, startTime: 0 },       // Chapter 38: File 18, 0:00
            38: { fileIndex: 17, startTime: 207 }      // Chapter 39: File 18, 3:27
        };

        // ÌååÏùº Î™©Î°ù
        const jamesGiantPeachFiles = [
            'James And The Giant Peach 01.mp3',  // File 0
            'James And The Giant Peach 02.mp3',  // File 1
            'James And The Giant Peach 03.mp3',  // File 2
            'James And The Giant Peach 04.mp3',  // File 3
            'James And The Giant Peach 05.mp3',  // File 4
            'James And The Giant Peach 06.mp3',  // File 5
            'James And The Giant Peach 07.mp3',  // File 6
            'James And The Giant Peach 08.mp3',  // File 7
            'James And The Giant Peach 09.mp3',  // File 8
            'James And The Giant Peach 10.mp3',  // File 9
            'James And The Giant Peach 11.mp3',  // File 10
            'James And The Giant Peach 12.mp3',  // File 11
            'James And The Giant Peach 13.mp3',  // File 12
            'James And The Giant Peach 14.mp3',  // File 13
            'James And The Giant Peach 15.mp3',  // File 14
            'James And The Giant Peach 16.mp3',  // File 15
            'James And The Giant Peach 17.mp3',  // File 16
            'James And The Giant Peach 18.mp3'   // File 17
        ];

        // Ï†ÑÏó≠ Î≥ÄÏàò
        let currentChapterIndex = 0;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let questions = [];
        let currentAudio = null;
        let playbackSpeed = 1.0;

        // üéß James and the Giant Peach Îã§Ï§ë ÌååÏùº Ïò§ÎîîÏò§ URL ÏÉùÏÑ± Ìï®Ïàò
        function getJamesAudioUrl(chapterIndex) {
            const timeMapping = jamesGiantPeachTimeMapping[chapterIndex];
            if (!timeMapping) return null;
            
            const fileName = jamesGiantPeachFiles[timeMapping.fileIndex];
            return {
                primary: `${AUDIO_BASE_URL}JGP001_James_and_the_Giant_Peach/${fileName}`,
                startTime: timeMapping.startTime,
                fileIndex: timeMapping.fileIndex
            };
        }

        // üéß James and the Giant Peach Ïò§ÎîîÏò§ Ïû¨ÏÉù Ìï®Ïàò (Îã§Ï§ë ÌååÏùº + ÏãúÍ∞Ñ Ï†êÌîÑ)
        function playChapterAudio(chapterIndex) {
            const chapter = bookData.chapterList[chapterIndex];
            const audioData = getJamesAudioUrl(chapterIndex);

            if (!audioData) {
                alert('Ìï¥Îãπ Ï±ïÌÑ∞Ïùò Ïò§ÎîîÏò§Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                return;
            }

            document.getElementById('audio-modal').style.display = 'flex';
            document.getElementById('audio-chapter-title').textContent = `Chapter ${chapterIndex + 1}`;
            document.getElementById('audio-chapter-subtitle').textContent = `${bookData.title} - ${bookData.author}`;
            document.getElementById('audio-info').classList.remove('hidden');

            const audioPlayer = document.getElementById('audio-player');
            const audioSource = document.getElementById('audio-source');
            const audioStatus = document.getElementById('audio-status');

            audioStatus.textContent = 'üîÑ Ïò§ÎîîÏò§ ÌååÏùºÏùÑ Î°úÎî© Ï§ë...';

            // Ìï¥Îãπ Ï±ïÌÑ∞Ïùò ÌååÏùº Î°úÎìú
            audioSource.src = audioData.primary;
            audioPlayer.load();

            const successHandler = function() {
                // Ï±ïÌÑ∞ ÏãúÏûë ÏãúÍ∞ÑÏúºÎ°ú Ï†êÌîÑ
                audioPlayer.currentTime = audioData.startTime;
                const minutes = Math.floor(audioData.startTime / 60);
                const seconds = audioData.startTime % 60;
                audioStatus.innerHTML = `‚úÖ Chapter ${chapterIndex + 1} Î°úÎìú ÏôÑÎ£å! (${minutes}:${String(seconds).padStart(2,'0')}Î∂ÄÌÑ∞ ÏãúÏûë)`;

                // üéØ Ï±ïÌÑ∞ ÌÅ¥Î¶≠ Ï¶âÏãú Ïû¨ÏÉù ÏãúÎèÑ!
                audioPlayer.play().then(() => {
                    audioStatus.innerHTML = `üéµ Chapter ${chapterIndex + 1} Ïû¨ÏÉù Ï§ë! (File ${audioData.fileIndex + 1})`;
                    document.querySelector('.play-pause-btn').textContent = '‚è∏Ô∏è ÏùºÏãúÏ†ïÏßÄ';
                }).catch(e => {
                    console.log('ÏûêÎèô Ïû¨ÏÉù Ï∞®Îã®Îê®:', e);
                    audioStatus.innerHTML = `‚úÖ Chapter ${chapterIndex + 1} Ï§ÄÎπÑÎê®! ‚ñ∂Ô∏è Ïû¨ÏÉù Î≤ÑÌäºÏùÑ ÎàåÎü¨Ï£ºÏÑ∏Ïöî`;
                });
            };

            const errorHandler = function() {
                audioStatus.innerHTML = '‚ùå Ïò§ÎîîÏò§ ÌååÏùºÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.';
                console.error('Audio load error for:', audioData.primary);
            };

            audioPlayer.addEventListener('canplaythrough', successHandler, { once: true });
            audioPlayer.addEventListener('error', errorHandler, { once: true });

            currentAudio = audioPlayer;
            currentAudio.currentChapterIndex = chapterIndex; // ÌòÑÏû¨ Ï±ïÌÑ∞ Ï†ÄÏû•
            playbackSpeed = 1.0;
        }

        // üéß Íµ¨Í∞ÑÏ≤òÏùåÏúºÎ°ú Ìï®Ïàò (Ï±ïÌÑ∞ ÏãúÏûëÏ†êÏúºÎ°ú)
        function resetToChapterStart() {
            if (!currentAudio || currentAudio.currentChapterIndex === undefined) return;
            
            const audioData = getJamesAudioUrl(currentAudio.currentChapterIndex);
            if (audioData) {
                currentAudio.currentTime = audioData.startTime;
            }
        }

        // Í∏∞Î≥∏ Ïò§ÎîîÏò§ Ïª®Ìä∏Î°§ Ìï®ÏàòÎì§
        function closeAudioModal() {
            document.getElementById('audio-modal').style.display = 'none';
            if (currentAudio) currentAudio.pause();
        }

        function togglePlayPause() {
            if (!currentAudio) return;
            if (currentAudio.paused) {
                currentAudio.play();
                document.querySelector('.play-pause-btn').textContent = '‚è∏Ô∏è ÏùºÏãúÏ†ïÏßÄ';
            } else {
                currentAudio.pause();
                document.querySelector('.play-pause-btn').textContent = '‚ñ∂Ô∏è Ïû¨ÏÉù';
            }
        }

        function changeSpeed() {
            if (!currentAudio) return;
            const speeds = [0.5, 0.75, 1.0, 1.25, 1.5, 2.0];
            const currentIndex = speeds.indexOf(playbackSpeed);
            playbackSpeed = speeds[(currentIndex + 1) % speeds.length];
            currentAudio.playbackRate = playbackSpeed;
            document.querySelector('.speed-btn').textContent = `${playbackSpeed}x`;
        }

        function downloadAudio() {
            const audioSource = document.getElementById('audio-source');
            if (audioSource.src) {
                const link = document.createElement('a');
                link.href = audioSource.src;
                link.download = `${document.getElementById('audio-chapter-title').textContent}.mp3`;
                link.click();
            }
        }

        // James and the Giant Peach ÎèÑÏÑú Îç∞Ïù¥ÌÑ∞ (39Ï±ïÌÑ∞)
        const bookData = {
            id: 'JGP001',
            title: "James and the Giant Peach",
            author: 'Roald Dahl',
            cover: 'üçë',
            progress: 0,
            chapters: 39,
            totalQuestions: 195,
            coverColor: 'linear-gradient(45deg, #FF6B9D, #FF8E8E)',
            summary: "James Henry Trotter loses his parents and is forced to live with his two horrible aunts, Sponge and Spiker. When a mysterious old man gives him magic crystals that accidentally spill on a barren peach tree, a giant peach grows. James enters the peach and meets friendly giant insects who become his companions on an incredible journey across the ocean and sky to New York City. This classic tale by Roald Dahl celebrates friendship, courage, and the power of imagination.",
            chapterList: [
                { title: 'Chapter 1', description: 'James Henry Trotter lives happily with his parents until tragedy strikes in London.', status: 'current', questionCount: 5 },
                { title: 'Chapter 2', description: 'Three years later, James lives miserably with his horrible aunts on a hill.', status: 'current', questionCount: 5 },
                { title: 'Chapter 3', description: 'James dreams of escape but is trapped by his cruel aunts Sponge and Spiker.', status: 'current', questionCount: 5 },
                { title: 'Chapter 4', description: 'A mysterious old man appears with magical green crystals for James.', status: 'current', questionCount: 5 },
                { title: 'Chapter 5', description: 'James accidentally spills the crystals on the old peach tree.', status: 'current', questionCount: 5 },
                { title: 'Chapter 6', description: 'A single peach begins to grow and grow until it\'s enormous.', status: 'current', questionCount: 5 },
                { title: 'Chapter 7', description: 'The aunts discover the giant peach and plan to make money from it.', status: 'current', questionCount: 5 },
                { title: 'Chapter 8', description: 'James finds a tunnel leading into the giant peach.', status: 'current', questionCount: 5 },
                { title: 'Chapter 9', description: 'James meets the Old-Green-Grasshopper inside the peach.', status: 'current', questionCount: 5 },
                { title: 'Chapter 10', description: 'James discovers more giant insects living in the peach pit.', status: 'current', questionCount: 5 },
                { title: 'Chapter 11', description: 'Miss Spider, Ladybug, and Centipede introduce themselves to James.', status: 'current', questionCount: 5 },
                { title: 'Chapter 12', description: 'The Earthworm and other insects tell James their stories.', status: 'current', questionCount: 5 },
                { title: 'Chapter 13', description: 'The insects explain how they became giant from the magic crystals.', status: 'current', questionCount: 5 },
                { title: 'Chapter 14', description: 'The peach breaks free and begins rolling down the hill.', status: 'current', questionCount: 5 },
                { title: 'Chapter 15', description: 'The peach rolls through the village, causing chaos and destruction.', status: 'current', questionCount: 5 },
                { title: 'Chapter 16', description: 'The peach crashes through Aunt Sponge and continues rolling.', status: 'current', questionCount: 5 },
                { title: 'Chapter 17', description: 'Aunt Spiker is also flattened as the peach rolls on.', status: 'current', questionCount: 5 },
                { title: 'Chapter 18', description: 'The peach reaches the sea and begins floating on the waves.', status: 'current', questionCount: 5 },
                { title: 'Chapter 19', description: 'James and the insects celebrate their escape from the aunts.', status: 'current', questionCount: 5 },
                { title: 'Chapter 20', description: 'Danger strikes as sharks begin attacking the peach.', status: 'current', questionCount: 5 },
                { title: 'Chapter 21', description: 'James comes up with a plan to escape the sharks using seagulls.', status: 'current', questionCount: 5 },
                { title: 'Chapter 22', description: 'The insects work together to catch seagulls with silk threads.', status: 'current', questionCount: 5 },
                { title: 'Chapter 23', description: 'More seagulls are caught and tied to the peach stem.', status: 'current', questionCount: 5 },
                { title: 'Chapter 24', description: 'The peach rises into the sky, lifted by hundreds of seagulls.', status: 'current', questionCount: 5 },
                { title: 'Chapter 25', description: 'Flying high above the ocean, the travelers feel free and happy.', status: 'current', questionCount: 5 },
                { title: 'Chapter 26', description: 'The Centipede sings a rude song and falls overboard.', status: 'current', questionCount: 5 },
                { title: 'Chapter 27', description: 'James bravely rescues the Centipede from the churning sea.', status: 'current', questionCount: 5 },
                { title: 'Chapter 28', description: 'The travelers encounter mysterious Cloud-Men in the sky.', status: 'current', questionCount: 5 },
                { title: 'Chapter 29', description: 'The Cloud-Men attack the peach with hailstones and lightning.', status: 'current', questionCount: 5 },
                { title: 'Chapter 30', description: 'The peach escapes the Cloud-Men and continues flying.', status: 'current', questionCount: 5 },
                { title: 'Chapter 31', description: 'Strange sights and sounds fill the night sky journey.', status: 'current', questionCount: 5 },
                { title: 'Chapter 32', description: 'Dawn breaks as the travelers approach a new land.', status: 'current', questionCount: 5 },
                { title: 'Chapter 33', description: 'The peach flies over New York City, causing panic below.', status: 'current', questionCount: 5 },
                { title: 'Chapter 34', description: 'An airplane cuts the seagull strings and the peach falls.', status: 'current', questionCount: 5 },
                { title: 'Chapter 35', description: 'The peach gets stuck on the Empire State Building\'s spike.', status: 'current', questionCount: 5 },
                { title: 'Chapter 36', description: 'James explains their story to the amazed New Yorkers.', status: 'current', questionCount: 5 },
                { title: 'Chapter 37', description: 'The city celebrates James and the insects as heroes.', status: 'current', questionCount: 5 },
                { title: 'Chapter 38', description: 'Each insect finds a perfect new life in New York City.', status: 'current', questionCount: 5 },
                { title: 'Chapter 39', description: 'James lives happily in Central Park, sharing his story with children.', status: 'current', questionCount: 5 }
            ]
        };

        // Î¨∏Ï†ú Îç∞Ïù¥ÌÑ∞ (ÏÉòÌîå - Ï≤òÏùå 5Í∞ú Ï±ïÌÑ∞Îßå)
        const questionsData = {
            0: [ // Chapter 1
                {
                    passage: "Until he was four years old, James Henry Trotter had a happy life. He lived peacefully with his mother and father in a beautiful house beside the sea.",
                    question: "Where did James live before he was four years old?",
                    options: ["In a city apartment", "In a beautiful house beside the sea with his parents", "With his aunts on a hill", "In an orphanage"],
                    correct: 1
                },
                {
                    passage: "Then, one day, James's mother and father went to London to do some shopping, and there a terrible thing happened. Both of them suddenly got eaten up (in full daylight, mind you, and on a crowded street) by an enormous angry rhinoceros which had escaped from the London Zoo.",
                    question: "What happened to James's parents in London?",
                    options: ["They got lost in the crowd", "They were eaten by an escaped rhinoceros from the zoo", "They decided to stay in London", "They had an accident"],
                    correct: 1
                },
                {
                    passage: "Now this, as you can well imagine, was a rather nasty experience for two such gentle parents. But in the long run it was far nastier for James than it was for them.",
                    question: "According to the narrator, who suffered more from this tragedy?",
                    options: ["James's parents", "James himself", "The rhinoceros", "The people in London"],
                    correct: 1
                },
                {
                    passage: "Their troubles were all over in a jiffy. They were dead and gone in thirty-five seconds flat. Poor James, on the other hand, was still very much alive, and all at once he found himself alone and frightened in a vast unfriendly world.",
                    question: "How long did it take for James's parents to die?",
                    options: ["Several minutes", "One hour", "Thirty-five seconds flat", "Half a day"],
                    correct: 2
                },
                {
                    passage: "The lovely house by the seaside had to be sold immediately, and the little boy, carrying nothing but a small suitcase containing a pair of pyjamas and a toothbrush, was sent away to live with his two aunts.",
                    question: "What did James take with him when he went to live with his aunts?",
                    options: ["All his toys and books", "Only a small suitcase with pyjamas and a toothbrush", "His favorite clothes", "Nothing at all"],
                    correct: 1
                }
            ],
            1: [ // Chapter 2
                {
                    passage: "Their names were Aunt Sponge and Aunt Spiker, and I am sorry to say that they were both really horrible people. They were selfish and lazy and cruel, and right from the beginning they started beating poor James for almost no reason at all.",
                    question: "What were James's aunts like?",
                    options: ["Kind and caring", "Selfish, lazy, and cruel", "Busy but loving", "Strict but fair"],
                    correct: 1
                },
                {
                    passage: "Aunt Sponge was enormously fat and very short. She had small piggy eyes, a sunken mouth, and one of those white flabby faces that looked exactly like a boiled dumpling.",
                    question: "How is Aunt Sponge described?",
                    options: ["Tall and thin", "Enormously fat and very short with a face like a boiled dumpling", "Average height and weight", "Beautiful but mean"],
                    correct: 1
                },
                {
                    passage: "Aunt Spiker, on the other hand, was lean and tall and bony, and she wore steel-rimmed spectacles that fixed onto the end of her nose with a clip. She had a screeching voice and long wet narrow lips, and whenever she got angry or excited, little flecks of spit would come shooting out of her mouth as she talked.",
                    question: "What distinguished Aunt Spiker from Aunt Sponge?",
                    options: ["She was also fat and short", "She was lean, tall, and bony with steel-rimmed spectacles", "She was kind and gentle", "She was deaf and mute"],
                    correct: 1
                },
                {
                    passage: "And now, three years later, James was still living in that house, and still being beaten and starved and cruelly treated by his two wicked aunts.",
                    question: "How long had James been living with his aunts by this point in the story?",
                    options: ["One year", "Two years", "Three years", "Four years"],
                    correct: 2
                },
                {
                    passage: "He was thin and white and as miserable as could be. He never smiled. He never laughed. He had no friends at all to play with, and nothing whatever to do except hang around the house and do chores for his aunts.",
                    question: "What was James's life like with his aunts?",
                    options: ["Happy and full of adventure", "Thin, white, and miserable with no friends or fun", "Busy but satisfying", "Lonely but comfortable"],
                    correct: 1
                }
            ]
            // ÎÇòÎ®∏ÏßÄ Ï±ïÌÑ∞Îì§ÎèÑ ÌïÑÏöîÏãú Ï∂îÍ∞Ä Í∞ÄÎä•
        };

        // ÎÇòÎ®∏ÏßÄ JavaScript Ìï®ÏàòÎì§ÏùÄ A Single ShardÏôÄ ÎèôÏùºÌïú Ìå®ÌÑ¥
        function showBookDetail() {
            document.getElementById('book-detail-screen').style.display = 'block';
            document.getElementById('learning-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'none';
            generateChapterGrid();
            updateProgress();
        }

        function generateChapterGrid() {
            const grid = document.getElementById('chapters-grid');
            grid.innerHTML = '';

            bookData.chapterList.forEach((chapter, index) => {
                const chapterCard = document.createElement('div');
                chapterCard.className = `chapter-card ${chapter.status}`;

                chapterCard.innerHTML = `
                    <div class="chapter-header">
                        <div class="chapter-info">
                            <h4>${chapter.title}</h4>
                            <p>${chapter.description} (${chapter.questionCount}Î¨∏Ï†ú)</p>
                        </div>
                        <div class="chapter-status ${chapter.status}">
                            ${chapter.status === 'completed' ? '‚úÖ ÏôÑÎ£å' :
                              chapter.status === 'current' ? 'üìñ ÏßÑÌñâÏ§ë' : 'üîí Ïû†ÍπÄ'}
                        </div>
                    </div>
                    <div class="chapter-actions">
                        <button class="chapter-btn audio-btn" onclick="playChapterAudio(${index})"
                                ${chapter.status === 'locked' ? 'disabled' : ''}>
                            üéß Ïò§ÎîîÏò§
                        </button>
                        <button class="chapter-btn quiz-btn" onclick="startLearning(${index})"
                                ${chapter.status === 'locked' ? 'disabled' : ''}>
                            üìù Î¨∏Ï†úÌíÄÍ∏∞
                        </button>
                    </div>
                `;

                grid.appendChild(chapterCard);
            });
        }

        function updateProgress() {
            const completedChapters = bookData.chapterList.filter(chapter => chapter.status === 'completed').length;
            const progressPercent = Math.round((completedChapters / bookData.chapters) * 100);
            document.getElementById('progress-value').textContent = `${progressPercent}%`;
        }

        function startLearning(chapterIndex) {
            if (bookData.chapterList[chapterIndex].status === 'locked') return;

            currentChapterIndex = chapterIndex;
            currentQuestionIndex = 0;
            userAnswers = [];
            questions = questionsData[chapterIndex] || [];

            if (questions.length === 0) {
                alert('Ïù¥ Ï±ïÌÑ∞Ïùò Î¨∏Ï†úÍ∞Ä Ï§ÄÎπÑÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                return;
            }

            document.getElementById('book-detail-screen').style.display = 'none';
            document.getElementById('learning-screen').style.display = 'block';
            document.getElementById('result-screen').style.display = 'none';

            const chapter = bookData.chapterList[chapterIndex];
            document.getElementById('learning-title').textContent = chapter.title;
            document.getElementById('learning-chapter-breadcrumb').textContent = chapter.title;

            showQuestion();
        }

        function showQuestion() {
            if (currentQuestionIndex >= questions.length) {
                submitAnswers();
                return;
            }

            const question = questions[currentQuestionIndex];
            const container = document.getElementById('question-container');

            container.innerHTML = `
                <div class="passage">${question.passage}</div>
                <div class="question-text">${question.question}</div>
                <div class="options">
                    ${question.options.map((option, index) =>
                        `<div class="option" onclick="selectOption(${index})" data-index="${index}">
                            ${String.fromCharCode(65 + index)}. ${option}
                        </div>`
                    ).join('')}
                </div>
            `;

            const progressPercent = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('learning-progress-bar').style.width = `${progressPercent}%`;
            document.getElementById('learning-progress-text').textContent = `Î¨∏Ï†ú ${currentQuestionIndex + 1} / ${questions.length}`;

            document.getElementById('prev-btn').disabled = currentQuestionIndex === 0;
            document.getElementById('next-btn').style.display = currentQuestionIndex === questions.length - 1 ? 'none' : 'inline-block';
            document.getElementById('submit-btn').style.display = currentQuestionIndex === questions.length - 1 ? 'inline-block' : 'none';

            if (userAnswers[currentQuestionIndex] !== undefined) {
                const selectedOption = container.querySelector(`[data-index="${userAnswers[currentQuestionIndex]}"]`);
                if (selectedOption) {
                    selectedOption.classList.add('selected');
                }
            }
        }

        function selectOption(index) {
            document.querySelectorAll('.option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector(`[data-index="${index}"]`).classList.add('selected');
            userAnswers[currentQuestionIndex] = index;
        }

        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                showQuestion();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion();
            }
        }

        function submitAnswers() {
            let correctCount = 0;
            for (let i = 0; i < questions.length; i++) {
                if (userAnswers[i] === questions[i].correct) {
                    correctCount++;
                }
            }

            const score = Math.round((correctCount / questions.length) * 100);

            if (score >= 70) {
                bookData.chapterList[currentChapterIndex].status = 'completed';
                if (currentChapterIndex + 1 < bookData.chapterList.length) {
                    if (bookData.chapterList[currentChapterIndex + 1].status === 'locked') {
                        bookData.chapterList[currentChapterIndex + 1].status = 'current';
                    }
                }
            }

            showResult(correctCount, score);
        }

        function showResult(correctCount, score) {
            document.getElementById('learning-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';

            document.getElementById('score-circle').textContent = `${score}%`;
            document.getElementById('total-questions').textContent = `${questions.length}Î¨∏Ï†ú`;
            document.getElementById('correct-answers').textContent = `${correctCount}Î¨∏Ï†ú`;
            document.getElementById('wrong-answers').textContent = `${questions.length - correctCount}Î¨∏Ï†ú`;
            document.getElementById('final-score').textContent = `${score}Ï†ê`;

            let message = '';
            let circleColor = '';

            if (score >= 90) {
                message = 'üåü ÏôÑÎ≤ΩÌï©ÎãàÎã§!';
                circleColor = 'linear-gradient(45deg, #FF6B9D, #FF8E8E)';
            } else if (score >= 80) {
                message = 'üéâ ÌõåÎ•≠Ìï¥Ïöî!';
                circleColor = 'linear-gradient(45deg, #FF6B9D, #FF8E8E)';
            } else if (score >= 70) {
                message = 'üëç ÏûòÌñàÏñ¥Ïöî!';
                circleColor = 'linear-gradient(45deg, #FF6B9D, #FF8E8E)';
            } else {
                message = 'üí™ Îã§Ïãú ÎèÑÏ†ÑÌï¥Î≥¥ÏÑ∏Ïöî!';
                circleColor = 'linear-gradient(45deg, #ff9800, #f57c00)';
            }

            document.getElementById('result-message').textContent = message;
            document.getElementById('score-circle').style.background = circleColor;
        }

        function retryChapter() {
            startLearning(currentChapterIndex);
        }

        function nextChapter() {
            if (currentChapterIndex + 1 < bookData.chapterList.length) {
                if (bookData.chapterList[currentChapterIndex + 1].status !== 'locked') {
                    startLearning(currentChapterIndex + 1);
                } else {
                    showBookDetail();
                }
            } else {
                showBookDetail();
            }
        }

        window.addEventListener('DOMContentLoaded', function() {
            showBookDetail();
        });

        document.addEventListener('keydown', function(e) {
            if (document.getElementById('learning-screen').style.display === 'block') {
                if (e.key === 'ArrowLeft') {
                    previousQuestion();
                } else if (e.key === 'ArrowRight') {
                    nextQuestion();
                } else if (e.key >= '1' && e.key <= '4') {
                    const index = parseInt(e.key) - 1;
                    if (index < questions[currentQuestionIndex]?.options.length) {
                        selectOption(index);
                    }
                }
            }

            if (e.key === 'Escape') {
                closeAudioModal();
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            const audioPlayer = document.getElementById('audio-player');

            audioPlayer.addEventListener('play', function() {
                document.querySelector('.play-pause-btn').textContent = '‚è∏Ô∏è ÏùºÏãúÏ†ïÏßÄ';
            });

            audioPlayer.addEventListener('pause', function() {
                document.querySelector('.play-pause-btn').textContent = '‚ñ∂Ô∏è Ïû¨ÏÉù';
            });

            audioPlayer.addEventListener('ended', function() {
                document.querySelector('.play-pause-btn').textContent = '‚ñ∂Ô∏è Ïû¨ÏÉù';
            });
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day of the Dragon King - Level 3 - ÏàòÎ¶¨Îî©Ïñ¥ÌïôÏõê</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #B8860B 0%, #DAA520 50%, #FFD700 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        /* Ìó§Îçî */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #B8860B, #DAA520);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .logo-text h1 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
        }

        .logo-text p {
            font-size: 0.9rem;
            color: #666;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
            color: #333;
            text-decoration: none;
        }

        .nav-btn:hover {
            background: #B8860B;
            color: white;
            transform: translateY(-2px);
        }

        /* Î©îÏù∏ ÏΩòÌÖêÏ∏† ÏòÅÏó≠ */
        .main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            min-height: 600px;
        }

        /* Ï±Ö ÏÉÅÏÑ∏ ÌôîÎ©¥ */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 30px;
            font-size: 0.9rem;
            color: #666;
        }

        .breadcrumb a {
            color: #B8860B;
            text-decoration: none;
            cursor: pointer;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .book-detail-header {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: flex-start;
        }

        .detail-book-cover {
            width: 150px;
            height: 220px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 4rem;
            font-weight: bold;
            flex-shrink: 0;
            background: linear-gradient(45deg, #B8860B, #DAA520);
        }

        .book-info {
            flex: 1;
        }

        .book-info h2 {
            font-size: 2.2rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .book-info .author {
            font-size: 1.2rem;
            color: #B8860B;
            margin-bottom: 20px;
        }

        .book-summary {
            font-size: 1rem;
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .book-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-box .value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #B8860B;
        }

        .stat-box .label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        /* Ï±ïÌÑ∞ Í∑∏Î¶¨Îìú */
        .chapters-section {
            margin-top: 40px;
        }

        .chapters-section h3 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 30px;
            text-align: center;
        }

        .chapters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .chapter-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
        }

        .chapter-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .chapter-card.completed {
            border-color: #28a745;
            background: linear-gradient(135deg, #28a74508, #ffffff);
        }

        .chapter-card.current {
            border-color: #B8860B;
            background: linear-gradient(135deg, #B8860B08, #ffffff);
        }

        .chapter-card.locked {
            opacity: 0.6;
            background: #f8f9fa;
        }

        .chapter-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .chapter-info h4 {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }

        .chapter-info p {
            font-size: 0.95rem;
            color: #666;
            line-height: 1.5;
        }

        .chapter-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .chapter-status.completed {
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
        }

        .chapter-status.current {
            background: rgba(184, 134, 11, 0.1);
            color: #B8860B;
        }

        .chapter-status.locked {
            background: rgba(108, 117, 125, 0.1);
            color: #6c757d;
        }

        .chapter-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .chapter-btn {
            padding: 12px 16px;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .audio-btn {
            background: linear-gradient(45deg, #B8860B, #DAA520);
            color: white;
        }

        .quiz-btn {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: white;
        }

        .chapter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .chapter-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* ÌïôÏäµ ÌôîÎ©¥ */
        .learning-screen {
            display: none;
        }

        .learning-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .learning-progress {
            background: #f8f9fa;
            border-radius: 10px;
            height: 8px;
            margin: 20px 0;
            overflow: hidden;
        }

        .learning-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #B8860B, #DAA520);
            transition: width 0.3s ease;
        }

        .question-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
        }

        .passage {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1rem;
            line-height: 1.6;
            color: #444;
        }

        .options {
            display: grid;
            gap: 10px;
        }

        .option {
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option:hover {
            background: #e9ecef;
            border-color: #B8860B;
        }

        .option.selected {
            background: rgba(184, 134, 11, 0.1);
            border-color: #B8860B;
        }

        .learning-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .control-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .next-btn {
            background: linear-gradient(45deg, #B8860B, #DAA520);
            color: white;
        }

        .prev-btn {
            background: #6c757d;
            color: white;
        }

        .submit-btn {
            background: linear-gradient(45deg, #B8860B, #DAA520);
            color: white;
        }

        .control-btn:hover {
            transform: translateY(-2px);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Í≤∞Í≥º ÌôîÎ©¥ */
        .result-screen {
            display: none;
            text-align: center;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(45deg, #B8860B, #DAA520);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            font-size: 2rem;
            font-weight: bold;
        }

        .result-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .result-stat {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .result-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        /* Ïò§ÎîîÏò§ ÌîåÎ†àÏù¥Ïñ¥ Î™®Îã¨ */
        .audio-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .audio-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 600px;
            width: 90%;
            position: relative;
        }

        .close-audio {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #666;
        }

        .audio-player {
            width: 100%;
            margin: 20px 0;
            border-radius: 10px;
        }

        .audio-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .audio-control-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .play-pause-btn {
            background: linear-gradient(45deg, #B8860B, #DAA520);
            color: white;
        }

        .speed-btn {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #ddd;
        }

        .download-btn {
            background: #FFD700;
            color: white;
        }

        .audio-info {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            font-size: 0.9rem;
            color: #666;
            transition: all 0.3s ease;
        }

        .audio-info.hidden {
            display: none;
        }

        /* Î∞òÏùëÌòï */
        @media (max-width: 768px) {
            .chapters-grid {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .book-detail-header {
                flex-direction: column;
                text-align: center;
            }

            .book-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .learning-controls {
                flex-direction: column;
            }

            .chapter-actions {
                grid-template-columns: 1fr;
            }

            .audio-controls {
                justify-content: center;
                gap: 10px;
            }

            .audio-content {
                padding: 30px 20px;
            }
        }

        .new-book-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: linear-gradient(45deg, #FF6B9D, #C44569);
            color: white;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: 700;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Level 3 ÌäπÎ≥Ñ Ïä§ÌÉÄÏùº */
        .level-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: linear-gradient(45deg, #FF6B00, #FF8E53);
            color: white;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ìó§Îçî -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">üê≤</div>
                <div class="logo-text">
                    <h1>Day of the Dragon King</h1>
                    <p>Level 3 - Mary Pope OsborneÏùò Îß§ÏßÅ Ìä∏Î¶¨ ÌïòÏö∞Ïä§ 14Í∂å</p>
                </div>
            </div>
            <div class="nav-buttons">
                <a href="http://www.suelibrary.store/" class="nav-btn">Î©îÏù∏ÏúºÎ°ú</a>
            </div>
        </div>

        <!-- Î©îÏù∏ ÏΩòÌÖêÏ∏† -->
        <div class="main-content">
            <!-- Ï±Ö ÏÉÅÏÑ∏ ÌôîÎ©¥ -->
            <div class="book-detail-screen" id="book-detail-screen">
                <div class="level-badge">Level 3</div>
                <div class="breadcrumb">
                    <span>Day of the Dragon King</span>
                </div>

                <div class="book-detail-header">
                    <div class="detail-book-cover">üê≤</div>
                    <div class="book-info">
                        <h2>Day of the Dragon King</h2>
                        <div class="author">Mary Pope Osborne</div>
                        <div class="book-summary">
                            Jack and Annie travel to ancient China during the Qin Dynasty! They must help save the country's books from being burned by the Dragon King. Meeting scholars and discovering the wisdom of ancient China, they learn about the power of knowledge and the importance of preserving learning for future generations.
                        </div>
                        <div class="book-stats">
                            <div class="stat-box">
                                <div class="value">10</div>
                                <div class="label">Ï±ïÌÑ∞</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">50</div>
                                <div class="label">Ï¥ù Î¨∏Ï†ú</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">Level 3</div>
                                <div class="label">Î†àÎ≤®</div>
                            </div>
                            <div class="stat-box">
                                <div class="value" id="progress-value">0%</div>
                                <div class="label">ÏßÑÎèÑ</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="chapters-section">
                    <h3>üèØ Ï±ïÌÑ∞Î≥Ñ ÌïôÏäµ</h3>
                    <div class="chapters-grid" id="chapters-grid">
                        <!-- Ï±ïÌÑ∞ Ïπ¥ÎìúÎì§ -->
                    </div>
                </div>
            </div>

            <!-- ÌïôÏäµ ÌôîÎ©¥ -->
            <div class="learning-screen" id="learning-screen">
                <div class="breadcrumb">
                    <a onclick="showBookDetail()">Day of the Dragon King</a>
                    <span>></span>
                    <span id="learning-chapter-breadcrumb">Chapter 1</span>
                </div>

                <div class="learning-header">
                    <h2 id="learning-title">Chapter 1: The Great Wall</h2>
                    <div class="learning-progress">
                        <div class="learning-progress-bar" id="learning-progress-bar" style="width: 0%"></div>
                    </div>
                    <p id="learning-progress-text">Î¨∏Ï†ú 1 / 5</p>
                </div>

                <div class="question-container" id="question-container">
                    <!-- Î¨∏Ï†úÍ∞Ä ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
                </div>

                <div class="learning-controls">
                    <button class="control-btn prev-btn" id="prev-btn" onclick="previousQuestion()" disabled>Ïù¥Ï†Ñ</button>
                    <button class="control-btn next-btn" id="next-btn" onclick="nextQuestion()">Îã§Ïùå</button>
                    <button class="control-btn submit-btn" id="submit-btn" onclick="submitAnswers()" style="display: none;">Ï†úÏ∂ú</button>
                </div>
            </div>

            <!-- Í≤∞Í≥º ÌôîÎ©¥ -->
            <div class="result-screen" id="result-screen">
                <div class="breadcrumb">
                    <a onclick="showBookDetail()">Day of the Dragon King</a>
                    <span>></span>
                    <span>Í≤∞Í≥º</span>
                </div>

                <div class="result-header">
                    <h2>üéâ ÌïôÏäµ ÏôÑÎ£å!</h2>
                    <div class="score-circle" id="score-circle">100%</div>
                    <h3 id="result-message">ÌõåÎ•≠Ìï©ÎãàÎã§!</h3>
                </div>

                <div class="result-details">
                    <div class="result-stat">
                        <h4>Ï¥ù Î¨∏Ï†ú</h4>
                        <p id="total-questions">5Î¨∏Ï†ú</p>
                    </div>
                    <div class="result-stat">
                        <h4>Ï†ïÎãµ</h4>
                        <p id="correct-answers">5Î¨∏Ï†ú</p>
                    </div>
                    <div class="result-stat">
                        <h4>Ïò§Îãµ</h4>
                        <p id="wrong-answers">0Î¨∏Ï†ú</p>
                    </div>
                    <div class="result-stat">
                        <h4>Ï†êÏàò</h4>
                        <p id="final-score">100Ï†ê</p>
                    </div>
                </div>

                <div class="result-actions">
                    <button class="control-btn prev-btn" onclick="retryChapter()">Îã§Ïãú ÌíÄÍ∏∞</button>
                    <button class="control-btn next-btn" onclick="nextChapter()">Îã§Ïùå Ï±ïÌÑ∞</button>
                    <button class="control-btn submit-btn" onclick="showBookDetail()">Ï±ïÌÑ∞ Î™©Î°ù</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ïò§ÎîîÏò§ ÌîåÎ†àÏù¥Ïñ¥ Î™®Îã¨ -->
    <div class="audio-modal" id="audio-modal">
        <div class="audio-content">
            <button class="close-audio" onclick="closeAudioModal()">√ó</button>
            <h3 id="audio-chapter-title">Chapter 1: The Great Wall</h3>
            <p id="audio-chapter-subtitle">Day of the Dragon King - Mary Pope Osborne</p>

            <audio class="audio-player" id="audio-player" controls preload="metadata">
                <source id="audio-source" src="" type="audio/mpeg">
                Î∏åÎùºÏö∞Ï†ÄÍ∞Ä Ïò§ÎîîÏò§Î•º ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.
            </audio>

            <div class="audio-controls">
                <button class="audio-control-btn play-pause-btn" onclick="togglePlayPause()">‚ñ∂Ô∏è Ïû¨ÏÉù</button>
                <button class="audio-control-btn speed-btn" onclick="changeSpeed()">1.0x</button>
                <button class="audio-control-btn" onclick="resetToChapterStart()" style="background: #28a745; color: white;">üîÑ Íµ¨Í∞ÑÏ≤òÏùå</button>
                <button class="audio-control-btn download-btn" onclick="downloadAudio()">üì• Îã§Ïö¥Î°úÎìú</button>
            </div>

            <div class="audio-info" id="audio-info">
                <div id="audio-status" style="margin-top: 10px; font-weight: bold; color: #B8860B;"></div>
            </div>
        </div>
    </div>

    <script>
        // üéØ Íµ¨Í∏Ä ÌÅ¥ÎùºÏö∞Îìú Ïä§ÌÜ†Î¶¨ÏßÄ Ïò§ÎîîÏò§ URL ÏÑ§Ï†ï
        const AUDIO_BASE_URL = 'https://storage.googleapis.com/kim-mom-reading-audio/audio/';

        // Magic Tree House 14Í∂å ÎèÑÏÑú Îç∞Ïù¥ÌÑ∞ (10Ï±ïÌÑ∞)
        const bookData = {
            id: 'MTH014',
            title: "Day of the Dragon King",
            author: 'Mary Pope Osborne',
            cover: 'üê≤',
            progress: 0,
            chapters: 10,
            totalQuestions: 50, // 10Ï±ïÌÑ∞ √ó 5Î¨∏Ï†ú
            coverColor: 'linear-gradient(45deg, #B8860B, #DAA520)',
            summary: "Jack and Annie travel to ancient China during the Qin Dynasty! They must help save the country's books from being burned by the Dragon King. Meeting scholars and discovering the wisdom of ancient China, they learn about the power of knowledge and the importance of preserving learning for future generations.",
            chapterList: [
                { title: 'The Great Wall', description: 'Jack and Annie discover the Great Wall of China and ancient Chinese culture.', status: 'current', questionCount: 5, startTime: 0 },
                { title: 'The Bamboo Book', description: 'They find an ancient bamboo scroll with important Chinese writing.', status: 'locked', questionCount: 5, startTime: 300 },
                { title: 'The Dragon King', description: 'They meet the powerful Dragon King who rules ancient China.', status: 'locked', questionCount: 5, startTime: 600 },
                { title: 'The Burning of the Books', description: 'They witness the terrible burning of Chinese books and scrolls.', status: 'locked', questionCount: 5, startTime: 900 },
                { title: 'The Silk Weaver', description: 'They meet a silk weaver who teaches them about Chinese crafts.', status: 'locked', questionCount: 5, startTime: 1200 },
                { title: 'The Tomb', description: 'They discover an ancient tomb with terracotta warriors.', status: 'locked', questionCount: 5, startTime: 1500 },
                { title: 'The Scholar', description: 'They meet a brave scholar trying to save ancient knowledge.', status: 'locked', questionCount: 5, startTime: 1800 },
                { title: 'The Writing of the Book', description: 'They help preserve important Chinese wisdom and knowledge.', status: 'locked', questionCount: 5, startTime: 2100 },
                { title: 'The Wild Man', description: 'They encounter a mysterious wild man in the Chinese countryside.', status: 'locked', questionCount: 5, startTime: 2400 },
                { title: 'The New China', description: 'They return having learned about Chinese civilization and wisdom.', status: 'locked', questionCount: 5, startTime: 2700 }
            ]
        };

        // Î¨∏Ï†ú Îç∞Ïù¥ÌÑ∞ (Ï†ÑÏ≤¥ 10Ï±ïÌÑ∞ ÏôÑÎ£å)
        const questionsData = {
            0: [ // Chapter 1: The Great Wall
                {
                    passage: "Jack and Annie found themselves standing near the most famous structure in ancient China - the Great Wall, which stretched endlessly across mountains and valleys.",
                    question: "What famous structure did Jack and Annie find themselves near in ancient China?",
                    options: ["A temple", "The Great Wall stretching across mountains and valleys", "A palace", "A river"],
                    correct: 1
                },
                {
                    passage: "The Great Wall was built to protect China from invading armies, and thousands of workers had spent years constructing this massive fortification.",
                    question: "Why was the Great Wall built and who constructed it?",
                    options: ["For decoration by artists", "To protect from invaders, built by thousands of workers over years", "As a road for travel", "For religious ceremonies"],
                    correct: 1
                },
                {
                    passage: "From their position on the wall, they could see the vast Chinese countryside with its rice fields, villages, and winding rivers.",
                    question: "What could Jack and Annie see from their position on the Great Wall?",
                    options: ["Only desert", "Vast countryside with rice fields, villages, and rivers", "Modern cities", "Ocean views"],
                    correct: 1
                },
                {
                    passage: "Jack noticed that the Chinese people were dressed in silk robes and had a very different culture from anything he had seen before.",
                    question: "What did Jack notice about the Chinese people and their culture?",
                    options: ["They looked exactly like modern people", "They wore silk robes and had a very different culture", "They all wore the same clothes", "They didn't have any culture"],
                    correct: 1
                },
                {
                    passage: "Annie was excited to explore this ancient civilization and learn about Chinese traditions, art, and philosophy.",
                    question: "What was Annie excited to learn about in ancient China?",
                    options: ["Modern technology", "Chinese traditions, art, and philosophy", "Western culture", "Only the language"],
                    correct: 1
                }
            ],
            1: [ // Chapter 2: The Bamboo Book
                {
                    passage: "In a small village near the Great Wall, Jack and Annie discovered a scholar's house filled with bamboo books and silk scrolls.",
                    question: "What did Jack and Annie find in the scholar's house?",
                    options: ["Modern books", "Bamboo books and silk scrolls", "Empty rooms", "Western furniture"],
                    correct: 1
                },
                {
                    passage: "The bamboo books were made of thin strips of bamboo tied together with silk cords, containing ancient Chinese wisdom and knowledge.",
                    question: "How were the bamboo books made and what did they contain?",
                    options: ["Paper bound with glue", "Thin bamboo strips tied with silk, containing ancient Chinese wisdom", "Stone tablets", "Metal sheets"],
                    correct: 1
                },
                {
                    passage: "The scholar explained that these books contained the teachings of great Chinese philosophers like Confucius and Laozi.",
                    question: "Whose teachings were contained in the bamboo books according to the scholar?",
                    options: ["Modern writers", "Great Chinese philosophers like Confucius and Laozi", "Foreign authors", "Unknown people"],
                    correct: 1
                },
                {
                    passage: "Jack was amazed to learn that Chinese writing used thousands of different characters, each representing ideas or sounds.",
                    question: "What amazed Jack about Chinese writing?",
                    options: ["It used only 26 letters", "It used thousands of different characters representing ideas or sounds", "It was identical to English", "It had no written form"],
                    correct: 1
                },
                {
                    passage: "The scholar looked worried and explained that the Dragon King had ordered all books to be burned, threatening China's accumulated knowledge.",
                    question: "What worried the scholar about the Dragon King's orders?",
                    options: ["Higher taxes", "All books to be burned, threatening China's knowledge", "New laws about farming", "Changes in clothing styles"],
                    correct: 1
                }
            ],
            2: [ // Chapter 3: The Dragon King
                {
                    passage: "The Dragon King was the powerful emperor of China, known for his fierce temper and his desire to control all knowledge in his empire.",
                    question: "Who was the Dragon King and what was he known for?",
                    options: ["A friendly ruler", "The powerful emperor known for fierce temper and controlling knowledge", "A mythical creature", "A peaceful philosopher"],
                    correct: 1
                },
                {
                    passage: "He believed that only the emperor should possess knowledge, and that common people should not be allowed to read or learn.",
                    question: "What did the Dragon King believe about knowledge and learning?",
                    options: ["Everyone should learn", "Only the emperor should possess knowledge, not common people", "Knowledge was useless", "Only children should learn"],
                    correct: 1
                },
                {
                    passage: "The Dragon King's soldiers marched through villages, collecting books and scrolls to be burned in massive bonfires.",
                    question: "What were the Dragon King's soldiers doing in the villages?",
                    options: ["Helping farmers", "Collecting books and scrolls to burn in bonfires", "Building houses", "Teaching children"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie watched in horror as centuries of Chinese wisdom and learning were being destroyed by the emperor's orders.",
                    question: "How did Jack and Annie feel watching the book burning?",
                    options: ["Happy and excited", "Horrified as centuries of wisdom was being destroyed", "Bored and uninterested", "Confused about what was happening"],
                    correct: 1
                },
                {
                    passage: "The scholar begged Jack and Annie to help save some of the most important books before they could be found and burned.",
                    question: "What did the scholar ask Jack and Annie to do?",
                    options: ["Leave immediately", "Help save important books before they were burned", "Hide in the mountains", "Join the emperor's army"],
                    correct: 1
                }
            ],
            3: [ // Chapter 4: The Burning of the Books
                {
                    passage: "In the town square, Jack and Annie witnessed the terrible sight of thousands of books being thrown into enormous fires.",
                    question: "What terrible sight did Jack and Annie witness in the town square?",
                    options: ["A celebration", "Thousands of books being thrown into enormous fires", "A peaceful gathering", "A market day"],
                    correct: 1
                },
                {
                    passage: "The flames consumed scrolls containing poetry, philosophy, history, and scientific knowledge that had taken centuries to accumulate.",
                    question: "What types of knowledge were being destroyed in the flames?",
                    options: ["Only children's stories", "Poetry, philosophy, history, and science accumulated over centuries", "Modern textbooks", "Foreign languages only"],
                    correct: 1
                },
                {
                    passage: "Many Chinese scholars wept openly as they watched their life's work and their ancestors' wisdom disappearing in smoke.",
                    question: "How did the Chinese scholars react to the book burning?",
                    options: ["They celebrated", "They wept openly watching their work and ancestors' wisdom disappear", "They ignored it", "They helped burn the books"],
                    correct: 1
                },
                {
                    passage: "Jack understood that this destruction of knowledge was similar to what had happened to the library in ancient Pompeii.",
                    question: "What connection did Jack make between this event and their previous adventure?",
                    options: ["No connection", "Similar to the library destruction in ancient Pompeii", "Completely different", "Only about volcanos"],
                    correct: 1
                },
                {
                    passage: "Annie realized they had to act quickly to save whatever books they could before this precious knowledge was lost forever.",
                    question: "What did Annie realize they needed to do?",
                    options: ["Watch and do nothing", "Act quickly to save books before knowledge was lost forever", "Leave China immediately", "Join the emperor's side"],
                    correct: 1
                }
            ],
            4: [ // Chapter 5: The Silk Weaver
                {
                    passage: "While searching for books to save, Jack and Annie met a skilled silk weaver who was hiding important scrolls in her silk cloth.",
                    question: "Who did Jack and Annie meet and what was she doing?",
                    options: ["A farmer planting rice", "A skilled silk weaver hiding scrolls in her silk cloth", "A soldier burning books", "A cook making food"],
                    correct: 1
                },
                {
                    passage: "The silk weaver explained that she was preserving ancient texts about silk-making techniques that had been passed down for generations.",
                    question: "What kind of texts was the silk weaver preserving?",
                    options: ["Modern stories", "Ancient texts about silk-making passed down for generations", "Foreign languages", "Military strategies"],
                    correct: 1
                },
                {
                    passage: "She showed them how silk was made from silkworm cocoons, a secret process that only the Chinese knew at that time.",
                    question: "What secret process did the silk weaver show Jack and Annie?",
                    options: ["Making paper", "How silk was made from silkworm cocoons, known only to Chinese", "Growing rice", "Building walls"],
                    correct: 1
                },
                {
                    passage: "The silk weaver trusted Jack and Annie and gave them some of her precious scrolls to hide and protect from the soldiers.",
                    question: "What did the silk weaver do to show her trust in Jack and Annie?",
                    options: ["Taught them Chinese", "Gave them precious scrolls to hide and protect", "Offered them food", "Asked them to leave"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie learned that many craftspeople and artists were secretly saving their knowledge, risking their lives for future generations.",
                    question: "What did Jack and Annie learn about craftspeople and artists?",
                    options: ["They didn't care about books", "Many were secretly saving knowledge, risking lives for future generations", "They supported the book burning", "They had no knowledge to save"],
                    correct: 1
                }
            ],
            5: [ // Chapter 6: The Tomb
                {
                    passage: "The silk weaver led Jack and Annie to a hidden underground tomb filled with terracotta warriors and ancient treasures.",
                    question: "Where did the silk weaver lead Jack and Annie?",
                    options: ["To a modern museum", "To a hidden underground tomb with terracotta warriors and treasures", "To the emperor's palace", "To a marketplace"],
                    correct: 1
                },
                {
                    passage: "The terracotta warriors were life-sized clay soldiers created to protect an ancient Chinese emperor in the afterlife.",
                    question: "What were the terracotta warriors and why were they created?",
                    options: ["Real soldiers", "Life-sized clay soldiers to protect an emperor in the afterlife", "Modern statues", "Children's toys"],
                    correct: 1
                },
                {
                    passage: "In the tomb, they discovered a secret library where scholars had hidden thousands of important books and scrolls.",
                    question: "What did they discover in the tomb?",
                    options: ["Gold and jewels", "A secret library with thousands of hidden books and scrolls", "Modern weapons", "Nothing important"],
                    correct: 1
                },
                {
                    passage: "The scholar explained that this underground library was one of several secret locations where Chinese knowledge was being preserved.",
                    question: "What did the scholar explain about the underground library?",
                    options: ["It was the only one", "It was one of several secret locations preserving Chinese knowledge", "It was empty", "It was recently built"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie realized they had found something even more valuable than gold - the preserved wisdom of an entire civilization.",
                    question: "What did Jack and Annie realize about their discovery?",
                    options: ["It was worthless", "They found something more valuable than gold - preserved civilization wisdom", "It was just old junk", "They should leave immediately"],
                    correct: 1
                }
            ],
            6: [ // Chapter 7: The Scholar
                {
                    passage: "In the hidden library, Jack and Annie met a brave scholar who had risked his life to save thousands of ancient Chinese texts.",
                    question: "Who did Jack and Annie meet in the hidden library?",
                    options: ["A soldier", "A brave scholar who risked his life to save ancient Chinese texts", "A merchant", "A farmer"],
                    correct: 1
                },
                {
                    passage: "The scholar told them about the importance of preserving knowledge, saying that books were the memory of humanity.",
                    question: "What did the scholar say about the importance of books?",
                    options: ["Books were worthless", "Books were the memory of humanity", "Books were just for entertainment", "Books were only for emperors"],
                    correct: 1
                },
                {
                    passage: "He showed them ancient texts about medicine, astronomy, mathematics, and philosophy that would benefit all of mankind.",
                    question: "What subjects were covered in the ancient texts the scholar showed them?",
                    options: ["Only stories", "Medicine, astronomy, mathematics, and philosophy", "Modern subjects", "Military tactics only"],
                    correct: 1
                },
                {
                    passage: "The scholar explained that knowledge belonged to all people, not just rulers, and should be shared freely.",
                    question: "What was the scholar's belief about knowledge?",
                    options: ["Only rulers should have it", "Knowledge belonged to all people and should be shared freely", "Knowledge was dangerous", "Knowledge was unnecessary"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie promised to help the scholar continue his work of preserving Chinese wisdom for future generations.",
                    question: "What did Jack and Annie promise the scholar?",
                    options: ["To forget what they saw", "To help preserve Chinese wisdom for future generations", "To tell the emperor", "To take the books home"],
                    correct: 1
                }
            ],
            7: [ // Chapter 8: The Writing of the Book
                {
                    passage: "The scholar asked Jack and Annie to help him create a special book that would preserve the most important Chinese teachings.",
                    question: "What did the scholar ask Jack and Annie to help him create?",
                    options: ["A letter to the emperor", "A special book preserving the most important Chinese teachings", "A map", "A poem"],
                    correct: 1
                },
                {
                    passage: "They worked together to carefully copy the wisdom of Confucius, who taught about respect, kindness, and living in harmony.",
                    question: "What teachings did they copy from Confucius?",
                    options: ["War strategies", "Respect, kindness, and living in harmony", "Cooking recipes", "Building techniques"],
                    correct: 1
                },
                {
                    passage: "They also preserved the teachings of Laozi, who wrote about finding peace and balance in nature and in life.",
                    question: "What did Laozi's teachings focus on?",
                    options: ["Making money", "Finding peace and balance in nature and life", "Conquering enemies", "Building cities"],
                    correct: 1
                },
                {
                    passage: "The scholar explained that these philosophies had guided Chinese people for centuries and deserved to survive.",
                    question: "What did the scholar say about these Chinese philosophies?",
                    options: ["They were new ideas", "They had guided Chinese people for centuries and deserved to survive", "They were foreign concepts", "They were outdated"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie understood that they were helping to preserve not just words, but the soul of Chinese civilization.",
                    question: "What did Jack and Annie understand about their work?",
                    options: ["They were just copying words", "They were preserving the soul of Chinese civilization", "They were wasting time", "They were helping the emperor"],
                    correct: 1
                }
            ],
            8: [ // Chapter 9: The Wild Man
                {
                    passage: "As they prepared to leave the hidden library, Jack and Annie encountered a mysterious wild man who lived in the Chinese mountains.",
                    question: "Who did Jack and Annie encounter as they prepared to leave?",
                    options: ["A palace guard", "A mysterious wild man from the Chinese mountains", "A merchant", "A child"],
                    correct: 1
                },
                {
                    passage: "The wild man turned out to be another scholar who had escaped to the wilderness to avoid the book burning.",
                    question: "Who was the wild man really?",
                    options: ["A criminal", "Another scholar who escaped to avoid the book burning", "A soldier", "A farmer"],
                    correct: 1
                },
                {
                    passage: "He had memorized hundreds of important texts and poems, keeping them alive in his mind when the written versions were destroyed.",
                    question: "How did the wild man preserve important texts?",
                    options: ["He hid books in caves", "He memorized hundreds of texts and poems in his mind", "He buried them", "He gave them to friends"],
                    correct: 1
                },
                {
                    passage: "The wild man taught Jack and Annie that knowledge could never truly be destroyed as long as people remembered it.",
                    question: "What important lesson did the wild man teach Jack and Annie?",
                    options: ["Books were more important than people", "Knowledge could never be destroyed as long as people remembered it", "Only written knowledge mattered", "Memory was unreliable"],
                    correct: 1
                },
                {
                    passage: "Before they parted, the wild man recited beautiful Chinese poetry that brought tears to their eyes with its wisdom and beauty.",
                    question: "What did the wild man do before Jack and Annie left?",
                    options: ["Gave them gold", "Recited beautiful Chinese poetry that brought tears to their eyes", "Warned them about danger", "Asked them to stay"],
                    correct: 1
                }
            ],
            9: [ // Chapter 10: The New China
                {
                    passage: "Back in the tree house, Jack and Annie reflected on their adventure and the brave Chinese people who had risked everything to preserve knowledge.",
                    question: "What did Jack and Annie reflect on in the tree house?",
                    options: ["Their next adventure", "The brave Chinese people who risked everything to preserve knowledge", "What to eat for dinner", "Their homework"],
                    correct: 1
                },
                {
                    passage: "They realized that the knowledge they had helped save would eventually lead to many Chinese inventions like paper, gunpowder, and the compass.",
                    question: "What did they realize about the knowledge they helped save?",
                    options: ["It would be forgotten", "It would lead to Chinese inventions like paper, gunpowder, and compass", "It was not important", "It would cause problems"],
                    correct: 1
                },
                {
                    passage: "Morgan le Fay appeared and explained that their mission had helped ensure that Chinese wisdom would survive and spread throughout the world.",
                    question: "What did Morgan le Fay explain about their mission?",
                    options: ["It had failed", "It helped ensure Chinese wisdom would survive and spread worldwide", "It was just practice", "It changed nothing"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie learned that the Dragon King's attempt to destroy knowledge had ultimately failed, and learning continued to flourish in China.",
                    question: "What did Jack and Annie learn about the Dragon King's attempt to destroy knowledge?",
                    options: ["It was successful", "It ultimately failed and learning continued to flourish", "It was never serious", "It only affected one city"],
                    correct: 1
                },
                {
                    passage: "They felt proud knowing they had played a part in preserving one of the world's greatest civilizations and its timeless wisdom.",
                    question: "How did Jack and Annie feel about their role in the adventure?",
                    options: ["Disappointed", "Proud they helped preserve one of the world's greatest civilizations", "Confused", "Worried about the future"],
                    correct: 1
                }
            ]
        };

        // Ï†ÑÏó≠ Î≥ÄÏàò
        let currentChapterIndex = 0;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let questions = [];
        let currentAudio = null;
        let playbackSpeed = 1.0;

        // üéß ÏûêÎèô Ïò§ÎîîÏò§ URL ÏÉùÏÑ± Ìï®Ïàò
        function getAudioUrl(chapterIndex) {
            const level = 'level3';
            const bookId = 'MTH014';
            const chapterNum = String(chapterIndex + 1).padStart(2, '0');
            
            const possibleFileNames = [
                `${bookId}_chapter${chapterNum}.mp3`,
                `${bookId}_ch${chapterNum}.mp3`,
                `${bookId}_${chapterNum}.mp3`,
                `magic_tree_house_14_chapter${chapterNum}.mp3`,
                `magic_tree_house_14_ch${chapterNum}.mp3`,
                `day_of_the_dragon_king_${chapterNum}.mp3`,
                `mary_pope_osborne_14_chapter${chapterNum}.mp3`,
                `${bookId}.mp3`
            ];
            
            return {
                primary: `${AUDIO_BASE_URL}${level}/${possibleFileNames[0]}`,
                alternatives: possibleFileNames.map(fileName => `${AUDIO_BASE_URL}${level}/${fileName}`)
            };
        }

        // üéß Ïò§ÎîîÏò§ Ïû¨ÏÉù Ìï®Ïàò
        function playChapterAudio(chapterIndex) {
            const chapter = bookData.chapterList[chapterIndex];
            const audioUrls = getAudioUrl(chapterIndex);

            document.getElementById('audio-modal').style.display = 'flex';
            document.getElementById('audio-chapter-title').textContent = `Chapter ${chapterIndex + 1}: ${chapter.title}`;
            document.getElementById('audio-chapter-subtitle').textContent = `${bookData.title} - ${bookData.author}`;

            // Ïò§ÎîîÏò§ Ï†ïÎ≥¥ ÏòÅÏó≠ Îã§Ïãú Î≥¥Ïù¥Í∏∞ (ÏÉàÎ°úÏö¥ Ïò§ÎîîÏò§ ÌîåÎ†àÏù¥Ïãú)
            document.getElementById('audio-info').classList.remove('hidden');

            const audioPlayer = document.getElementById('audio-player');
            const audioSource = document.getElementById('audio-source');
            const audioStatus = document.getElementById('audio-status');

            audioStatus.textContent = 'üîÑ Ïò§ÎîîÏò§ ÌååÏùºÏùÑ Ï∞æÎäî Ï§ë...';

            function tryLoadAudio(urlIndex = 0) {
                if (urlIndex >= audioUrls.alternatives.length) {
                    audioStatus.innerHTML = `‚ùå Ïò§ÎîîÏò§ ÌååÏùºÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.`;
                    return;
                }

                const currentUrl = audioUrls.alternatives[urlIndex];
                audioSource.src = currentUrl;
                audioPlayer.load();

                const successHandler = function() {
                    const startTime = chapter.startTime || 0;
                    audioPlayer.currentTime = startTime;
                    audioStatus.innerHTML = `‚úÖ Ïò§ÎîîÏò§ Ï§ÄÎπÑ ÏôÑÎ£å!`;
                };

                const errorHandler = function() {
                    setTimeout(() => tryLoadAudio(urlIndex + 1), 100);
                };

                audioPlayer.addEventListener('canplaythrough', successHandler, { once: true });
                audioPlayer.addEventListener('error', errorHandler, { once: true });
            }

            tryLoadAudio(0);
            currentAudio = audioPlayer;
            playbackSpeed = 1.0;
        }

        // Í∏∞Î≥∏ Ìï®ÏàòÎì§
        function closeAudioModal() {
            document.getElementById('audio-modal').style.display = 'none';
            if (currentAudio) currentAudio.pause();
        }

        function togglePlayPause() {
            if (!currentAudio) return;
            if (currentAudio.paused) {
                currentAudio.play();
                document.querySelector('.play-pause-btn').textContent = '‚è∏Ô∏è ÏùºÏãúÏ†ïÏßÄ';
            } else {
                currentAudio.pause();
                document.querySelector('.play-pause-btn').textContent = '‚ñ∂Ô∏è Ïû¨ÏÉù';
            }
        }

        function changeSpeed() {
            if (!currentAudio) return;
            const speeds = [0.5, 0.75, 1.0, 1.25, 1.5, 2.0];
            const currentIndex = speeds.indexOf(playbackSpeed);
            playbackSpeed = speeds[(currentIndex + 1) % speeds.length];
            currentAudio.playbackRate = playbackSpeed;
            document.querySelector('.speed-btn').textContent = `${playbackSpeed}x`;
        }

        function resetToChapterStart() {
            if (!currentAudio) return;
            const currentChapter = parseInt(document.getElementById('audio-chapter-title').textContent.match(/Chapter (\d+)/)[1]) - 1;
            currentAudio.currentTime = bookData.chapterList[currentChapter]?.startTime || 0;
        }

        function downloadAudio() {
            const audioSource = document.getElementById('audio-source');
            if (audioSource.src) {
                const link = document.createElement('a');
                link.href = audioSource.src;
                link.download = `${document.getElementById('audio-chapter-title').textContent}.mp3`;
                link.click();
            }
        }

        // Ï±Ö ÏÉÅÏÑ∏ Ï†ïÎ≥¥ ÌëúÏãú
        function showBookDetail() {
            document.getElementById('book-detail-screen').style.display = 'block';
            document.getElementById('learning-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'none';
            generateChapterGrid();
            updateProgress();
        }

        // Ï±ïÌÑ∞ Í∑∏Î¶¨Îìú ÏÉùÏÑ±
        function generateChapterGrid() {
            const grid = document.getElementById('chapters-grid');
            grid.innerHTML = '';

            bookData.chapterList.forEach((chapter, index) => {
                const chapterCard = document.createElement('div');
                chapterCard.className = `chapter-card ${chapter.status}`;

                chapterCard.innerHTML = `
                    <div class="chapter-header">
                        <div class="chapter-info">
                            <h4>Chapter ${index + 1}: ${chapter.title}</h4>
                            <p>${chapter.description} (${chapter.questionCount}Î¨∏Ï†ú)</p>
                        </div>
                        <div class="chapter-status ${chapter.status}">
                            ${chapter.status === 'completed' ? '‚úÖ ÏôÑÎ£å' :
                              chapter.status === 'current' ? 'üìñ ÏßÑÌñâÏ§ë' : 'üîí Ïû†ÍπÄ'}
                        </div>
                    </div>
                    <div class="chapter-actions">
                        <button class="chapter-btn audio-btn" onclick="playChapterAudio(${index})"
                                ${chapter.status === 'locked' ? 'disabled' : ''}>
                            üéß Ïò§ÎîîÏò§
                        </button>
                        <button class="chapter-btn quiz-btn" onclick="startLearning(${index})"
                                ${chapter.status === 'locked' ? 'disabled' : ''}>
                            üìù Î¨∏Ï†úÌíÄÍ∏∞
                        </button>
                    </div>
                `;

                grid.appendChild(chapterCard);
            });
        }

        // ÏßÑÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
        function updateProgress() {
            const completedChapters = bookData.chapterList.filter(chapter => chapter.status === 'completed').length;
            const progress = Math.round((completedChapters / bookData.chapters) * 100);
            document.getElementById('progress-value').textContent = progress + '%';
        }

        // ÌïôÏäµ ÏãúÏûë
        function startLearning(chapterIndex) {
            currentChapterIndex = chapterIndex;
            currentQuestionIndex = 0;
            userAnswers = [];
            questions = questionsData[chapterIndex];

            if (!questions || questions.length === 0) {
                alert('Ïù¥ Ï±ïÌÑ∞Ïùò Î¨∏Ï†úÍ∞Ä ÏïÑÏßÅ Ï§ÄÎπÑÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                return;
            }

            document.getElementById('book-detail-screen').style.display = 'none';
            document.getElementById('learning-screen').style.display = 'block';
            document.getElementById('result-screen').style.display = 'none';

            const chapter = bookData.chapterList[chapterIndex];
            document.getElementById('learning-title').textContent = `Chapter ${chapterIndex + 1}: ${chapter.title}`;
            document.getElementById('learning-chapter-breadcrumb').textContent = `Chapter ${chapterIndex + 1}`;

            showQuestion();
            updateLearningProgress();
        }

        // Î¨∏Ï†ú ÌëúÏãú
        function showQuestion() {
            const question = questions[currentQuestionIndex];
            const container = document.getElementById('question-container');

            container.innerHTML = `
                <div class="question-text">Î¨∏Ï†ú ${currentQuestionIndex + 1}</div>
                <div class="passage">${question.passage}</div>
                <div class="question-text">${question.question}</div>
                <div class="options">
                    ${question.options.map((option, index) =>
                        `<div class="option" onclick="selectOption(${index})" data-index="${index}">
                            ${String.fromCharCode(65 + index)}. ${option}
                        </div>`
                    ).join('')}
                </div>
            `;

            if (userAnswers[currentQuestionIndex] !== undefined) {
                const selectedOption = container.querySelector(`[data-index="${userAnswers[currentQuestionIndex]}"]`);
                if (selectedOption) selectedOption.classList.add('selected');
            }

            updateNavigationButtons();
        }

        // ÏÑ†ÌÉùÏßÄ ÏÑ†ÌÉù
        function selectOption(optionIndex) {
            document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
            document.querySelector(`[data-index="${optionIndex}"]`).classList.add('selected');
            userAnswers[currentQuestionIndex] = optionIndex;
            updateNavigationButtons();
        }

        // ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò
        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                showQuestion();
                updateLearningProgress();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion();
                updateLearningProgress();
            }
        }

        function updateLearningProgress() {
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('learning-progress-bar').style.width = progress + '%';
            document.getElementById('learning-progress-text').textContent = `Î¨∏Ï†ú ${currentQuestionIndex + 1} / ${questions.length}`;
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const submitBtn = document.getElementById('submit-btn');

            prevBtn.disabled = currentQuestionIndex === 0;

            if (currentQuestionIndex === questions.length - 1) {
                nextBtn.style.display = 'none';
                submitBtn.style.display = 'block';
                submitBtn.disabled = userAnswers[currentQuestionIndex] === undefined;
            } else {
                nextBtn.style.display = 'block';
                submitBtn.style.display = 'none';
                nextBtn.disabled = userAnswers[currentQuestionIndex] === undefined;
            }
        }

        // ÎãµÏïà Ï†úÏ∂ú
        function submitAnswers() {
            let correctCount = 0;
            questions.forEach((question, index) => {
                if (userAnswers[index] === question.correct) correctCount++;
            });

            const score = Math.round((correctCount / questions.length) * 100);

            if (score >= 70) {
                bookData.chapterList[currentChapterIndex].status = 'completed';
                if (currentChapterIndex < bookData.chapterList.length - 1) {
                    bookData.chapterList[currentChapterIndex + 1].status = 'current';
                }
            }

            showResults(correctCount, questions.length, score);
        }

        // Í≤∞Í≥º ÌëúÏãú
        function showResults(correct, total, score) {
            document.getElementById('learning-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';

            document.getElementById('score-circle').textContent = score + '%';
            document.getElementById('total-questions').textContent = total + 'Î¨∏Ï†ú';
            document.getElementById('correct-answers').textContent = correct + 'Î¨∏Ï†ú';
            document.getElementById('wrong-answers').textContent = (total - correct) + 'Î¨∏Ï†ú';
            document.getElementById('final-score').textContent = score + 'Ï†ê';

            let message = '';
            if (score >= 90) message = 'ÌõåÎ•≠Ìï©ÎãàÎã§! üåü';
            else if (score >= 80) message = 'ÏûòÌñàÏñ¥Ïöî! üëè';
            else if (score >= 70) message = 'Ï¢ãÏïÑÏöî! üëç';
            else message = 'Îã§Ïãú ÌïúÎ≤à ÎèÑÏ†ÑÌï¥Î≥¥ÏÑ∏Ïöî! üí™';

            document.getElementById('result-message').textContent = message;
        }

        function retryChapter() {
            startLearning(currentChapterIndex);
        }

        function nextChapter() {
            if (currentChapterIndex < bookData.chapterList.length - 1) {
                startLearning(currentChapterIndex + 1);
            } else {
                alert('Î™®Îì† Ï±ïÌÑ∞Î•º ÏôÑÎ£åÌñàÏäµÎãàÎã§! üéâ');
                showBookDetail();
            }
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú
        window.addEventListener('load', function() {
            showBookDetail();
            console.log('üê≤ Magic Tree House: Day of the Dragon King ÌïôÏäµ ÏãúÏä§ÌÖúÏù¥ Ï§ÄÎπÑÎêòÏóàÏäµÎãàÎã§!');
        });

        // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠Ïãú Îã´Í∏∞
        document.getElementById('audio-modal').addEventListener('click', function(e) {
            if (e.target === this) closeAudioModal();
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Viking Ships at Sunrise - Level 3 - ÏàòÎ¶¨Îî©Ïñ¥ÌïôÏõê</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #2F4F4F 0%, #4682B4 50%, #87CEEB 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        /* Ìó§Îçî */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #2F4F4F, #4682B4);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .logo-text h1 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
        }

        .logo-text p {
            font-size: 0.9rem;
            color: #666;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
            color: #333;
            text-decoration: none;
        }

        .nav-btn:hover {
            background: #2F4F4F;
            color: white;
            transform: translateY(-2px);
        }

        /* Î©îÏù∏ ÏΩòÌÖêÏ∏† ÏòÅÏó≠ */
        .main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            min-height: 600px;
        }

        /* Ï±Ö ÏÉÅÏÑ∏ ÌôîÎ©¥ */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 30px;
            font-size: 0.9rem;
            color: #666;
        }

        .breadcrumb a {
            color: #2F4F4F;
            text-decoration: none;
            cursor: pointer;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .book-detail-header {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: flex-start;
        }

        .detail-book-cover {
            width: 150px;
            height: 220px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 4rem;
            font-weight: bold;
            flex-shrink: 0;
            background: linear-gradient(45deg, #2F4F4F, #4682B4);
        }

        .book-info {
            flex: 1;
        }

        .book-info h2 {
            font-size: 2.2rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .book-info .author {
            font-size: 1.2rem;
            color: #2F4F4F;
            margin-bottom: 20px;
        }

        .book-summary {
            font-size: 1rem;
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .book-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-box .value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2F4F4F;
        }

        .stat-box .label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        /* Ï±ïÌÑ∞ Í∑∏Î¶¨Îìú */
        .chapters-section {
            margin-top: 40px;
        }

        .chapters-section h3 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 30px;
            text-align: center;
        }

        .chapters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .chapter-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
        }

        .chapter-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .chapter-card.completed {
            border-color: #28a745;
            background: linear-gradient(135deg, #28a74508, #ffffff);
        }

        .chapter-card.current {
            border-color: #2F4F4F;
            background: linear-gradient(135deg, #2F4F4F08, #ffffff);
        }

        .chapter-card.locked {
            opacity: 0.6;
            background: #f8f9fa;
        }

        .chapter-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .chapter-info h4 {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }

        .chapter-info p {
            font-size: 0.95rem;
            color: #666;
            line-height: 1.5;
        }

        .chapter-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .chapter-status.completed {
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
        }

        .chapter-status.current {
            background: rgba(47, 79, 79, 0.1);
            color: #2F4F4F;
        }

        .chapter-status.locked {
            background: rgba(108, 117, 125, 0.1);
            color: #6c757d;
        }

        .chapter-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .chapter-btn {
            padding: 12px 16px;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .audio-btn {
            background: linear-gradient(45deg, #2F4F4F, #4682B4);
            color: white;
        }

        .quiz-btn {
            background: linear-gradient(45deg, #87CEEB, #4682B4);
            color: white;
        }

        .chapter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .chapter-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* ÌïôÏäµ ÌôîÎ©¥ */
        .learning-screen {
            display: none;
        }

        .learning-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .learning-progress {
            background: #f8f9fa;
            border-radius: 10px;
            height: 8px;
            margin: 20px 0;
            overflow: hidden;
        }

        .learning-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #2F4F4F, #4682B4);
            transition: width 0.3s ease;
        }

        .question-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
        }

        .passage {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1rem;
            line-height: 1.6;
            color: #444;
        }

        .options {
            display: grid;
            gap: 10px;
        }

        .option {
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option:hover {
            background: #e9ecef;
            border-color: #2F4F4F;
        }

        .option.selected {
            background: rgba(47, 79, 79, 0.1);
            border-color: #2F4F4F;
        }

        .learning-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .control-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .next-btn {
            background: linear-gradient(45deg, #2F4F4F, #4682B4);
            color: white;
        }

        .prev-btn {
            background: #6c757d;
            color: white;
        }

        .submit-btn {
            background: linear-gradient(45deg, #2F4F4F, #4682B4);
            color: white;
        }

        .control-btn:hover {
            transform: translateY(-2px);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Í≤∞Í≥º ÌôîÎ©¥ */
        .result-screen {
            display: none;
            text-align: center;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(45deg, #2F4F4F, #4682B4);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            font-size: 2rem;
            font-weight: bold;
        }

        .result-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .result-stat {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .result-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        /* Ïò§ÎîîÏò§ ÌîåÎ†àÏù¥Ïñ¥ Î™®Îã¨ */
        .audio-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .audio-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 600px;
            width: 90%;
            position: relative;
        }

        .close-audio {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #666;
        }

        .audio-player {
            width: 100%;
            margin: 20px 0;
            border-radius: 10px;
        }

        .audio-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .audio-control-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .play-pause-btn {
            background: linear-gradient(45deg, #2F4F4F, #4682B4);
            color: white;
        }

        .speed-btn {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #ddd;
        }

        .download-btn {
            background: #87CEEB;
            color: white;
        }

        .audio-info {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            font-size: 0.9rem;
            color: #666;
            transition: all 0.3s ease;
        }

        .audio-info.hidden {
            display: none;
        }

        /* Î∞òÏùëÌòï */
        @media (max-width: 768px) {
            .chapters-grid {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .book-detail-header {
                flex-direction: column;
                text-align: center;
            }

            .book-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .learning-controls {
                flex-direction: column;
            }

            .chapter-actions {
                grid-template-columns: 1fr;
            }

            .audio-controls {
                justify-content: center;
                gap: 10px;
            }

            .audio-content {
                padding: 30px 20px;
            }
        }

        .new-book-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: linear-gradient(45deg, #FF6B9D, #C44569);
            color: white;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: 700;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Level 3 ÌäπÎ≥Ñ Ïä§ÌÉÄÏùº */
        .level-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: linear-gradient(45deg, #FF6B00, #FF8E53);
            color: white;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ìó§Îçî -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">‚öîÔ∏è</div>
                <div class="logo-text">
                    <h1>Viking Ships at Sunrise</h1>
                    <p>Level 3 - Mary Pope OsborneÏùò Îß§ÏßÅ Ìä∏Î¶¨ ÌïòÏö∞Ïä§ 15Í∂å</p>
                </div>
            </div>
            <div class="nav-buttons">
                <a href="http://www.suelibrary.store/" class="nav-btn">Î©îÏù∏ÏúºÎ°ú</a>
            </div>
        </div>

        <!-- Î©îÏù∏ ÏΩòÌÖêÏ∏† -->
        <div class="main-content">
            <!-- Ï±Ö ÏÉÅÏÑ∏ ÌôîÎ©¥ -->
            <div class="book-detail-screen" id="book-detail-screen">
                <div class="level-badge">Level 3</div>
                <div class="breadcrumb">
                    <span>Viking Ships at Sunrise</span>
                </div>

                <div class="book-detail-header">
                    <div class="detail-book-cover">‚öîÔ∏è</div>
                    <div class="book-info">
                        <h2>Viking Ships at Sunrise</h2>
                        <div class="author">Mary Pope Osborne</div>
                        <div class="book-summary">
                            Jack and Annie travel to medieval Ireland to help a monk save precious books from Viking raiders! They must brave the dangers of the Irish coast and help Brother Patrick preserve ancient manuscripts in his monastery. Learning about medieval monasteries and Viking culture, they discover how knowledge survived through the Dark Ages.
                        </div>
                        <div class="book-stats">
                            <div class="stat-box">
                                <div class="value">10</div>
                                <div class="label">Ï±ïÌÑ∞</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">50</div>
                                <div class="label">Ï¥ù Î¨∏Ï†ú</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">Level 3</div>
                                <div class="label">Î†àÎ≤®</div>
                            </div>
                            <div class="stat-box">
                                <div class="value" id="progress-value">0%</div>
                                <div class="label">ÏßÑÎèÑ</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="chapters-section">
                    <h3>üõ°Ô∏è Ï±ïÌÑ∞Î≥Ñ ÌïôÏäµ</h3>
                    <div class="chapters-grid" id="chapters-grid">
                        <!-- Ï±ïÌÑ∞ Ïπ¥ÎìúÎì§ -->
                    </div>
                </div>
            </div>

            <!-- ÌïôÏäµ ÌôîÎ©¥ -->
            <div class="learning-screen" id="learning-screen">
                <div class="breadcrumb">
                    <a onclick="showBookDetail()">Viking Ships at Sunrise</a>
                    <span>></span>
                    <span id="learning-chapter-breadcrumb">Chapter 1</span>
                </div>

                <div class="learning-header">
                    <h2 id="learning-title">Chapter 1: Help!</h2>
                    <div class="learning-progress">
                        <div class="learning-progress-bar" id="learning-progress-bar" style="width: 0%"></div>
                    </div>
                    <p id="learning-progress-text">Î¨∏Ï†ú 1 / 5</p>
                </div>

                <div class="question-container" id="question-container">
                    <!-- Î¨∏Ï†úÍ∞Ä ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
                </div>

                <div class="learning-controls">
                    <button class="control-btn prev-btn" id="prev-btn" onclick="previousQuestion()" disabled>Ïù¥Ï†Ñ</button>
                    <button class="control-btn next-btn" id="next-btn" onclick="nextQuestion()">Îã§Ïùå</button>
                    <button class="control-btn submit-btn" id="submit-btn" onclick="submitAnswers()" style="display: none;">Ï†úÏ∂ú</button>
                </div>
            </div>

            <!-- Í≤∞Í≥º ÌôîÎ©¥ -->
            <div class="result-screen" id="result-screen">
                <div class="breadcrumb">
                    <a onclick="showBookDetail()">Viking Ships at Sunrise</a>
                    <span>></span>
                    <span>Í≤∞Í≥º</span>
                </div>

                <div class="result-header">
                    <h2>üéâ ÌïôÏäµ ÏôÑÎ£å!</h2>
                    <div class="score-circle" id="score-circle">100%</div>
                    <h3 id="result-message">ÌõåÎ•≠Ìï©ÎãàÎã§!</h3>
                </div>

                <div class="result-details">
                    <div class="result-stat">
                        <h4>Ï¥ù Î¨∏Ï†ú</h4>
                        <p id="total-questions">5Î¨∏Ï†ú</p>
                    </div>
                    <div class="result-stat">
                        <h4>Ï†ïÎãµ</h4>
                        <p id="correct-answers">5Î¨∏Ï†ú</p>
                    </div>
                    <div class="result-stat">
                        <h4>Ïò§Îãµ</h4>
                        <p id="wrong-answers">0Î¨∏Ï†ú</p>
                    </div>
                    <div class="result-stat">
                        <h4>Ï†êÏàò</h4>
                        <p id="final-score">100Ï†ê</p>
                    </div>
                </div>

                <div class="result-actions">
                    <button class="control-btn prev-btn" onclick="retryChapter()">Îã§Ïãú ÌíÄÍ∏∞</button>
                    <button class="control-btn next-btn" onclick="nextChapter()">Îã§Ïùå Ï±ïÌÑ∞</button>
                    <button class="control-btn submit-btn" onclick="showBookDetail()">Ï±ïÌÑ∞ Î™©Î°ù</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ïò§ÎîîÏò§ ÌîåÎ†àÏù¥Ïñ¥ Î™®Îã¨ -->
    <div class="audio-modal" id="audio-modal">
        <div class="audio-content">
            <button class="close-audio" onclick="closeAudioModal()">√ó</button>
            <h3 id="audio-chapter-title">Chapter 1: Help!</h3>
            <p id="audio-chapter-subtitle">Viking Ships at Sunrise - Mary Pope Osborne</p>

            <audio class="audio-player" id="audio-player" controls preload="metadata">
                <source id="audio-source" src="" type="audio/mpeg">
                Î∏åÎùºÏö∞Ï†ÄÍ∞Ä Ïò§ÎîîÏò§Î•º ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.
            </audio>

            <div class="audio-controls">
                <button class="audio-control-btn play-pause-btn" onclick="togglePlayPause()">‚ñ∂Ô∏è Ïû¨ÏÉù</button>
                <button class="audio-control-btn speed-btn" onclick="changeSpeed()">1.0x</button>
                <button class="audio-control-btn" onclick="resetToChapterStart()" style="background: #28a745; color: white;">üîÑ Íµ¨Í∞ÑÏ≤òÏùå</button>
                <button class="audio-control-btn download-btn" onclick="downloadAudio()">üì• Îã§Ïö¥Î°úÎìú</button>
            </div>

            <div class="audio-info" id="audio-info">
                <div id="audio-status" style="margin-top: 10px; font-weight: bold; color: #2F4F4F;"></div>
            </div>
        </div>
    </div>

    <script>
        // üéØ Íµ¨Í∏Ä ÌÅ¥ÎùºÏö∞Îìú Ïä§ÌÜ†Î¶¨ÏßÄ Ïò§ÎîîÏò§ URL ÏÑ§Ï†ï
        const AUDIO_BASE_URL = 'https://storage.googleapis.com/kim-mom-reading-audio/audio/';

        // Magic Tree House 15Í∂å ÎèÑÏÑú Îç∞Ïù¥ÌÑ∞ (10Ï±ïÌÑ∞)
        const bookData = {
            id: 'MTH015',
            title: "Viking Ships at Sunrise",
            author: 'Mary Pope Osborne',
            cover: '‚öîÔ∏è',
            progress: 0,
            chapters: 10,
            totalQuestions: 50, // 10Ï±ïÌÑ∞ √ó 5Î¨∏Ï†ú
            coverColor: 'linear-gradient(45deg, #2F4F4F, #4682B4)',
            summary: "Jack and Annie travel to medieval Ireland to help a monk save precious books from Viking raiders! They must brave the dangers of the Irish coast and help Brother Patrick preserve ancient manuscripts in his monastery. Learning about medieval monasteries and Viking culture, they discover how knowledge survived through the Dark Ages.",
            chapterList: [
                { title: 'Help!', description: 'Jack and Annie receive an urgent call for help from medieval Ireland.', status: 'current', questionCount: 5, startTime: 0 },
                { title: 'The Steep Cliff', description: 'They arrive on a dangerous cliff overlooking the Irish coast.', status: 'locked', questionCount: 5, startTime: 300 },
                { title: 'Brother Patrick', description: 'They meet a monk who needs help protecting precious manuscripts.', status: 'locked', questionCount: 5, startTime: 600 },
                { title: 'The Vikings Are Coming!', description: 'Viking ships appear on the horizon, threatening the monastery.', status: 'locked', questionCount: 5, startTime: 900 },
                { title: 'The Secret of the Serpent Ship', description: 'They learn about Viking ships and navigation techniques.', status: 'locked', questionCount: 5, startTime: 1200 },
                { title: 'The Tomb', description: 'They hide in an ancient tomb to escape the Viking raiders.', status: 'locked', questionCount: 5, startTime: 1500 },
                { title: 'The Rock of Scriptures', description: 'They discover where the monks hid their most precious books.', status: 'locked', questionCount: 5, startTime: 1800 },
                { title: 'The Cross of Light', description: 'They find a beautiful illuminated manuscript with amazing artwork.', status: 'locked', questionCount: 5, startTime: 2100 },
                { title: 'Hearth and Home', description: 'They help save the monastery and its precious knowledge.', status: 'locked', questionCount: 5, startTime: 2400 },
                { title: 'The Book of Stories', description: 'They return with understanding of how books survived the Dark Ages.', status: 'locked', questionCount: 5, startTime: 2700 }
            ]
        };

        // Î¨∏Ï†ú Îç∞Ïù¥ÌÑ∞ (Ï†ÑÏ≤¥ 10Ï±ïÌÑ∞ ÏôÑÎ£å)
        const questionsData = {
            0: [ // Chapter 1: Help!
                {
                    passage: "Jack and Annie found a note in the tree house written in urgent handwriting, calling for help to save precious books from destruction.",
                    question: "What kind of note did Jack and Annie find in the tree house?",
                    options: ["A birthday invitation", "An urgent note calling for help to save books from destruction", "A shopping list", "A thank you card"],
                    correct: 1
                },
                {
                    passage: "The note explained that Viking raiders were attacking monasteries in Ireland and burning all the books and manuscripts they could find.",
                    question: "What were the Viking raiders doing to the monasteries according to the note?",
                    options: ["Building new libraries", "Attacking and burning books and manuscripts", "Teaching the monks", "Bringing gifts"],
                    correct: 1
                },
                {
                    passage: "Morgan le Fay appeared and told them that medieval Irish monks had spent years copying important books by hand to preserve knowledge.",
                    question: "What had the medieval Irish monks been doing according to Morgan?",
                    options: ["Fighting Vikings", "Spending years copying important books by hand", "Building ships", "Growing food"],
                    correct: 1
                },
                {
                    passage: "She explained that these monasteries were centers of learning during the Dark Ages, when much knowledge was being lost elsewhere in Europe.",
                    question: "What role did monasteries play during the Dark Ages?",
                    options: ["They were military fortresses", "They were centers of learning when knowledge was being lost", "They were only for prayer", "They were marketplaces"],
                    correct: 1
                },
                {
                    passage: "Morgan urged Jack and Annie to help save as many books as possible from the Viking raids before this precious knowledge was lost forever.",
                    question: "What did Morgan urge Jack and Annie to do?",
                    options: ["Fight the Vikings", "Help save books from Viking raids before knowledge was lost", "Build a fortress", "Learn to read Irish"],
                    correct: 1
                }
            ],
            1: [ // Chapter 2: The Steep Cliff
                {
                    passage: "Jack and Annie found themselves on a steep, rocky cliff overlooking the gray waters of the Irish Sea during a misty morning.",
                    question: "Where did Jack and Annie find themselves?",
                    options: ["In a forest", "On a steep cliff overlooking the Irish Sea", "In a city", "Underground"],
                    correct: 1
                },
                {
                    passage: "Below them, they could see a small monastery perched on the edge of the cliff, with stone buildings and a tall round tower.",
                    question: "What could they see below the cliff?",
                    options: ["A modern city", "A small monastery with stone buildings and a round tower", "A Viking camp", "Nothing but rocks"],
                    correct: 1
                },
                {
                    passage: "The Irish coast was wild and beautiful, with crashing waves, seabirds crying overhead, and green fields stretching inland.",
                    question: "How did the Irish coast appear to Jack and Annie?",
                    options: ["Ugly and boring", "Wild and beautiful with waves, seabirds, and green fields", "Completely flat", "Full of modern buildings"],
                    correct: 1
                },
                {
                    passage: "They noticed that the morning mist was beginning to clear, revealing the vast expanse of the ocean where danger might approach.",
                    question: "What did the clearing mist reveal?",
                    options: ["A city", "The vast ocean where danger might approach", "Mountains", "A desert"],
                    correct: 1
                },
                {
                    passage: "Jack felt worried about how they would safely climb down the steep cliff to reach the monastery below.",
                    question: "What worried Jack about their situation?",
                    options: ["The weather", "How to safely climb down the steep cliff to the monastery", "Finding food", "Speaking Irish"],
                    correct: 1
                }
            ],
            2: [ // Chapter 3: Brother Patrick
                {
                    passage: "They carefully made their way down to the monastery and met Brother Patrick, a friendly Irish monk wearing a simple brown robe.",
                    question: "Who did Jack and Annie meet at the monastery?",
                    options: ["A Viking warrior", "Brother Patrick, a friendly Irish monk in a brown robe", "A king", "A merchant"],
                    correct: 1
                },
                {
                    passage: "Brother Patrick was working in the scriptorium, a special room where monks copied books by hand using quill pens and beautiful colored inks.",
                    question: "Where was Brother Patrick working and what was he doing?",
                    options: ["In the kitchen cooking", "In the scriptorium copying books by hand with quill pens", "In the garden planting", "In the tower watching"],
                    correct: 1
                },
                {
                    passage: "He showed them illuminated manuscripts with gorgeous decorations, intricate Celtic knots, and golden letters that took months to complete.",
                    question: "What did Brother Patrick show them?",
                    options: ["Simple books", "Illuminated manuscripts with decorations, Celtic knots, and golden letters", "Empty pages", "Modern printed books"],
                    correct: 1
                },
                {
                    passage: "Brother Patrick explained that these books contained religious texts, classical knowledge from Greece and Rome, and Irish poetry and stories.",
                    question: "What kinds of content did the manuscripts contain?",
                    options: ["Only children's stories", "Religious texts, classical knowledge, and Irish poetry and stories", "Modern science", "Viking legends"],
                    correct: 1
                },
                {
                    passage: "He looked worried and told Jack and Annie that Viking ships had been spotted approaching the coast, threatening to destroy everything.",
                    question: "Why did Brother Patrick look worried?",
                    options: ["He was sick", "Viking ships were approaching, threatening to destroy everything", "He ran out of ink", "The weather was bad"],
                    correct: 1
                }
            ],
            3: [ // Chapter 4: The Vikings Are Coming!
                {
                    passage: "Brother Patrick led Jack and Annie to the top of the round tower, where they could see Viking longships with striped sails approaching across the sea.",
                    question: "What did they see from the top of the round tower?",
                    options: ["Fishing boats", "Viking longships with striped sails approaching", "Modern ships", "Nothing on the sea"],
                    correct: 1
                },
                {
                    passage: "The Viking ships had fearsome dragon heads carved on their prows and were filled with warriors carrying axes, swords, and shields.",
                    question: "What did the Viking ships look like?",
                    options: ["Beautiful and peaceful", "Fearsome with dragon heads and warriors carrying weapons", "Small and harmless", "Modern warships"],
                    correct: 1
                },
                {
                    passage: "Brother Patrick explained that the Vikings were fierce raiders from the north who attacked monasteries to steal gold and burn books they couldn't read.",
                    question: "What did Brother Patrick explain about the Vikings?",
                    options: ["They were peaceful traders", "They were fierce raiders who stole gold and burned books", "They were monks too", "They were lost explorers"],
                    correct: 1
                },
                {
                    passage: "The monastery's bell began to ring urgently, warning all the monks to gather their most precious manuscripts and prepare to hide them.",
                    question: "Why did the monastery bell ring urgently?",
                    options: ["For dinner time", "To warn monks to gather manuscripts and prepare to hide them", "For morning prayers", "To celebrate"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie realized they had very little time to help save the books before the Vikings reached the shore and began their raid.",
                    question: "What did Jack and Annie realize about their situation?",
                    options: ["They had plenty of time", "They had very little time to save books before Vikings arrived", "The Vikings weren't coming", "They should leave immediately"],
                    correct: 1
                }
            ],
            4: [ // Chapter 5: The Secret of the Serpent Ship
                {
                    passage: "As the Viking ships came closer, Jack and Annie could see the intricate serpent and dragon carvings that decorated the ships' hulls and prows.",
                    question: "What decorations did Jack and Annie see on the Viking ships?",
                    options: ["Flowers and birds", "Intricate serpent and dragon carvings", "Plain wood", "Christian symbols"],
                    correct: 1
                },
                {
                    passage: "Brother Patrick explained that Vikings were actually skilled shipbuilders and navigators who could sail across vast oceans using the stars and sun.",
                    question: "What skills did Brother Patrick say the Vikings possessed?",
                    options: ["Only fighting", "Skilled shipbuilding and navigation using stars and sun", "Just farming", "Only raiding"],
                    correct: 1
                },
                {
                    passage: "The longships were designed to be fast and shallow, allowing them to sail up rivers and land directly on beaches for surprise attacks.",
                    question: "Why were Viking longships designed to be fast and shallow?",
                    options: ["To look beautiful", "To sail up rivers and land on beaches for surprise attacks", "To carry more cargo", "To be comfortable"],
                    correct: 1
                },
                {
                    passage: "Jack was fascinated to learn that Vikings had their own culture, poetry, and stories, even though they were feared as raiders.",
                    question: "What did Jack learn about Viking culture?",
                    options: ["They had no culture", "They had their own culture, poetry, and stories despite being raiders", "They only cared about fighting", "They had no written language"],
                    correct: 1
                },
                {
                    passage: "Brother Patrick said that while Vikings destroyed many books, they also carried stories and knowledge across the seas to new lands.",
                    question: "What did Brother Patrick say about Vikings and knowledge?",
                    options: ["They only destroyed everything", "While they destroyed books, they also carried stories to new lands", "They never learned anything", "They only stole gold"],
                    correct: 1
                }
            ],
            5: [ // Chapter 6: The Tomb
                {
                    passage: "Brother Patrick led Jack and Annie to an ancient stone tomb hidden among the rocks near the monastery for safety.",
                    question: "Where did Brother Patrick lead Jack and Annie for safety?",
                    options: ["To the kitchen", "To an ancient stone tomb hidden among rocks", "To the tower", "To the beach"],
                    correct: 1
                },
                {
                    passage: "Inside the tomb, they found carved Celtic crosses and ancient Irish symbols that had been there for hundreds of years.",
                    question: "What did they find inside the ancient tomb?",
                    options: ["Modern furniture", "Carved Celtic crosses and ancient Irish symbols", "Viking weapons", "Nothing"],
                    correct: 1
                },
                {
                    passage: "The tomb was cool and dark, providing a perfect hiding place where the Vikings would not think to look for valuable manuscripts.",
                    question: "Why was the tomb a good hiding place?",
                    options: ["It was too small", "It was cool, dark, and Vikings wouldn't think to look there", "It was too obvious", "It was underwater"],
                    correct: 1
                },
                {
                    passage: "Brother Patrick carefully placed several precious illuminated manuscripts in leather pouches to protect them from moisture and damage.",
                    question: "How did Brother Patrick protect the manuscripts in the tomb?",
                    options: ["Left them unwrapped", "Placed them carefully in leather pouches", "Buried them in dirt", "Put them in metal boxes"],
                    correct: 1
                },
                {
                    passage: "From their hiding place, they could hear the Vikings landing on the shore below and the sounds of their raiding party approaching the monastery.",
                    question: "What could they hear from their hiding place?",
                    options: ["Singing and dancing", "Vikings landing and raiding party approaching monastery", "Complete silence", "Birds chirping"],
                    correct: 1
                }
            ],
            6: [ // Chapter 7: The Rock of Scriptures
                {
                    passage: "Brother Patrick revealed a secret chamber carved into the rock itself, where the monks kept their most precious and irreplaceable manuscripts.",
                    question: "What did Brother Patrick reveal to Jack and Annie?",
                    options: ["A treasure room", "A secret chamber in the rock for precious manuscripts", "A escape tunnel", "A weapon storage"],
                    correct: 1
                },
                {
                    passage: "This hidden library contained copies of classical Greek and Roman texts that had been lost everywhere else in Europe during the Dark Ages.",
                    question: "What important texts were stored in the hidden library?",
                    options: ["Modern novels", "Classical Greek and Roman texts lost elsewhere in Europe", "Viking stories", "Only religious books"],
                    correct: 1
                },
                {
                    passage: "Brother Patrick explained that Irish monasteries had become the guardians of ancient knowledge when barbarian invasions destroyed libraries elsewhere.",
                    question: "What role had Irish monasteries played according to Brother Patrick?",
                    options: ["They destroyed books", "They became guardians of ancient knowledge when others were destroyed", "They only copied Irish books", "They traded books for gold"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie helped carry armloads of precious volumes into the secret chamber, working quickly as the Viking voices grew louder.",
                    question: "What did Jack and Annie do to help save the books?",
                    options: ["They ran away", "They helped carry volumes into the secret chamber quickly", "They fought the Vikings", "They hid in the tower"],
                    correct: 1
                },
                {
                    passage: "The rock chamber was so well hidden that even if the Vikings burned the entire monastery, these books would survive for future generations.",
                    question: "Why was the rock chamber so important for preserving books?",
                    options: ["It was beautiful", "It was so well hidden that books would survive even if monastery burned", "It was easy to find", "It was the largest room"],
                    correct: 1
                }
            ],
            7: [ // Chapter 8: The Cross of Light
                {
                    passage: "In the deepest part of the secret chamber, Brother Patrick showed them the monastery's greatest treasure - an illuminated manuscript called the Cross of Light.",
                    question: "What was the monastery's greatest treasure?",
                    options: ["A golden crown", "An illuminated manuscript called the Cross of Light", "A magic sword", "A bag of jewels"],
                    correct: 1
                },
                {
                    passage: "The Cross of Light was covered in intricate Celtic artwork with intertwining animals, spirals, and religious scenes painted in brilliant gold and blue.",
                    question: "What made the Cross of Light manuscript so special?",
                    options: ["It was very old", "Intricate Celtic artwork with animals, spirals, and scenes in gold and blue", "It was very large", "It was written in a foreign language"],
                    correct: 1
                },
                {
                    passage: "Brother Patrick explained that this manuscript had taken three monks working together for five years to complete, using the finest materials available.",
                    question: "How long and how many monks did it take to create the Cross of Light?",
                    options: ["One monk, one year", "Three monks working together for five years", "Ten monks, six months", "Many monks, one month"],
                    correct: 1
                },
                {
                    passage: "The beautiful artwork showed the blending of Christian and Celtic traditions, creating a unique Irish style of illuminated manuscript.",
                    question: "What cultural traditions were blended in the manuscript's artwork?",
                    options: ["Roman and Greek", "Christian and Celtic traditions creating unique Irish style", "Viking and Roman", "Only Christian"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie understood that they were looking at one of the most beautiful books ever created, representing years of devoted artistic work.",
                    question: "What did Jack and Annie understand about the Cross of Light manuscript?",
                    options: ["It was worthless", "They were looking at one of the most beautiful books ever created", "It was just another book", "It was a copy of something else"],
                    correct: 1
                }
            ],
            8: [ // Chapter 9: Hearth and Home
                {
                    passage: "As the Vikings raided the monastery buildings above, Jack and Annie helped Brother Patrick save dozens of precious manuscripts in the secret chamber.",
                    question: "What did Jack and Annie accomplish while Vikings raided above?",
                    options: ["They fought the Vikings", "They helped save dozens of manuscripts in the secret chamber", "They escaped alone", "They did nothing"],
                    correct: 1
                },
                {
                    passage: "When the Vikings finally left at sunset, the monastery buildings were damaged but the most important books had been preserved safely.",
                    question: "What was the result after the Vikings left?",
                    options: ["Everything was destroyed", "Buildings were damaged but important books were preserved", "Nothing was touched", "Only books were destroyed"],
                    correct: 1
                },
                {
                    passage: "Brother Patrick thanked Jack and Annie, explaining that their help had saved centuries of accumulated knowledge and artistic work.",
                    question: "What did Brother Patrick thank Jack and Annie for saving?",
                    options: ["The buildings", "Centuries of accumulated knowledge and artistic work", "His personal belongings", "The food supplies"],
                    correct: 1
                },
                {
                    passage: "The other monks emerged from hiding and began the work of rebuilding their monastery, knowing their precious books were safe.",
                    question: "What did the monks do after the Viking raid ended?",
                    options: ["They gave up and left", "They emerged and began rebuilding, knowing books were safe", "They chased after the Vikings", "They celebrated immediately"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie learned that despite the destruction, the monasteries would continue their important work of preserving knowledge for future generations.",
                    question: "What important lesson did Jack and Annie learn?",
                    options: ["Monasteries would close forever", "Despite destruction, monasteries would continue preserving knowledge", "Books weren't really important", "Vikings always won"],
                    correct: 1
                }
            ],
            9: [ // Chapter 10: The Book of Stories
                {
                    passage: "Back in the tree house, Jack and Annie reflected on how Irish monks had helped preserve the knowledge of ancient civilizations during the Dark Ages.",
                    question: "What did Jack and Annie reflect on in the tree house?",
                    options: ["Their next adventure", "How Irish monks preserved ancient knowledge during Dark Ages", "What to eat for lunch", "Viking fighting techniques"],
                    correct: 1
                },
                {
                    passage: "Morgan le Fay appeared and explained that the books they had helped save would eventually help bring Europe out of the Dark Ages into the Renaissance.",
                    question: "What did Morgan explain about the books they saved?",
                    options: ["They would be forgotten", "They would help bring Europe out of Dark Ages into Renaissance", "They would be burned later", "They were not important"],
                    correct: 1
                },
                {
                    passage: "She told them that Irish monasteries had earned the nickname 'Land of Saints and Scholars' for their dedication to learning and knowledge.",
                    question: "What nickname had Irish monasteries earned and why?",
                    options: ["Land of Warriors", "Land of Saints and Scholars for dedication to learning", "Land of Vikings", "Land of Gold"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie realized they had witnessed how knowledge survived through one of history's most difficult periods, thanks to devoted scholars.",
                    question: "What did Jack and Annie realize they had witnessed?",
                    options: ["A simple raid", "How knowledge survived history's difficult periods thanks to scholars", "Just an adventure", "The end of learning"],
                    correct: 1
                },
                {
                    passage: "They felt proud knowing they had played a part in preserving the cultural heritage that would eventually lead to universities and libraries around the world.",
                    question: "How did Jack and Annie feel about their role in the adventure?",
                    options: ["Disappointed", "Proud they helped preserve heritage leading to universities and libraries", "Confused", "Worried about Vikings"],
                    correct: 1
                }
            ]
        };

        // Ï†ÑÏó≠ Î≥ÄÏàò
        let currentChapterIndex = 0;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let questions = [];
        let currentAudio = null;
        let playbackSpeed = 1.0;

        // üéß ÏûêÎèô Ïò§ÎîîÏò§ URL ÏÉùÏÑ± Ìï®Ïàò
        function getAudioUrl(chapterIndex) {
            const level = 'level3';
            const bookId = 'MTH015';
            const chapterNum = String(chapterIndex + 1).padStart(2, '0');
            
            const possibleFileNames = [
                `${bookId}_chapter${chapterNum}.mp3`,
                `${bookId}_ch${chapterNum}.mp3`,
                `${bookId}_${chapterNum}.mp3`,
                `magic_tree_house_15_chapter${chapterNum}.mp3`,
                `magic_tree_house_15_ch${chapterNum}.mp3`,
                `viking_ships_at_sunrise_${chapterNum}.mp3`,
                `mary_pope_osborne_15_chapter${chapterNum}.mp3`,
                `${bookId}.mp3`
            ];
            
            return {
                primary: `${AUDIO_BASE_URL}${level}/${possibleFileNames[0]}`,
                alternatives: possibleFileNames.map(fileName => `${AUDIO_BASE_URL}${level}/${fileName}`)
            };
        }

        // üéß Ïò§ÎîîÏò§ Ïû¨ÏÉù Ìï®Ïàò
        function playChapterAudio(chapterIndex) {
            const chapter = bookData.chapterList[chapterIndex];
            const audioUrls = getAudioUrl(chapterIndex);

            document.getElementById('audio-modal').style.display = 'flex';
            document.getElementById('audio-chapter-title').textContent = `Chapter ${chapterIndex + 1}: ${chapter.title}`;
            document.getElementById('audio-chapter-subtitle').textContent = `${bookData.title} - ${bookData.author}`;

            // Ïò§ÎîîÏò§ Ï†ïÎ≥¥ ÏòÅÏó≠ Îã§Ïãú Î≥¥Ïù¥Í∏∞ (ÏÉàÎ°úÏö¥ Ïò§ÎîîÏò§ ÌîåÎ†àÏù¥Ïãú)
            document.getElementById('audio-info').classList.remove('hidden');

            const audioPlayer = document.getElementById('audio-player');
            const audioSource = document.getElementById('audio-source');
            const audioStatus = document.getElementById('audio-status');

            audioStatus.textContent = 'üîÑ Ïò§ÎîîÏò§ ÌååÏùºÏùÑ Ï∞æÎäî Ï§ë...';

            function tryLoadAudio(urlIndex = 0) {
                if (urlIndex >= audioUrls.alternatives.length) {
                    audioStatus.innerHTML = `‚ùå Ïò§ÎîîÏò§ ÌååÏùºÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.`;
                    return;
                }

                const currentUrl = audioUrls.alternatives[urlIndex];
                audioSource.src = currentUrl;
                audioPlayer.load();

                const successHandler = function() {
                    const startTime = chapter.startTime || 0;
                    audioPlayer.currentTime = startTime;
                    audioStatus.innerHTML = `‚úÖ Ïò§ÎîîÏò§ Ï§ÄÎπÑ ÏôÑÎ£å!`;
                };

                const errorHandler = function() {
                    setTimeout(() => tryLoadAudio(urlIndex + 1), 100);
                };

                audioPlayer.addEventListener('canplaythrough', successHandler, { once: true });
                audioPlayer.addEventListener('error', errorHandler, { once: true });
            }

            tryLoadAudio(0);
            currentAudio = audioPlayer;
            playbackSpeed = 1.0;
        }

        // Í∏∞Î≥∏ Ìï®ÏàòÎì§
        function closeAudioModal() {
            document.getElementById('audio-modal').style.display = 'none';
            if (currentAudio) currentAudio.pause();
        }

        function togglePlayPause() {
            if (!currentAudio) return;
            if (currentAudio.paused) {
                currentAudio.play();
                document.querySelector('.play-pause-btn').textContent = '‚è∏Ô∏è ÏùºÏãúÏ†ïÏßÄ';
            } else {
                currentAudio.pause();
                document.querySelector('.play-pause-btn').textContent = '‚ñ∂Ô∏è Ïû¨ÏÉù';
            }
        }

        function changeSpeed() {
            if (!currentAudio) return;
            const speeds = [0.5, 0.75, 1.0, 1.25, 1.5, 2.0];
            const currentIndex = speeds.indexOf(playbackSpeed);
            playbackSpeed = speeds[(currentIndex + 1) % speeds.length];
            currentAudio.playbackRate = playbackSpeed;
            document.querySelector('.speed-btn').textContent = `${playbackSpeed}x`;
        }

        function resetToChapterStart() {
            if (!currentAudio) return;
            const currentChapter = parseInt(document.getElementById('audio-chapter-title').textContent.match(/Chapter (\d+)/)[1]) - 1;
            currentAudio.currentTime = bookData.chapterList[currentChapter]?.startTime || 0;
        }

        function downloadAudio() {
            const audioSource = document.getElementById('audio-source');
            if (audioSource.src) {
                const link = document.createElement('a');
                link.href = audioSource.src;
                link.download = `${document.getElementById('audio-chapter-title').textContent}.mp3`;
                link.click();
            }
        }

        // Ï±Ö ÏÉÅÏÑ∏ Ï†ïÎ≥¥ ÌëúÏãú
        function showBookDetail() {
            document.getElementById('book-detail-screen').style.display = 'block';
            document.getElementById('learning-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'none';
            generateChapterGrid();
            updateProgress();
        }

        // Ï±ïÌÑ∞ Í∑∏Î¶¨Îìú ÏÉùÏÑ±
        function generateChapterGrid() {
            const grid = document.getElementById('chapters-grid');
            grid.innerHTML = '';

            bookData.chapterList.forEach((chapter, index) => {
                const chapterCard = document.createElement('div');
                chapterCard.className = `chapter-card ${chapter.status}`;

                chapterCard.innerHTML = `
                    <div class="chapter-header">
                        <div class="chapter-info">
                            <h4>Chapter ${index + 1}: ${chapter.title}</h4>
                            <p>${chapter.description} (${chapter.questionCount}Î¨∏Ï†ú)</p>
                        </div>
                        <div class="chapter-status ${chapter.status}">
                            ${chapter.status === 'completed' ? '‚úÖ ÏôÑÎ£å' :
                              chapter.status === 'current' ? 'üìñ ÏßÑÌñâÏ§ë' : 'üîí Ïû†ÍπÄ'}
                        </div>
                    </div>
                    <div class="chapter-actions">
                        <button class="chapter-btn audio-btn" onclick="playChapterAudio(${index})"
                                ${chapter.status === 'locked' ? 'disabled' : ''}>
                            üéß Ïò§ÎîîÏò§
                        </button>
                        <button class="chapter-btn quiz-btn" onclick="startLearning(${index})"
                                ${chapter.status === 'locked' ? 'disabled' : ''}>
                            üìù Î¨∏Ï†úÌíÄÍ∏∞
                        </button>
                    </div>
                `;

                grid.appendChild(chapterCard);
            });
        }

        // ÏßÑÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
        function updateProgress() {
            const completedChapters = bookData.chapterList.filter(chapter => chapter.status === 'completed').length;
            const progress = Math.round((completedChapters / bookData.chapters) * 100);
            document.getElementById('progress-value').textContent = progress + '%';
        }

        // ÌïôÏäµ ÏãúÏûë
        function startLearning(chapterIndex) {
            currentChapterIndex = chapterIndex;
            currentQuestionIndex = 0;
            userAnswers = [];
            questions = questionsData[chapterIndex];

            if (!questions || questions.length === 0) {
                alert('Ïù¥ Ï±ïÌÑ∞Ïùò Î¨∏Ï†úÍ∞Ä ÏïÑÏßÅ Ï§ÄÎπÑÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                return;
            }

            document.getElementById('book-detail-screen').style.display = 'none';
            document.getElementById('learning-screen').style.display = 'block';
            document.getElementById('result-screen').style.display = 'none';

            const chapter = bookData.chapterList[chapterIndex];
            document.getElementById('learning-title').textContent = `Chapter ${chapterIndex + 1}: ${chapter.title}`;
            document.getElementById('learning-chapter-breadcrumb').textContent = `Chapter ${chapterIndex + 1}`;

            showQuestion();
            updateLearningProgress();
        }

        // Î¨∏Ï†ú ÌëúÏãú
        function showQuestion() {
            const question = questions[currentQuestionIndex];
            const container = document.getElementById('question-container');

            container.innerHTML = `
                <div class="question-text">Î¨∏Ï†ú ${currentQuestionIndex + 1}</div>
                <div class="passage">${question.passage}</div>
                <div class="question-text">${question.question}</div>
                <div class="options">
                    ${question.options.map((option, index) =>
                        `<div class="option" onclick="selectOption(${index})" data-index="${index}">
                            ${String.fromCharCode(65 + index)}. ${option}
                        </div>`
                    ).join('')}
                </div>
            `;

            if (userAnswers[currentQuestionIndex] !== undefined) {
                const selectedOption = container.querySelector(`[data-index="${userAnswers[currentQuestionIndex]}"]`);
                if (selectedOption) selectedOption.classList.add('selected');
            }

            updateNavigationButtons();
        }

        // ÏÑ†ÌÉùÏßÄ ÏÑ†ÌÉù
        function selectOption(optionIndex) {
            document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
            document.querySelector(`[data-index="${optionIndex}"]`).classList.add('selected');
            userAnswers[currentQuestionIndex] = optionIndex;
            updateNavigationButtons();
        }

        // ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò
        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                showQuestion();
                updateLearningProgress();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion();
                updateLearningProgress();
            }
        }

        function updateLearningProgress() {
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('learning-progress-bar').style.width = progress + '%';
            document.getElementById('learning-progress-text').textContent = `Î¨∏Ï†ú ${currentQuestionIndex + 1} / ${questions.length}`;
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const submitBtn = document.getElementById('submit-btn');

            prevBtn.disabled = currentQuestionIndex === 0;

            if (currentQuestionIndex === questions.length - 1) {
                nextBtn.style.display = 'none';
                submitBtn.style.display = 'block';
                submitBtn.disabled = userAnswers[currentQuestionIndex] === undefined;
            } else {
                nextBtn.style.display = 'block';
                submitBtn.style.display = 'none';
                nextBtn.disabled = userAnswers[currentQuestionIndex] === undefined;
            }
        }

        // ÎãµÏïà Ï†úÏ∂ú
        function submitAnswers() {
            let correctCount = 0;
            questions.forEach((question, index) => {
                if (userAnswers[index] === question.correct) correctCount++;
            });

            const score = Math.round((correctCount / questions.length) * 100);

            if (score >= 70) {
                bookData.chapterList[currentChapterIndex].status = 'completed';
                if (currentChapterIndex < bookData.chapterList.length - 1) {
                    bookData.chapterList[currentChapterIndex + 1].status = 'current';
                }
            }

            showResults(correctCount, questions.length, score);
        }

        // Í≤∞Í≥º ÌëúÏãú
        function showResults(correct, total, score) {
            document.getElementById('learning-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';

            document.getElementById('score-circle').textContent = score + '%';
            document.getElementById('total-questions').textContent = total + 'Î¨∏Ï†ú';
            document.getElementById('correct-answers').textContent = correct + 'Î¨∏Ï†ú';
            document.getElementById('wrong-answers').textContent = (total - correct) + 'Î¨∏Ï†ú';
            document.getElementById('final-score').textContent = score + 'Ï†ê';

            let message = '';
            if (score >= 90) message = 'ÌõåÎ•≠Ìï©ÎãàÎã§! üåü';
            else if (score >= 80) message = 'ÏûòÌñàÏñ¥Ïöî! üëè';
            else if (score >= 70) message = 'Ï¢ãÏïÑÏöî! üëç';
            else message = 'Îã§Ïãú ÌïúÎ≤à ÎèÑÏ†ÑÌï¥Î≥¥ÏÑ∏Ïöî! üí™';

            document.getElementById('result-message').textContent = message;
        }

        function retryChapter() {
            startLearning(currentChapterIndex);
        }

        function nextChapter() {
            if (currentChapterIndex < bookData.chapterList.length - 1) {
                startLearning(currentChapterIndex + 1);
            } else {
                alert('Î™®Îì† Ï±ïÌÑ∞Î•º ÏôÑÎ£åÌñàÏäµÎãàÎã§! üéâ');
                showBookDetail();
            }
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú
        window.addEventListener('load', function() {
            showBookDetail();
            console.log('‚öîÔ∏è Magic Tree House: Viking Ships at Sunrise ÌïôÏäµ ÏãúÏä§ÌÖúÏù¥ Ï§ÄÎπÑÎêòÏóàÏäµÎãàÎã§!');
        });

        // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠Ïãú Îã´Í∏∞
        document.getElementById('audio-modal').addEventListener('click', function(e) {
            if (e.target === this) closeAudioModal();
        });
    </script>
</body>
</html>
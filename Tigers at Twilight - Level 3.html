<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tigers at Twilight - Level 3 - ÏàòÎ¶¨Îî©Ïñ¥ÌïôÏõê</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #228B22 0%, #32CD32 50%, #90EE90 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        /* Ìó§Îçî */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #228B22, #32CD32);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .logo-text h1 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
        }

        .logo-text p {
            font-size: 0.9rem;
            color: #666;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
            color: #333;
            text-decoration: none;
        }

        .nav-btn:hover {
            background: #228B22;
            color: white;
            transform: translateY(-2px);
        }

        /* Î©îÏù∏ ÏΩòÌÖêÏ∏† ÏòÅÏó≠ */
        .main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            min-height: 600px;
        }

        /* Ï±Ö ÏÉÅÏÑ∏ ÌôîÎ©¥ */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 30px;
            font-size: 0.9rem;
            color: #666;
        }

        .breadcrumb a {
            color: #228B22;
            text-decoration: none;
            cursor: pointer;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .book-detail-header {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: flex-start;
        }

        .detail-book-cover {
            width: 150px;
            height: 220px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 4rem;
            font-weight: bold;
            flex-shrink: 0;
            background: linear-gradient(45deg, #228B22, #32CD32);
        }

        .book-info {
            flex: 1;
        }

        .book-info h2 {
            font-size: 2.2rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .book-info .author {
            font-size: 1.2rem;
            color: #228B22;
            margin-bottom: 20px;
        }

        .book-summary {
            font-size: 1rem;
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .book-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-box .value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #228B22;
        }

        .stat-box .label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        /* Ï±ïÌÑ∞ Í∑∏Î¶¨Îìú */
        .chapters-section {
            margin-top: 40px;
        }

        .chapters-section h3 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 30px;
            text-align: center;
        }

        .chapters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .chapter-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
        }

        .chapter-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .chapter-card.completed {
            border-color: #28a745;
            background: linear-gradient(135deg, #28a74508, #ffffff);
        }

        .chapter-card.current {
            border-color: #228B22;
            background: linear-gradient(135deg, #228B2208, #ffffff);
        }

        .chapter-card.locked {
            opacity: 0.6;
            background: #f8f9fa;
        }

        .chapter-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .chapter-info h4 {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }

        .chapter-info p {
            font-size: 0.95rem;
            color: #666;
            line-height: 1.5;
        }

        .chapter-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .chapter-status.completed {
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
        }

        .chapter-status.current {
            background: rgba(34, 139, 34, 0.1);
            color: #228B22;
        }

        .chapter-status.locked {
            background: rgba(108, 117, 125, 0.1);
            color: #6c757d;
        }

        .chapter-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .chapter-btn {
            padding: 12px 16px;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .audio-btn {
            background: linear-gradient(45deg, #228B22, #32CD32);
            color: white;
        }

        .quiz-btn {
            background: linear-gradient(45deg, #32CD32, #90EE90);
            color: white;
        }

        .chapter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .chapter-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* ÌïôÏäµ ÌôîÎ©¥ */
        .learning-screen {
            display: none;
        }

        .learning-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .learning-progress {
            background: #f8f9fa;
            border-radius: 10px;
            height: 8px;
            margin: 20px 0;
            overflow: hidden;
        }

        .learning-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #228B22, #32CD32);
            transition: width 0.3s ease;
        }

        .question-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
        }

        .passage {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1rem;
            line-height: 1.6;
            color: #444;
        }

        .options {
            display: grid;
            gap: 10px;
        }

        .option {
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option:hover {
            background: #e9ecef;
            border-color: #228B22;
        }

        .option.selected {
            background: rgba(34, 139, 34, 0.1);
            border-color: #228B22;
        }

        .learning-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .control-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .next-btn {
            background: linear-gradient(45deg, #228B22, #32CD32);
            color: white;
        }

        .prev-btn {
            background: #6c757d;
            color: white;
        }

        .submit-btn {
            background: linear-gradient(45deg, #228B22, #32CD32);
            color: white;
        }

        .control-btn:hover {
            transform: translateY(-2px);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Í≤∞Í≥º ÌôîÎ©¥ */
        .result-screen {
            display: none;
            text-align: center;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(45deg, #228B22, #32CD32);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            font-size: 2rem;
            font-weight: bold;
        }

        .result-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .result-stat {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .result-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        /* Ïò§ÎîîÏò§ ÌîåÎ†àÏù¥Ïñ¥ Î™®Îã¨ */
        .audio-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .audio-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 600px;
            width: 90%;
            position: relative;
        }

        .close-audio {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #666;
        }

        .audio-player {
            width: 100%;
            margin: 20px 0;
            border-radius: 10px;
        }

        .audio-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .audio-control-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .play-pause-btn {
            background: linear-gradient(45deg, #228B22, #32CD32);
            color: white;
        }

        .speed-btn {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #ddd;
        }

        .download-btn {
            background: #32CD32;
            color: white;
        }

        .audio-info {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            font-size: 0.9rem;
            color: #666;
            transition: all 0.3s ease;
        }

        .audio-info.hidden {
            display: none;
        }

        /* Î∞òÏùëÌòï */
        @media (max-width: 768px) {
            .chapters-grid {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .book-detail-header {
                flex-direction: column;
                text-align: center;
            }

            .book-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .learning-controls {
                flex-direction: column;
            }

            .chapter-actions {
                grid-template-columns: 1fr;
            }

            .audio-controls {
                justify-content: center;
                gap: 10px;
            }

            .audio-content {
                padding: 30px 20px;
            }
        }

        .new-book-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: linear-gradient(45deg, #FF6B9D, #C44569);
            color: white;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: 700;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Level 3 ÌäπÎ≥Ñ Ïä§ÌÉÄÏùº */
        .level-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: linear-gradient(45deg, #FF6B00, #FF8E53);
            color: white;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ìó§Îçî -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">üêÖ</div>
                <div class="logo-text">
                    <h1>Tigers at Twilight</h1>
                    <p>Level 3 - Mary Pope OsborneÏùò Îß§ÏßÅ Ìä∏Î¶¨ ÌïòÏö∞Ïä§ 19Í∂å</p>
                </div>
            </div>
            <div class="nav-buttons">
                <a href="http://www.suelibrary.store/" class="nav-btn">Î©îÏù∏ÏúºÎ°ú</a>
            </div>
        </div>

        <!-- Î©îÏù∏ ÏΩòÌÖêÏ∏† -->
        <div class="main-content">
            <!-- Ï±Ö ÏÉÅÏÑ∏ ÌôîÎ©¥ -->
            <div class="book-detail-screen" id="book-detail-screen">
                <div class="level-badge">Level 3</div>
                <div class="breadcrumb">
                    <span>Tigers at Twilight</span>
                </div>

                <div class="book-detail-header">
                    <div class="detail-book-cover">üêÖ</div>
                    <div class="book-info">
                        <h2>Tigers at Twilight</h2>
                        <div class="author">Mary Pope Osborne</div>
                        <div class="book-summary">
                            Jack and Annie travel to the forests of India to break an ancient spell! They must help save the last wild tigers while learning about Indian culture, the importance of protecting endangered species, and meeting the great poet Rabindranath Tagore. Experience the beauty and danger of the Indian jungle at twilight.
                        </div>
                        <div class="book-stats">
                            <div class="stat-box">
                                <div class="value">10</div>
                                <div class="label">Ï±ïÌÑ∞</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">50</div>
                                <div class="label">Ï¥ù Î¨∏Ï†ú</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">Level 3</div>
                                <div class="label">Î†àÎ≤®</div>
                            </div>
                            <div class="stat-box">
                                <div class="value" id="progress-value">0%</div>
                                <div class="label">ÏßÑÎèÑ</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="chapters-section">
                    <h3>üêÖ Ï±ïÌÑ∞Î≥Ñ ÌïôÏäµ</h3>
                    <div class="chapters-grid" id="chapters-grid">
                        <!-- Ï±ïÌÑ∞ Ïπ¥ÎìúÎì§ -->
                    </div>
                </div>
            </div>

            <!-- ÌïôÏäµ ÌôîÎ©¥ -->
            <div class="learning-screen" id="learning-screen">
                <div class="breadcrumb">
                    <a onclick="showBookDetail()">Tigers at Twilight</a>
                    <span>></span>
                    <span id="learning-chapter-breadcrumb">Chapter 1</span>
                </div>

                <div class="learning-header">
                    <h2 id="learning-title">Chapter 1: The Enchanted Tiger</h2>
                    <div class="learning-progress">
                        <div class="learning-progress-bar" id="learning-progress-bar" style="width: 0%"></div>
                    </div>
                    <p id="learning-progress-text">Î¨∏Ï†ú 1 / 5</p>
                </div>

                <div class="question-container" id="question-container">
                    <!-- Î¨∏Ï†úÍ∞Ä ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
                </div>

                <div class="learning-controls">
                    <button class="control-btn prev-btn" id="prev-btn" onclick="previousQuestion()" disabled>Ïù¥Ï†Ñ</button>
                    <button class="control-btn next-btn" id="next-btn" onclick="nextQuestion()">Îã§Ïùå</button>
                    <button class="control-btn submit-btn" id="submit-btn" onclick="submitAnswers()" style="display: none;">Ï†úÏ∂ú</button>
                </div>
            </div>

            <!-- Í≤∞Í≥º ÌôîÎ©¥ -->
            <div class="result-screen" id="result-screen">
                <div class="breadcrumb">
                    <a onclick="showBookDetail()">Tigers at Twilight</a>
                    <span>></span>
                    <span>Í≤∞Í≥º</span>
                </div>

                <div class="result-header">
                    <h2>üéâ ÌïôÏäµ ÏôÑÎ£å!</h2>
                    <div class="score-circle" id="score-circle">100%</div>
                    <h3 id="result-message">ÌõåÎ•≠Ìï©ÎãàÎã§!</h3>
                </div>

                <div class="result-details">
                    <div class="result-stat">
                        <h4>Ï¥ù Î¨∏Ï†ú</h4>
                        <p id="total-questions">5Î¨∏Ï†ú</p>
                    </div>
                    <div class="result-stat">
                        <h4>Ï†ïÎãµ</h4>
                        <p id="correct-answers">5Î¨∏Ï†ú</p>
                    </div>
                    <div class="result-stat">
                        <h4>Ïò§Îãµ</h4>
                        <p id="wrong-answers">0Î¨∏Ï†ú</p>
                    </div>
                    <div class="result-stat">
                        <h4>Ï†êÏàò</h4>
                        <p id="final-score">100Ï†ê</p>
                    </div>
                </div>

                <div class="result-actions">
                    <button class="control-btn prev-btn" onclick="retryChapter()">Îã§Ïãú ÌíÄÍ∏∞</button>
                    <button class="control-btn next-btn" onclick="nextChapter()">Îã§Ïùå Ï±ïÌÑ∞</button>
                    <button class="control-btn submit-btn" onclick="showBookDetail()">Ï±ïÌÑ∞ Î™©Î°ù</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ïò§ÎîîÏò§ ÌîåÎ†àÏù¥Ïñ¥ Î™®Îã¨ -->
    <div class="audio-modal" id="audio-modal">
        <div class="audio-content">
            <button class="close-audio" onclick="closeAudioModal()">√ó</button>
            <h3 id="audio-chapter-title">Chapter 1: The Enchanted Tiger</h3>
            <p id="audio-chapter-subtitle">Tigers at Twilight - Mary Pope Osborne</p>

            <audio class="audio-player" id="audio-player" controls preload="metadata">
                <source id="audio-source" src="" type="audio/mpeg">
                Î∏åÎùºÏö∞Ï†ÄÍ∞Ä Ïò§ÎîîÏò§Î•º ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.
            </audio>

            <div class="audio-controls">
                <button class="audio-control-btn play-pause-btn" onclick="togglePlayPause()">‚ñ∂Ô∏è Ïû¨ÏÉù</button>
                <button class="audio-control-btn speed-btn" onclick="changeSpeed()">1.0x</button>
                <button class="audio-control-btn" onclick="resetToChapterStart()" style="background: #28a745; color: white;">üîÑ Íµ¨Í∞ÑÏ≤òÏùå</button>
                <button class="audio-control-btn download-btn" onclick="downloadAudio()">üì• Îã§Ïö¥Î°úÎìú</button>
            </div>

            <div class="audio-info" id="audio-info">
                <div id="audio-status" style="margin-top: 10px; font-weight: bold; color: #228B22;"></div>
            </div>
        </div>
    </div>

    <script>
        // üéØ Íµ¨Í∏Ä ÌÅ¥ÎùºÏö∞Îìú Ïä§ÌÜ†Î¶¨ÏßÄ Ïò§ÎîîÏò§ URL ÏÑ§Ï†ï
        const AUDIO_BASE_URL = 'https://storage.googleapis.com/kim-mom-reading-audio/audio/';

        // Magic Tree House 19Í∂å ÎèÑÏÑú Îç∞Ïù¥ÌÑ∞ (10Ï±ïÌÑ∞)
        const bookData = {
            id: 'MTH019',
            title: "Tigers at Twilight",
            author: 'Mary Pope Osborne',
            cover: 'üêÖ',
            progress: 0,
            chapters: 10,
            totalQuestions: 50, // 10Ï±ïÌÑ∞ √ó 5Î¨∏Ï†ú
            coverColor: 'linear-gradient(45deg, #228B22, #32CD32)',
            summary: "Jack and Annie travel to the forests of India to break an ancient spell! They must help save the last wild tigers while learning about Indian culture, the importance of protecting endangered species, and meeting the great poet Rabindranath Tagore. Experience the beauty and danger of the Indian jungle at twilight.",
            chapterList: [
                { title: 'The Enchanted Tiger', description: 'Jack and Annie discover a magical tiger statue and their new mission in India.', status: 'current', questionCount: 5, startTime: 0 },
                { title: 'The Silk Weaver', description: 'They meet a silk weaver and learn about Indian textiles and culture.', status: 'locked', questionCount: 5, startTime: 300 },
                { title: 'Where Are the Tigers?', description: 'They search for tigers in the forest but find them mysteriously absent.', status: 'locked', questionCount: 5, startTime: 600 },
                { title: 'Kama the Elephant Boy', description: 'They meet a young elephant keeper who helps them understand the jungle.', status: 'locked', questionCount: 5, startTime: 900 },
                { title: 'Night Walk', description: 'They venture into the dangerous jungle at night looking for tigers.', status: 'locked', questionCount: 5, startTime: 1200 },
                { title: 'The Tiger Trap', description: 'They discover poachers trying to capture the last remaining tigers.', status: 'locked', questionCount: 5, startTime: 1500 },
                { title: 'The Weaver\'s Question', description: 'They meet the great poet Rabindranath Tagore and learn about wisdom.', status: 'locked', questionCount: 5, startTime: 1800 },
                { title: 'The Hermit', description: 'A wise hermit teaches them about the connection between all living things.', status: 'locked', questionCount: 5, startTime: 2100 },
                { title: 'The Sick Baby', description: 'They help care for a sick tiger cub and learn about compassion.', status: 'locked', questionCount: 5, startTime: 2400 },
                { title: 'A True Hero', description: 'They break the spell and help save the tigers from extinction.', status: 'locked', questionCount: 5, startTime: 2700 }
            ]
        };

        // Î¨∏Ï†ú Îç∞Ïù¥ÌÑ∞ (Ï†ÑÏ≤¥ 10Ï±ïÌÑ∞ ÏôÑÎ£å)
        const questionsData = {
            0: [ // Chapter 1: The Enchanted Tiger
                {
                    passage: "Jack and Annie found a beautiful tiger statue made of gold and precious stones in the tree house, along with a note about breaking an ancient spell.",
                    question: "What did Jack and Annie find in the tree house?",
                    options: ["A real tiger", "A beautiful tiger statue made of gold and stones with a note", "A book about animals", "A map of India"],
                    correct: 1
                },
                {
                    passage: "The note explained that they needed to travel to India to help break a spell that was causing the tigers to disappear from the forest.",
                    question: "What was their mission according to the note?",
                    options: ["To catch tigers", "To travel to India and break a spell causing tigers to disappear", "To study tiger behavior", "To photograph tigers"],
                    correct: 1
                },
                {
                    passage: "Jack read that tigers were becoming endangered because of hunting and habitat destruction, making their protection very important.",
                    question: "Why were tigers becoming endangered?",
                    options: ["They were getting sick", "Because of hunting and habitat destruction", "They were moving to other countries", "They were fighting each other"],
                    correct: 1
                },
                {
                    passage: "The magical tiger statue seemed to glow in the afternoon light, suggesting it held special powers that could help them complete their mission.",
                    question: "What was special about the tiger statue?",
                    options: ["It was very heavy", "It seemed to glow and held special powers for their mission", "It was very old", "It made sounds"],
                    correct: 1
                },
                {
                    passage: "Annie felt excited about visiting India and learning about its rich culture, while Jack worried about the dangers of encountering real tigers.",
                    question: "How did Jack and Annie feel about going to India?",
                    options: ["Both were scared", "Annie excited about culture, Jack worried about dangers", "Both were bored", "Annie worried, Jack excited"],
                    correct: 1
                }
            ],
            1: [ // Chapter 2: The Silk Weaver
                {
                    passage: "Jack and Annie found themselves in a village in India where they met a skilled silk weaver creating beautiful patterns on her loom.",
                    question: "Where did Jack and Annie find themselves and whom did they meet?",
                    options: ["In a city with a shopkeeper", "In an Indian village with a skilled silk weaver", "In a forest with a hunter", "In a school with a teacher"],
                    correct: 1
                },
                {
                    passage: "The silk weaver showed them how she created intricate designs using colorful silk threads, explaining that weaving was both an art and a way to tell stories.",
                    question: "What did the silk weaver teach them about weaving?",
                    options: ["It was just a job", "It was both an art and a way to tell stories using colorful threads", "It was very easy", "It was only for making money"],
                    correct: 1
                },
                {
                    passage: "She told them that each pattern had special meaning and that tigers were often woven into fabrics as symbols of strength and courage.",
                    question: "What did the weaver say about tigers in her patterns?",
                    options: ["Tigers were bad luck", "Tigers were symbols of strength and courage in fabrics", "Tigers were just decorations", "Tigers were not used"],
                    correct: 1
                },
                {
                    passage: "The weaver looked sad when she mentioned that she hadn't seen any real tigers in the forest for many months, which worried the villagers.",
                    question: "What made the silk weaver sad?",
                    options: ["Her loom was broken", "She hadn't seen real tigers in the forest for months", "She ran out of silk", "No one bought her fabrics"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie learned that tigers were deeply important to Indian culture and were featured in many traditional stories, art, and religious beliefs.",
                    question: "What did Jack and Annie learn about tigers in Indian culture?",
                    options: ["Tigers were feared by everyone", "Tigers were deeply important in stories, art, and religious beliefs", "Tigers were only hunted", "Tigers were ignored"],
                    correct: 1
                }
            ],
            2: [ // Chapter 3: Where Are the Tigers?
                {
                    passage: "Jack and Annie ventured into the Indian forest looking for tigers, but found only empty paths and silent jungle where tigers should have been roaming.",
                    question: "What did Jack and Annie find when they looked for tigers in the forest?",
                    options: ["Many tigers everywhere", "Only empty paths and silent jungle where tigers should be", "Other dangerous animals", "Lots of people"],
                    correct: 1
                },
                {
                    passage: "They saw evidence that tigers had once lived there - paw prints in dried mud, scratch marks on trees, and places where tigers had rested.",
                    question: "What evidence showed that tigers had once lived in the forest?",
                    options: ["Nothing at all", "Paw prints, scratch marks on trees, and resting places", "Only bird feathers", "Human footprints"],
                    correct: 1
                },
                {
                    passage: "The forest felt strangely quiet without the presence of tigers, as if an important part of the natural balance had been removed.",
                    question: "How did the forest feel without tigers?",
                    options: ["Very noisy", "Strangely quiet, as if natural balance had been removed", "Exactly the same", "Very crowded"],
                    correct: 1
                },
                {
                    passage: "Jack explained to Annie that tigers were apex predators, meaning they helped control other animal populations and kept the ecosystem healthy.",
                    question: "What did Jack explain about tigers' role in nature?",
                    options: ["Tigers were not important", "Tigers were apex predators that kept the ecosystem healthy", "Tigers only caused problems", "Tigers didn't affect other animals"],
                    correct: 1
                },
                {
                    passage: "They wondered if the ancient spell mentioned in their mission was somehow causing the tigers to vanish from their natural habitat.",
                    question: "What did Jack and Annie think might be causing the tigers to vanish?",
                    options: ["Bad weather", "The ancient spell from their mission", "Too many people", "Not enough food"],
                    correct: 1
                }
            ],
            3: [ // Chapter 4: Kama the Elephant Boy
                {
                    passage: "Jack and Annie met a young boy named Kama who worked as an elephant keeper and knew the forest better than anyone else in the village.",
                    question: "Who did Jack and Annie meet in the forest?",
                    options: ["A tiger hunter", "A young boy named Kama who was an elephant keeper", "A forest ranger", "A traveling merchant"],
                    correct: 1
                },
                {
                    passage: "Kama explained that elephants and tigers usually avoided each other, but both were disappearing from the forest at the same time.",
                    question: "What did Kama say about elephants and tigers?",
                    options: ["They fought all the time", "They usually avoided each other but both were disappearing", "They were best friends", "They lived together"],
                    correct: 1
                },
                {
                    passage: "He told them that his elephant, Saba, was very intelligent and could sense things that humans couldn't, including danger and changes in the forest.",
                    question: "What was special about Kama's elephant Saba?",
                    options: ["Saba was very small", "Saba was intelligent and could sense danger and forest changes", "Saba was very old", "Saba couldn't do anything"],
                    correct: 1
                },
                {
                    passage: "Kama offered to help Jack and Annie search for tigers, saying that Saba could track scents and sounds that might lead them to the missing animals.",
                    question: "How did Kama offer to help Jack and Annie?",
                    options: ["He refused to help", "He offered to help search using Saba's tracking abilities", "He told them to give up", "He only gave them directions"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie learned that in India, elephants and their keepers often formed deep bonds and worked together as partners for many years.",
                    question: "What did Jack and Annie learn about elephants and their keepers?",
                    options: ["They were enemies", "They formed deep bonds and worked as partners for years", "They barely knew each other", "They only worked for short periods"],
                    correct: 1
                }
            ],
            4: [ // Chapter 5: Night Walk
                {
                    passage: "As twilight approached, Kama led Jack and Annie on a dangerous night walk through the forest, when tigers were most likely to be active.",
                    question: "When did Kama lead Jack and Annie through the forest?",
                    options: ["In the morning", "At twilight on a dangerous night walk when tigers were active", "At noon", "They didn't go"],
                    correct: 1
                },
                {
                    passage: "The forest at night was full of mysterious sounds - rustling leaves, animal calls, and the distant trumpeting of elephants echoing through the darkness.",
                    question: "What was the forest like at night?",
                    options: ["Completely silent", "Full of mysterious sounds like rustling, calls, and elephant trumpeting", "Very bright", "Full of people"],
                    correct: 1
                },
                {
                    passage: "Saba the elephant moved quietly through the forest paths, using her trunk to test the air for tiger scents while staying alert for any signs of danger.",
                    question: "How did Saba help during the night walk?",
                    options: ["She made lots of noise", "She moved quietly and used her trunk to test air for tiger scents", "She ran away", "She refused to move"],
                    correct: 1
                },
                {
                    passage: "Jack felt nervous about being in the jungle at night, but Annie was excited by the adventure and the chance to see tigers in their natural environment.",
                    question: "How did Jack and Annie feel about the night walk?",
                    options: ["Both were bored", "Jack felt nervous, Annie was excited about the adventure", "Both were scared", "Annie was nervous, Jack excited"],
                    correct: 1
                },
                {
                    passage: "They learned that tigers are primarily nocturnal hunters, preferring to hunt and move around during the cooler evening and nighttime hours.",
                    question: "What did they learn about tigers' behavior?",
                    options: ["Tigers only hunt during the day", "Tigers are nocturnal hunters, preferring evening and night", "Tigers never hunt", "Tigers sleep all the time"],
                    correct: 1
                }
            ],
            5: [ // Chapter 6: The Tiger Trap
                {
                    passage: "Deep in the forest, Jack and Annie discovered a hidden camp where poachers had set up traps to capture the remaining tigers for their valuable parts.",
                    question: "What did Jack and Annie discover in the forest?",
                    options: ["A tourist camp", "A hidden poacher camp with traps to capture tigers", "A research station", "A village celebration"],
                    correct: 1
                },
                {
                    passage: "The poachers were planning to sell tiger parts illegally, as some people believed tiger bones and other parts had magical healing properties.",
                    question: "Why were the poachers trying to capture tigers?",
                    options: ["To study them", "To sell tiger parts illegally for supposed healing properties", "To protect them", "To move them to zoos"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie realized that this illegal hunting was the real reason why tigers had disappeared from the forest, not just the ancient spell.",
                    question: "What did Jack and Annie realize about why tigers had disappeared?",
                    options: ["Only the spell was responsible", "Illegal hunting was the real reason, not just the spell", "Tigers had moved naturally", "There was no real reason"],
                    correct: 1
                },
                {
                    passage: "They saw several tigers trapped in cages, looking scared and unhealthy, far from their natural habitat where they should be free to roam.",
                    question: "What condition were the trapped tigers in?",
                    options: ["Happy and healthy", "Scared and unhealthy, far from their natural habitat", "Playing together", "Sleeping peacefully"],
                    correct: 1
                },
                {
                    passage: "Kama explained that stopping poachers was dangerous work, but necessary to save the tigers and preserve them for future generations.",
                    question: "What did Kama say about stopping poachers?",
                    options: ["It was easy work", "It was dangerous but necessary to save tigers for future generations", "It was impossible", "It wasn't important"],
                    correct: 1
                }
            ],
            6: [ // Chapter 7: The Weaver's Question
                {
                    passage: "Back in the village, Jack and Annie met a famous poet and philosopher named Rabindranath Tagore, who was visiting the silk weaver.",
                    question: "Who did Jack and Annie meet in the village?",
                    options: ["A government official", "The famous poet Rabindranath Tagore visiting the silk weaver", "A tourist", "A shopkeeper"],
                    correct: 1
                },
                {
                    passage: "Tagore asked them a profound question: 'What is more important - saving one tiger or teaching people to respect all of nature?'",
                    question: "What profound question did Tagore ask?",
                    options: ["How to catch tigers", "What's more important - saving one tiger or teaching respect for nature", "Where tigers come from", "How to make money"],
                    correct: 1
                },
                {
                    passage: "He explained that true conservation meant not just protecting individual animals, but changing people's hearts and minds about the natural world.",
                    question: "What did Tagore say about true conservation?",
                    options: ["Only protect animals", "Not just protecting animals, but changing hearts and minds about nature", "Focus only on tigers", "Don't worry about nature"],
                    correct: 1
                },
                {
                    passage: "Tagore shared his poetry about the connection between humans and nature, emphasizing that we are all part of the same web of life.",
                    question: "What did Tagore's poetry emphasize?",
                    options: ["Humans are separate from nature", "We are all part of the same web of life", "Only humans matter", "Nature is dangerous"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie began to understand that their mission was about more than just breaking a spell - it was about helping people learn to live in harmony with wildlife.",
                    question: "What did Jack and Annie understand about their mission?",
                    options: ["It was only about magic", "It was about helping people live in harmony with wildlife, not just breaking spells", "It was impossible", "It was only about tigers"],
                    correct: 1
                }
            ],
            7: [ // Chapter 8: The Hermit
                {
                    passage: "In a remote part of the forest, Jack and Annie met an old hermit who had lived peacefully among the animals for many years.",
                    question: "Who did Jack and Annie meet in the remote forest?",
                    options: ["A park ranger", "An old hermit who lived peacefully among animals", "A hunter", "A scientist"],
                    correct: 1
                },
                {
                    passage: "The hermit told them that he had seen the last tigers hiding in a secret valley, protected by the ancient spell that kept them safe from poachers.",
                    question: "What did the hermit tell them about the tigers?",
                    options: ["All tigers were gone", "The last tigers were hiding in a secret valley protected by the spell", "Tigers were everywhere", "Tigers had moved to another country"],
                    correct: 1
                },
                {
                    passage: "He explained that the spell was actually protecting the tigers, but it also kept them isolated and unable to live naturally in the forest.",
                    question: "What was the spell actually doing to the tigers?",
                    options: ["Making them disappear forever", "Protecting them but keeping them isolated from natural forest life", "Making them dangerous", "Making them multiply"],
                    correct: 1
                },
                {
                    passage: "The hermit taught Jack and Annie that sometimes what seems like a problem might actually be nature's way of protecting something precious.",
                    question: "What lesson did the hermit teach about problems in nature?",
                    options: ["All problems are bad", "Sometimes problems might be nature's way of protecting precious things", "Problems don't matter", "Only humans can solve problems"],
                    correct: 1
                },
                {
                    passage: "He said that breaking the spell would only help if people also learned to protect tigers and stop the illegal hunting that endangered them.",
                    question: "What condition did the hermit give for breaking the spell?",
                    options: ["Just break it immediately", "It would only help if people learned to protect tigers and stop hunting", "Never break the spell", "The spell couldn't be broken"],
                    correct: 1
                }
            ],
            8: [ // Chapter 9: The Sick Baby
                {
                    passage: "In the secret valley, Jack and Annie found a mother tiger with a sick baby cub that needed help to survive.",
                    question: "What did Jack and Annie find in the secret valley?",
                    options: ["Empty caves", "A mother tiger with a sick baby cub needing help", "Treasure", "Other people"],
                    correct: 1
                },
                {
                    passage: "The baby tiger was weak and wouldn't eat, and the mother tiger looked at Jack and Annie with pleading eyes, as if asking for help.",
                    question: "What was wrong with the baby tiger?",
                    options: ["It was too playful", "It was weak and wouldn't eat, with mother pleading for help", "It was perfectly healthy", "It was too big"],
                    correct: 1
                },
                {
                    passage: "Using knowledge from their previous adventures, Jack and Annie found healing herbs that could help the sick cub regain its strength.",
                    question: "How did Jack and Annie help the sick cub?",
                    options: ["They took it to a zoo", "They found healing herbs to help it regain strength", "They did nothing", "They called for human help"],
                    correct: 1
                },
                {
                    passage: "As they cared for the baby tiger, they learned about the strong family bonds between tigers and how mother tigers fiercely protect their young.",
                    question: "What did they learn about tiger families?",
                    options: ["Tigers don't care about family", "Strong family bonds with mothers fiercely protecting young", "Tigers live alone always", "Tiger families don't exist"],
                    correct: 1
                },
                {
                    passage: "The experience of helping the sick cub made Jack and Annie understand the importance of compassion and caring for all living creatures.",
                    question: "What did helping the sick cub teach Jack and Annie?",
                    options: ["Nothing important", "The importance of compassion and caring for all living creatures", "To avoid wild animals", "That tigers are dangerous"],
                    correct: 1
                }
            ],
            9: [ // Chapter 10: A True Hero
                {
                    passage: "With the help of Kama, the hermit, and Tagore's wisdom, Jack and Annie organized the villagers to protect the tigers and stop the poachers.",
                    question: "How did Jack and Annie organize help for the tigers?",
                    options: ["They worked alone", "With Kama, the hermit, and Tagore's wisdom, they organized villagers", "They gave up", "They called the police only"],
                    correct: 1
                },
                {
                    passage: "The villagers agreed to become tiger guardians, creating a community-based conservation program that would protect the tigers' habitat.",
                    question: "What did the villagers agree to do?",
                    options: ["Hunt more tigers", "Become tiger guardians with community-based conservation", "Leave the village", "Ignore the problem"],
                    correct: 1
                },
                {
                    passage: "When the community showed genuine care for the tigers and their environment, the ancient spell was finally broken, allowing tigers to return safely.",
                    question: "What broke the ancient spell?",
                    options: ["Magic words", "The community showing genuine care for tigers and environment", "Fighting the poachers", "Finding treasure"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie watched as the tigers emerged from the secret valley and began to roam freely through the forest once again.",
                    question: "What happened when the spell was broken?",
                    options: ["Tigers disappeared forever", "Tigers emerged and began roaming freely through forest", "Nothing changed", "More problems appeared"],
                    correct: 1
                },
                {
                    passage: "They realized that the real magic wasn't in breaking spells, but in inspiring people to become heroes for wildlife conservation and environmental protection.",
                    question: "What did Jack and Annie realize about real magic?",
                    options: ["Magic spells were most important", "Real magic was inspiring people to become heroes for conservation", "Magic didn't exist", "Only children could do magic"],
                    correct: 1
                }
            ]
        };

        // Ï†ÑÏó≠ Î≥ÄÏàò
        let currentChapterIndex = 0;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let questions = [];
        let currentAudio = null;
        let playbackSpeed = 1.0;

        // üéß ÏûêÎèô Ïò§ÎîîÏò§ URL ÏÉùÏÑ± Ìï®Ïàò
        function getAudioUrl(chapterIndex) {
            const level = 'level3';
            const bookId = 'MTH019';
            const chapterNum = String(chapterIndex + 1).padStart(2, '0');
            
            const possibleFileNames = [
                `${bookId}_chapter${chapterNum}.mp3`,
                `${bookId}_ch${chapterNum}.mp3`,
                `${bookId}_${chapterNum}.mp3`,
                `magic_tree_house_19_chapter${chapterNum}.mp3`,
                `magic_tree_house_19_ch${chapterNum}.mp3`,
                `tigers_at_twilight_${chapterNum}.mp3`,
                `mary_pope_osborne_19_chapter${chapterNum}.mp3`,
                `${bookId}.mp3`
            ];
            
            return {
                primary: `${AUDIO_BASE_URL}${level}/${possibleFileNames[0]}`,
                alternatives: possibleFileNames.map(fileName => `${AUDIO_BASE_URL}${level}/${fileName}`)
            };
        }

        // üéß Ïò§ÎîîÏò§ Ïû¨ÏÉù Ìï®Ïàò
        function playChapterAudio(chapterIndex) {
            const chapter = bookData.chapterList[chapterIndex];
            const audioUrls = getAudioUrl(chapterIndex);

            document.getElementById('audio-modal').style.display = 'flex';
            document.getElementById('audio-chapter-title').textContent = `Chapter ${chapterIndex + 1}: ${chapter.title}`;
            document.getElementById('audio-chapter-subtitle').textContent = `${bookData.title} - ${bookData.author}`;

            // Ïò§ÎîîÏò§ Ï†ïÎ≥¥ ÏòÅÏó≠ Îã§Ïãú Î≥¥Ïù¥Í∏∞ (ÏÉàÎ°úÏö¥ Ïò§ÎîîÏò§ ÌîåÎ†àÏù¥Ïãú)
            document.getElementById('audio-info').classList.remove('hidden');

            const audioPlayer = document.getElementById('audio-player');
            const audioSource = document.getElementById('audio-source');
            const audioStatus = document.getElementById('audio-status');

            audioStatus.textContent = 'üîÑ Ïò§ÎîîÏò§ ÌååÏùºÏùÑ Ï∞æÎäî Ï§ë...';

            function tryLoadAudio(urlIndex = 0) {
                if (urlIndex >= audioUrls.alternatives.length) {
                    audioStatus.innerHTML = `‚ùå Ïò§ÎîîÏò§ ÌååÏùºÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.`;
                    return;
                }

                const currentUrl = audioUrls.alternatives[urlIndex];
                audioSource.src = currentUrl;
                audioPlayer.load();

                const successHandler = function() {
                    const startTime = chapter.startTime || 0;
                    audioPlayer.currentTime = startTime;
                    audioStatus.innerHTML = `‚úÖ Ïò§ÎîîÏò§ Ï§ÄÎπÑ ÏôÑÎ£å!`;
                };

                const errorHandler = function() {
                    setTimeout(() => tryLoadAudio(urlIndex + 1), 100);
                };

                audioPlayer.addEventListener('canplaythrough', successHandler, { once: true });
                audioPlayer.addEventListener('error', errorHandler, { once: true });
            }

            tryLoadAudio(0);
            currentAudio = audioPlayer;
            playbackSpeed = 1.0;
        }

        // Í∏∞Î≥∏ Ìï®ÏàòÎì§
        function closeAudioModal() {
            document.getElementById('audio-modal').style.display = 'none';
            if (currentAudio) currentAudio.pause();
        }

        function togglePlayPause() {
            if (!currentAudio) return;
            if (currentAudio.paused) {
                currentAudio.play();
                document.querySelector('.play-pause-btn').textContent = '‚è∏Ô∏è ÏùºÏãúÏ†ïÏßÄ';
            } else {
                currentAudio.pause();
                document.querySelector('.play-pause-btn').textContent = '‚ñ∂Ô∏è Ïû¨ÏÉù';
            }
        }

        function changeSpeed() {
            if (!currentAudio) return;
            const speeds = [0.5, 0.75, 1.0, 1.25, 1.5, 2.0];
            const currentIndex = speeds.indexOf(playbackSpeed);
            playbackSpeed = speeds[(currentIndex + 1) % speeds.length];
            currentAudio.playbackRate = playbackSpeed;
            document.querySelector('.speed-btn').textContent = `${playbackSpeed}x`;
        }

        function resetToChapterStart() {
            if (!currentAudio) return;
            const currentChapter = parseInt(document.getElementById('audio-chapter-title').textContent.match(/Chapter (\d+)/)[1]) - 1;
            currentAudio.currentTime = bookData.chapterList[currentChapter]?.startTime || 0;
        }

        function downloadAudio() {
            const audioSource = document.getElementById('audio-source');
            if (audioSource.src) {
                const link = document.createElement('a');
                link.href = audioSource.src;
                link.download = `${document.getElementById('audio-chapter-title').textContent}.mp3`;
                link.click();
            }
        }

        // Ï±Ö ÏÉÅÏÑ∏ Ï†ïÎ≥¥ ÌëúÏãú
        function showBookDetail() {
            document.getElementById('book-detail-screen').style.display = 'block';
            document.getElementById('learning-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'none';
            generateChapterGrid();
            updateProgress();
        }

        // Ï±ïÌÑ∞ Í∑∏Î¶¨Îìú ÏÉùÏÑ±
        function generateChapterGrid() {
            const grid = document.getElementById('chapters-grid');
            grid.innerHTML = '';

            bookData.chapterList.forEach((chapter, index) => {
                const chapterCard = document.createElement('div');
                chapterCard.className = `chapter-card ${chapter.status}`;

                chapterCard.innerHTML = `
                    <div class="chapter-header">
                        <div class="chapter-info">
                            <h4>Chapter ${index + 1}: ${chapter.title}</h4>
                            <p>${chapter.description} (${chapter.questionCount}Î¨∏Ï†ú)</p>
                        </div>
                        <div class="chapter-status ${chapter.status}">
                            ${chapter.status === 'completed' ? '‚úÖ ÏôÑÎ£å' :
                              chapter.status === 'current' ? 'üìñ ÏßÑÌñâÏ§ë' : 'üîí Ïû†ÍπÄ'}
                        </div>
                    </div>
                    <div class="chapter-actions">
                        <button class="chapter-btn audio-btn" onclick="playChapterAudio(${index})"
                                ${chapter.status === 'locked' ? 'disabled' : ''}>
                            üéß Ïò§ÎîîÏò§
                        </button>
                        <button class="chapter-btn quiz-btn" onclick="startLearning(${index})"
                                ${chapter.status === 'locked' ? 'disabled' : ''}>
                            üìù Î¨∏Ï†úÌíÄÍ∏∞
                        </button>
                    </div>
                `;

                grid.appendChild(chapterCard);
            });
        }

        // ÏßÑÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
        function updateProgress() {
            const completedChapters = bookData.chapterList.filter(chapter => chapter.status === 'completed').length;
            const progress = Math.round((completedChapters / bookData.chapters) * 100);
            document.getElementById('progress-value').textContent = progress + '%';
        }

        // ÌïôÏäµ ÏãúÏûë
        function startLearning(chapterIndex) {
            currentChapterIndex = chapterIndex;
            currentQuestionIndex = 0;
            userAnswers = [];
            questions = questionsData[chapterIndex];

            if (!questions || questions.length === 0) {
                alert('Ïù¥ Ï±ïÌÑ∞Ïùò Î¨∏Ï†úÍ∞Ä ÏïÑÏßÅ Ï§ÄÎπÑÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                return;
            }

            document.getElementById('book-detail-screen').style.display = 'none';
            document.getElementById('learning-screen').style.display = 'block';
            document.getElementById('result-screen').style.display = 'none';

            const chapter = bookData.chapterList[chapterIndex];
            document.getElementById('learning-title').textContent = `Chapter ${chapterIndex + 1}: ${chapter.title}`;
            document.getElementById('learning-chapter-breadcrumb').textContent = `Chapter ${chapterIndex + 1}`;

            showQuestion();
            updateLearningProgress();
        }

        // Î¨∏Ï†ú ÌëúÏãú
        function showQuestion() {
            const question = questions[currentQuestionIndex];
            const container = document.getElementById('question-container');

            container.innerHTML = `
                <div class="question-text">Î¨∏Ï†ú ${currentQuestionIndex + 1}</div>
                <div class="passage">${question.passage}</div>
                <div class="question-text">${question.question}</div>
                <div class="options">
                    ${question.options.map((option, index) =>
                        `<div class="option" onclick="selectOption(${index})" data-index="${index}">
                            ${String.fromCharCode(65 + index)}. ${option}
                        </div>`
                    ).join('')}
                </div>
            `;

            if (userAnswers[currentQuestionIndex] !== undefined) {
                const selectedOption = container.querySelector(`[data-index="${userAnswers[currentQuestionIndex]}"]`);
                if (selectedOption) selectedOption.classList.add('selected');
            }

            updateNavigationButtons();
        }

        // ÏÑ†ÌÉùÏßÄ ÏÑ†ÌÉù
        function selectOption(optionIndex) {
            document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
            document.querySelector(`[data-index="${optionIndex}"]`).classList.add('selected');
            userAnswers[currentQuestionIndex] = optionIndex;
            updateNavigationButtons();
        }

        // ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò
        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                showQuestion();
                updateLearningProgress();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion();
                updateLearningProgress();
            }
        }

        function updateLearningProgress() {
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('learning-progress-bar').style.width = progress + '%';
            document.getElementById('learning-progress-text').textContent = `Î¨∏Ï†ú ${currentQuestionIndex + 1} / ${questions.length}`;
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const submitBtn = document.getElementById('submit-btn');

            prevBtn.disabled = currentQuestionIndex === 0;

            if (currentQuestionIndex === questions.length - 1) {
                nextBtn.style.display = 'none';
                submitBtn.style.display = 'block';
                submitBtn.disabled = userAnswers[currentQuestionIndex] === undefined;
            } else {
                nextBtn.style.display = 'block';
                submitBtn.style.display = 'none';
                nextBtn.disabled = userAnswers[currentQuestionIndex] === undefined;
            }
        }

        // ÎãµÏïà Ï†úÏ∂ú
        function submitAnswers() {
            let correctCount = 0;
            questions.forEach((question, index) => {
                if (userAnswers[index] === question.correct) correctCount++;
            });

            const score = Math.round((correctCount / questions.length) * 100);

            if (score >= 70) {
                bookData.chapterList[currentChapterIndex].status = 'completed';
                if (currentChapterIndex < bookData.chapterList.length - 1) {
                    bookData.chapterList[currentChapterIndex + 1].status = 'current';
                }
            }

            showResults(correctCount, questions.length, score);
        }

        // Í≤∞Í≥º ÌëúÏãú
        function showResults(correct, total, score) {
            document.getElementById('learning-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';

            document.getElementById('score-circle').textContent = score + '%';
            document.getElementById('total-questions').textContent = total + 'Î¨∏Ï†ú';
            document.getElementById('correct-answers').textContent = correct + 'Î¨∏Ï†ú';
            document.getElementById('wrong-answers').textContent = (total - correct) + 'Î¨∏Ï†ú';
            document.getElementById('final-score').textContent = score + 'Ï†ê';

            let message = '';
            if (score >= 90) message = 'ÌõåÎ•≠Ìï©ÎãàÎã§! üåü';
            else if (score >= 80) message = 'ÏûòÌñàÏñ¥Ïöî! üëè';
            else if (score >= 70) message = 'Ï¢ãÏïÑÏöî! üëç';
            else message = 'Îã§Ïãú ÌïúÎ≤à ÎèÑÏ†ÑÌï¥Î≥¥ÏÑ∏Ïöî! üí™';

            document.getElementById('result-message').textContent = message;
        }

        function retryChapter() {
            startLearning(currentChapterIndex);
        }

        function nextChapter() {
            if (currentChapterIndex < bookData.chapterList.length - 1) {
                startLearning(currentChapterIndex + 1);
            } else {
                alert('Î™®Îì† Ï±ïÌÑ∞Î•º ÏôÑÎ£åÌñàÏäµÎãàÎã§! üéâ');
                showBookDetail();
            }
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú
        window.addEventListener('load', function() {
            showBookDetail();
            console.log('üêÖ Magic Tree House: Tigers at Twilight ÌïôÏäµ ÏãúÏä§ÌÖúÏù¥ Ï§ÄÎπÑÎêòÏóàÏäµÎãàÎã§!');
        });

        // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠Ïãú Îã´Í∏∞
        document.getElementById('audio-modal').addEventListener('click', function(e) {
            if (e.target === this) closeAudioModal();
        });
    </script>
</body>
</html>
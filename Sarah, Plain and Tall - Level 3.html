<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sarah, Plain and Tall - Level 3 - ÏàòÎ¶¨Îî©Ïñ¥ÌïôÏõê</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #DEB887 0%, #87CEEB 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        /* Ìó§Îçî */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #DEB887, #87CEEB);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .logo-text h1 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
        }

        .logo-text p {
            font-size: 0.9rem;
            color: #666;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
            color: #333;
            text-decoration: none;
        }

        .nav-btn:hover {
            background: #DEB887;
            color: white;
            transform: translateY(-2px);
        }

        /* Î©îÏù∏ ÏΩòÌÖêÏ∏† ÏòÅÏó≠ */
        .main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            min-height: 600px;
        }

        /* Ï±Ö ÏÉÅÏÑ∏ ÌôîÎ©¥ */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 30px;
            font-size: 0.9rem;
            color: #666;
        }

        .breadcrumb a {
            color: #DEB887;
            text-decoration: none;
            cursor: pointer;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .book-detail-header {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: flex-start;
        }

        .detail-book-cover {
            width: 150px;
            height: 220px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 4rem;
            font-weight: bold;
            flex-shrink: 0;
            background: linear-gradient(45deg, #DEB887, #87CEEB);
        }

        .book-info {
            flex: 1;
        }

        .book-info h2 {
            font-size: 2.2rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .book-info .author {
            font-size: 1.2rem;
            color: #DEB887;
            margin-bottom: 20px;
        }

        .book-summary {
            font-size: 1rem;
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .book-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-box .value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #DEB887;
        }

        .stat-box .label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        /* Ï±ïÌÑ∞ Í∑∏Î¶¨Îìú */
        .chapters-section {
            margin-top: 40px;
        }

        .chapters-section h3 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 30px;
            text-align: center;
        }

        .chapters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .chapter-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
        }

        .chapter-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .chapter-card.completed {
            border-color: #28a745;
            background: linear-gradient(135deg, #28a74508, #ffffff);
        }

        .chapter-card.current {
            border-color: #DEB887;
            background: linear-gradient(135deg, #DEB88708, #ffffff);
        }

        .chapter-card.locked {
            opacity: 0.6;
            background: #f8f9fa;
        }

        .chapter-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .chapter-info h4 {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }

        .chapter-info p {
            font-size: 0.95rem;
            color: #666;
            line-height: 1.5;
        }

        .chapter-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .chapter-status.completed {
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
        }

        .chapter-status.current {
            background: rgba(222, 184, 135, 0.1);
            color: #DEB887;
        }

        .chapter-status.locked {
            background: rgba(108, 117, 125, 0.1);
            color: #6c757d;
        }

        .chapter-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .chapter-btn {
            padding: 12px 16px;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .audio-btn {
            background: linear-gradient(45deg, #DEB887, #F4A460);
            color: white;
        }

        .quiz-btn {
            background: linear-gradient(45deg, #87CEEB, #4682B4);
            color: white;
        }

        .chapter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .chapter-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* ÌïôÏäµ ÌôîÎ©¥ */
        .learning-screen {
            display: none;
        }

        .learning-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .learning-progress {
            background: #f8f9fa;
            border-radius: 10px;
            height: 8px;
            margin: 20px 0;
            overflow: hidden;
        }

        .learning-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #DEB887, #87CEEB);
            transition: width 0.3s ease;
        }

        .question-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
        }

        .passage {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1rem;
            line-height: 1.6;
            color: #444;
        }

        .options {
            display: grid;
            gap: 10px;
        }

        .option {
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option:hover {
            background: #e9ecef;
            border-color: #DEB887;
        }

        .option.selected {
            background: rgba(222, 184, 135, 0.1);
            border-color: #DEB887;
        }

        .learning-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .control-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .next-btn {
            background: linear-gradient(45deg, #DEB887, #87CEEB);
            color: white;
        }

        .prev-btn {
            background: #6c757d;
            color: white;
        }

        .submit-btn {
            background: linear-gradient(45deg, #DEB887, #87CEEB);
            color: white;
        }

        .control-btn:hover {
            transform: translateY(-2px);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Í≤∞Í≥º ÌôîÎ©¥ */
        .result-screen {
            display: none;
            text-align: center;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(45deg, #DEB887, #87CEEB);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            font-size: 2rem;
            font-weight: bold;
        }

        .result-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .result-stat {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .result-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        /* Ïò§ÎîîÏò§ ÌîåÎ†àÏù¥Ïñ¥ Î™®Îã¨ */
        .audio-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .audio-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 600px;
            width: 90%;
            position: relative;
        }

        .close-audio {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #666;
        }

        .audio-player {
            width: 100%;
            margin: 20px 0;
            border-radius: 10px;
        }

        .audio-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .audio-control-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .play-pause-btn {
            background: linear-gradient(45deg, #DEB887, #F4A460);
            color: white;
        }

        .speed-btn {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #ddd;
        }

        .download-btn {
            background: #87CEEB;
            color: white;
        }

        .audio-info {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            font-size: 0.9rem;
            color: #666;
            transition: all 0.3s ease;
        }

        .audio-info.hidden {
            display: none;
        }

        /* Î∞òÏùëÌòï */
        @media (max-width: 768px) {
            .chapters-grid {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .book-detail-header {
                flex-direction: column;
                text-align: center;
            }

            .book-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .learning-controls {
                flex-direction: column;
            }

            .chapter-actions {
                grid-template-columns: 1fr;
            }

            .audio-controls {
                justify-content: center;
                gap: 10px;
            }

            .audio-content {
                padding: 30px 20px;
            }
        }

        .new-book-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: linear-gradient(45deg, #FF6B9D, #C44569);
            color: white;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: 700;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ìó§Îçî -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">üåæ</div>
                <div class="logo-text">
                    <h1>Sarah, Plain and Tall</h1>
                    <p>Level 3 - Patricia MacLachlanÏùò Í∞êÎèôÏ†ÅÏù∏ Í∞ÄÏ°± Ïù¥ÏïºÍ∏∞</p>
                </div>
            </div>
            <div class="nav-buttons">
                <a href="http://www.suelibrary.store/" class="nav-btn">Î©îÏù∏ÏúºÎ°ú</a>
            </div>
        </div>

        <!-- Î©îÏù∏ ÏΩòÌÖêÏ∏† -->
        <div class="main-content">
            <!-- Ï±Ö ÏÉÅÏÑ∏ ÌôîÎ©¥ -->
            <div class="book-detail-screen" id="book-detail-screen">
                <div class="breadcrumb">

                    <span>Sarah, Plain and Tall</span>
                </div>

                <div class="book-detail-header">
                    <div class="detail-book-cover">üåæ</div>
                    <div class="book-info">
                        <h2>Sarah, Plain and Tall</h2>
                        <div class="author">Patricia MacLachlan</div>
                        <div class="book-summary">
                            Set in the early 1900s on the American prairie, this Newbery Medal-winning story tells of Anna and Caleb, whose father places an ad for a mail-order bride. Sarah Elisabeth Wheaton from Maine responds, bringing hope for a new family while missing her beloved sea.
                        </div>
                        <div class="book-stats">
                            <div class="stat-box">
                                <div class="value">10</div>
                                <div class="label">Ï±ïÌÑ∞</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">50</div>
                                <div class="label">Ï¥ù Î¨∏Ï†ú</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">Level 3</div>
                                <div class="label">Î†àÎ≤®</div>
                            </div>
                            <div class="stat-box">
                                <div class="value" id="progress-value">0%</div>
                                <div class="label">ÏßÑÎèÑ</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="chapters-section">
                    <h3>üìñ Ï±ïÌÑ∞Î≥Ñ ÌïôÏäµ</h3>
                    <div class="chapters-grid" id="chapters-grid">
                        <!-- Ï±ïÌÑ∞ Ïπ¥ÎìúÎì§ -->
                    </div>
                </div>
            </div>

            <!-- ÌïôÏäµ ÌôîÎ©¥ -->
            <div class="learning-screen" id="learning-screen">
                <div class="breadcrumb">

                    <a onclick="showBookDetail()">Sarah, Plain and Tall</a>
                    <span>></span>
                    <span id="learning-chapter-breadcrumb">Chapter 1</span>
                </div>

                <div class="learning-header">
                    <h2 id="learning-title">Chapter 1: The Advertisement</h2>
                    <div class="learning-progress">
                        <div class="learning-progress-bar" id="learning-progress-bar" style="width: 0%"></div>
                    </div>
                    <p id="learning-progress-text">Î¨∏Ï†ú 1 / 5</p>
                </div>

                <div class="question-container" id="question-container">
                    <!-- Î¨∏Ï†úÍ∞Ä ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
                </div>

                <div class="learning-controls">
                    <button class="control-btn prev-btn" id="prev-btn" onclick="previousQuestion()" disabled>Ïù¥Ï†Ñ</button>
                    <button class="control-btn next-btn" id="next-btn" onclick="nextQuestion()">Îã§Ïùå</button>
                    <button class="control-btn submit-btn" id="submit-btn" onclick="submitAnswers()" style="display: none;">Ï†úÏ∂ú</button>
                </div>
            </div>

            <!-- Í≤∞Í≥º ÌôîÎ©¥ -->
            <div class="result-screen" id="result-screen">
                <div class="breadcrumb">

                    <a onclick="showBookDetail()">Sarah, Plain and Tall</a>
                    <span>></span>
                    <span>Í≤∞Í≥º</span>
                </div>

                <div class="result-header">
                    <h2>üéâ ÌïôÏäµ ÏôÑÎ£å!</h2>
                    <div class="score-circle" id="score-circle">100%</div>
                    <h3 id="result-message">ÌõåÎ•≠Ìï©ÎãàÎã§!</h3>
                </div>

                <div class="result-details">
                    <div class="result-stat">
                        <h4>Ï¥ù Î¨∏Ï†ú</h4>
                        <p id="total-questions">5Î¨∏Ï†ú</p>
                    </div>
                    <div class="result-stat">
                        <h4>Ï†ïÎãµ</h4>
                        <p id="correct-answers">5Î¨∏Ï†ú</p>
                    </div>
                    <div class="result-stat">
                        <h4>Ïò§Îãµ</h4>
                        <p id="wrong-answers">0Î¨∏Ï†ú</p>
                    </div>
                    <div class="result-stat">
                        <h4>Ï†êÏàò</h4>
                        <p id="final-score">100Ï†ê</p>
                    </div>
                </div>

                <div class="result-actions">
                    <button class="control-btn prev-btn" onclick="retryChapter()">Îã§Ïãú ÌíÄÍ∏∞</button>
                    <button class="control-btn next-btn" onclick="nextChapter()">Îã§Ïùå Ï±ïÌÑ∞</button>
                    <button class="control-btn submit-btn" onclick="showBookDetail()">Ï±ïÌÑ∞ Î™©Î°ù</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ïò§ÎîîÏò§ ÌîåÎ†àÏù¥Ïñ¥ Î™®Îã¨ -->
    <div class="audio-modal" id="audio-modal">
        <div class="audio-content">
            <button class="close-audio" onclick="closeAudioModal()">√ó</button>
            <h3 id="audio-chapter-title">Chapter 1: The Advertisement</h3>
            <p id="audio-chapter-subtitle">Sarah, Plain and Tall - Patricia MacLachlan</p>

            <audio class="audio-player" id="audio-player" controls preload="metadata">
                <source id="audio-source" src="" type="audio/mpeg">
                Î∏åÎùºÏö∞Ï†ÄÍ∞Ä Ïò§ÎîîÏò§Î•º ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.
            </audio>

            <div class="audio-controls">
                <button class="audio-control-btn play-pause-btn" onclick="togglePlayPause()">‚ñ∂Ô∏è Ïû¨ÏÉù</button>
                <button class="audio-control-btn speed-btn" onclick="changeSpeed()">1.0x</button>
                <button class="audio-control-btn" onclick="resetToChapterStart()" style="background: #28a745; color: white;">üîÑ Íµ¨Í∞ÑÏ≤òÏùå</button>
                <button class="audio-control-btn download-btn" onclick="downloadAudio()">üì• Îã§Ïö¥Î°úÎìú</button>
            </div>

            <div class="audio-info" id="audio-info">
                <div id="audio-status" style="margin-top: 10px; font-weight: bold; color: #DEB887;"></div>
            </div>
        </div>
    </div>

    <script>
        // üéØ Íµ¨Í∏Ä ÌÅ¥ÎùºÏö∞Îìú Ïä§ÌÜ†Î¶¨ÏßÄ Ïò§ÎîîÏò§ URL ÏÑ§Ï†ï
        const AUDIO_BASE_URL = 'https://storage.googleapis.com/kim-mom-reading-audio/audio/';

        // Sarah, Plain and Tall ÎèÑÏÑú Îç∞Ïù¥ÌÑ∞ (Ï†ÑÏ≤¥ 10Ï±ïÌÑ∞)
        const bookData = {
            id: 'SPT001',
            title: "Sarah, Plain and Tall",
            author: 'Patricia MacLachlan',
            cover: 'üåæ',
            progress: 0,
            chapters: 10,
            totalQuestions: 50, // 10Ï±ïÌÑ∞ √ó 5Î¨∏Ï†ú
            coverColor: 'linear-gradient(45deg, #DEB887, #87CEEB)',
            summary: "Set in the early 1900s on the American prairie, this Newbery Medal-winning story tells of Anna and Caleb, whose father places an ad for a mail-order bride. Sarah Elisabeth Wheaton from Maine responds, bringing hope for a new family while missing her beloved sea.",
            chapterList: [
                { title: 'The Advertisement', description: 'Papa places an ad for a wife and mother.', status: 'current', questionCount: 5, startTime: 0 },
                { title: 'Sarah\'s Letter', description: 'Sarah responds from Maine, describing herself as plain and tall.', status: 'locked', questionCount: 5, startTime: 480 },
                { title: 'Letters Exchange', description: 'Papa and Sarah write back and forth about their lives.', status: 'locked', questionCount: 5, startTime: 960 },
                { title: 'Waiting for Sarah', description: 'The family prepares for Sarah\'s arrival.', status: 'locked', questionCount: 5, startTime: 1440 },
                { title: 'Sarah Arrives', description: 'Sarah comes to the prairie and begins to adapt.', status: 'locked', questionCount: 5, startTime: 1920 },
                { title: 'Life on the Prairie', description: 'Sarah learns about prairie life and shares her skills.', status: 'locked', questionCount: 5, startTime: 2400 },
                { title: 'Missing the Sea', description: 'Sarah struggles with homesickness for Maine.', status: 'locked', questionCount: 5, startTime: 2880 },
                { title: 'Storm on the Prairie', description: 'A fierce storm tests Sarah\'s resolve to stay.', status: 'locked', questionCount: 5, startTime: 3360 },
                { title: 'Sarah\'s Trip to Town', description: 'Sarah goes to town alone, causing worry.', status: 'locked', questionCount: 5, startTime: 3840 },
                { title: 'Sarah\'s Choice', description: 'Sarah must decide whether to stay or return to Maine.', status: 'locked', questionCount: 5, startTime: 4320 }
            ]
        };

        // Î¨∏Ï†ú Îç∞Ïù¥ÌÑ∞ (Ï†ÑÏ≤¥ 10Ï±ïÌÑ∞)
        const questionsData = {
            0: [ // Chapter 1: The Advertisement
                {
                    passage: "Did Mama sing every day? Caleb asked me. Every-single-day? He sat close to the fire, his chin in his hands. It was winter, and Papa was mending harness in the barn. I could hear the dogs stirring in the yard, and the sound of the wind.",
                    question: "What season was it when Caleb asked about Mama?",
                    options: ["Spring", "Summer", "Winter", "Fall"],
                    correct: 2
                },
                {
                    passage: "Every-single-day, I told him for the second time this week. For the twentieth time this month. The hundredth time this year? And the thousandth time since Mama died? Who knows? But always the same. Yes, every-single-day.",
                    question: "How often does Anna have to answer Caleb's question about Mama?",
                    options: ["Once in a while", "Very frequently - many times each week and month", "Never before", "Only on special occasions"],
                    correct: 1
                },
                {
                    passage: "Caleb was only three years old when Mama died. Sometimes I forget he doesn't remember her as I do. But I do remember. I remember the singing, and the yellow bonnet she wore when she went to town.",
                    question: "How old was Caleb when their mother died?",
                    options: ["Two years old", "Three years old", "Four years old", "Five years old"],
                    correct: 1
                },
                {
                    passage: "Papa came inside, his hair wet with snow. Sarah will come in the spring, he said quietly. Sarah? Caleb asked. Who is Sarah? She will be here in the spring. I have written to ask her to come.",
                    question: "When did Papa say Sarah would come?",
                    options: ["In the winter", "In the spring", "In the summer", "In the fall"],
                    correct: 1
                },
                {
                    passage: "Papa showed us the letter he had written to place in the newspaper: Would a woman who can cook and keep house and is fond of children come to live with a widower and his two children?",
                    question: "What did Papa's advertisement ask for?",
                    options: ["A housekeeper only", "A woman who can cook, keep house, and is fond of children", "A teacher for the children", "A farmhand to help with work"],
                    correct: 1
                }
            ],
            1: [ // Chapter 2: Sarah's Letter
                {
                    passage: "Sarah's letter came on a day when the corn snow was deep and the wind was sharp. Papa read it to us by the fire. Dear Mr. Witting, she wrote. I am Sarah Elisabeth Wheaton from Maine.",
                    question: "Where was Sarah from?",
                    options: ["Massachusetts", "Maine", "Montana", "Minnesota"],
                    correct: 1
                },
                {
                    passage: "I am answering your advertisement. I have never been married, though I have been asked. I have lived with an older brother, William, who fishes the coast of Maine.",
                    question: "What was Sarah's brother William's occupation?",
                    options: ["He was a farmer", "He fished the coast of Maine", "He was a shopkeeper", "He was a teacher"],
                    correct: 1
                },
                {
                    passage: "I am strong and I work hard and I am willing to travel. But I am not mild mannered. If you should still care to write, I would be interested in your children and about where you live. And you should know, I am Sarah, plain and tall.",
                    question: "How did Sarah describe herself?",
                    options: ["Beautiful and gentle", "Plain and tall", "Short and pretty", "Quiet and shy"],
                    correct: 1
                },
                {
                    passage: "Caleb was quiet for a moment. Then he said, What's that mean? What does she mean, 'plain and tall'? Plain means not fancy, I said. Not beautiful? he asked.",
                    question: "How did Anna explain 'plain' to Caleb?",
                    options: ["Ugly", "Not fancy, but maybe beautiful in a quiet way", "Very beautiful", "Average looking"],
                    correct: 1
                },
                {
                    passage: "Papa wrote back to Sarah, and I waited every day for her answer. When it came, Papa read: Dear Mr. Witting, Yes, I am interested in your children and where you live. Tell me about the prairie.",
                    question: "What did Sarah want to know about?",
                    options: ["The children's ages", "The prairie", "The house they lived in", "The work she would do"],
                    correct: 1
                }
            ],
            2: [ // Chapter 3: Letters Exchange
                {
                    passage: "Papa and Sarah wrote back and forth. Sarah wrote that she could make a hearty soup and biscuits and keep a clean house and set broken bones, though she hoped she wouldn't have to.",
                    question: "What skills did Sarah mention she had?",
                    options: ["Only cooking", "Cooking, housekeeping, and setting broken bones", "Only cleaning", "Teaching children"],
                    correct: 1
                },
                {
                    passage: "She loved cats and had one named Seal because it was gray like the seals that came to the shore in Maine. She sang all the old songs, she wrote, and some new ones.",
                    question: "Why was Sarah's cat named Seal?",
                    options: ["It was named after her brother", "It was gray like the seals from Maine's shore", "It was named after a book", "She found it by the sea"],
                    correct: 1
                },
                {
                    passage: "Papa wrote that the prairie reached as far as the eye could see, with grass that moved like water in the wind. He told her about the harsh winters and the hot summers.",
                    question: "How did Papa describe the prairie grass?",
                    options: ["It stood perfectly still", "It moved like water in the wind", "It was brown and dry", "It was very short"],
                    correct: 1
                },
                {
                    passage: "Sarah wrote back that she would come for a month's visit. If we all suited, she would stay. If we didn't suit, she would take the train back to Maine.",
                    question: "What arrangement did Sarah suggest?",
                    options: ["She would stay permanently right away", "She would come for a month's visit to see if they all suited", "She would only visit for a week", "She would move there immediately"],
                    correct: 1
                },
                {
                    passage: "Will she sing? Caleb asked Papa. I don't know, Papa said. Sarah, plain and tall, wrote that she could cook and clean and fix things. But Papa had not asked if she could sing.",
                    question: "What worried the children about Sarah?",
                    options: ["Whether she would be kind", "Whether she could sing like Mama", "Whether she would like them", "Whether she would leave soon"],
                    correct: 1
                }
            ],
            3: [ // Chapter 4: Waiting for Sarah
                {
                    passage: "Papa cleaned the house until it shone. We washed our hair and put on our best clothes. Papa even washed his hair and shaved his beard. Caleb complained that Papa looked naked without his beard.",
                    question: "How did the family prepare for Sarah's arrival?",
                    options: ["They did nothing special", "They cleaned the house and dressed in their best clothes", "They went to town", "They cooked a big meal"],
                    correct: 1
                },
                {
                    passage: "Papa had written that Sarah would come by train to the next town, and he would meet her there. The night before Sarah came, Caleb asked me, What if she doesn't like us?",
                    question: "What was Caleb worried about?",
                    options: ["That Sarah wouldn't like them", "That Sarah wouldn't be able to cook", "That Sarah would be too strict", "That the weather would be bad"],
                    correct: 0
                },
                {
                    passage: "I told him that we would like her. But I was worried, too. What if she didn't like the prairie? What if she missed the sea so much that she couldn't be happy here?",
                    question: "What was Anna worried about regarding Sarah?",
                    options: ["That Sarah wouldn't like the children", "That Sarah wouldn't like the prairie and would miss the sea", "That Sarah wouldn't be able to cook", "That Sarah would be too strict"],
                    correct: 1
                },
                {
                    passage: "Caleb and I had found some wildflowers to put in Sarah's room. We picked them early in the morning when the dew was still on them, purple and white and yellow.",
                    question: "What did the children do for Sarah's room?",
                    options: ["They cleaned it thoroughly", "They put wildflowers in it", "They painted it", "They bought new furniture"],
                    correct: 1
                },
                {
                    passage: "That night I dreamed about Sarah coming. In my dream, she looked like Mama, with brown hair and a gentle smile. But when I woke up, I remembered that Sarah was plain and tall, not like Mama at all.",
                    question: "What did Anna dream about Sarah?",
                    options: ["That she looked plain and tall", "That she looked like Mama with brown hair and a gentle smile", "That she was very different from everyone", "That she was crying"],
                    correct: 1
                }
            ],
            4: [ // Chapter 5: Sarah Arrives
                {
                    passage: "Sarah came in the spring. She came through green grass fields that bloomed with Indian paintbrush, red and orange, and blue-eyed grass. Papa got up early for the long day of travel to the train and back.",
                    question: "What season did Sarah arrive in?",
                    options: ["Winter", "Spring", "Summer", "Fall"],
                    correct: 1
                },
                {
                    passage: "When they came home, Papa called out, Sarah has come! She was plain and tall, just as she had written. She had brought a large yellow cat named Seal and a small bag with a few belongings.",
                    question: "What did Sarah bring with her?",
                    options: ["Many suitcases and boxes", "A large yellow cat named Seal and a small bag", "Only clothes", "Gifts for everyone"],
                    correct: 1
                },
                {
                    passage: "Sarah looked around the small house, then went to the window. The prairie goes on forever, she said. Like the sea. She was quiet for a moment. But the sea is not quiet. Here, there is so much sky.",
                    question: "How did Sarah compare the prairie to the sea?",
                    options: ["They were completely different", "The prairie went on forever like the sea, but the sea wasn't quiet", "The prairie was better than the sea", "The prairie was exactly like the sea"],
                    correct: 1
                },
                {
                    passage: "Sarah made us a yellow cake with chickens and cows drawn on top in frosting. This is the way my aunt makes cake, she said. And the way I learned.",
                    question: "What special thing did Sarah make for the family?",
                    options: ["A regular cake", "A yellow cake with chickens and cows drawn in frosting", "Biscuits and soup", "A pie"],
                    correct: 1
                },
                {
                    passage: "But Sarah didn't sing. She would hum sometimes while she worked, but she didn't sing the songs that Caleb and I remembered Mama singing. And every morning Sarah stood by the window, looking out at the prairie.",
                    question: "What did Sarah do every morning?",
                    options: ["She sang loudly", "She stood by the window looking at the prairie", "She cooked breakfast immediately", "She went outside"],
                    correct: 1
                }
            ],
            5: [ // Chapter 6: Life on the Prairie
                {
                    passage: "Sarah taught us many things. She taught us how to braid our hair and how to make a perfect fire in the stove. She showed us how to plant a garden and how to tell when vegetables were ready to pick.",
                    question: "What did Sarah teach the children?",
                    options: ["Only how to cook", "How to braid hair, make fires, plant gardens, and pick vegetables", "Only how to clean", "How to read and write"],
                    correct: 1
                },
                {
                    passage: "Sarah could fix anything that was broken. She mended the roof where it leaked, painted the fence, and even fixed Papa's old plow that had been sitting in the barn for years.",
                    question: "What showed that Sarah was handy with repairs?",
                    options: ["She only cooked well", "She mended the roof, painted the fence, and fixed Papa's old plow", "She only cleaned the house", "She only worked in the garden"],
                    correct: 1
                },
                {
                    passage: "In the evenings, Sarah would tell us stories about Maine. She told us about the lobster boats that went out early in the morning, and the fog that rolled in from the sea, thick and gray.",
                    question: "What did Sarah tell stories about?",
                    options: ["Her childhood friends", "Maine, lobster boats, and fog from the sea", "Her travels around the country", "Books she had read"],
                    correct: 1
                },
                {
                    passage: "Sarah made curtains for all the windows, yellow ones like the sun. When the wind blew them, they looked like they were dancing. Caleb said they made the whole house feel happier.",
                    question: "What did Sarah make for the house?",
                    options: ["New furniture", "Yellow curtains for all the windows", "New rugs", "Painted walls"],
                    correct: 1
                },
                {
                    passage: "Papa smiled more often now. I could see him watching Sarah as she worked, and sometimes I caught him humming while he did his chores, something he hadn't done since Mama died.",
                    question: "How did Papa change after Sarah arrived?",
                    options: ["He became more serious", "He smiled more often and started humming again", "He worked less", "He became quieter"],
                    correct: 1
                }
            ],
            6: [ // Chapter 7: Missing the Sea
                {
                    passage: "Sarah missed the sea. She missed the sound of the sea and the gulls and the salt smell of the air. She told us about the lobster boats and the fog that came in from the sea.",
                    question: "What did Sarah miss most about Maine?",
                    options: ["Her brother William", "The sea and everything about it", "Her old house", "Her friends"],
                    correct: 1
                },
                {
                    passage: "I wish you could see the sea, Sarah told us. She took Caleb and me to the cow pond. This is a little like the sea, she said, but the sea is much bigger. It goes on and on and on.",
                    question: "How did Sarah describe the sea to the children?",
                    options: ["It was exactly like their pond", "It was much bigger than their pond and went on and on", "It was always calm and peaceful", "It was too dangerous to enjoy"],
                    correct: 1
                },
                {
                    passage: "Sarah picked flowers from the fields and put them in jars of water around the house. She sang them water songs, she said. I know water songs and prairie songs too.",
                    question: "What did Sarah do with the prairie flowers?",
                    options: ["She threw them away", "She put them in water jars and said she sang them water songs", "She dried them", "She gave them to neighbors"],
                    correct: 1
                },
                {
                    passage: "One morning Sarah took the wagon to town. She came back with three colored pencils. Blue for the sea and the sky, yellow for the wild flowers, and green for the grass.",
                    question: "Why did Sarah buy colored pencils?",
                    options: ["For the children to play with", "To draw pictures of the prairie and sea", "To teach art to the children", "To decorate the house"],
                    correct: 1
                },
                {
                    passage: "But the pictures seemed to make Sarah sad. She would look at them and then look out the window at the endless prairie and sigh. I began to worry that Sarah would leave us.",
                    question: "How did drawing pictures affect Sarah?",
                    options: ["It made her very happy", "It seemed to make her sad", "It helped her feel at home", "It didn't affect her at all"],
                    correct: 1
                }
            ],
            7: [ // Chapter 8: Storm on the Prairie
                {
                    passage: "The storm came quickly across the prairie. The sky turned dark green, and the wind began to howl. Sarah had never seen a prairie storm before, and her eyes were wide with fear.",
                    question: "How did Sarah react to the prairie storm?",
                    options: ["She was calm and confident", "Her eyes were wide with fear", "She was excited", "She went outside to watch"],
                    correct: 1
                },
                {
                    passage: "Papa quickly gathered us all into the cellar. The wind roared above us, and we could hear things crashing and banging outside. Sarah held Caleb close, and I could see her hands shaking.",
                    question: "Where did the family go during the storm?",
                    options: ["They stayed in the house", "They went into the cellar", "They went to the barn", "They went to town"],
                    correct: 1
                },
                {
                    passage: "When the storm was over, we came outside to see the damage. The chicken coop was destroyed, and several trees were down. But the house was still standing, and we were all safe.",
                    question: "What damage did the storm cause?",
                    options: ["No damage at all", "The chicken coop was destroyed and several trees were down", "The house was completely destroyed", "Only minor damage to the garden"],
                    correct: 1
                },
                {
                    passage: "Sarah looked around at the destruction and then at the endless sky. In Maine, she said quietly, we have trees to protect us. Here, there's nothing but sky. Nothing but sky and wind.",
                    question: "What did Sarah say about the difference between Maine and the prairie?",
                    options: ["They were exactly the same", "In Maine they had trees for protection, but here there was nothing but sky and wind", "The prairie was better than Maine", "She preferred the prairie storms"],
                    correct: 1
                },
                {
                    passage: "That night, Sarah sat by the window for a long time, looking out at the prairie. I wondered if she was thinking about going back to Maine, back to the sea and the trees and the protection they offered.",
                    question: "What was Anna worried about after the storm?",
                    options: ["That Sarah was hurt", "That Sarah might be thinking about going back to Maine", "That there would be another storm", "That Papa was upset"],
                    correct: 1
                }
            ],
            8: [ // Chapter 9: Sarah's Trip to Town
                {
                    passage: "One day Sarah took the wagon to town by herself. She had never done this before. Papa was worried, and so was I. What if she doesn't come back? Caleb asked, saying what we all feared.",
                    question: "What was the family afraid of when Sarah went to town alone?",
                    options: ["That she would get lost", "That she wouldn't come back", "That she would have an accident", "That she would spend too much money"],
                    correct: 1
                },
                {
                    passage: "Sarah was gone for a long time. We waited and watched from the window. When we finally saw the wagon coming across the prairie, Papa let out his breath in a long sigh.",
                    question: "How did the family feel when they saw Sarah returning?",
                    options: ["They were angry", "They were relieved", "They were disappointed", "They were confused"],
                    correct: 1
                },
                {
                    passage: "Sarah was singing as the wagon approached the house. It was the first time we had heard her sing since she arrived. Her voice was clear and sweet, carrying across the prairie.",
                    question: "What was different about Sarah when she returned from town?",
                    options: ["She was crying", "She was singing for the first time since she arrived", "She was very quiet", "She looked angry"],
                    correct: 1
                },
                {
                    passage: "Sarah had brought gifts from town. For Anna, she brought a paper with dried flowers pressed inside. For Caleb, she brought a shell - a conch shell that made the sound of the sea when you held it to your ear.",
                    question: "What gift did Sarah bring for Caleb?",
                    options: ["Pressed flowers", "A conch shell that sounded like the sea", "Colored pencils", "A book"],
                    correct: 1
                },
                {
                    passage: "For Papa, she brought colored pencils to match her own. Now we can draw pictures together, she said with a smile. Pictures of this place, our place.",
                    question: "Why did Sarah bring Papa colored pencils?",
                    options: ["So he could work better", "So they could draw pictures together of their place", "So he could write letters", "So the children could use them"],
                    correct: 1
                }
            ],
            9: [ // Chapter 10: Sarah's Choice
                {
                    passage: "I went to town, Sarah said, to buy things I had never seen before. But there were things there I had seen before. There was a church with a bell, and I had seen that in Maine.",
                    question: "What did Sarah realize about the town?",
                    options: ["It was completely different from Maine", "There were things she had seen before in Maine", "It was exactly like Maine", "She had never seen anything like it"],
                    correct: 1
                },
                {
                    passage: "There were people walking to and fro, and I had seen that. There were children and flowers and a post office. All things I had seen before, in Maine.",
                    question: "What other familiar things did Sarah see in town?",
                    options: ["Only the church", "People, children, flowers, and a post office", "Only the buildings", "Nothing familiar"],
                    correct: 1
                },
                {
                    passage: "But what I had never seen before, Sarah said, smiling at us, was three people who loved me enough to let me go, and who loved me enough to want me to stay.",
                    question: "What had Sarah never seen before?",
                    options: ["A prairie town", "Three people who loved her enough to let her go but wanted her to stay", "A place like Maine", "Such a big sky"],
                    correct: 1
                },
                {
                    passage: "She looked at Papa. So I came back, she said. I will always miss my home, but you are my family now. And she began to sing.",
                    question: "Why did Sarah decide to stay?",
                    options: ["She liked the town", "Because the family was now her home", "She couldn't afford the train ticket", "She was afraid to travel"],
                    correct: 1
                },
                {
                    passage: "The song Sarah sang was about home. Not about a place, but about people who love you and want you to stay. It was a new song, one I had never heard before, but somehow it sounded familiar, like coming home.",
                    question: "What was special about the song Sarah sang?",
                    options: ["It was a song from Maine", "It was about home being people who love you, not a place", "It was Mama's favorite song", "It was a sad song about leaving"],
                    correct: 1
                }
            ]
        };

        // Ï†ÑÏó≠ Î≥ÄÏàò
        let currentChapterIndex = 0;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let questions = [];
        let currentAudio = null;
        let playbackSpeed = 1.0;

        // üéß ÏûêÎèô Ïò§ÎîîÏò§ URL ÏÉùÏÑ± Ìï®Ïàò (Sarah, Plain and TallÏö©)
function getAudioUrl(chapterIndex) {
    // 3ÏûêÎ¶¨ Ìå®Îî©ÏúºÎ°ú ÌååÏùºÎ™Ö ÏÉùÏÑ± (LT001, LT002, ..., LT009)
    const chapterNum = String(chapterIndex + 1).padStart(3, '0');
    const fileName = `LT${chapterNum}.mp3`;

    return {
        primary: `${AUDIO_BASE_URL}Sarah,%20Plain%20and%20Tall/${fileName}`,
        alternatives: [`${AUDIO_BASE_URL}Sarah,%20Plain%20and%20Tall/${fileName}`]
    };
}
        // üéß Ïò§ÎîîÏò§ Ïû¨ÏÉù Ìï®Ïàò
        function playChapterAudio(chapterIndex) {
            const chapter = bookData.chapterList[chapterIndex];
            const audioUrls = getAudioUrl(chapterIndex);

            document.getElementById('audio-modal').style.display = 'flex';
            document.getElementById('audio-chapter-title').textContent = `Chapter ${chapterIndex + 1}: ${chapter.title}`;
            document.getElementById('audio-chapter-subtitle').textContent = `${bookData.title} - ${bookData.author}`;

            // Ïò§ÎîîÏò§ Ï†ïÎ≥¥ ÏòÅÏó≠ Îã§Ïãú Î≥¥Ïù¥Í∏∞ (ÏÉàÎ°úÏö¥ Ïò§ÎîîÏò§ ÌîåÎ†àÏù¥Ïãú)
            document.getElementById('audio-info').classList.remove('hidden');

            const audioPlayer = document.getElementById('audio-player');
            const audioSource = document.getElementById('audio-source');
            const audioStatus = document.getElementById('audio-status');

            audioStatus.textContent = 'üîÑ Ïò§ÎîîÏò§ ÌååÏùºÏùÑ Ï∞æÎäî Ï§ë...';

            function tryLoadAudio(urlIndex = 0) {
                if (urlIndex >= audioUrls.alternatives.length) {
                    audioStatus.innerHTML = `‚ùå Ïò§ÎîîÏò§ ÌååÏùºÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.`;
                    return;
                }

                const currentUrl = audioUrls.alternatives[urlIndex];
                audioSource.src = currentUrl;
                audioPlayer.load();

                const successHandler = function() {
                    const startTime = chapter.startTime || 0;
                    audioPlayer.currentTime = startTime;
                    audioStatus.innerHTML = `‚úÖ Ïò§ÎîîÏò§ Ï§ÄÎπÑ ÏôÑÎ£å!`;
                };

                const errorHandler = function() {
                    setTimeout(() => tryLoadAudio(urlIndex + 1), 100);
                };

                audioPlayer.addEventListener('canplaythrough', successHandler, { once: true });
                audioPlayer.addEventListener('error', errorHandler, { once: true });
            }

            tryLoadAudio(0);
            currentAudio = audioPlayer;
            playbackSpeed = 1.0;
        }

        // Í∏∞Î≥∏ Ìï®ÏàòÎì§
        function closeAudioModal() {
            document.getElementById('audio-modal').style.display = 'none';
            if (currentAudio) currentAudio.pause();
        }

        function togglePlayPause() {
            if (!currentAudio) return;
            if (currentAudio.paused) {
                currentAudio.play();
                document.querySelector('.play-pause-btn').textContent = '‚è∏Ô∏è ÏùºÏãúÏ†ïÏßÄ';
            } else {
                currentAudio.pause();
                document.querySelector('.play-pause-btn').textContent = '‚ñ∂Ô∏è Ïû¨ÏÉù';
            }
        }

        function changeSpeed() {
            if (!currentAudio) return;
            const speeds = [0.5, 0.75, 1.0, 1.25, 1.5, 2.0];
            const currentIndex = speeds.indexOf(playbackSpeed);
            playbackSpeed = speeds[(currentIndex + 1) % speeds.length];
            currentAudio.playbackRate = playbackSpeed;
            document.querySelector('.speed-btn').textContent = `${playbackSpeed}x`;
        }

        function resetToChapterStart() {
            if (!currentAudio) return;
            const currentChapter = parseInt(document.getElementById('audio-chapter-title').textContent.match(/Chapter (\d+)/)[1]) - 1;
            currentAudio.currentTime = bookData.chapterList[currentChapter]?.startTime || 0;
        }

        function downloadAudio() {
            const audioSource = document.getElementById('audio-source');
            if (audioSource.src) {
                const link = document.createElement('a');
                link.href = audioSource.src;
                link.download = `${document.getElementById('audio-chapter-title').textContent}.mp3`;
                link.click();
            }
        }

        // Ï±Ö ÏÉÅÏÑ∏ Ï†ïÎ≥¥ ÌëúÏãú
        function showBookDetail() {
            document.getElementById('book-detail-screen').style.display = 'block';
            document.getElementById('learning-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'none';
            generateChapterGrid();
            updateProgress();
        }

        // Ï±ïÌÑ∞ Í∑∏Î¶¨Îìú ÏÉùÏÑ±
        function generateChapterGrid() {
            const grid = document.getElementById('chapters-grid');
            grid.innerHTML = '';

            bookData.chapterList.forEach((chapter, index) => {
                const chapterCard = document.createElement('div');
                chapterCard.className = `chapter-card ${chapter.status}`;

                chapterCard.innerHTML = `
                    <div class="chapter-header">
                        <div class="chapter-info">
                            <h4>Chapter ${index + 1}: ${chapter.title}</h4>
                            <p>${chapter.description} (${chapter.questionCount}Î¨∏Ï†ú)</p>
                        </div>
                        <div class="chapter-status ${chapter.status}">
                            ${chapter.status === 'completed' ? '‚úÖ ÏôÑÎ£å' :
                              chapter.status === 'current' ? 'üìñ ÏßÑÌñâÏ§ë' : 'üîí Ïû†ÍπÄ'}
                        </div>
                    </div>
                    <div class="chapter-actions">
                        <button class="chapter-btn audio-btn" onclick="playChapterAudio(${index})"
                                ${chapter.status === 'locked' ? 'disabled' : ''}>
                            üéß Ïò§ÎîîÏò§
                        </button>
                        <button class="chapter-btn quiz-btn" onclick="startLearning(${index})"
                                ${chapter.status === 'locked' ? 'disabled' : ''}>
                            üìù Î¨∏Ï†úÌíÄÍ∏∞
                        </button>
                    </div>
                `;

                grid.appendChild(chapterCard);
            });
        }

        // ÏßÑÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
        function updateProgress() {
            const completedChapters = bookData.chapterList.filter(chapter => chapter.status === 'completed').length;
            const progress = Math.round((completedChapters / bookData.chapters) * 100);
            document.getElementById('progress-value').textContent = progress + '%';
        }

        // ÌïôÏäµ ÏãúÏûë
        function startLearning(chapterIndex) {
            currentChapterIndex = chapterIndex;
            currentQuestionIndex = 0;
            userAnswers = [];
            questions = questionsData[chapterIndex];

            if (!questions || questions.length === 0) {
                alert('Ïù¥ Ï±ïÌÑ∞Ïùò Î¨∏Ï†úÍ∞Ä ÏïÑÏßÅ Ï§ÄÎπÑÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                return;
            }

            document.getElementById('book-detail-screen').style.display = 'none';
            document.getElementById('learning-screen').style.display = 'block';
            document.getElementById('result-screen').style.display = 'none';

            const chapter = bookData.chapterList[chapterIndex];
            document.getElementById('learning-title').textContent = `Chapter ${chapterIndex + 1}: ${chapter.title}`;
            document.getElementById('learning-chapter-breadcrumb').textContent = `Chapter ${chapterIndex + 1}`;

            showQuestion();
            updateLearningProgress();
        }

        // Î¨∏Ï†ú ÌëúÏãú
        function showQuestion() {
            const question = questions[currentQuestionIndex];
            const container = document.getElementById('question-container');

            container.innerHTML = `
                <div class="question-text">Î¨∏Ï†ú ${currentQuestionIndex + 1}</div>
                <div class="passage">${question.passage}</div>
                <div class="question-text">${question.question}</div>
                <div class="options">
                    ${question.options.map((option, index) =>
                        `<div class="option" onclick="selectOption(${index})" data-index="${index}">
                            ${String.fromCharCode(65 + index)}. ${option}
                        </div>`
                    ).join('')}
                </div>
            `;

            if (userAnswers[currentQuestionIndex] !== undefined) {
                const selectedOption = container.querySelector(`[data-index="${userAnswers[currentQuestionIndex]}"]`);
                if (selectedOption) selectedOption.classList.add('selected');
            }

            updateNavigationButtons();
        }

        // ÏÑ†ÌÉùÏßÄ ÏÑ†ÌÉù
        function selectOption(optionIndex) {
            document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
            document.querySelector(`[data-index="${optionIndex}"]`).classList.add('selected');
            userAnswers[currentQuestionIndex] = optionIndex;
            updateNavigationButtons();
        }

        // ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò
        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                showQuestion();
                updateLearningProgress();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion();
                updateLearningProgress();
            }
        }

        function updateLearningProgress() {
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('learning-progress-bar').style.width = progress + '%';
            document.getElementById('learning-progress-text').textContent = `Î¨∏Ï†ú ${currentQuestionIndex + 1} / ${questions.length}`;
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const submitBtn = document.getElementById('submit-btn');

            prevBtn.disabled = currentQuestionIndex === 0;

            if (currentQuestionIndex === questions.length - 1) {
                nextBtn.style.display = 'none';
                submitBtn.style.display = 'block';
                submitBtn.disabled = userAnswers[currentQuestionIndex] === undefined;
            } else {
                nextBtn.style.display = 'block';
                submitBtn.style.display = 'none';
                nextBtn.disabled = userAnswers[currentQuestionIndex] === undefined;
            }
        }

        // ÎãµÏïà Ï†úÏ∂ú
        function submitAnswers() {
            let correctCount = 0;
            questions.forEach((question, index) => {
                if (userAnswers[index] === question.correct) correctCount++;
            });

            const score = Math.round((correctCount / questions.length) * 100);

            if (score >= 70) {
                bookData.chapterList[currentChapterIndex].status = 'completed';
                if (currentChapterIndex < bookData.chapterList.length - 1) {
                    bookData.chapterList[currentChapterIndex + 1].status = 'current';
                }
            }

            showResults(correctCount, questions.length, score);
        }

        // Í≤∞Í≥º ÌëúÏãú
        function showResults(correct, total, score) {
            document.getElementById('learning-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';

            document.getElementById('score-circle').textContent = score + '%';
            document.getElementById('total-questions').textContent = total + 'Î¨∏Ï†ú';
            document.getElementById('correct-answers').textContent = correct + 'Î¨∏Ï†ú';
            document.getElementById('wrong-answers').textContent = (total - correct) + 'Î¨∏Ï†ú';
            document.getElementById('final-score').textContent = score + 'Ï†ê';

            let message = '';
            if (score >= 90) message = 'ÌõåÎ•≠Ìï©ÎãàÎã§! üåü';
            else if (score >= 80) message = 'ÏûòÌñàÏñ¥Ïöî! üëè';
            else if (score >= 70) message = 'Ï¢ãÏïÑÏöî! üëç';
            else message = 'Îã§Ïãú ÌïúÎ≤à ÎèÑÏ†ÑÌï¥Î≥¥ÏÑ∏Ïöî! üí™';

            document.getElementById('result-message').textContent = message;
        }

        function retryChapter() {
            startLearning(currentChapterIndex);
        }

        function nextChapter() {
            if (currentChapterIndex < bookData.chapterList.length - 1) {
                startLearning(currentChapterIndex + 1);
            } else {
                alert('Î™®Îì† Ï±ïÌÑ∞Î•º ÏôÑÎ£åÌñàÏäµÎãàÎã§! üéâ');
                showBookDetail();
            }
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú
        window.addEventListener('load', function() {
            showBookDetail();
            console.log('üéØ Sarah, Plain and Tall ÌïôÏäµ ÏãúÏä§ÌÖúÏù¥ Ï§ÄÎπÑÎêòÏóàÏäµÎãàÎã§!');
        });

        // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠Ïãú Îã´Í∏∞
        document.getElementById('audio-modal').addEventListener('click', function(e) {
            if (e.target === this) closeAudioModal();
        });
    </script>
</body>
</html>
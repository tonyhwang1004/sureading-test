<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twister on Tuesday - Level 4 - ÏàòÎ¶¨Îî©Ïñ¥ÌïôÏõê</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #8B4513 0%, #DAA520 50%, #F0E68C 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        /* Ìó§Îçî */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #8B4513, #DAA520);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .logo-text h1 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
        }

        .logo-text p {
            font-size: 0.9rem;
            color: #666;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
            color: #333;
            text-decoration: none;
        }

        .nav-btn:hover {
            background: #8B4513;
            color: white;
            transform: translateY(-2px);
        }

        /* Î©îÏù∏ ÏΩòÌÖêÏ∏† ÏòÅÏó≠ */
        .main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            min-height: 600px;
        }

        /* Ï±Ö ÏÉÅÏÑ∏ ÌôîÎ©¥ */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 30px;
            font-size: 0.9rem;
            color: #666;
        }

        .breadcrumb a {
            color: #8B4513;
            text-decoration: none;
            cursor: pointer;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .book-detail-header {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: flex-start;
        }

        .detail-book-cover {
            width: 150px;
            height: 220px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 4rem;
            font-weight: bold;
            flex-shrink: 0;
            background: linear-gradient(45deg, #8B4513, #DAA520);
        }

        .book-info {
            flex: 1;
        }

        .book-info h2 {
            font-size: 2.2rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .book-info .author {
            font-size: 1.2rem;
            color: #8B4513;
            margin-bottom: 20px;
        }

        .book-summary {
            font-size: 1rem;
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .book-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-box .value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #8B4513;
        }

        .stat-box .label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        /* Ï±ïÌÑ∞ Í∑∏Î¶¨Îìú */
        .chapters-section {
            margin-top: 40px;
        }

        .chapters-section h3 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 30px;
            text-align: center;
        }

        .chapters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .chapter-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
        }

        .chapter-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .chapter-card.completed {
            border-color: #28a745;
            background: linear-gradient(135deg, #28a74508, #ffffff);
        }

        .chapter-card.current {
            border-color: #8B4513;
            background: linear-gradient(135deg, #8B451308, #ffffff);
        }

        .chapter-card.locked {
            opacity: 0.6;
            background: #f8f9fa;
        }

        .chapter-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .chapter-info h4 {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }

        .chapter-info p {
            font-size: 0.95rem;
            color: #666;
            line-height: 1.5;
        }

        .chapter-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .chapter-status.completed {
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
        }

        .chapter-status.current {
            background: rgba(139, 69, 19, 0.1);
            color: #8B4513;
        }

        .chapter-status.locked {
            background: rgba(108, 117, 125, 0.1);
            color: #6c757d;
        }

        .chapter-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .chapter-btn {
            padding: 12px 16px;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .audio-btn {
            background: linear-gradient(45deg, #8B4513, #DAA520);
            color: white;
        }

        .quiz-btn {
            background: linear-gradient(45deg, #DAA520, #F0E68C);
            color: #333;
        }

        .chapter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .chapter-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* ÌïôÏäµ ÌôîÎ©¥ */
        .learning-screen {
            display: none;
        }

        .learning-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .learning-progress {
            background: #f8f9fa;
            border-radius: 10px;
            height: 8px;
            margin: 20px 0;
            overflow: hidden;
        }

        .learning-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #8B4513, #DAA520);
            transition: width 0.3s ease;
        }

        .question-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
        }

        .passage {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1rem;
            line-height: 1.6;
            color: #444;
        }

        .options {
            display: grid;
            gap: 10px;
        }

        .option {
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option:hover {
            background: #e9ecef;
            border-color: #8B4513;
        }

        .option.selected {
            background: rgba(139, 69, 19, 0.1);
            border-color: #8B4513;
        }

        .learning-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .control-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .next-btn {
            background: linear-gradient(45deg, #8B4513, #DAA520);
            color: white;
        }

        .prev-btn {
            background: #6c757d;
            color: white;
        }

        .submit-btn {
            background: linear-gradient(45deg, #8B4513, #DAA520);
            color: white;
        }

        .control-btn:hover {
            transform: translateY(-2px);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Í≤∞Í≥º ÌôîÎ©¥ */
        .result-screen {
            display: none;
            text-align: center;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(45deg, #8B4513, #DAA520);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            font-size: 2rem;
            font-weight: bold;
        }

        .result-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .result-stat {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .result-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        /* Ïò§ÎîîÏò§ ÌîåÎ†àÏù¥Ïñ¥ Î™®Îã¨ */
        .audio-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .audio-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 600px;
            width: 90%;
            position: relative;
        }

        .close-audio {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #666;
        }

        .audio-player {
            width: 100%;
            margin: 20px 0;
            border-radius: 10px;
        }

        .audio-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .audio-control-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .play-pause-btn {
            background: linear-gradient(45deg, #8B4513, #DAA520);
            color: white;
        }

        .speed-btn {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #ddd;
        }

        .download-btn {
            background: #DAA520;
            color: white;
        }

        .audio-info {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            font-size: 0.9rem;
            color: #666;
            transition: all 0.3s ease;
        }

        .audio-info.hidden {
            display: none;
        }

        /* Î∞òÏùëÌòï */
        @media (max-width: 768px) {
            .chapters-grid {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .book-detail-header {
                flex-direction: column;
                text-align: center;
            }

            .book-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .learning-controls {
                flex-direction: column;
            }

            .chapter-actions {
                grid-template-columns: 1fr;
            }

            .audio-controls {
                justify-content: center;
                gap: 10px;
            }

            .audio-content {
                padding: 30px 20px;
            }
        }

        .new-book-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: linear-gradient(45deg, #FF6B9D, #C44569);
            color: white;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: 700;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Level 4 ÌäπÎ≥Ñ Ïä§ÌÉÄÏùº */
        .level-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: linear-gradient(45deg, #8B4513, #FF6B9D);
            color: white;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ìó§Îçî -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">üå™Ô∏è</div>
                <div class="logo-text">
                    <h1>Twister on Tuesday</h1>
                    <p>Level 4 - Mary Pope OsborneÏùò Îß§ÏßÅ Ìä∏Î¶¨ ÌïòÏö∞Ïä§ 23Í∂å</p>
                </div>
            </div>
            <div class="nav-buttons">
                <a href="http://www.suelibrary.store/" class="nav-btn">Î©îÏù∏ÏúºÎ°ú</a>
            </div>
        </div>

        <!-- Î©îÏù∏ ÏΩòÌÖêÏ∏† -->
        <div class="main-content">
            <!-- Ï±Ö ÏÉÅÏÑ∏ ÌôîÎ©¥ -->
            <div class="book-detail-screen" id="book-detail-screen">
                <div class="level-badge">Level 4</div>
                <div class="breadcrumb">
                    <span>Twister on Tuesday</span>
                </div>

                <div class="book-detail-header">
                    <div class="detail-book-cover">üå™Ô∏è</div>
                    <div class="book-info">
                        <h2>Twister on Tuesday</h2>
                        <div class="author">Mary Pope Osborne</div>
                        <div class="book-summary">
                            Jack and Annie are whisked back to the American frontier in the 1870s! They find themselves on the Kansas prairie just as a massive tornado is approaching. With the help of a brave schoolteacher and her students, they must take shelter and learn about the power of nature and the strength of communities during difficult times.
                        </div>
                        <div class="book-stats">
                            <div class="stat-box">
                                <div class="value">10</div>
                                <div class="label">Ï±ïÌÑ∞</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">50</div>
                                <div class="label">Ï¥ù Î¨∏Ï†ú</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">Level 4</div>
                                <div class="label">Î†àÎ≤®</div>
                            </div>
                            <div class="stat-box">
                                <div class="value" id="progress-value">0%</div>
                                <div class="label">ÏßÑÎèÑ</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="chapters-section">
                    <h3>üå™Ô∏è Ï±ïÌÑ∞Î≥Ñ ÌïôÏäµ</h3>
                    <div class="chapters-grid" id="chapters-grid">
                        <!-- Ï±ïÌÑ∞ Ïπ¥ÎìúÎì§ -->
                    </div>
                </div>
            </div>

            <!-- ÌïôÏäµ ÌôîÎ©¥ -->
            <div class="learning-screen" id="learning-screen">
                <div class="breadcrumb">
                    <a onclick="showBookDetail()">Twister on Tuesday</a>
                    <span>></span>
                    <span id="learning-chapter-breadcrumb">Chapter 1</span>
                </div>

                <div class="learning-header">
                    <h2 id="learning-title">Chapter 1: The One-Room Schoolhouse</h2>
                    <div class="learning-progress">
                        <div class="learning-progress-bar" id="learning-progress-bar" style="width: 0%"></div>
                    </div>
                    <p id="learning-progress-text">Î¨∏Ï†ú 1 / 5</p>
                </div>

                <div class="question-container" id="question-container">
                    <!-- Î¨∏Ï†úÍ∞Ä ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
                </div>

                <div class="learning-controls">
                    <button class="control-btn prev-btn" id="prev-btn" onclick="previousQuestion()" disabled>Ïù¥Ï†Ñ</button>
                    <button class="control-btn next-btn" id="next-btn" onclick="nextQuestion()">Îã§Ïùå</button>
                    <button class="control-btn submit-btn" id="submit-btn" onclick="submitAnswers()" style="display: none;">Ï†úÏ∂ú</button>
                </div>
            </div>

            <!-- Í≤∞Í≥º ÌôîÎ©¥ -->
            <div class="result-screen" id="result-screen">
                <div class="breadcrumb">
                    <a onclick="showBookDetail()">Twister on Tuesday</a>
                    <span>></span>
                    <span>Í≤∞Í≥º</span>
                </div>

                <div class="result-header">
                    <h2>üéâ ÌïôÏäµ ÏôÑÎ£å!</h2>
                    <div class="score-circle" id="score-circle">100%</div>
                    <h3 id="result-message">ÌõåÎ•≠Ìï©ÎãàÎã§!</h3>
                </div>

                <div class="result-details">
                    <div class="result-stat">
                        <h4>Ï¥ù Î¨∏Ï†ú</h4>
                        <p id="total-questions">5Î¨∏Ï†ú</p>
                    </div>
                    <div class="result-stat">
                        <h4>Ï†ïÎãµ</h4>
                        <p id="correct-answers">5Î¨∏Ï†ú</p>
                    </div>
                    <div class="result-stat">
                        <h4>Ïò§Îãµ</h4>
                        <p id="wrong-answers">0Î¨∏Ï†ú</p>
                    </div>
                    <div class="result-stat">
                        <h4>Ï†êÏàò</h4>
                        <p id="final-score">100Ï†ê</p>
                    </div>
                </div>

                <div class="result-actions">
                    <button class="control-btn prev-btn" onclick="retryChapter()">Îã§Ïãú ÌíÄÍ∏∞</button>
                    <button class="control-btn next-btn" onclick="nextChapter()">Îã§Ïùå Ï±ïÌÑ∞</button>
                    <button class="control-btn submit-btn" onclick="showBookDetail()">Ï±ïÌÑ∞ Î™©Î°ù</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ïò§ÎîîÏò§ ÌîåÎ†àÏù¥Ïñ¥ Î™®Îã¨ -->
    <div class="audio-modal" id="audio-modal">
        <div class="audio-content">
            <button class="close-audio" onclick="closeAudioModal()">√ó</button>
            <h3 id="audio-chapter-title">Chapter 1: The One-Room Schoolhouse</h3>
            <p id="audio-chapter-subtitle">Twister on Tuesday - Mary Pope Osborne</p>

            <audio class="audio-player" id="audio-player" controls preload="metadata">
                <source id="audio-source" src="" type="audio/mpeg">
                Î∏åÎùºÏö∞Ï†ÄÍ∞Ä Ïò§ÎîîÏò§Î•º ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.
            </audio>

            <div class="audio-controls">
                <button class="audio-control-btn play-pause-btn" onclick="togglePlayPause()">‚ñ∂Ô∏è Ïû¨ÏÉù</button>
                <button class="audio-control-btn speed-btn" onclick="changeSpeed()">1.0x</button>
                <button class="audio-control-btn" onclick="resetToChapterStart()" style="background: #28a745; color: white;">üîÑ Íµ¨Í∞ÑÏ≤òÏùå</button>
                <button class="audio-control-btn download-btn" onclick="downloadAudio()">üì• Îã§Ïö¥Î°úÎìú</button>
            </div>

            <div class="audio-info" id="audio-info">
                <div id="audio-status" style="margin-top: 10px; font-weight: bold; color: #8B4513;"></div>
            </div>
        </div>
    </div>

    <script>
        // üéØ Íµ¨Í∏Ä ÌÅ¥ÎùºÏö∞Îìú Ïä§ÌÜ†Î¶¨ÏßÄ Ïò§ÎîîÏò§ URL ÏÑ§Ï†ï
        const AUDIO_BASE_URL = 'https://storage.googleapis.com/kim-mom-reading-audio/audio/';

        // Magic Tree House 23Í∂å ÎèÑÏÑú Îç∞Ïù¥ÌÑ∞ (10Ï±ïÌÑ∞)
        const bookData = {
            id: 'MTH023',
            title: "Twister on Tuesday",
            author: 'Mary Pope Osborne',
            cover: 'üå™Ô∏è',
            progress: 0,
            chapters: 10,
            totalQuestions: 50,
            coverColor: 'linear-gradient(45deg, #8B4513, #DAA520)',
            summary: "Jack and Annie are whisked back to the American frontier in the 1870s! They find themselves on the Kansas prairie just as a massive tornado is approaching. With the help of a brave schoolteacher and her students, they must take shelter and learn about the power of nature and the strength of communities during difficult times.",
            chapterList: [
                { title: 'The One-Room Schoolhouse', description: 'Jack and Annie arrive at a frontier schoolhouse on the Kansas prairie.', status: 'current', questionCount: 5, startTime: 0 },
                { title: 'The Storm Clouds Gather', description: 'Dark storm clouds begin forming on the horizon, signaling danger.', status: 'locked', questionCount: 5, startTime: 300 },
                { title: 'Miss Neely', description: 'They meet the brave schoolteacher who protects her students.', status: 'locked', questionCount: 5, startTime: 600 },
                { title: 'The Warning Signs', description: 'Learning to recognize the signs of an approaching tornado.', status: 'locked', questionCount: 5, startTime: 900 },
                { title: 'Into the Storm Cellar', description: 'Taking shelter underground as the tornado approaches.', status: 'locked', questionCount: 5, startTime: 1200 },
                { title: 'The Twister Strikes', description: 'The massive tornado passes directly overhead.', status: 'locked', questionCount: 5, startTime: 1500 },
                { title: 'After the Storm', description: 'Emerging from the cellar to see the tornado\'s destruction.', status: 'locked', questionCount: 5, startTime: 1800 },
                { title: 'Helping Hands', description: 'The community comes together to help those in need.', status: 'locked', questionCount: 5, startTime: 2100 },
                { title: 'The School Bell Rings', description: 'Despite the damage, the school continues its important mission.', status: 'locked', questionCount: 5, startTime: 2400 },
                { title: 'Home to Frog Creek', description: 'Returning home with lessons about courage and community.', status: 'locked', questionCount: 5, startTime: 2700 }
            ]
        };

        // Î¨∏Ï†ú Îç∞Ïù¥ÌÑ∞ (Ï†ÑÏ≤¥ 10Ï±ïÌÑ∞ ÏôÑÎ£å)
        const questionsData = {
            0: [ // Chapter 1: The One-Room Schoolhouse
                {
                    passage: "Jack and Annie found themselves standing in front of a small wooden building on the endless Kansas prairie in the 1870s, with children's voices coming from inside.",
                    question: "Where did Jack and Annie arrive and what did they hear?",
                    options: ["A big city school with traffic noises", "Small wooden building on Kansas prairie with children's voices", "A farmhouse with animal sounds", "A train station with whistle sounds"],
                    correct: 1
                },
                {
                    passage: "The one-room schoolhouse had rows of wooden desks and a blackboard at the front, where children of different ages were learning together under one teacher.",
                    question: "What was special about the schoolhouse they discovered?",
                    options: ["It had separate rooms for each grade", "One-room schoolhouse with different ages learning together under one teacher", "It was made of brick and very large", "It only taught older students"],
                    correct: 1
                },
                {
                    passage: "Through the windows, Jack could see the vast prairie stretching endlessly in all directions, with tall grass waving in the wind like an ocean.",
                    question: "What did Jack see when he looked out the windows?",
                    options: ["Mountains and forests", "Vast prairie stretching endlessly with tall grass waving like an ocean", "Other buildings and houses", "Rivers and lakes"],
                    correct: 1
                },
                {
                    passage: "Annie noticed that the sky was starting to look strange, with dark clouds forming on the distant horizon that seemed different from normal storm clouds.",
                    question: "What did Annie notice about the sky?",
                    options: ["It was perfectly clear and sunny", "Strange dark clouds forming on horizon, different from normal storm clouds", "Rainbow colors everywhere", "Snow clouds gathering"],
                    correct: 1
                },
                {
                    passage: "The children inside were dressed in simple frontier clothing, and Jack and Annie realized they had traveled back to a time when life on the prairie was both challenging and dangerous.",
                    question: "What did Jack and Annie realize about the time period?",
                    options: ["They were in modern times", "They had traveled back to challenging and dangerous prairie frontier times", "They were in the future", "They were in a big city setting"],
                    correct: 1
                }
            ],
            1: [ // Chapter 2: The Storm Clouds Gather
                {
                    passage: "The dark clouds on the horizon began to grow larger and more ominous, swirling in ways that made Jack and Annie feel uneasy about what was coming.",
                    question: "How did the storm clouds change and how did Jack and Annie feel?",
                    options: ["Clouds stayed the same, they felt happy", "Dark clouds grew larger and more ominous, swirling, making them feel uneasy", "Clouds disappeared completely", "Clouds turned white and fluffy"],
                    correct: 1
                },
                {
                    passage: "The wind began to pick up across the prairie, making the tall grass bend and sway more violently, and carrying an strange, electric feeling in the air.",
                    question: "What changes did they notice in the wind and air?",
                    options: ["Wind stopped completely", "Wind picked up, grass swayed violently, strange electric feeling in air", "Gentle breeze with sweet smells", "Cold air with snow"],
                    correct: 1
                },
                {
                    passage: "Inside the schoolhouse, some of the children started looking worried as they glanced toward the windows and saw the approaching storm clouds.",
                    question: "How did the children in the schoolhouse react to the approaching storm?",
                    options: ["They continued playing happily", "Some children started looking worried, glancing toward windows at storm clouds", "They all fell asleep", "They started singing loudly"],
                    correct: 1
                },
                {
                    passage: "Jack remembered reading about prairie storms and how they could be much more dangerous than storms in other places because there was nowhere to hide on the flat land.",
                    question: "What did Jack remember about prairie storms?",
                    options: ["They were always gentle and safe", "They could be more dangerous than other storms because nowhere to hide on flat land", "They only happened at night", "They brought good luck"],
                    correct: 1
                },
                {
                    passage: "The temperature began to drop suddenly, and both Jack and Annie could sense that this was not going to be an ordinary storm.",
                    question: "What other signs indicated this would not be an ordinary storm?",
                    options: ["Temperature got warmer", "Temperature dropped suddenly, they sensed this was not ordinary storm", "Everything stayed exactly the same", "It started raining gently"],
                    correct: 1
                }
            ],
            2: [ // Chapter 3: Miss Neely
                {
                    passage: "The schoolteacher, Miss Neely, was a young woman with kind but alert eyes who immediately noticed the changing weather and began preparing her students.",
                    question: "Who was Miss Neely and what did she do when she noticed the weather?",
                    options: ["An old man who ignored the weather", "Young woman with kind but alert eyes who began preparing her students", "A student who was scared", "A farmer who left immediately"],
                    correct: 1
                },
                {
                    passage: "Miss Neely had lived on the prairie for several years and knew how to read the signs of dangerous weather that could threaten her students' safety.",
                    question: "Why was Miss Neely able to recognize dangerous weather signs?",
                    options: ["She was new to the area", "She had lived on prairie for several years and knew how to read weather signs", "She had never seen storms before", "She only taught indoors"],
                    correct: 1
                },
                {
                    passage: "When Jack and Annie approached the schoolhouse, Miss Neely welcomed them inside but kept glancing nervously at the darkening sky.",
                    question: "How did Miss Neely react when Jack and Annie approached?",
                    options: ["She told them to go away", "She welcomed them inside but kept glancing nervously at darkening sky", "She ignored them completely", "She ran away in fear"],
                    correct: 1
                },
                {
                    passage: "Miss Neely explained to her students that they needed to stay calm and follow her instructions carefully because prairie storms could be very dangerous.",
                    question: "What did Miss Neely tell her students about the situation?",
                    options: ["Nothing was wrong", "They needed to stay calm and follow instructions because prairie storms could be dangerous", "School was dismissed early for fun", "They should run home immediately"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie were impressed by how Miss Neely remained brave and composed even though they could see she was worried about protecting all the children.",
                    question: "What impressed Jack and Annie about Miss Neely?",
                    options: ["She seemed scared and panicked", "She remained brave and composed even though worried about protecting children", "She didn't care about the students", "She was very young and inexperienced"],
                    correct: 1
                }
            ],
            3: [ // Chapter 4: The Warning Signs
                {
                    passage: "Miss Neely taught Jack, Annie, and the students how to recognize tornado warning signs: a greenish sky, large hail, and an eerie silence before the wind.",
                    question: "What tornado warning signs did Miss Neely teach them to recognize?",
                    options: ["Blue sky and gentle rain", "Greenish sky, large hail, and eerie silence before the wind", "Red sky and snow", "Normal clouds and sunshine"],
                    correct: 1
                },
                {
                    passage: "The sky began to take on that strange greenish color that Miss Neely had described, and the air became unnaturally still and quiet.",
                    question: "What changes confirmed Miss Neely's tornado warnings were accurate?",
                    options: ["Sky turned bright blue", "Sky took on strange greenish color, air became unnaturally still and quiet", "Heavy rain started", "Sun came out brightly"],
                    correct: 1
                },
                {
                    passage: "Suddenly, hailstones the size of marbles began pelting the roof of the schoolhouse, making loud drumming sounds that frightened some of the younger children.",
                    question: "What happened that frightened some of the younger children?",
                    options: ["A bird flew into the window", "Hailstones size of marbles began pelting roof, making loud drumming sounds", "Someone knocked on the door", "The lights went out"],
                    correct: 1
                },
                {
                    passage: "Miss Neely explained that the hail meant the storm was getting stronger and that they needed to prepare for the possibility of taking shelter immediately.",
                    question: "What did Miss Neely say the hail meant for their situation?",
                    options: ["The storm was ending", "Hail meant storm was getting stronger, they needed to prepare for shelter immediately", "It was safe to go outside", "Nothing to worry about"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie learned that on the prairie, people had to be constantly aware of weather changes because storms could develop very quickly and become deadly.",
                    question: "What important lesson did Jack and Annie learn about prairie life?",
                    options: ["Weather was always predictable", "People had to be constantly aware of weather changes because storms could develop quickly and become deadly", "Storms were never dangerous", "Weather didn't matter on the prairie"],
                    correct: 1
                }
            ],
            4: [ // Chapter 5: Into the Storm Cellar
                {
                    passage: "Miss Neely quickly led all the children to a wooden door in the floor that opened to reveal a small underground storm cellar dug beneath the schoolhouse.",
                    question: "Where did Miss Neely lead the children for safety?",
                    options: ["To the attic above", "To wooden door in floor revealing underground storm cellar beneath schoolhouse", "Outside to run away", "To a nearby barn"],
                    correct: 1
                },
                {
                    passage: "The storm cellar was dark, cramped, and smelled of earth, but it was the safest place to be when a tornado was approaching the area.",
                    question: "What was the storm cellar like and why was it important?",
                    options: ["Bright and spacious", "Dark, cramped, smelled of earth, but safest place when tornado approaching", "Comfortable with furniture", "Above ground with windows"],
                    correct: 1
                },
                {
                    passage: "All the children huddled together in the small space while Miss Neely counted to make sure everyone was safely inside before closing the heavy door above them.",
                    question: "What did everyone do once they were in the storm cellar?",
                    options: ["Spread out in different areas", "Huddled together while Miss Neely counted to ensure everyone safely inside", "Tried to leave immediately", "Started playing games"],
                    correct: 1
                },
                {
                    passage: "Above them, they could hear the wind beginning to roar like a freight train, which Miss Neely said was the sound of a tornado getting very close.",
                    question: "What sound did they hear above them and what did it mean?",
                    options: ["Gentle rain falling", "Wind roaring like freight train, which Miss Neely said meant tornado getting very close", "Birds singing", "Complete silence"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie were amazed by how the simple storm cellar, though uncomfortable, provided life-saving protection from the dangerous tornado above.",
                    question: "What did Jack and Annie realize about the storm cellar?",
                    options: ["It was completely useless", "Though uncomfortable, it provided life-saving protection from dangerous tornado above", "It was just for storage", "It was too dangerous to use"],
                    correct: 1
                }
            ],
            5: [ // Chapter 6: The Twister Strikes
                {
                    passage: "The tornado passed directly overhead with a deafening roar that sounded like a hundred freight trains, making the earth shake and the cellar walls tremble.",
                    question: "What was it like when the tornado passed directly overhead?",
                    options: ["Quiet and peaceful", "Deafening roar like hundred freight trains, earth shook, cellar walls trembled", "Gentle breeze", "Light rain"],
                    correct: 1
                },
                {
                    passage: "The children held hands and tried to stay calm while debris from the tornado crashed and banged on the cellar door above them.",
                    question: "How did the children cope with the tornado overhead?",
                    options: ["They screamed and panicked", "Held hands and tried to stay calm while debris crashed on cellar door", "They slept through it", "They tried to go outside"],
                    correct: 1
                },
                {
                    passage: "Miss Neely calmly told stories and led songs to keep the children's minds off the terrifying sounds of the tornado destroying everything above ground.",
                    question: "How did Miss Neely help the children during the tornado?",
                    options: ["She cried and worried loudly", "Calmly told stories and led songs to keep minds off terrifying tornado sounds", "She left them alone", "She shouted at them to be quiet"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie could hardly believe the incredible power of the tornado as it seemed to lift and move heavy objects like they were toys.",
                    question: "What amazed Jack and Annie about the tornado's power?",
                    options: ["It seemed very weak", "Incredible power seemed to lift and move heavy objects like they were toys", "It only moved small things", "It had no effect on anything"],
                    correct: 1
                },
                {
                    passage: "After what felt like hours but was probably only minutes, the terrible roaring sound began to fade as the tornado moved away from the schoolhouse.",
                    question: "How did they know the tornado was moving away?",
                    options: ["The noise got louder", "Terrible roaring sound began to fade as tornado moved away from schoolhouse", "Nothing changed", "It started raining harder"],
                    correct: 1
                }
            ],
            6: [ // Chapter 7: After the Storm
                {
                    passage: "When they finally emerged from the storm cellar, Jack and Annie were shocked to see that the tornado had completely destroyed several buildings and scattered debris everywhere.",
                    question: "What did Jack and Annie see when they emerged from the cellar?",
                    options: ["Everything looked exactly the same", "Tornado had completely destroyed several buildings and scattered debris everywhere", "New buildings had appeared", "Everything was cleaner than before"],
                    correct: 1
                },
                {
                    passage: "The schoolhouse had lost its roof and most of its walls, but amazingly, the storm cellar had protected everyone from serious injury.",
                    question: "What happened to the schoolhouse and how were the people?",
                    options: ["Schoolhouse was completely untouched", "Schoolhouse lost roof and walls, but storm cellar protected everyone from serious injury", "Everyone was badly hurt", "The cellar was destroyed"],
                    correct: 1
                },
                {
                    passage: "Miss Neely immediately began checking on each child to make sure no one was hurt, showing the same calm leadership she had displayed during the storm.",
                    question: "What did Miss Neely do first after the tornado passed?",
                    options: ["She ran away in fear", "Immediately began checking on each child to ensure no one was hurt", "She started crying", "She ignored the children"],
                    correct: 1
                },
                {
                    passage: "The prairie landscape had been completely changed by the tornado, with some areas stripped bare while others were covered with debris from far away.",
                    question: "How had the tornado changed the prairie landscape?",
                    options: ["It looked exactly the same", "Completely changed - some areas stripped bare, others covered with debris from far away", "Only small changes", "More beautiful than before"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie realized that while the tornado had been destructive, the people's preparation and quick action had saved many lives.",
                    question: "What important realization did Jack and Annie have about the disaster?",
                    options: ["Preparation was useless", "While tornado was destructive, people's preparation and quick action saved many lives", "Nothing could help in tornados", "Tornados weren't really dangerous"],
                    correct: 1
                }
            ],
            7: [ // Chapter 8: Helping Hands
                {
                    passage: "Neighbors from nearby farms quickly arrived to help search for survivors and begin cleaning up the damage caused by the powerful tornado.",
                    question: "Who came to help after the tornado and what did they do?",
                    options: ["No one came to help", "Neighbors from nearby farms quickly arrived to help search for survivors and clean up", "Only government officials", "People from far away cities"],
                    correct: 1
                },
                {
                    passage: "The community worked together to share food, clothing, and shelter with families whose homes had been destroyed by the twister.",
                    question: "How did the community help families affected by the tornado?",
                    options: ["Everyone only helped themselves", "Community worked together to share food, clothing, and shelter with affected families", "They charged money for help", "They waited for outside assistance"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie joined in helping to gather scattered belongings and debris, learning about the importance of neighbors helping each other in times of crisis.",
                    question: "What did Jack and Annie do to help and what did they learn?",
                    options: ["They just watched others work", "Joined in gathering scattered belongings, learned importance of neighbors helping in crisis", "They complained about the work", "They tried to leave immediately"],
                    correct: 1
                },
                {
                    passage: "Miss Neely organized the older students to help comfort the younger children and assist with the cleanup efforts around the destroyed schoolhouse.",
                    question: "How did Miss Neely organize help after the disaster?",
                    options: ["She did everything herself", "Organized older students to comfort younger children and assist with cleanup efforts", "She gave up and left", "She only worried about herself"],
                    correct: 1
                },
                {
                    passage: "Despite losing almost everything, the prairie families remained hopeful and determined to rebuild their community stronger than before.",
                    question: "What was remarkable about the prairie families' attitude after the disaster?",
                    options: ["They gave up completely", "Despite losing almost everything, remained hopeful and determined to rebuild stronger", "They were angry and bitter", "They decided to move away"],
                    correct: 1
                }
            ],
            8: [ // Chapter 9: The School Bell Rings
                {
                    passage: "Even though the schoolhouse was badly damaged, Miss Neely found the school bell in the debris and rang it to call the children together.",
                    question: "What did Miss Neely do with the school bell after finding it in the debris?",
                    options: ["She threw it away", "Found school bell in debris and rang it to call children together", "She sold it for money", "She kept it hidden"],
                    correct: 1
                },
                {
                    passage: "Miss Neely announced that school would continue, even if they had to meet outdoors, because education was too important to stop.",
                    question: "What did Miss Neely announce about school after the tornado?",
                    options: ["School was permanently closed", "School would continue, even outdoors, because education was too important to stop", "School would wait until next year", "Only some students could return"],
                    correct: 1
                },
                {
                    passage: "The children and their families worked together to set up a temporary outdoor classroom using salvaged desks and benches from the wreckage.",
                    question: "How did they solve the problem of having no schoolhouse?",
                    options: ["They gave up on school", "Children and families worked together to set up temporary outdoor classroom using salvaged furniture", "They waited for a new building", "They moved to another town"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie were inspired by how the community refused to let the tornado stop the children's education and their hope for the future.",
                    question: "What inspired Jack and Annie about the community's response?",
                    options: ["How quickly they forgot about school", "How community refused to let tornado stop children's education and hope for future", "How they gave up easily", "How they blamed each other"],
                    correct: 1
                },
                {
                    passage: "The sound of the school bell ringing again across the prairie was a symbol that life would go on and the community would survive and thrive.",
                    question: "What did the school bell ringing symbolize for the community?",
                    options: ["That the tornado was returning", "That life would go on and community would survive and thrive", "That school was ending forever", "That everyone should leave"],
                    correct: 1
                }
            ],
            9: [ // Chapter 10: Home to Frog Creek
                {
                    passage: "As Jack and Annie prepared to leave, they reflected on how they had witnessed both the destructive power of nature and the strength of human communities.",
                    question: "What did Jack and Annie reflect on as they prepared to leave?",
                    options: ["Only the destruction they saw", "They witnessed both destructive power of nature and strength of human communities", "How boring the adventure was", "How scared they had been"],
                    correct: 1
                },
                {
                    passage: "Miss Neely thanked Jack and Annie for their help and told them that courage isn't about not being afraid, but about doing what's right despite fear.",
                    question: "What important lesson about courage did Miss Neely teach Jack and Annie?",
                    options: ["Courage means never being afraid", "Courage isn't about not being afraid, but doing what's right despite fear", "Courage is only for adults", "Courage means running away"],
                    correct: 1
                },
                {
                    passage: "The children waved goodbye and promised to remember Jack and Annie's kindness during their community's difficult time.",
                    question: "How did the children say goodbye to Jack and Annie?",
                    options: ["They ignored them", "Waved goodbye and promised to remember their kindness during difficult time", "They were angry at them", "They asked them to stay forever"],
                    correct: 1
                },
                {
                    passage: "Back at the tree house, Jack and Annie understood that they had learned valuable lessons about facing natural disasters and the importance of community support.",
                    question: "What valuable lessons did Jack and Annie learn from their adventure?",
                    options: ["How to predict the weather", "Lessons about facing natural disasters and importance of community support", "How to build houses", "How to become teachers"],
                    correct: 1
                },
                {
                    passage: "As they returned to Frog Creek, Jack and Annie felt grateful for their own safe home and the strong community that surrounded them.",
                    question: "How did Jack and Annie feel when they returned to Frog Creek?",
                    options: ["Sad and disappointed", "Grateful for their safe home and strong community that surrounded them", "Worried about more adventures", "Uninterested in their own home"],
                    correct: 1
                }
            ]
        };

        // Ï†ÑÏó≠ Î≥ÄÏàò
        let currentChapterIndex = 0;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let questions = [];
        let currentAudio = null;
        let playbackSpeed = 1.0;

        // üéß ÏûêÎèô Ïò§ÎîîÏò§ URL ÏÉùÏÑ± Ìï®Ïàò
        function getAudioUrl(chapterIndex) {
            const level = 'level4';
            const bookId = 'MTH023';
            const chapterNum = String(chapterIndex + 1).padStart(2, '0');
            
            const possibleFileNames = [
                `${bookId}_chapter${chapterNum}.mp3`,
                `${bookId}_ch${chapterNum}.mp3`,
                `${bookId}_${chapterNum}.mp3`,
                `magic_tree_house_23_chapter${chapterNum}.mp3`,
                `magic_tree_house_23_ch${chapterNum}.mp3`,
                `twister_on_tuesday_${chapterNum}.mp3`,
                `mary_pope_osborne_23_chapter${chapterNum}.mp3`,
                `${bookId}.mp3`
            ];
            
            return {
                primary: `${AUDIO_BASE_URL}${level}/${possibleFileNames[0]}`,
                alternatives: possibleFileNames.map(fileName => `${AUDIO_BASE_URL}${level}/${fileName}`)
            };
        }

        // üéß Ïò§ÎîîÏò§ Ïû¨ÏÉù Ìï®Ïàò
        function playChapterAudio(chapterIndex) {
            const chapter = bookData.chapterList[chapterIndex];
            const audioUrls = getAudioUrl(chapterIndex);

            document.getElementById('audio-modal').style.display = 'flex';
            document.getElementById('audio-chapter-title').textContent = `Chapter ${chapterIndex + 1}: ${chapter.title}`;
            document.getElementById('audio-chapter-subtitle').textContent = `${bookData.title} - ${bookData.author}`;

            document.getElementById('audio-info').classList.remove('hidden');

            const audioPlayer = document.getElementById('audio-player');
            const audioSource = document.getElementById('audio-source');
            const audioStatus = document.getElementById('audio-status');

            audioStatus.textContent = 'üîÑ Ïò§ÎîîÏò§ ÌååÏùºÏùÑ Ï∞æÎäî Ï§ë...';

            function tryLoadAudio(urlIndex = 0) {
                if (urlIndex >= audioUrls.alternatives.length) {
                    audioStatus.innerHTML = `‚ùå Ïò§ÎîîÏò§ ÌååÏùºÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.`;
                    return;
                }

                const currentUrl = audioUrls.alternatives[urlIndex];
                audioSource.src = currentUrl;
                audioPlayer.load();

                const successHandler = function() {
                    const startTime = chapter.startTime || 0;
                    audioPlayer.currentTime = startTime;
                    audioStatus.innerHTML = `‚úÖ Ïò§ÎîîÏò§ Ï§ÄÎπÑ ÏôÑÎ£å!`;
                };

                const errorHandler = function() {
                    setTimeout(() => tryLoadAudio(urlIndex + 1), 100);
                };

                audioPlayer.addEventListener('canplaythrough', successHandler, { once: true });
                audioPlayer.addEventListener('error', errorHandler, { once: true });
            }

            tryLoadAudio(0);
            currentAudio = audioPlayer;
            playbackSpeed = 1.0;
        }

        // Í∏∞Î≥∏ Ìï®ÏàòÎì§
        function closeAudioModal() {
            document.getElementById('audio-modal').style.display = 'none';
            if (currentAudio) currentAudio.pause();
        }

        function togglePlayPause() {
            if (!currentAudio) return;
            if (currentAudio.paused) {
                currentAudio.play();
                document.querySelector('.play-pause-btn').textContent = '‚è∏Ô∏è ÏùºÏãúÏ†ïÏßÄ';
            } else {
                currentAudio.pause();
                document.querySelector('.play-pause-btn').textContent = '‚ñ∂Ô∏è Ïû¨ÏÉù';
            }
        }

        function changeSpeed() {
            if (!currentAudio) return;
            const speeds = [0.5, 0.75, 1.0, 1.25, 1.5, 2.0];
            const currentIndex = speeds.indexOf(playbackSpeed);
            playbackSpeed = speeds[(currentIndex + 1) % speeds.length];
            currentAudio.playbackRate = playbackSpeed;
            document.querySelector('.speed-btn').textContent = `${playbackSpeed}x`;
        }

        function resetToChapterStart() {
            if (!currentAudio) return;
            const currentChapter = parseInt(document.getElementById('audio-chapter-title').textContent.match(/Chapter (\d+)/)[1]) - 1;
            currentAudio.currentTime = bookData.chapterList[currentChapter]?.startTime || 0;
        }

        function downloadAudio() {
            const audioSource = document.getElementById('audio-source');
            if (audioSource.src) {
                const link = document.createElement('a');
                link.href = audioSource.src;
                link.download = `${document.getElementById('audio-chapter-title').textContent}.mp3`;
                link.click();
            }
        }

        // Ï±Ö ÏÉÅÏÑ∏ Ï†ïÎ≥¥ ÌëúÏãú
        function showBookDetail() {
            document.getElementById('book-detail-screen').style.display = 'block';
            document.getElementById('learning-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'none';
            generateChapterGrid();
            updateProgress();
        }

        // Ï±ïÌÑ∞ Í∑∏Î¶¨Îìú ÏÉùÏÑ±
        function generateChapterGrid() {
            const grid = document.getElementById('chapters-grid');
            grid.innerHTML = '';

            bookData.chapterList.forEach((chapter, index) => {
                const chapterCard = document.createElement('div');
                chapterCard.className = `chapter-card ${chapter.status}`;

                chapterCard.innerHTML = `
                    <div class="chapter-header">
                        <div class="chapter-info">
                            <h4>Chapter ${index + 1}: ${chapter.title}</h4>
                            <p>${chapter.description} (${chapter.questionCount}Î¨∏Ï†ú)</p>
                        </div>
                        <div class="chapter-status ${chapter.status}">
                            ${chapter.status === 'completed' ? '‚úÖ ÏôÑÎ£å' :
                              chapter.status === 'current' ? 'üìñ ÏßÑÌñâÏ§ë' : 'üîí Ïû†ÍπÄ'}
                        </div>
                    </div>
                    <div class="chapter-actions">
                        <button class="chapter-btn audio-btn" onclick="playChapterAudio(${index})"
                                ${chapter.status === 'locked' ? 'disabled' : ''}>
                            üéß Ïò§ÎîîÏò§
                        </button>
                        <button class="chapter-btn quiz-btn" onclick="startLearning(${index})"
                                ${chapter.status === 'locked' ? 'disabled' : ''}>
                            üìù Î¨∏Ï†úÌíÄÍ∏∞
                        </button>
                    </div>
                `;

                grid.appendChild(chapterCard);
            });
        }

        // ÏßÑÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
        function updateProgress() {
            const completedChapters = bookData.chapterList.filter(chapter => chapter.status === 'completed').length;
            const progress = Math.round((completedChapters / bookData.chapters) * 100);
            document.getElementById('progress-value').textContent = progress + '%';
        }

        // ÌïôÏäµ ÏãúÏûë
        function startLearning(chapterIndex) {
            currentChapterIndex = chapterIndex;
            currentQuestionIndex = 0;
            userAnswers = [];
            questions = questionsData[chapterIndex];

            if (!questions || questions.length === 0) {
                alert('Ïù¥ Ï±ïÌÑ∞Ïùò Î¨∏Ï†úÍ∞Ä ÏïÑÏßÅ Ï§ÄÎπÑÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                return;
            }

            document.getElementById('book-detail-screen').style.display = 'none';
            document.getElementById('learning-screen').style.display = 'block';
            document.getElementById('result-screen').style.display = 'none';

            const chapter = bookData.chapterList[chapterIndex];
            document.getElementById('learning-title').textContent = `Chapter ${chapterIndex + 1}: ${chapter.title}`;
            document.getElementById('learning-chapter-breadcrumb').textContent = `Chapter ${chapterIndex + 1}`;

            showQuestion();
            updateLearningProgress();
        }

        // Î¨∏Ï†ú ÌëúÏãú
        function showQuestion() {
            const question = questions[currentQuestionIndex];
            const container = document.getElementById('question-container');

            container.innerHTML = `
                <div class="question-text">Î¨∏Ï†ú ${currentQuestionIndex + 1}</div>
                <div class="passage">${question.passage}</div>
                <div class="question-text">${question.question}</div>
                <div class="options">
                    ${question.options.map((option, index) =>
                        `<div class="option" onclick="selectOption(${index})" data-index="${index}">
                            ${String.fromCharCode(65 + index)}. ${option}
                        </div>`
                    ).join('')}
                </div>
            `;

            if (userAnswers[currentQuestionIndex] !== undefined) {
                const selectedOption = container.querySelector(`[data-index="${userAnswers[currentQuestionIndex]}"]`);
                if (selectedOption) selectedOption.classList.add('selected');
            }

            updateNavigationButtons();
        }

        // ÏÑ†ÌÉùÏßÄ ÏÑ†ÌÉù
        function selectOption(optionIndex) {
            document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
            document.querySelector(`[data-index="${optionIndex}"]`).classList.add('selected');
            userAnswers[currentQuestionIndex] = optionIndex;
            updateNavigationButtons();
        }

        // ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò
        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                showQuestion();
                updateLearningProgress();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion();
                updateLearningProgress();
            }
        }

        function updateLearningProgress() {
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('learning-progress-bar').style.width = progress + '%';
            document.getElementById('learning-progress-text').textContent = `Î¨∏Ï†ú ${currentQuestionIndex + 1} / ${questions.length}`;
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const submitBtn = document.getElementById('submit-btn');

            prevBtn.disabled = currentQuestionIndex === 0;

            if (currentQuestionIndex === questions.length - 1) {
                nextBtn.style.display = 'none';
                submitBtn.style.display = 'block';
                submitBtn.disabled = userAnswers[currentQuestionIndex] === undefined;
            } else {
                nextBtn.style.display = 'block';
                submitBtn.style.display = 'none';
                nextBtn.disabled = userAnswers[currentQuestionIndex] === undefined;
            }
        }

        // ÎãµÏïà Ï†úÏ∂ú
        function submitAnswers() {
            let correctCount = 0;
            questions.forEach((question, index) => {
                if (userAnswers[index] === question.correct) correctCount++;
            });

            const score = Math.round((correctCount / questions.length) * 100);

            if (score >= 70) {
                bookData.chapterList[currentChapterIndex].status = 'completed';
                if (currentChapterIndex < bookData.chapterList.length - 1) {
                    bookData.chapterList[currentChapterIndex + 1].status = 'current';
                }
            }

            showResults(correctCount, questions.length, score);
        }

        // Í≤∞Í≥º ÌëúÏãú
        function showResults(correct, total, score) {
            document.getElementById('learning-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';

            document.getElementById('score-circle').textContent = score + '%';
            document.getElementById('total-questions').textContent = total + 'Î¨∏Ï†ú';
            document.getElementById('correct-answers').textContent = correct + 'Î¨∏Ï†ú';
            document.getElementById('wrong-answers').textContent = (total - correct) + 'Î¨∏Ï†ú';
            document.getElementById('final-score').textContent = score + 'Ï†ê';

            let message = '';
            if (score >= 90) message = 'ÌõåÎ•≠Ìï©ÎãàÎã§! üåü';
            else if (score >= 80) message = 'ÏûòÌñàÏñ¥Ïöî! üëè';
            else if (score >= 70) message = 'Ï¢ãÏïÑÏöî! üëç';
            else message = 'Îã§Ïãú ÌïúÎ≤à ÎèÑÏ†ÑÌï¥Î≥¥ÏÑ∏Ïöî! üí™';

            document.getElementById('result-message').textContent = message;
        }

        function retryChapter() {
            startLearning(currentChapterIndex);
        }

        function nextChapter() {
            if (currentChapterIndex < bookData.chapterList.length - 1) {
                startLearning(currentChapterIndex + 1);
            } else {
                alert('Î™®Îì† Ï±ïÌÑ∞Î•º ÏôÑÎ£åÌñàÏäµÎãàÎã§! üéâ');
                showBookDetail();
            }
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú
        window.addEventListener('load', function() {
            showBookDetail();
            console.log('üå™Ô∏è Magic Tree House: Twister on Tuesday ÌïôÏäµ ÏãúÏä§ÌÖúÏù¥ Ï§ÄÎπÑÎêòÏóàÏäµÎãàÎã§!');
        });

        // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠Ïãú Îã´Í∏∞
        document.getElementById('audio-modal').addEventListener('click', function(e) {
            if (e.target === this) closeAudioModal();
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dingoes at Dinnertime - Level 3 - ÏàòÎ¶¨Îî©Ïñ¥ÌïôÏõê</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #FF4500 0%, #FF8C00 50%, #FFD700 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        /* Ìó§Îçî */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #FF4500, #FF8C00);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .logo-text h1 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
        }

        .logo-text p {
            font-size: 0.9rem;
            color: #666;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
            color: #333;
            text-decoration: none;
        }

        .nav-btn:hover {
            background: #FF4500;
            color: white;
            transform: translateY(-2px);
        }

        /* Î©îÏù∏ ÏΩòÌÖêÏ∏† ÏòÅÏó≠ */
        .main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            min-height: 600px;
        }

        /* Ï±Ö ÏÉÅÏÑ∏ ÌôîÎ©¥ */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 30px;
            font-size: 0.9rem;
            color: #666;
        }

        .breadcrumb a {
            color: #FF4500;
            text-decoration: none;
            cursor: pointer;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .book-detail-header {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: flex-start;
        }

        .detail-book-cover {
            width: 150px;
            height: 220px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 4rem;
            font-weight: bold;
            flex-shrink: 0;
            background: linear-gradient(45deg, #FF4500, #FF8C00);
        }

        .book-info {
            flex: 1;
        }

        .book-info h2 {
            font-size: 2.2rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .book-info .author {
            font-size: 1.2rem;
            color: #FF4500;
            margin-bottom: 20px;
        }

        .book-summary {
            font-size: 1rem;
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .book-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-box .value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #FF4500;
        }

        .stat-box .label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        /* Ï±ïÌÑ∞ Í∑∏Î¶¨Îìú */
        .chapters-section {
            margin-top: 40px;
        }

        .chapters-section h3 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 30px;
            text-align: center;
        }

        .chapters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .chapter-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
        }

        .chapter-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .chapter-card.completed {
            border-color: #28a745;
            background: linear-gradient(135deg, #28a74508, #ffffff);
        }

        .chapter-card.current {
            border-color: #FF4500;
            background: linear-gradient(135deg, #FF450008, #ffffff);
        }

        .chapter-card.locked {
            opacity: 0.6;
            background: #f8f9fa;
        }

        .chapter-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .chapter-info h4 {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }

        .chapter-info p {
            font-size: 0.95rem;
            color: #666;
            line-height: 1.5;
        }

        .chapter-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .chapter-status.completed {
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
        }

        .chapter-status.current {
            background: rgba(255, 69, 0, 0.1);
            color: #FF4500;
        }

        .chapter-status.locked {
            background: rgba(108, 117, 125, 0.1);
            color: #6c757d;
        }

        .chapter-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .chapter-btn {
            padding: 12px 16px;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .audio-btn {
            background: linear-gradient(45deg, #FF4500, #FF8C00);
            color: white;
        }

        .quiz-btn {
            background: linear-gradient(45deg, #FF8C00, #FFD700);
            color: white;
        }

        .chapter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .chapter-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* ÌïôÏäµ ÌôîÎ©¥ */
        .learning-screen {
            display: none;
        }

        .learning-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .learning-progress {
            background: #f8f9fa;
            border-radius: 10px;
            height: 8px;
            margin: 20px 0;
            overflow: hidden;
        }

        .learning-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #FF4500, #FF8C00);
            transition: width 0.3s ease;
        }

        .question-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
        }

        .passage {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1rem;
            line-height: 1.6;
            color: #444;
        }

        .options {
            display: grid;
            gap: 10px;
        }

        .option {
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option:hover {
            background: #e9ecef;
            border-color: #FF4500;
        }

        .option.selected {
            background: rgba(255, 69, 0, 0.1);
            border-color: #FF4500;
        }

        .learning-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .control-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .next-btn {
            background: linear-gradient(45deg, #FF4500, #FF8C00);
            color: white;
        }

        .prev-btn {
            background: #6c757d;
            color: white;
        }

        .submit-btn {
            background: linear-gradient(45deg, #FF4500, #FF8C00);
            color: white;
        }

        .control-btn:hover {
            transform: translateY(-2px);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Í≤∞Í≥º ÌôîÎ©¥ */
        .result-screen {
            display: none;
            text-align: center;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(45deg, #FF4500, #FF8C00);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            font-size: 2rem;
            font-weight: bold;
        }

        .result-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .result-stat {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .result-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        /* Ïò§ÎîîÏò§ ÌîåÎ†àÏù¥Ïñ¥ Î™®Îã¨ */
        .audio-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .audio-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 600px;
            width: 90%;
            position: relative;
        }

        .close-audio {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #666;
        }

        .audio-player {
            width: 100%;
            margin: 20px 0;
            border-radius: 10px;
        }

        .audio-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .audio-control-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .play-pause-btn {
            background: linear-gradient(45deg, #FF4500, #FF8C00);
            color: white;
        }

        .speed-btn {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #ddd;
        }

        .download-btn {
            background: #FF8C00;
            color: white;
        }

        .audio-info {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            font-size: 0.9rem;
            color: #666;
            transition: all 0.3s ease;
        }

        .audio-info.hidden {
            display: none;
        }

        /* Î∞òÏùëÌòï */
        @media (max-width: 768px) {
            .chapters-grid {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .book-detail-header {
                flex-direction: column;
                text-align: center;
            }

            .book-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .learning-controls {
                flex-direction: column;
            }

            .chapter-actions {
                grid-template-columns: 1fr;
            }

            .audio-controls {
                justify-content: center;
                gap: 10px;
            }

            .audio-content {
                padding: 30px 20px;
            }
        }

        .new-book-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: linear-gradient(45deg, #FF6B9D, #C44569);
            color: white;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: 700;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Level 3 ÌäπÎ≥Ñ Ïä§ÌÉÄÏùº */
        .level-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: linear-gradient(45deg, #FF6B00, #FF8E53);
            color: white;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ìó§Îçî -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">ü¶ò</div>
                <div class="logo-text">
                    <h1>Dingoes at Dinnertime</h1>
                    <p>Level 3 - Mary Pope OsborneÏùò Îß§ÏßÅ Ìä∏Î¶¨ ÌïòÏö∞Ïä§ 20Í∂å</p>
                </div>
            </div>
            <div class="nav-buttons">
                <a href="http://www.suelibrary.store/" class="nav-btn">Î©îÏù∏ÏúºÎ°ú</a>
            </div>
        </div>

        <!-- Î©îÏù∏ ÏΩòÌÖêÏ∏† -->
        <div class="main-content">
            <!-- Ï±Ö ÏÉÅÏÑ∏ ÌôîÎ©¥ -->
            <div class="book-detail-screen" id="book-detail-screen">
                <div class="level-badge">Level 3</div>
                <div class="breadcrumb">
                    <span>Dingoes at Dinnertime</span>
                </div>

                <div class="book-detail-header">
                    <div class="detail-book-cover">ü¶ò</div>
                    <div class="book-info">
                        <h2>Dingoes at Dinnertime</h2>
                        <div class="author">Mary Pope Osborne</div>
                        <div class="book-summary">
                            Jack and Annie travel to the Australian Outback to find the fourth object needed to break the spell on Morgan le Fay! They must survive in the harsh desert, learn about Aboriginal culture and Dreamtime stories, and encounter dangerous dingoes while helping a lost joey find its mother.
                        </div>
                        <div class="book-stats">
                            <div class="stat-box">
                                <div class="value">10</div>
                                <div class="label">Ï±ïÌÑ∞</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">50</div>
                                <div class="label">Ï¥ù Î¨∏Ï†ú</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">Level 3</div>
                                <div class="label">Î†àÎ≤®</div>
                            </div>
                            <div class="stat-box">
                                <div class="value" id="progress-value">0%</div>
                                <div class="label">ÏßÑÎèÑ</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="chapters-section">
                    <h3>ü¶ò Ï±ïÌÑ∞Î≥Ñ ÌïôÏäµ</h3>
                    <div class="chapters-grid" id="chapters-grid">
                        <!-- Ï±ïÌÑ∞ Ïπ¥ÎìúÎì§ -->
                    </div>
                </div>
            </div>

            <!-- ÌïôÏäµ ÌôîÎ©¥ -->
            <div class="learning-screen" id="learning-screen">
                <div class="breadcrumb">
                    <a onclick="showBookDetail()">Dingoes at Dinnertime</a>
                    <span>></span>
                    <span id="learning-chapter-breadcrumb">Chapter 1</span>
                </div>

                <div class="learning-header">
                    <h2 id="learning-title">Chapter 1: The Last Gift</h2>
                    <div class="learning-progress">
                        <div class="learning-progress-bar" id="learning-progress-bar" style="width: 0%"></div>
                    </div>
                    <p id="learning-progress-text">Î¨∏Ï†ú 1 / 5</p>
                </div>

                <div class="question-container" id="question-container">
                    <!-- Î¨∏Ï†úÍ∞Ä ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
                </div>

                <div class="learning-controls">
                    <button class="control-btn prev-btn" id="prev-btn" onclick="previousQuestion()" disabled>Ïù¥Ï†Ñ</button>
                    <button class="control-btn next-btn" id="next-btn" onclick="nextQuestion()">Îã§Ïùå</button>
                    <button class="control-btn submit-btn" id="submit-btn" onclick="submitAnswers()" style="display: none;">Ï†úÏ∂ú</button>
                </div>
            </div>

            <!-- Í≤∞Í≥º ÌôîÎ©¥ -->
            <div class="result-screen" id="result-screen">
                <div class="breadcrumb">
                    <a onclick="showBookDetail()">Dingoes at Dinnertime</a>
                    <span>></span>
                    <span>Í≤∞Í≥º</span>
                </div>

                <div class="result-header">
                    <h2>üéâ ÌïôÏäµ ÏôÑÎ£å!</h2>
                    <div class="score-circle" id="score-circle">100%</div>
                    <h3 id="result-message">ÌõåÎ•≠Ìï©ÎãàÎã§!</h3>
                </div>

                <div class="result-details">
                    <div class="result-stat">
                        <h4>Ï¥ù Î¨∏Ï†ú</h4>
                        <p id="total-questions">5Î¨∏Ï†ú</p>
                    </div>
                    <div class="result-stat">
                        <h4>Ï†ïÎãµ</h4>
                        <p id="correct-answers">5Î¨∏Ï†ú</p>
                    </div>
                    <div class="result-stat">
                        <h4>Ïò§Îãµ</h4>
                        <p id="wrong-answers">0Î¨∏Ï†ú</p>
                    </div>
                    <div class="result-stat">
                        <h4>Ï†êÏàò</h4>
                        <p id="final-score">100Ï†ê</p>
                    </div>
                </div>

                <div class="result-actions">
                    <button class="control-btn prev-btn" onclick="retryChapter()">Îã§Ïãú ÌíÄÍ∏∞</button>
                    <button class="control-btn next-btn" onclick="nextChapter()">Îã§Ïùå Ï±ïÌÑ∞</button>
                    <button class="control-btn submit-btn" onclick="showBookDetail()">Ï±ïÌÑ∞ Î™©Î°ù</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ïò§ÎîîÏò§ ÌîåÎ†àÏù¥Ïñ¥ Î™®Îã¨ -->
    <div class="audio-modal" id="audio-modal">
        <div class="audio-content">
            <button class="close-audio" onclick="closeAudioModal()">√ó</button>
            <h3 id="audio-chapter-title">Chapter 1: The Last Gift</h3>
            <p id="audio-chapter-subtitle">Dingoes at Dinnertime - Mary Pope Osborne</p>

            <audio class="audio-player" id="audio-player" controls preload="metadata">
                <source id="audio-source" src="" type="audio/mpeg">
                Î∏åÎùºÏö∞Ï†ÄÍ∞Ä Ïò§ÎîîÏò§Î•º ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.
            </audio>

            <div class="audio-controls">
                <button class="audio-control-btn play-pause-btn" onclick="togglePlayPause()">‚ñ∂Ô∏è Ïû¨ÏÉù</button>
                <button class="audio-control-btn speed-btn" onclick="changeSpeed()">1.0x</button>
                <button class="audio-control-btn" onclick="resetToChapterStart()" style="background: #28a745; color: white;">üîÑ Íµ¨Í∞ÑÏ≤òÏùå</button>
                <button class="audio-control-btn download-btn" onclick="downloadAudio()">üì• Îã§Ïö¥Î°úÎìú</button>
            </div>

            <div class="audio-info" id="audio-info">
                <div id="audio-status" style="margin-top: 10px; font-weight: bold; color: #FF4500;"></div>
            </div>
        </div>
    </div>

    <script>
        // üéØ Íµ¨Í∏Ä ÌÅ¥ÎùºÏö∞Îìú Ïä§ÌÜ†Î¶¨ÏßÄ Ïò§ÎîîÏò§ URL ÏÑ§Ï†ï
        const AUDIO_BASE_URL = 'https://storage.googleapis.com/kim-mom-reading-audio/audio/';

        // Magic Tree House 20Í∂å ÎèÑÏÑú Îç∞Ïù¥ÌÑ∞ (10Ï±ïÌÑ∞)
        const bookData = {
            id: 'MTH020',
            title: "Dingoes at Dinnertime",
            author: 'Mary Pope Osborne',
            cover: 'ü¶ò',
            progress: 0,
            chapters: 10,
            totalQuestions: 50, // 10Ï±ïÌÑ∞ √ó 5Î¨∏Ï†ú
            coverColor: 'linear-gradient(45deg, #FF4500, #FF8C00)',
            summary: "Jack and Annie travel to the Australian Outback to find the fourth object needed to break the spell on Morgan le Fay! They must survive in the harsh desert, learn about Aboriginal culture and Dreamtime stories, and encounter dangerous dingoes while helping a lost joey find its mother.",
            chapterList: [
                { title: 'The Last Gift', description: 'Jack and Annie prepare for their final mission to save Morgan le Fay.', status: 'current', questionCount: 5, startTime: 0 },
                { title: 'The Wild Dog', description: 'They arrive in the Australian Outback and encounter their first dingo.', status: 'locked', questionCount: 5, startTime: 300 },
                { title: 'Teddy and Kathleen', description: 'They meet the two young sorcerers Teddy and Kathleen who need their help.', status: 'locked', questionCount: 5, startTime: 600 },
                { title: 'Wombat Stew', description: 'They learn about bush survival and Australian wildlife.', status: 'locked', questionCount: 5, startTime: 900 },
                { title: 'Dinner Time', description: 'A pack of dingoes threatens them during their evening meal.', status: 'locked', questionCount: 5, startTime: 1200 },
                { title: 'Ghost Wind', description: 'They experience the mysterious ghost wind of the Australian desert.', status: 'locked', questionCount: 5, startTime: 1500 },
                { title: 'The Sorcerer\'s Gift', description: 'They discover their special gift and power to help others.', status: 'locked', questionCount: 5, startTime: 1800 },
                { title: 'The Bunyip', description: 'They encounter the legendary Bunyip from Aboriginal mythology.', status: 'locked', questionCount: 5, startTime: 2100 },
                { title: 'The Billabong', description: 'They find water and safety at a billabong with Aboriginal people.', status: 'locked', questionCount: 5, startTime: 2400 },
                { title: 'The Wand', description: 'They complete their mission and help free Morgan from her spell.', status: 'locked', questionCount: 5, startTime: 2700 }
            ]
        };

        // Î¨∏Ï†ú Îç∞Ïù¥ÌÑ∞ (Ï†ÑÏ≤¥ 10Ï±ïÌÑ∞ ÏôÑÎ£å)
        const questionsData = {
            0: [ // Chapter 1: The Last Gift
                {
                    passage: "Jack and Annie discovered they needed to find one more special gift to complete their mission and break the powerful spell that had been cast on Morgan le Fay.",
                    question: "What did Jack and Annie need to find to complete their mission?",
                    options: ["A magic book", "One more special gift to break the spell on Morgan le Fay", "A treasure chest", "A new tree house"],
                    correct: 1
                },
                {
                    passage: "Morgan le Fay had been turned into a mouse by the evil sorcerer Merlin, and only by collecting four special gifts could they restore her to human form.",
                    question: "What had happened to Morgan le Fay and how could it be reversed?",
                    options: ["She was lost in time", "She was turned into a mouse by Merlin, reversible with four gifts", "She was imprisoned in a castle", "She had lost her memory"],
                    correct: 1
                },
                {
                    passage: "The tree house was filled with the three gifts they had already collected: a pocket watch from the Titanic, a lotus flower from India, and an eagle feather from the Lakota.",
                    question: "What three gifts had Jack and Annie already collected?",
                    options: ["Books, maps, and coins", "Pocket watch from Titanic, lotus flower from India, eagle feather from Lakota", "Jewels, gold, and silver", "Stones, shells, and leaves"],
                    correct: 1
                },
                {
                    passage: "Their research book showed them pictures of the Australian Outback, with its red desert, unusual animals, and Aboriginal rock paintings.",
                    question: "What did the research book show them about their next destination?",
                    options: ["A tropical jungle", "Australian Outback with red desert, animals, and Aboriginal art", "A snowy mountain", "A busy city"],
                    correct: 1
                },
                {
                    passage: "Jack felt nervous about going to such a hot, dry, and dangerous place, while Annie was excited to see kangaroos and other unique Australian animals.",
                    question: "How did Jack and Annie feel about going to Australia?",
                    options: ["Both were scared", "Jack felt nervous about the danger, Annie excited to see animals", "Both were excited", "Annie was scared, Jack excited"],
                    correct: 1
                }
            ],
            1: [ // Chapter 2: The Wild Dog
                {
                    passage: "Jack and Annie found themselves in the scorching hot Australian Outback, surrounded by red sand, sparse vegetation, and the intense heat of the desert sun.",
                    question: "Where did Jack and Annie find themselves?",
                    options: ["In a cool forest", "In the scorching Australian Outback with red sand and intense heat", "Near a lake", "In a city"],
                    correct: 1
                },
                {
                    passage: "They heard a wild howling sound in the distance and saw a dog-like animal with golden fur watching them from behind some rocks.",
                    question: "What did they see and hear in the Outback?",
                    options: ["Birds singing", "Wild howling and a golden dog-like animal watching from rocks", "Cars driving by", "People calling"],
                    correct: 1
                },
                {
                    passage: "Jack recognized the animal as a dingo from his research - a wild dog native to Australia that can be both dangerous and intelligent.",
                    question: "What animal did Jack recognize, and what did he know about it?",
                    options: ["A pet dog that was friendly", "A dingo - a wild, dangerous but intelligent dog native to Australia", "A wolf from Europe", "A coyote from America"],
                    correct: 1
                },
                {
                    passage: "The dingo seemed curious about the children but kept its distance, neither approaching nor running away, just observing them carefully.",
                    question: "How did the dingo behave toward Jack and Annie?",
                    options: ["It attacked them immediately", "It seemed curious, keeping distance while observing them carefully", "It ran away scared", "It came up to play"],
                    correct: 1
                },
                {
                    passage: "Annie wanted to try communicating with the dingo, but Jack warned her that wild animals in the Outback could be unpredictable and potentially dangerous.",
                    question: "What did Annie want to do, and what did Jack warn her about?",
                    options: ["Annie wanted to run, Jack said stay", "Annie wanted to communicate, Jack warned wild animals are unpredictable", "Annie wanted to hide, Jack wanted to approach", "Annie was scared, Jack was confident"],
                    correct: 1
                }
            ],
            2: [ // Chapter 3: Teddy and Kathleen
                {
                    passage: "Jack and Annie were surprised to encounter two young people in the Outback - Teddy, a boy about their age, and Kathleen, a girl with magical abilities.",
                    question: "Who did Jack and Annie encounter in the Outback?",
                    options: ["Two adult explorers", "Two young people - Teddy and Kathleen with magical abilities", "A family of tourists", "Aboriginal guides"],
                    correct: 1
                },
                {
                    passage: "Teddy and Kathleen revealed that they were young sorcerers sent by Merlin to help Jack and Annie find the fourth gift needed to save Morgan.",
                    question: "What did Teddy and Kathleen reveal about themselves?",
                    options: ["They were lost tourists", "They were young sorcerers sent by Merlin to help find the fourth gift", "They were researchers", "They were park rangers"],
                    correct: 1
                },
                {
                    passage: "Kathleen explained that the fourth gift had to be something that represented the heart - a gift of caring, compassion, and love for others.",
                    question: "What did Kathleen say the fourth gift had to represent?",
                    options: ["Money and wealth", "The heart - caring, compassion, and love for others", "Intelligence and wisdom", "Strength and power"],
                    correct: 1
                },
                {
                    passage: "Teddy told them that they couldn't simply find this gift lying around - it had to be earned through their actions and demonstrated through helping someone in need.",
                    question: "How did Teddy say the fourth gift had to be obtained?",
                    options: ["By finding it hidden somewhere", "By earning it through actions and helping someone in need", "By solving a puzzle", "By defeating an enemy"],
                    correct: 1
                },
                {
                    passage: "The young sorcerers warned Jack and Annie that the Australian Outback was full of dangers, but also opportunities to show true kindness and courage.",
                    question: "What did the sorcerers warn about the Outback?",
                    options: ["It was completely safe", "It was full of dangers but also opportunities to show kindness and courage", "They should leave immediately", "It had no animals"],
                    correct: 1
                }
            ],
            3: [ // Chapter 4: Wombat Stew
                {
                    passage: "Teddy and Kathleen taught Jack and Annie important survival skills for the harsh Australian desert, including finding water and edible plants.",
                    question: "What did Teddy and Kathleen teach Jack and Annie?",
                    options: ["How to build cities", "Important survival skills for the desert including finding water and plants", "How to fly", "How to drive cars"],
                    correct: 1
                },
                {
                    passage: "They learned about native Australian animals like wombats, which are sturdy, burrowing marsupials that can survive in the tough Outback conditions.",
                    question: "What did they learn about wombats?",
                    options: ["They are dangerous predators", "They are sturdy, burrowing marsupials that survive tough Outback conditions", "They live in trees", "They are extinct"],
                    correct: 1
                },
                {
                    passage: "Kathleen showed them how Aboriginal people had lived in harmony with the land for thousands of years, using every part of plants and animals respectfully.",
                    question: "What did Kathleen teach about Aboriginal people?",
                    options: ["They destroyed the environment", "They lived in harmony with land for thousands of years, using everything respectfully", "They only lived in cities", "They never used plants or animals"],
                    correct: 1
                },
                {
                    passage: "As they prepared a simple meal over a small fire, they heard the sounds of various Australian animals beginning to stir as evening approached.",
                    question: "What happened as they prepared their meal in the evening?",
                    options: ["Everything was silent", "They heard Australian animals beginning to stir as evening approached", "A storm started", "People arrived"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie were amazed by how much knowledge was needed to survive in the Outback, and they gained new respect for the people who called this harsh land home.",
                    question: "What did Jack and Annie gain respect for?",
                    options: ["Modern technology", "The knowledge needed to survive and people who called the harsh Outback home", "City life", "Easy living"],
                    correct: 1
                }
            ],
            4: [ // Chapter 5: Dinner Time
                {
                    passage: "As darkness fell over the Outback, a pack of dingoes appeared near their campfire, drawn by the smell of food and curious about the humans.",
                    question: "What happened as darkness fell over the Outback?",
                    options: ["Nothing occurred", "A pack of dingoes appeared near campfire, drawn by food smell", "It started raining", "They went to sleep"],
                    correct: 1
                },
                {
                    passage: "The dingoes circled the camp cautiously, their eyes glowing in the firelight as they assessed whether these strangers posed a threat or opportunity.",
                    question: "How did the dingoes behave around the camp?",
                    options: ["They attacked immediately", "They circled cautiously with glowing eyes, assessing the strangers", "They ran away quickly", "They came up friendly"],
                    correct: 1
                },
                {
                    passage: "Teddy warned everyone to stay calm and avoid sudden movements, as dingoes are intelligent predators that can become aggressive if they feel threatened.",
                    question: "What did Teddy warn about dealing with the dingoes?",
                    options: ["Run away immediately", "Stay calm and avoid sudden movements as they can become aggressive", "Make loud noises", "Feed them immediately"],
                    correct: 1
                },
                {
                    passage: "The largest dingo, apparently the pack leader, stepped closer to the fire and stared directly at Jack and Annie with piercing yellow eyes.",
                    question: "What did the pack leader dingo do?",
                    options: ["It stayed far away", "It stepped closer and stared at Jack and Annie with piercing yellow eyes", "It howled loudly", "It lay down to sleep"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie realized that this encounter with the dingoes might be their chance to demonstrate the compassion and courage needed to earn their fourth gift.",
                    question: "What did Jack and Annie realize about the dingo encounter?",
                    options: ["It was just bad luck", "It might be their chance to demonstrate compassion and courage for the fourth gift", "They should ignore it", "It was not important"],
                    correct: 1
                }
            ],
            5: [ // Chapter 6: Ghost Wind
                {
                    passage: "A strange, howling wind began to blow across the desert, carrying with it the sounds and stories of the ancient Aboriginal Dreamtime.",
                    question: "What strange phenomenon occurred in the desert?",
                    options: ["Heavy rain", "A howling wind carrying sounds and stories of Aboriginal Dreamtime", "An earthquake", "Complete silence"],
                    correct: 1
                },
                {
                    passage: "Kathleen explained that the Aboriginal people believed this ghost wind carried the spirits of their ancestors and the wisdom of the land itself.",
                    question: "What did Kathleen explain about the ghost wind?",
                    options: ["It was just weather", "Aboriginal people believed it carried ancestor spirits and land's wisdom", "It was dangerous", "It meant nothing"],
                    correct: 1
                },
                {
                    passage: "In the wind, Jack and Annie could hear what sounded like ancient songs and stories being whispered across the vast expanse of the Outback.",
                    question: "What did Jack and Annie hear in the wind?",
                    options: ["Nothing unusual", "Ancient songs and stories being whispered across the Outback", "Modern music", "Animal sounds only"],
                    correct: 1
                },
                {
                    passage: "The dingoes seemed to respond to the ghost wind by becoming more restless, pacing around the camp and occasionally howling in response to the mysterious sounds.",
                    question: "How did the dingoes respond to the ghost wind?",
                    options: ["They fell asleep", "They became restless, pacing and howling in response to mysterious sounds", "They ran away", "They became friendly"],
                    correct: 1
                },
                {
                    passage: "Teddy told them that the ghost wind often appeared when important events were about to happen, suggesting their mission was reaching a crucial point.",
                    question: "What did Teddy say about when the ghost wind appeared?",
                    options: ["It meant bad weather", "It often appeared when important events were about to happen", "It was completely random", "It meant they should leave"],
                    correct: 1
                }
            ],
            6: [ // Chapter 7: The Sorcerer's Gift
                {
                    passage: "Teddy and Kathleen revealed that they themselves were looking for something - a special gift that would complete their own magical training.",
                    question: "What did Teddy and Kathleen reveal they were looking for?",
                    options: ["Food and water", "A special gift to complete their own magical training", "A way home", "Treasure"],
                    correct: 1
                },
                {
                    passage: "They explained that true magic comes not from spells and potions, but from acts of genuine kindness, courage, and selfless help to others.",
                    question: "What did they explain about true magic?",
                    options: ["It comes from books", "It comes from genuine kindness, courage, and selfless help to others", "It comes from wands", "It comes from being powerful"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie realized that their mission to find the fourth gift was connected to helping Teddy and Kathleen succeed in their own magical quest.",
                    question: "What did Jack and Annie realize about their missions?",
                    options: ["They were separate goals", "Their mission was connected to helping Teddy and Kathleen with their quest", "They should work alone", "It was impossible"],
                    correct: 1
                },
                {
                    passage: "The four children understood that by working together and caring for each other, they could accomplish what none of them could achieve alone.",
                    question: "What did the four children understand about working together?",
                    options: ["They were better apart", "By working together and caring for each other, they could achieve more", "Only one person should lead", "Teamwork didn't matter"],
                    correct: 1
                },
                {
                    passage: "As they shared their stories and hopes around the campfire, the dingoes seemed to sense the growing bond of friendship and trust among the group.",
                    question: "What did the dingoes seem to sense as the children shared stories?",
                    options: ["Nothing at all", "The growing bond of friendship and trust among the group", "Danger approaching", "It was time to hunt"],
                    correct: 1
                }
            ],
            7: [ // Chapter 8: The Bunyip
                {
                    passage: "From the darkness beyond their camp came a strange, haunting cry that didn't sound like any animal they had heard before in the Outback.",
                    question: "What did they hear from the darkness beyond their camp?",
                    options: ["A familiar bird call", "A strange, haunting cry unlike any Outback animal they'd heard", "Human voices", "Complete silence"],
                    correct: 1
                },
                {
                    passage: "Kathleen whispered that the sound might be coming from a Bunyip, a legendary water creature from Aboriginal mythology that was said to protect sacred places.",
                    question: "What did Kathleen think might be making the sound?",
                    options: ["A lost person", "A Bunyip, a legendary water creature from Aboriginal mythology", "A broken machine", "The wind"],
                    correct: 1
                },
                {
                    passage: "The Bunyip was described as a guardian spirit that would only reveal itself to those who showed proper respect for the land and its creatures.",
                    question: "What was special about the Bunyip according to Aboriginal beliefs?",
                    options: ["It was evil and dangerous", "A guardian spirit revealing itself only to those who respected land and creatures", "It was just an ordinary animal", "It didn't really exist"],
                    correct: 1
                },
                {
                    passage: "As the cry grew louder, the dingoes began to act strangely - not with fear, but with what seemed like recognition and respect for the unseen presence.",
                    question: "How did the dingoes react to the Bunyip's cry?",
                    options: ["With terror and panic", "Strangely, not with fear but with recognition and respect", "They ignored it completely", "They became aggressive"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie felt that encountering the legendary Bunyip might be a sign that they were close to finding the gift they needed to complete their mission.",
                    question: "What did Jack and Annie feel about encountering the Bunyip?",
                    options: ["It was bad luck", "It might be a sign they were close to finding their needed gift", "It meant they should give up", "It was just coincidence"],
                    correct: 1
                }
            ],
            8: [ // Chapter 9: The Billabong
                {
                    passage: "Following the sound of the Bunyip, Jack and Annie discovered a hidden billabong - a water hole surrounded by Aboriginal rock paintings and sacred symbols.",
                    question: "What did Jack and Annie discover by following the Bunyip's sound?",
                    options: ["An empty desert", "A hidden billabong with Aboriginal rock paintings and sacred symbols", "A modern city", "A dangerous cliff"],
                    correct: 1
                },
                {
                    passage: "Near the billabong, they found a group of Aboriginal people who welcomed them with kindness and shared their knowledge of the land and its stories.",
                    question: "Who did they find near the billabong?",
                    options: ["No one", "Aboriginal people who welcomed them kindly and shared land knowledge", "Hostile strangers", "Lost tourists"],
                    correct: 1
                },
                {
                    passage: "The Aboriginal elder told them ancient Dreamtime stories about how all living creatures are connected and must care for one another to survive.",
                    question: "What did the Aboriginal elder tell them about?",
                    options: ["Modern science", "Ancient Dreamtime stories about how all creatures are connected and must care for each other", "How to make money", "City life"],
                    correct: 1
                },
                {
                    passage: "They learned that the dingo pack had been following them not to attack, but to lead them to this sacred place where they could find what they were seeking.",
                    question: "Why had the dingo pack been following them?",
                    options: ["To attack them", "Not to attack, but to lead them to this sacred place to find what they sought", "For fun", "By accident"],
                    correct: 1
                },
                {
                    passage: "The elder explained that the greatest gift anyone can give is to help those who cannot help themselves, especially the young and vulnerable.",
                    question: "What did the elder say was the greatest gift anyone can give?",
                    options: ["Money and gold", "To help those who cannot help themselves, especially young and vulnerable", "To be famous", "To be powerful"],
                    correct: 1
                }
            ],
            9: [ // Chapter 10: The Wand
                {
                    passage: "Near the billabong, Jack and Annie found a lost baby kangaroo (joey) that had been separated from its mother and was in desperate need of help.",
                    question: "What did Jack and Annie find near the billabong?",
                    options: ["A treasure chest", "A lost baby kangaroo (joey) separated from its mother needing help", "A broken car", "An empty bottle"],
                    correct: 1
                },
                {
                    passage: "Working together with Teddy and Kathleen, they used their combined knowledge and compassion to care for the joey and help it find its way back to its mother.",
                    question: "How did they help the joey?",
                    options: ["They ignored it", "They worked together using knowledge and compassion to reunite it with its mother", "They took it home", "They called for professional help"],
                    correct: 1
                },
                {
                    passage: "As they successfully reunited the joey with its mother kangaroo, a beautiful golden light appeared, and they realized they had found their fourth gift.",
                    question: "What happened when they reunited the joey with its mother?",
                    options: ["Nothing special", "A golden light appeared and they realized they'd found their fourth gift", "It started raining", "The animals ran away"],
                    correct: 1
                },
                {
                    passage: "The gift was not a physical object, but the act of showing compassion and helping a creature in need - this was the gift of the heart.",
                    question: "What was the fourth gift?",
                    options: ["A golden coin", "Not a physical object, but showing compassion and helping - the gift of the heart", "A magic wand", "A precious stone"],
                    correct: 1
                },
                {
                    passage: "With all four gifts collected, Morgan le Fay was finally freed from her spell, and she appeared to thank Jack and Annie for their courage, kindness, and dedication.",
                    question: "What happened when all four gifts were collected?",
                    options: ["Nothing changed", "Morgan le Fay was freed and appeared to thank them for courage, kindness, dedication", "They got lost", "More problems appeared"],
                    correct: 1
                }
            ]
        };

        // Ï†ÑÏó≠ Î≥ÄÏàò
        let currentChapterIndex = 0;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let questions = [];
        let currentAudio = null;
        let playbackSpeed = 1.0;

        // üéß ÏûêÎèô Ïò§ÎîîÏò§ URL ÏÉùÏÑ± Ìï®Ïàò
        function getAudioUrl(chapterIndex) {
            const level = 'level3';
            const bookId = 'MTH020';
            const chapterNum = String(chapterIndex + 1).padStart(2, '0');
            
            const possibleFileNames = [
                `${bookId}_chapter${chapterNum}.mp3`,
                `${bookId}_ch${chapterNum}.mp3`,
                `${bookId}_${chapterNum}.mp3`,
                `magic_tree_house_20_chapter${chapterNum}.mp3`,
                `magic_tree_house_20_ch${chapterNum}.mp3`,
                `dingoes_at_dinnertime_${chapterNum}.mp3`,
                `mary_pope_osborne_20_chapter${chapterNum}.mp3`,
                `${bookId}.mp3`
            ];
            
            return {
                primary: `${AUDIO_BASE_URL}${level}/${possibleFileNames[0]}`,
                alternatives: possibleFileNames.map(fileName => `${AUDIO_BASE_URL}${level}/${fileName}`)
            };
        }

        // üéß Ïò§ÎîîÏò§ Ïû¨ÏÉù Ìï®Ïàò
        function playChapterAudio(chapterIndex) {
            const chapter = bookData.chapterList[chapterIndex];
            const audioUrls = getAudioUrl(chapterIndex);

            document.getElementById('audio-modal').style.display = 'flex';
            document.getElementById('audio-chapter-title').textContent = `Chapter ${chapterIndex + 1}: ${chapter.title}`;
            document.getElementById('audio-chapter-subtitle').textContent = `${bookData.title} - ${bookData.author}`;

            // Ïò§ÎîîÏò§ Ï†ïÎ≥¥ ÏòÅÏó≠ Îã§Ïãú Î≥¥Ïù¥Í∏∞ (ÏÉàÎ°úÏö¥ Ïò§ÎîîÏò§ ÌîåÎ†àÏù¥Ïãú)
            document.getElementById('audio-info').classList.remove('hidden');

            const audioPlayer = document.getElementById('audio-player');
            const audioSource = document.getElementById('audio-source');
            const audioStatus = document.getElementById('audio-status');

            audioStatus.textContent = 'üîÑ Ïò§ÎîîÏò§ ÌååÏùºÏùÑ Ï∞æÎäî Ï§ë...';

            function tryLoadAudio(urlIndex = 0) {
                if (urlIndex >= audioUrls.alternatives.length) {
                    audioStatus.innerHTML = `‚ùå Ïò§ÎîîÏò§ ÌååÏùºÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.`;
                    return;
                }

                const currentUrl = audioUrls.alternatives[urlIndex];
                audioSource.src = currentUrl;
                audioPlayer.load();

                const successHandler = function() {
                    const startTime = chapter.startTime || 0;
                    audioPlayer.currentTime = startTime;
                    audioStatus.innerHTML = `‚úÖ Ïò§ÎîîÏò§ Ï§ÄÎπÑ ÏôÑÎ£å!`;
                };

                const errorHandler = function() {
                    setTimeout(() => tryLoadAudio(urlIndex + 1), 100);
                };

                audioPlayer.addEventListener('canplaythrough', successHandler, { once: true });
                audioPlayer.addEventListener('error', errorHandler, { once: true });
            }

            tryLoadAudio(0);
            currentAudio = audioPlayer;
            playbackSpeed = 1.0;
        }

        // Í∏∞Î≥∏ Ìï®ÏàòÎì§
        function closeAudioModal() {
            document.getElementById('audio-modal').style.display = 'none';
            if (currentAudio) currentAudio.pause();
        }

        function togglePlayPause() {
            if (!currentAudio) return;
            if (currentAudio.paused) {
                currentAudio.play();
                document.querySelector('.play-pause-btn').textContent = '‚è∏Ô∏è ÏùºÏãúÏ†ïÏßÄ';
            } else {
                currentAudio.pause();
                document.querySelector('.play-pause-btn').textContent = '‚ñ∂Ô∏è Ïû¨ÏÉù';
            }
        }

        function changeSpeed() {
            if (!currentAudio) return;
            const speeds = [0.5, 0.75, 1.0, 1.25, 1.5, 2.0];
            const currentIndex = speeds.indexOf(playbackSpeed);
            playbackSpeed = speeds[(currentIndex + 1) % speeds.length];
            currentAudio.playbackRate = playbackSpeed;
            document.querySelector('.speed-btn').textContent = `${playbackSpeed}x`;
        }

        function resetToChapterStart() {
            if (!currentAudio) return;
            const currentChapter = parseInt(document.getElementById('audio-chapter-title').textContent.match(/Chapter (\d+)/)[1]) - 1;
            currentAudio.currentTime = bookData.chapterList[currentChapter]?.startTime || 0;
        }

        function downloadAudio() {
            const audioSource = document.getElementById('audio-source');
            if (audioSource.src) {
                const link = document.createElement('a');
                link.href = audioSource.src;
                link.download = `${document.getElementById('audio-chapter-title').textContent}.mp3`;
                link.click();
            }
        }

        // Ï±Ö ÏÉÅÏÑ∏ Ï†ïÎ≥¥ ÌëúÏãú
        function showBookDetail() {
            document.getElementById('book-detail-screen').style.display = 'block';
            document.getElementById('learning-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'none';
            generateChapterGrid();
            updateProgress();
        }

        // Ï±ïÌÑ∞ Í∑∏Î¶¨Îìú ÏÉùÏÑ±
        function generateChapterGrid() {
            const grid = document.getElementById('chapters-grid');
            grid.innerHTML = '';

            bookData.chapterList.forEach((chapter, index) => {
                const chapterCard = document.createElement('div');
                chapterCard.className = `chapter-card ${chapter.status}`;

                chapterCard.innerHTML = `
                    <div class="chapter-header">
                        <div class="chapter-info">
                            <h4>Chapter ${index + 1}: ${chapter.title}</h4>
                            <p>${chapter.description} (${chapter.questionCount}Î¨∏Ï†ú)</p>
                        </div>
                        <div class="chapter-status ${chapter.status}">
                            ${chapter.status === 'completed' ? '‚úÖ ÏôÑÎ£å' :
                              chapter.status === 'current' ? 'üìñ ÏßÑÌñâÏ§ë' : 'üîí Ïû†ÍπÄ'}
                        </div>
                    </div>
                    <div class="chapter-actions">
                        <button class="chapter-btn audio-btn" onclick="playChapterAudio(${index})"
                                ${chapter.status === 'locked' ? 'disabled' : ''}>
                            üéß Ïò§ÎîîÏò§
                        </button>
                        <button class="chapter-btn quiz-btn" onclick="startLearning(${index})"
                                ${chapter.status === 'locked' ? 'disabled' : ''}>
                            üìù Î¨∏Ï†úÌíÄÍ∏∞
                        </button>
                    </div>
                `;

                grid.appendChild(chapterCard);
            });
        }

        // ÏßÑÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
        function updateProgress() {
            const completedChapters = bookData.chapterList.filter(chapter => chapter.status === 'completed').length;
            const progress = Math.round((completedChapters / bookData.chapters) * 100);
            document.getElementById('progress-value').textContent = progress + '%';
        }

        // ÌïôÏäµ ÏãúÏûë
        function startLearning(chapterIndex) {
            currentChapterIndex = chapterIndex;
            currentQuestionIndex = 0;
            userAnswers = [];
            questions = questionsData[chapterIndex];

            if (!questions || questions.length === 0) {
                alert('Ïù¥ Ï±ïÌÑ∞Ïùò Î¨∏Ï†úÍ∞Ä ÏïÑÏßÅ Ï§ÄÎπÑÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                return;
            }

            document.getElementById('book-detail-screen').style.display = 'none';
            document.getElementById('learning-screen').style.display = 'block';
            document.getElementById('result-screen').style.display = 'none';

            const chapter = bookData.chapterList[chapterIndex];
            document.getElementById('learning-title').textContent = `Chapter ${chapterIndex + 1}: ${chapter.title}`;
            document.getElementById('learning-chapter-breadcrumb').textContent = `Chapter ${chapterIndex + 1}`;

            showQuestion();
            updateLearningProgress();
        }

        // Î¨∏Ï†ú ÌëúÏãú
        function showQuestion() {
            const question = questions[currentQuestionIndex];
            const container = document.getElementById('question-container');

            container.innerHTML = `
                <div class="question-text">Î¨∏Ï†ú ${currentQuestionIndex + 1}</div>
                <div class="passage">${question.passage}</div>
                <div class="question-text">${question.question}</div>
                <div class="options">
                    ${question.options.map((option, index) =>
                        `<div class="option" onclick="selectOption(${index})" data-index="${index}">
                            ${String.fromCharCode(65 + index)}. ${option}
                        </div>`
                    ).join('')}
                </div>
            `;

            if (userAnswers[currentQuestionIndex] !== undefined) {
                const selectedOption = container.querySelector(`[data-index="${userAnswers[currentQuestionIndex]}"]`);
                if (selectedOption) selectedOption.classList.add('selected');
            }

            updateNavigationButtons();
        }

        // ÏÑ†ÌÉùÏßÄ ÏÑ†ÌÉù
        function selectOption(optionIndex) {
            document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
            document.querySelector(`[data-index="${optionIndex}"]`).classList.add('selected');
            userAnswers[currentQuestionIndex] = optionIndex;
            updateNavigationButtons();
        }

        // ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò
        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                showQuestion();
                updateLearningProgress();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion();
                updateLearningProgress();
            }
        }

        function updateLearningProgress() {
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('learning-progress-bar').style.width = progress + '%';
            document.getElementById('learning-progress-text').textContent = `Î¨∏Ï†ú ${currentQuestionIndex + 1} / ${questions.length}`;
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const submitBtn = document.getElementById('submit-btn');

            prevBtn.disabled = currentQuestionIndex === 0;

            if (currentQuestionIndex === questions.length - 1) {
                nextBtn.style.display = 'none';
                submitBtn.style.display = 'block';
                submitBtn.disabled = userAnswers[currentQuestionIndex] === undefined;
            } else {
                nextBtn.style.display = 'block';
                submitBtn.style.display = 'none';
                nextBtn.disabled = userAnswers[currentQuestionIndex] === undefined;
            }
        }

        // ÎãµÏïà Ï†úÏ∂ú
        function submitAnswers() {
            let correctCount = 0;
            questions.forEach((question, index) => {
                if (userAnswers[index] === question.correct) correctCount++;
            });

            const score = Math.round((correctCount / questions.length) * 100);

            if (score >= 70) {
                bookData.chapterList[currentChapterIndex].status = 'completed';
                if (currentChapterIndex < bookData.chapterList.length - 1) {
                    bookData.chapterList[currentChapterIndex + 1].status = 'current';
                }
            }

            showResults(correctCount, questions.length, score);
        }

        // Í≤∞Í≥º ÌëúÏãú
        function showResults(correct, total, score) {
            document.getElementById('learning-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';

            document.getElementById('score-circle').textContent = score + '%';
            document.getElementById('total-questions').textContent = total + 'Î¨∏Ï†ú';
            document.getElementById('correct-answers').textContent = correct + 'Î¨∏Ï†ú';
            document.getElementById('wrong-answers').textContent = (total - correct) + 'Î¨∏Ï†ú';
            document.getElementById('final-score').textContent = score + 'Ï†ê';

            let message = '';
            if (score >= 90) message = 'ÌõåÎ•≠Ìï©ÎãàÎã§! üåü';
            else if (score >= 80) message = 'ÏûòÌñàÏñ¥Ïöî! üëè';
            else if (score >= 70) message = 'Ï¢ãÏïÑÏöî! üëç';
            else message = 'Îã§Ïãú ÌïúÎ≤à ÎèÑÏ†ÑÌï¥Î≥¥ÏÑ∏Ïöî! üí™';

            document.getElementById('result-message').textContent = message;
        }

        function retryChapter() {
            startLearning(currentChapterIndex);
        }

        function nextChapter() {
            if (currentChapterIndex < bookData.chapterList.length - 1) {
                startLearning(currentChapterIndex + 1);
            } else {
                alert('Î™®Îì† Ï±ïÌÑ∞Î•º ÏôÑÎ£åÌñàÏäµÎãàÎã§! üéâ');
                showBookDetail();
            }
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú
        window.addEventListener('load', function() {
            showBookDetail();
            console.log('ü¶ò Magic Tree House: Dingoes at Dinnertime ÌïôÏäµ ÏãúÏä§ÌÖúÏù¥ Ï§ÄÎπÑÎêòÏóàÏäµÎãàÎã§!');
        });

        // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠Ïãú Îã´Í∏∞
        document.getElementById('audio-modal').addEventListener('click', function(e) {
            if (e.target === this) closeAudioModal();
        });
    </script>
</body>
</html>
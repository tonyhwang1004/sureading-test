<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revolutionary War on Wednesday - Level 4 - ÏàòÎ¶¨Îî©Ïñ¥ÌïôÏõê</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #8B0000 0%, #DC143C 50%, #FFB6C1 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        /* Ìó§Îçî */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #8B0000, #DC143C);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .logo-text h1 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
        }

        .logo-text p {
            font-size: 0.9rem;
            color: #666;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
            color: #333;
            text-decoration: none;
        }

        .nav-btn:hover {
            background: #8B0000;
            color: white;
            transform: translateY(-2px);
        }

        /* Î©îÏù∏ ÏΩòÌÖêÏ∏† ÏòÅÏó≠ */
        .main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            min-height: 600px;
        }

        /* Ï±Ö ÏÉÅÏÑ∏ ÌôîÎ©¥ */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 30px;
            font-size: 0.9rem;
            color: #666;
        }

        .breadcrumb a {
            color: #8B0000;
            text-decoration: none;
            cursor: pointer;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .book-detail-header {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: flex-start;
        }

        .detail-book-cover {
            width: 150px;
            height: 220px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 4rem;
            font-weight: bold;
            flex-shrink: 0;
            background: linear-gradient(45deg, #8B0000, #DC143C);
        }

        .book-info {
            flex: 1;
        }

        .book-info h2 {
            font-size: 2.2rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .book-info .author {
            font-size: 1.2rem;
            color: #8B0000;
            margin-bottom: 20px;
        }

        .book-summary {
            font-size: 1rem;
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .book-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-box .value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #8B0000;
        }

        .stat-box .label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        /* Ï±ïÌÑ∞ Í∑∏Î¶¨Îìú */
        .chapters-section {
            margin-top: 40px;
        }

        .chapters-section h3 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 30px;
            text-align: center;
        }

        .chapters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .chapter-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
        }

        .chapter-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .chapter-card.completed {
            border-color: #28a745;
            background: linear-gradient(135deg, #28a74508, #ffffff);
        }

        .chapter-card.current {
            border-color: #8B0000;
            background: linear-gradient(135deg, #8B000008, #ffffff);
        }

        .chapter-card.locked {
            opacity: 0.6;
            background: #f8f9fa;
        }

        .chapter-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .chapter-info h4 {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }

        .chapter-info p {
            font-size: 0.95rem;
            color: #666;
            line-height: 1.5;
        }

        .chapter-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .chapter-status.completed {
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
        }

        .chapter-status.current {
            background: rgba(139, 0, 0, 0.1);
            color: #8B0000;
        }

        .chapter-status.locked {
            background: rgba(108, 117, 125, 0.1);
            color: #6c757d;
        }

        .chapter-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .chapter-btn {
            padding: 12px 16px;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .audio-btn {
            background: linear-gradient(45deg, #8B0000, #DC143C);
            color: white;
        }

        .quiz-btn {
            background: linear-gradient(45deg, #DC143C, #FFB6C1);
            color: white;
        }

        .chapter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .chapter-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* ÌïôÏäµ ÌôîÎ©¥ */
        .learning-screen {
            display: none;
        }

        .learning-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .learning-progress {
            background: #f8f9fa;
            border-radius: 10px;
            height: 8px;
            margin: 20px 0;
            overflow: hidden;
        }

        .learning-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #8B0000, #DC143C);
            transition: width 0.3s ease;
        }

        .question-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
        }

        .passage {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1rem;
            line-height: 1.6;
            color: #444;
        }

        .options {
            display: grid;
            gap: 10px;
        }

        .option {
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option:hover {
            background: #e9ecef;
            border-color: #8B0000;
        }

        .option.selected {
            background: rgba(139, 0, 0, 0.1);
            border-color: #8B0000;
        }

        .learning-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .control-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .next-btn {
            background: linear-gradient(45deg, #8B0000, #DC143C);
            color: white;
        }

        .prev-btn {
            background: #6c757d;
            color: white;
        }

        .submit-btn {
            background: linear-gradient(45deg, #8B0000, #DC143C);
            color: white;
        }

        .control-btn:hover {
            transform: translateY(-2px);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Í≤∞Í≥º ÌôîÎ©¥ */
        .result-screen {
            display: none;
            text-align: center;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(45deg, #8B0000, #DC143C);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            font-size: 2rem;
            font-weight: bold;
        }

        .result-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .result-stat {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .result-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        /* Ïò§ÎîîÏò§ ÌîåÎ†àÏù¥Ïñ¥ Î™®Îã¨ */
        .audio-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .audio-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 600px;
            width: 90%;
            position: relative;
        }

        .close-audio {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #666;
        }

        .audio-player {
            width: 100%;
            margin: 20px 0;
            border-radius: 10px;
        }

        .audio-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .audio-control-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .play-pause-btn {
            background: linear-gradient(45deg, #8B0000, #DC143C);
            color: white;
        }

        .speed-btn {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #ddd;
        }

        .download-btn {
            background: #DC143C;
            color: white;
        }

        .audio-info {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            font-size: 0.9rem;
            color: #666;
            transition: all 0.3s ease;
        }

        .audio-info.hidden {
            display: none;
        }

        /* Î∞òÏùëÌòï */
        @media (max-width: 768px) {
            .chapters-grid {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .book-detail-header {
                flex-direction: column;
                text-align: center;
            }

            .book-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .learning-controls {
                flex-direction: column;
            }

            .chapter-actions {
                grid-template-columns: 1fr;
            }

            .audio-controls {
                justify-content: center;
                gap: 10px;
            }

            .audio-content {
                padding: 30px 20px;
            }
        }

        .new-book-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: linear-gradient(45deg, #FF6B9D, #C44569);
            color: white;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: 700;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Level 4 ÌäπÎ≥Ñ Ïä§ÌÉÄÏùº */
        .level-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: linear-gradient(45deg, #8B0000, #FF6B9D);
            color: white;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ìó§Îçî -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">‚öîÔ∏è</div>
                <div class="logo-text">
                    <h1>Revolutionary War on Wednesday</h1>
                    <p>Level 4 - Mary Pope OsborneÏùò Îß§ÏßÅ Ìä∏Î¶¨ ÌïòÏö∞Ïä§ 22Í∂å</p>
                </div>
            </div>
            <div class="nav-buttons">
                <a href="http://www.suelibrary.store/" class="nav-btn">Î©îÏù∏ÏúºÎ°ú</a>
            </div>
        </div>

        <!-- Î©îÏù∏ ÏΩòÌÖêÏ∏† -->
        <div class="main-content">
            <!-- Ï±Ö ÏÉÅÏÑ∏ ÌôîÎ©¥ -->
            <div class="book-detail-screen" id="book-detail-screen">
                <div class="level-badge">Level 4</div>
                <div class="breadcrumb">
                    <span>Revolutionary War on Wednesday</span>
                </div>

                <div class="book-detail-header">
                    <div class="detail-book-cover">‚öîÔ∏è</div>
                    <div class="book-info">
                        <h2>Revolutionary War on Wednesday</h2>
                        <div class="author">Mary Pope Osborne</div>
                        <div class="book-summary">
                            Jack and Annie are transported to the time of the American Revolutionary War! They meet George Washington before he crosses the Delaware River, witness the harsh winter at Valley Forge, and help deliver an important message that could change the course of history. Experience the birth of American independence and the courage of those who fought for freedom.
                        </div>
                        <div class="book-stats">
                            <div class="stat-box">
                                <div class="value">10</div>
                                <div class="label">Ï±ïÌÑ∞</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">50</div>
                                <div class="label">Ï¥ù Î¨∏Ï†ú</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">Level 4</div>
                                <div class="label">Î†àÎ≤®</div>
                            </div>
                            <div class="stat-box">
                                <div class="value" id="progress-value">0%</div>
                                <div class="label">ÏßÑÎèÑ</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="chapters-section">
                    <h3>‚öîÔ∏è Ï±ïÌÑ∞Î≥Ñ ÌïôÏäµ</h3>
                    <div class="chapters-grid" id="chapters-grid">
                        <!-- Ï±ïÌÑ∞ Ïπ¥ÎìúÎì§ -->
                    </div>
                </div>
            </div>

            <!-- ÌïôÏäµ ÌôîÎ©¥ -->
            <div class="learning-screen" id="learning-screen">
                <div class="breadcrumb">
                    <a onclick="showBookDetail()">Revolutionary War on Wednesday</a>
                    <span>></span>
                    <span id="learning-chapter-breadcrumb">Chapter 1</span>
                </div>

                <div class="learning-header">
                    <h2 id="learning-title">Chapter 1: The Delaware</h2>
                    <div class="learning-progress">
                        <div class="learning-progress-bar" id="learning-progress-bar" style="width: 0%"></div>
                    </div>
                    <p id="learning-progress-text">Î¨∏Ï†ú 1 / 5</p>
                </div>

                <div class="question-container" id="question-container">
                    <!-- Î¨∏Ï†úÍ∞Ä ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
                </div>

                <div class="learning-controls">
                    <button class="control-btn prev-btn" id="prev-btn" onclick="previousQuestion()" disabled>Ïù¥Ï†Ñ</button>
                    <button class="control-btn next-btn" id="next-btn" onclick="nextQuestion()">Îã§Ïùå</button>
                    <button class="control-btn submit-btn" id="submit-btn" onclick="submitAnswers()" style="display: none;">Ï†úÏ∂ú</button>
                </div>
            </div>

            <!-- Í≤∞Í≥º ÌôîÎ©¥ -->
            <div class="result-screen" id="result-screen">
                <div class="breadcrumb">
                    <a onclick="showBookDetail()">Revolutionary War on Wednesday</a>
                    <span>></span>
                    <span>Í≤∞Í≥º</span>
                </div>

                <div class="result-header">
                    <h2>üéâ ÌïôÏäµ ÏôÑÎ£å!</h2>
                    <div class="score-circle" id="score-circle">100%</div>
                    <h3 id="result-message">ÌõåÎ•≠Ìï©ÎãàÎã§!</h3>
                </div>

                <div class="result-details">
                    <div class="result-stat">
                        <h4>Ï¥ù Î¨∏Ï†ú</h4>
                        <p id="total-questions">5Î¨∏Ï†ú</p>
                    </div>
                    <div class="result-stat">
                        <h4>Ï†ïÎãµ</h4>
                        <p id="correct-answers">5Î¨∏Ï†ú</p>
                    </div>
                    <div class="result-stat">
                        <h4>Ïò§Îãµ</h4>
                        <p id="wrong-answers">0Î¨∏Ï†ú</p>
                    </div>
                    <div class="result-stat">
                        <h4>Ï†êÏàò</h4>
                        <p id="final-score">100Ï†ê</p>
                    </div>
                </div>

                <div class="result-actions">
                    <button class="control-btn prev-btn" onclick="retryChapter()">Îã§Ïãú ÌíÄÍ∏∞</button>
                    <button class="control-btn next-btn" onclick="nextChapter()">Îã§Ïùå Ï±ïÌÑ∞</button>
                    <button class="control-btn submit-btn" onclick="showBookDetail()">Ï±ïÌÑ∞ Î™©Î°ù</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ïò§ÎîîÏò§ ÌîåÎ†àÏù¥Ïñ¥ Î™®Îã¨ -->
    <div class="audio-modal" id="audio-modal">
        <div class="audio-content">
            <button class="close-audio" onclick="closeAudioModal()">√ó</button>
            <h3 id="audio-chapter-title">Chapter 1: The Delaware</h3>
            <p id="audio-chapter-subtitle">Revolutionary War on Wednesday - Mary Pope Osborne</p>

            <audio class="audio-player" id="audio-player" controls preload="metadata">
                <source id="audio-source" src="" type="audio/mpeg">
                Î∏åÎùºÏö∞Ï†ÄÍ∞Ä Ïò§ÎîîÏò§Î•º ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.
            </audio>

            <div class="audio-controls">
                <button class="audio-control-btn play-pause-btn" onclick="togglePlayPause()">‚ñ∂Ô∏è Ïû¨ÏÉù</button>
                <button class="audio-control-btn speed-btn" onclick="changeSpeed()">1.0x</button>
                <button class="audio-control-btn" onclick="resetToChapterStart()" style="background: #28a745; color: white;">üîÑ Íµ¨Í∞ÑÏ≤òÏùå</button>
                <button class="audio-control-btn download-btn" onclick="downloadAudio()">üì• Îã§Ïö¥Î°úÎìú</button>
            </div>

            <div class="audio-info" id="audio-info">
                <div id="audio-status" style="margin-top: 10px; font-weight: bold; color: #8B0000;"></div>
            </div>
        </div>
    </div>

    <script>
        // üéØ Íµ¨Í∏Ä ÌÅ¥ÎùºÏö∞Îìú Ïä§ÌÜ†Î¶¨ÏßÄ Ïò§ÎîîÏò§ URL ÏÑ§Ï†ï
        const AUDIO_BASE_URL = 'https://storage.googleapis.com/kim-mom-reading-audio/audio/';

        // Magic Tree House 22Í∂å ÎèÑÏÑú Îç∞Ïù¥ÌÑ∞ (10Ï±ïÌÑ∞)
        const bookData = {
            id: 'MTH022',
            title: "Revolutionary War on Wednesday",
            author: 'Mary Pope Osborne',
            cover: '‚öîÔ∏è',
            progress: 0,
            chapters: 10,
            totalQuestions: 50,
            coverColor: 'linear-gradient(45deg, #8B0000, #DC143C)',
            summary: "Jack and Annie are transported to the time of the American Revolutionary War! They meet George Washington before he crosses the Delaware River, witness the harsh winter at Valley Forge, and help deliver an important message that could change the course of history. Experience the birth of American independence and the courage of those who fought for freedom.",
            chapterList: [
                { title: 'The Delaware', description: 'Jack and Annie arrive during Washington\'s famous crossing of the Delaware River.', status: 'current', questionCount: 5, startTime: 0 },
                { title: 'Captain of the Guard', description: 'They meet the captain of Washington\'s guard and learn about the mission.', status: 'locked', questionCount: 5, startTime: 300 },
                { title: 'Crossing the River', description: 'They help with the dangerous river crossing on a cold December night.', status: 'locked', questionCount: 5, startTime: 600 },
                { title: 'The Letter', description: 'A mysterious letter holds important information for General Washington.', status: 'locked', questionCount: 5, startTime: 900 },
                { title: 'The Spy', description: 'They discover a British spy and must warn the American forces.', status: 'locked', questionCount: 5, startTime: 1200 },
                { title: 'The Password', description: 'Learning the secret password becomes crucial for their mission.', status: 'locked', questionCount: 5, startTime: 1500 },
                { title: 'The Bridge', description: 'A dangerous journey across a bridge under enemy fire.', status: 'locked', questionCount: 5, startTime: 1800 },
                { title: 'The Battle', description: 'They witness the Battle of Trenton and its importance to the war.', status: 'locked', questionCount: 5, startTime: 2100 },
                { title: 'These Are the Times', description: 'They meet Thomas Paine and learn about the power of words.', status: 'locked', questionCount: 5, startTime: 2400 },
                { title: 'Just in Time', description: 'Their mission is completed just in time to help change history.', status: 'locked', questionCount: 5, startTime: 2700 }
            ]
        };

        // Î¨∏Ï†ú Îç∞Ïù¥ÌÑ∞ (Ï†ÑÏ≤¥ 10Ï±ïÌÑ∞ ÏôÑÎ£å)
        const questionsData = {
            0: [ // Chapter 1: The Delaware
                {
                    passage: "Jack and Annie found themselves on the banks of the Delaware River on a cold December night in 1776, watching soldiers prepare for a dangerous crossing.",
                    question: "When and where did Jack and Annie arrive?",
                    options: ["A summer day by a lake", "Cold December night 1776 at Delaware River watching soldiers", "Spring morning in a field", "Autumn evening in a city"],
                    correct: 1
                },
                {
                    passage: "The soldiers were preparing to cross the icy river in small boats, despite the harsh winter weather and floating chunks of ice that made the journey treacherous.",
                    question: "What made the river crossing dangerous for the soldiers?",
                    options: ["Enemy ships", "Harsh winter weather and floating ice chunks making journey treacherous", "Deep water only", "Strong winds"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie observed that the soldiers looked cold, tired, and worried, but they were determined to follow their commander across the river.",
                    question: "How did the soldiers appear to Jack and Annie?",
                    options: ["Happy and well-rested", "Cold, tired, and worried but determined to follow their commander", "Angry and rebellious", "Confident and excited"],
                    correct: 1
                },
                {
                    passage: "They learned that this was General George Washington's army, preparing for a surprise attack that could change the course of the Revolutionary War.",
                    question: "Whose army was preparing to cross the river and why?",
                    options: ["British army retreating", "General George Washington's army preparing surprise attack to change Revolutionary War", "French army exploring", "Colonial militia practicing"],
                    correct: 1
                },
                {
                    passage: "The crossing had to be completed in secret and in darkness to maintain the element of surprise against the enemy forces.",
                    question: "Why did the crossing need to be done in secret and darkness?",
                    options: ["Better weather at night", "To maintain element of surprise against enemy forces", "To avoid paying tolls", "Rivers were safer at night"],
                    correct: 1
                }
            ],
            1: [ // Chapter 2: Captain of the Guard
                {
                    passage: "A tall officer in a blue uniform approached Jack and Annie, introducing himself as the captain of Washington's guard and asking what they were doing there.",
                    question: "Who approached Jack and Annie and what did he want to know?",
                    options: ["A British soldier asking for directions", "Captain of Washington's guard asking what they were doing there", "A local farmer offering help", "A fellow child looking for parents"],
                    correct: 1
                },
                {
                    passage: "The captain explained that they were about to undertake a mission that could save the Continental Army and the cause of American independence.",
                    question: "What did the captain say about their mission?",
                    options: ["It was just a training exercise", "Mission could save Continental Army and American independence cause", "They were retreating to safety", "It was a routine patrol"],
                    correct: 1
                },
                {
                    passage: "He told them that the army had suffered many defeats and morale was very low, but this surprise attack could turn the tide of the war.",
                    question: "What was the condition of the Continental Army according to the captain?",
                    options: ["They were winning easily", "Army suffered defeats, low morale, but surprise attack could turn tide", "They were well-supplied and confident", "They were ready to surrender"],
                    correct: 1
                },
                {
                    passage: "The captain warned Jack and Annie that the mission was extremely dangerous and that many soldiers might not survive the night.",
                    question: "What warning did the captain give Jack and Annie?",
                    options: ["The weather would be bad", "Mission extremely dangerous, many soldiers might not survive the night", "They would get lost", "The boats were uncomfortable"],
                    correct: 1
                },
                {
                    passage: "Despite the danger, the captain said that freedom was worth any risk, and that they were fighting for the future of their new nation.",
                    question: "What did the captain say about the risk they were taking?",
                    options: ["It wasn't worth it", "Freedom was worth any risk, fighting for future of new nation", "They should wait for better conditions", "The enemy was too strong"],
                    correct: 1
                }
            ],
            2: [ // Chapter 3: Crossing the River
                {
                    passage: "Jack and Annie helped load supplies into the small boats as soldiers began the treacherous crossing of the ice-filled Delaware River.",
                    question: "How did Jack and Annie help with the river crossing?",
                    options: ["They stayed on shore and watched", "Helped load supplies into small boats for the treacherous crossing", "They guided the boats", "They counted the soldiers"],
                    correct: 1
                },
                {
                    passage: "The boats were overcrowded with soldiers, horses, and cannons, making the crossing even more dangerous as ice chunks threatened to damage the vessels.",
                    question: "What made the boats dangerous during the crossing?",
                    options: ["Too much food", "Overcrowded with soldiers, horses, cannons, plus ice chunks threatening vessels", "Bad weather only", "Enemy fire from shore"],
                    correct: 1
                },
                {
                    passage: "Many soldiers had no shoes and left bloody footprints in the snow, showing their dedication despite terrible hardships.",
                    question: "What showed the soldiers' dedication despite hardships?",
                    options: ["They sang songs", "Many had no shoes, left bloody footprints in snow despite hardships", "They marched quickly", "They carried heavy packs"],
                    correct: 1
                },
                {
                    passage: "General Washington himself was in one of the boats, standing tall and brave, inspiring confidence in his men during the dangerous crossing.",
                    question: "How did General Washington inspire his men during the crossing?",
                    options: ["He gave speeches", "Stood tall and brave in boat, inspiring confidence during dangerous crossing", "He sang with them", "He helped row the boats"],
                    correct: 1
                },
                {
                    passage: "The crossing took much longer than expected due to the ice and harsh weather, but eventually all the men and equipment made it safely across.",
                    question: "What happened with the timing of the crossing?",
                    options: ["It went exactly as planned", "Took much longer than expected due to ice and weather, but all made it safely", "They had to turn back", "Only half the army crossed"],
                    correct: 1
                }
            ],
            3: [ // Chapter 4: The Letter
                {
                    passage: "A messenger arrived with an urgent letter for General Washington, but he was wounded and asked Jack and Annie to deliver it for him.",
                    question: "What did the wounded messenger ask Jack and Annie to do?",
                    options: ["Help him walk", "Deliver urgent letter to General Washington for him", "Find a doctor", "Hide from enemies"],
                    correct: 1
                },
                {
                    passage: "The letter contained crucial information about enemy troop movements that could determine the success or failure of the surprise attack.",
                    question: "What important information did the letter contain?",
                    options: ["Weather predictions", "Crucial information about enemy troop movements for the surprise attack", "Supply lists", "Personal messages"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie had to find General Washington quickly, as the information in the letter could change the entire battle plan.",
                    question: "Why did Jack and Annie need to find Washington quickly?",
                    options: ["He was expecting them", "Information in letter could change entire battle plan", "They were lost", "It was getting late"],
                    correct: 1
                },
                {
                    passage: "They searched through the camp of soldiers, asking for directions to Washington's headquarters while keeping the letter safe.",
                    question: "How did Jack and Annie search for General Washington?",
                    options: ["They waited for him to find them", "Searched camp asking for directions to headquarters while keeping letter safe", "They followed other officers", "They shouted his name"],
                    correct: 1
                },
                {
                    passage: "The letter was sealed with wax, and Jack and Annie realized that delivering it intact was crucial for the success of the mission.",
                    question: "What did Jack and Annie realize about the letter's importance?",
                    options: ["It was just routine correspondence", "Delivering it intact was crucial for mission success", "It could wait until morning", "Anyone could read it"],
                    correct: 1
                }
            ],
            4: [ // Chapter 5: The Spy
                {
                    passage: "While searching for Washington, Jack and Annie overheard a man speaking to British soldiers, revealing that there was a spy in the American camp.",
                    question: "What did Jack and Annie discover while searching for Washington?",
                    options: ["A lost soldier", "A spy in American camp speaking to British soldiers", "A secret weapon", "A hidden treasure"],
                    correct: 1
                },
                {
                    passage: "The spy was giving the British information about Washington's surprise attack, which could ruin the entire mission and endanger all the soldiers.",
                    question: "What was the spy doing that endangered the mission?",
                    options: ["Stealing supplies", "Giving British information about Washington's surprise attack", "Spreading rumors", "Breaking equipment"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie realized they had to warn the American forces about the spy before the surprise attack began and the enemy was ready for them.",
                    question: "What did Jack and Annie need to do about the spy?",
                    options: ["Ignore the situation", "Warn American forces before surprise attack began and enemy was ready", "Follow the spy", "Tell other children"],
                    correct: 1
                },
                {
                    passage: "They had to be very careful not to be seen by the spy or the British soldiers, as being caught could result in serious consequences.",
                    question: "Why did Jack and Annie need to be careful around the spy?",
                    options: ["He might recognize them", "Being caught by spy or British could result in serious consequences", "They were supposed to be sleeping", "They weren't allowed in that area"],
                    correct: 1
                },
                {
                    passage: "The information about the spy was just as important as the letter they were carrying, making their mission twice as crucial.",
                    question: "How did discovering the spy affect their mission?",
                    options: ["It made it easier", "Information about spy was as important as letter, making mission twice as crucial", "It didn't matter", "It delayed them too much"],
                    correct: 1
                }
            ],
            5: [ // Chapter 6: The Password
                {
                    passage: "To reach General Washington safely, Jack and Annie had to learn the secret password that would allow them past the guards.",
                    question: "What did Jack and Annie need to get past the guards?",
                    options: ["A written permit", "The secret password to reach General Washington safely", "An officer's uniform", "A special badge"],
                    correct: 1
                },
                {
                    passage: "They listened carefully to conversations between soldiers until they heard someone mention the password: 'Victory or Death.'",
                    question: "How did they learn the password and what was it?",
                    options: ["A guard told them directly", "Listened to soldiers' conversations, password was 'Victory or Death'", "They found it written down", "An officer gave it to them"],
                    correct: 1
                },
                {
                    passage: "The password 'Victory or Death' reflected the desperate situation of the Continental Army and their determination to succeed or perish trying.",
                    question: "What did the password 'Victory or Death' reflect about the army?",
                    options: ["They were confident of easy victory", "Desperate situation and determination to succeed or perish trying", "They were just being dramatic", "It was a joke among soldiers"],
                    correct: 1
                },
                {
                    passage: "When challenged by the guards, Jack nervously whispered the password, and they were allowed to pass through to the command area.",
                    question: "What happened when Jack and Annie encountered the guards?",
                    options: ["They were turned away", "Jack nervously whispered password and they were allowed through", "The guards recognized them", "They had to show identification"],
                    correct: 1
                },
                {
                    passage: "Using the correct password saved precious time and allowed them to continue their urgent mission to deliver the letter and spy information.",
                    question: "Why was knowing the password important for their mission?",
                    options: ["It impressed the soldiers", "Saved precious time to continue urgent mission with letter and spy information", "It was required by army rules", "Guards would have been angry"],
                    correct: 1
                }
            ],
            6: [ // Chapter 7: The Bridge
                {
                    passage: "To reach Washington's headquarters, Jack and Annie had to cross a narrow wooden bridge while enemy musket fire whistled overhead.",
                    question: "What danger did Jack and Annie face crossing the bridge?",
                    options: ["The bridge was broken", "Enemy musket fire whistled overhead while crossing narrow wooden bridge", "It was too crowded", "The weather was bad"],
                    correct: 1
                },
                {
                    passage: "Soldiers told them to keep low and move quickly across the bridge, as British sharpshooters were positioned in the trees nearby.",
                    question: "What advice did soldiers give them about crossing the bridge?",
                    options: ["Take their time and be careful", "Keep low and move quickly because British sharpshooters in nearby trees", "Wait for backup", "Use the ropes on the sides"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie crawled across the bridge on their hands and knees, clutching the important letter while bullets splintered the wood around them.",
                    question: "How did Jack and Annie cross the dangerous bridge?",
                    options: ["They ran standing up", "Crawled on hands and knees clutching letter while bullets splintered wood", "They rode on a horse", "Soldiers carried them"],
                    correct: 1
                },
                {
                    passage: "Halfway across the bridge, Annie's cloak got caught on a loose board, and Jack had to help free her while staying hidden from the enemy.",
                    question: "What problem occurred halfway across the bridge?",
                    options: ["Jack dropped the letter", "Annie's cloak caught on loose board, Jack helped free her while staying hidden", "They forgot the password", "A soldier fell"],
                    correct: 1
                },
                {
                    passage: "Once they safely reached the other side, they realized that their courage had been tested, but their determination to complete the mission remained strong.",
                    question: "What did Jack and Annie realize after crossing the bridge safely?",
                    options: ["They wanted to go home", "Courage was tested but determination to complete mission remained strong", "It was easier than expected", "They were too scared to continue"],
                    correct: 1
                }
            ],
            7: [ // Chapter 8: The Battle
                {
                    passage: "Jack and Annie finally reached General Washington and delivered both the letter and the information about the British spy just as the battle was about to begin.",
                    question: "What did Jack and Annie accomplish just before the battle?",
                    options: ["They found a safe place to hide", "Reached Washington, delivered letter and spy information before battle began", "They joined the fighting", "They got lost in confusion"],
                    correct: 1
                },
                {
                    passage: "Washington read the letter quickly and immediately changed his battle plans based on the new information about enemy positions.",
                    question: "How did Washington respond to the letter?",
                    options: ["He ignored it until later", "Read quickly and immediately changed battle plans based on enemy positions", "He was too busy to read it", "He gave it to another officer"],
                    correct: 1
                },
                {
                    passage: "The Battle of Trenton began with Washington's forces surprising the Hessian soldiers who were celebrating Christmas and not expecting an attack.",
                    question: "How did the Battle of Trenton begin?",
                    options: ["With formal declarations", "Washington surprised Hessian soldiers celebrating Christmas, not expecting attack", "Both sides met at noon", "The British attacked first"],
                    correct: 1
                },
                {
                    passage: "Thanks to the information Jack and Annie provided, the American forces were able to avoid the British trap and achieve a crucial victory.",
                    question: "How did Jack and Annie's information help the battle?",
                    options: ["It didn't make any difference", "Information helped Americans avoid British trap and achieve crucial victory", "It only confused the generals", "It arrived too late"],
                    correct: 1
                },
                {
                    passage: "The victory at Trenton was a turning point that restored hope to the Continental Army and encouraged more colonists to join the fight for independence.",
                    question: "What was the significance of the victory at Trenton?",
                    options: ["It ended the war immediately", "Turning point that restored hope and encouraged more colonists to join independence fight", "It was just a small skirmish", "It made the British angry"],
                    correct: 1
                }
            ],
            8: [ // Chapter 9: These Are the Times
                {
                    passage: "After the battle, Jack and Annie met Thomas Paine, the author of 'Common Sense,' who was writing another pamphlet to inspire the American soldiers.",
                    question: "Who did Jack and Annie meet after the battle and what was he doing?",
                    options: ["A British prisoner asking for help", "Thomas Paine, author of 'Common Sense,' writing pamphlet to inspire soldiers", "A doctor treating wounds", "A French diplomat"],
                    correct: 1
                },
                {
                    passage: "Thomas Paine was writing 'The Crisis,' which began with the famous words: 'These are the times that try men's souls.'",
                    question: "What was Thomas Paine writing and how did it begin?",
                    options: ["A letter home", "'The Crisis' beginning with 'These are the times that try men's souls'", "A battle report", "A poem about victory"],
                    correct: 1
                },
                {
                    passage: "Paine explained to Jack and Annie that words could be as powerful as weapons in inspiring people to fight for their beliefs and freedom.",
                    question: "What did Thomas Paine teach Jack and Annie about words?",
                    options: ["Words were not important in war", "Words could be as powerful as weapons in inspiring people to fight for freedom", "Only actions mattered", "Writing was a waste of time"],
                    correct: 1
                },
                {
                    passage: "He told them that the pamphlet would be read to soldiers around campfires to remind them why they were fighting and to give them courage.",
                    question: "How would Paine's pamphlet be used according to what he said?",
                    options: ["Kept secret from soldiers", "Read to soldiers around campfires to remind them why fighting and give courage", "Only read by officers", "Sent to England as a threat"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie learned that the Revolutionary War was being fought not just with muskets and cannons, but also with ideas and words that could change minds.",
                    question: "What did Jack and Annie learn about how the Revolutionary War was fought?",
                    options: ["Only with weapons", "Not just with muskets and cannons, but with ideas and words that changed minds", "Through secret negotiations", "By avoiding battles"],
                    correct: 1
                }
            ],
            9: [ // Chapter 10: Just in Time
                {
                    passage: "As dawn broke over the battlefield, Jack and Annie realized that their mission had been completed successfully and they had helped change the course of history.",
                    question: "What did Jack and Annie realize as dawn broke over the battlefield?",
                    options: ["They had failed their mission", "Mission completed successfully, they helped change course of history", "They needed to find Washington again", "The battle was still going on"],
                    correct: 1
                },
                {
                    passage: "The tree house appeared in the distance, and they knew it was time to return home, having witnessed one of the most important moments in American history.",
                    question: "What appeared in the distance and what did it mean?",
                    options: ["A British ship", "Tree house appeared, time to return home having witnessed important American history", "Another battle", "Their families looking for them"],
                    correct: 1
                },
                {
                    passage: "Before leaving, General Washington personally thanked Jack and Annie for their brave service and the crucial information they had provided.",
                    question: "What did General Washington do before they left?",
                    options: ["He ignored them", "Personally thanked them for brave service and crucial information provided", "He gave them medals", "He asked them to stay"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie understood that ordinary people, even children, could make a difference in important historical events through courage and determination.",
                    question: "What important lesson did Jack and Annie learn?",
                    options: ["Only adults could make a difference", "Ordinary people, even children, could make difference in history through courage", "History couldn't be changed", "They were too young to help"],
                    correct: 1
                },
                {
                    passage: "As they climbed into the tree house, they felt proud to have helped the brave soldiers who were fighting for the freedom that would become the United States of America.",
                    question: "How did Jack and Annie feel climbing into the tree house?",
                    options: ["Sad to leave", "Proud to have helped brave soldiers fighting for freedom of future United States", "Worried about getting home", "Tired from the adventure"],
                    correct: 1
                }
            ]
        };

        // Ï†ÑÏó≠ Î≥ÄÏàò
        let currentChapterIndex = 0;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let questions = [];
        let currentAudio = null;
        let playbackSpeed = 1.0;

        // üéß ÏûêÎèô Ïò§ÎîîÏò§ URL ÏÉùÏÑ± Ìï®Ïàò
        function getAudioUrl(chapterIndex) {
            const level = 'level4';
            const bookId = 'MTH022';
            const chapterNum = String(chapterIndex + 1).padStart(2, '0');
            
            const possibleFileNames = [
                `${bookId}_chapter${chapterNum}.mp3`,
                `${bookId}_ch${chapterNum}.mp3`,
                `${bookId}_${chapterNum}.mp3`,
                `magic_tree_house_22_chapter${chapterNum}.mp3`,
                `magic_tree_house_22_ch${chapterNum}.mp3`,
                `revolutionary_war_on_wednesday_${chapterNum}.mp3`,
                `mary_pope_osborne_22_chapter${chapterNum}.mp3`,
                `${bookId}.mp3`
            ];
            
            return {
                primary: `${AUDIO_BASE_URL}${level}/${possibleFileNames[0]}`,
                alternatives: possibleFileNames.map(fileName => `${AUDIO_BASE_URL}${level}/${fileName}`)
            };
        }

        // üéß Ïò§ÎîîÏò§ Ïû¨ÏÉù Ìï®Ïàò
        function playChapterAudio(chapterIndex) {
            const chapter = bookData.chapterList[chapterIndex];
            const audioUrls = getAudioUrl(chapterIndex);

            document.getElementById('audio-modal').style.display = 'flex';
            document.getElementById('audio-chapter-title').textContent = `Chapter ${chapterIndex + 1}: ${chapter.title}`;
            document.getElementById('audio-chapter-subtitle').textContent = `${bookData.title} - ${bookData.author}`;

            document.getElementById('audio-info').classList.remove('hidden');

            const audioPlayer = document.getElementById('audio-player');
            const audioSource = document.getElementById('audio-source');
            const audioStatus = document.getElementById('audio-status');

            audioStatus.textContent = 'üîÑ Ïò§ÎîîÏò§ ÌååÏùºÏùÑ Ï∞æÎäî Ï§ë...';

            function tryLoadAudio(urlIndex = 0) {
                if (urlIndex >= audioUrls.alternatives.length) {
                    audioStatus.innerHTML = `‚ùå Ïò§ÎîîÏò§ ÌååÏùºÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.`;
                    return;
                }

                const currentUrl = audioUrls.alternatives[urlIndex];
                audioSource.src = currentUrl;
                audioPlayer.load();

                const successHandler = function() {
                    const startTime = chapter.startTime || 0;
                    audioPlayer.currentTime = startTime;
                    audioStatus.innerHTML = `‚úÖ Ïò§ÎîîÏò§ Ï§ÄÎπÑ ÏôÑÎ£å!`;
                };

                const errorHandler = function() {
                    setTimeout(() => tryLoadAudio(urlIndex + 1), 100);
                };

                audioPlayer.addEventListener('canplaythrough', successHandler, { once: true });
                audioPlayer.addEventListener('error', errorHandler, { once: true });
            }

            tryLoadAudio(0);
            currentAudio = audioPlayer;
            playbackSpeed = 1.0;
        }

        // Í∏∞Î≥∏ Ìï®ÏàòÎì§
        function closeAudioModal() {
            document.getElementById('audio-modal').style.display = 'none';
            if (currentAudio) currentAudio.pause();
        }

        function togglePlayPause() {
            if (!currentAudio) return;
            if (currentAudio.paused) {
                currentAudio.play();
                document.querySelector('.play-pause-btn').textContent = '‚è∏Ô∏è ÏùºÏãúÏ†ïÏßÄ';
            } else {
                currentAudio.pause();
                document.querySelector('.play-pause-btn').textContent = '‚ñ∂Ô∏è Ïû¨ÏÉù';
            }
        }

        function changeSpeed() {
            if (!currentAudio) return;
            const speeds = [0.5, 0.75, 1.0, 1.25, 1.5, 2.0];
            const currentIndex = speeds.indexOf(playbackSpeed);
            playbackSpeed = speeds[(currentIndex + 1) % speeds.length];
            currentAudio.playbackRate = playbackSpeed;
            document.querySelector('.speed-btn').textContent = `${playbackSpeed}x`;
        }

        function resetToChapterStart() {
            if (!currentAudio) return;
            const currentChapter = parseInt(document.getElementById('audio-chapter-title').textContent.match(/Chapter (\d+)/)[1]) - 1;
            currentAudio.currentTime = bookData.chapterList[currentChapter]?.startTime || 0;
        }

        function downloadAudio() {
            const audioSource = document.getElementById('audio-source');
            if (audioSource.src) {
                const link = document.createElement('a');
                link.href = audioSource.src;
                link.download = `${document.getElementById('audio-chapter-title').textContent}.mp3`;
                link.click();
            }
        }

        // Ï±Ö ÏÉÅÏÑ∏ Ï†ïÎ≥¥ ÌëúÏãú
        function showBookDetail() {
            document.getElementById('book-detail-screen').style.display = 'block';
            document.getElementById('learning-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'none';
            generateChapterGrid();
            updateProgress();
        }

        // Ï±ïÌÑ∞ Í∑∏Î¶¨Îìú ÏÉùÏÑ±
        function generateChapterGrid() {
            const grid = document.getElementById('chapters-grid');
            grid.innerHTML = '';

            bookData.chapterList.forEach((chapter, index) => {
                const chapterCard = document.createElement('div');
                chapterCard.className = `chapter-card ${chapter.status}`;

                chapterCard.innerHTML = `
                    <div class="chapter-header">
                        <div class="chapter-info">
                            <h4>Chapter ${index + 1}: ${chapter.title}</h4>
                            <p>${chapter.description} (${chapter.questionCount}Î¨∏Ï†ú)</p>
                        </div>
                        <div class="chapter-status ${chapter.status}">
                            ${chapter.status === 'completed' ? '‚úÖ ÏôÑÎ£å' :
                              chapter.status === 'current' ? 'üìñ ÏßÑÌñâÏ§ë' : 'üîí Ïû†ÍπÄ'}
                        </div>
                    </div>
                    <div class="chapter-actions">
                        <button class="chapter-btn audio-btn" onclick="playChapterAudio(${index})"
                                ${chapter.status === 'locked' ? 'disabled' : ''}>
                            üéß Ïò§ÎîîÏò§
                        </button>
                        <button class="chapter-btn quiz-btn" onclick="startLearning(${index})"
                                ${chapter.status === 'locked' ? 'disabled' : ''}>
                            üìù Î¨∏Ï†úÌíÄÍ∏∞
                        </button>
                    </div>
                `;

                grid.appendChild(chapterCard);
            });
        }

        // ÏßÑÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
        function updateProgress() {
            const completedChapters = bookData.chapterList.filter(chapter => chapter.status === 'completed').length;
            const progress = Math.round((completedChapters / bookData.chapters) * 100);
            document.getElementById('progress-value').textContent = progress + '%';
        }

        // ÌïôÏäµ ÏãúÏûë
        function startLearning(chapterIndex) {
            currentChapterIndex = chapterIndex;
            currentQuestionIndex = 0;
            userAnswers = [];
            questions = questionsData[chapterIndex];

            if (!questions || questions.length === 0) {
                alert('Ïù¥ Ï±ïÌÑ∞Ïùò Î¨∏Ï†úÍ∞Ä ÏïÑÏßÅ Ï§ÄÎπÑÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                return;
            }

            document.getElementById('book-detail-screen').style.display = 'none';
            document.getElementById('learning-screen').style.display = 'block';
            document.getElementById('result-screen').style.display = 'none';

            const chapter = bookData.chapterList[chapterIndex];
            document.getElementById('learning-title').textContent = `Chapter ${chapterIndex + 1}: ${chapter.title}`;
            document.getElementById('learning-chapter-breadcrumb').textContent = `Chapter ${chapterIndex + 1}`;

            showQuestion();
            updateLearningProgress();
        }

        // Î¨∏Ï†ú ÌëúÏãú
        function showQuestion() {
            const question = questions[currentQuestionIndex];
            const container = document.getElementById('question-container');

            container.innerHTML = `
                <div class="question-text">Î¨∏Ï†ú ${currentQuestionIndex + 1}</div>
                <div class="passage">${question.passage}</div>
                <div class="question-text">${question.question}</div>
                <div class="options">
                    ${question.options.map((option, index) =>
                        `<div class="option" onclick="selectOption(${index})" data-index="${index}">
                            ${String.fromCharCode(65 + index)}. ${option}
                        </div>`
                    ).join('')}
                </div>
            `;

            if (userAnswers[currentQuestionIndex] !== undefined) {
                const selectedOption = container.querySelector(`[data-index="${userAnswers[currentQuestionIndex]}"]`);
                if (selectedOption) selectedOption.classList.add('selected');
            }

            updateNavigationButtons();
        }

        // ÏÑ†ÌÉùÏßÄ ÏÑ†ÌÉù
        function selectOption(optionIndex) {
            document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
            document.querySelector(`[data-index="${optionIndex}"]`).classList.add('selected');
            userAnswers[currentQuestionIndex] = optionIndex;
            updateNavigationButtons();
        }

        // ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò
        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                showQuestion();
                updateLearningProgress();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion();
                updateLearningProgress();
            }
        }

        function updateLearningProgress() {
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('learning-progress-bar').style.width = progress + '%';
            document.getElementById('learning-progress-text').textContent = `Î¨∏Ï†ú ${currentQuestionIndex + 1} / ${questions.length}`;
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const submitBtn = document.getElementById('submit-btn');

            prevBtn.disabled = currentQuestionIndex === 0;

            if (currentQuestionIndex === questions.length - 1) {
                nextBtn.style.display = 'none';
                submitBtn.style.display = 'block';
                submitBtn.disabled = userAnswers[currentQuestionIndex] === undefined;
            } else {
                nextBtn.style.display = 'block';
                submitBtn.style.display = 'none';
                nextBtn.disabled = userAnswers[currentQuestionIndex] === undefined;
            }
        }

        // ÎãµÏïà Ï†úÏ∂ú
        function submitAnswers() {
            let correctCount = 0;
            questions.forEach((question, index) => {
                if (userAnswers[index] === question.correct) correctCount++;
            });

            const score = Math.round((correctCount / questions.length) * 100);

            if (score >= 70) {
                bookData.chapterList[currentChapterIndex].status = 'completed';
                if (currentChapterIndex < bookData.chapterList.length - 1) {
                    bookData.chapterList[currentChapterIndex + 1].status = 'current';
                }
            }

            showResults(correctCount, questions.length, score);
        }

        // Í≤∞Í≥º ÌëúÏãú
        function showResults(correct, total, score) {
            document.getElementById('learning-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';

            document.getElementById('score-circle').textContent = score + '%';
            document.getElementById('total-questions').textContent = total + 'Î¨∏Ï†ú';
            document.getElementById('correct-answers').textContent = correct + 'Î¨∏Ï†ú';
            document.getElementById('wrong-answers').textContent = (total - correct) + 'Î¨∏Ï†ú';
            document.getElementById('final-score').textContent = score + 'Ï†ê';

            let message = '';
            if (score >= 90) message = 'ÌõåÎ•≠Ìï©ÎãàÎã§! üåü';
            else if (score >= 80) message = 'ÏûòÌñàÏñ¥Ïöî! üëè';
            else if (score >= 70) message = 'Ï¢ãÏïÑÏöî! üëç';
            else message = 'Îã§Ïãú ÌïúÎ≤à ÎèÑÏ†ÑÌï¥Î≥¥ÏÑ∏Ïöî! üí™';

            document.getElementById('result-message').textContent = message;
        }

        function retryChapter() {
            startLearning(currentChapterIndex);
        }

        function nextChapter() {
            if (currentChapterIndex < bookData.chapterList.length - 1) {
                startLearning(currentChapterIndex + 1);
            } else {
                alert('Î™®Îì† Ï±ïÌÑ∞Î•º ÏôÑÎ£åÌñàÏäµÎãàÎã§! üéâ');
                showBookDetail();
            }
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú
        window.addEventListener('load', function() {
            showBookDetail();
            console.log('‚öîÔ∏è Magic Tree House: Revolutionary War on Wednesday ÌïôÏäµ ÏãúÏä§ÌÖúÏù¥ Ï§ÄÎπÑÎêòÏóàÏäµÎãàÎã§!');
        });

        // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠Ïãú Îã´Í∏∞
        document.getElementById('audio-modal').addEventListener('click', function(e) {
            if (e.target === this) closeAudioModal();
        });
    </script>
</body>
</html>
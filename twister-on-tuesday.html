<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twister on Tuesday - Level 3-2 - ìˆ˜ë¦¬ë”©ì–´í•™ì›</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #8B4513 0%, #DEB887 50%, #F4A460 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        /* í—¤ë” */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #8B4513, #DEB887);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .logo-text h1 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
        }

        .logo-text p {
            font-size: 0.9rem;
            color: #666;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
            color: #333;
            text-decoration: none;
        }

        .nav-btn:hover {
            background: #8B4513;
            color: white;
            transform: translateY(-2px);
        }

        /* ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ */
        .main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            min-height: 600px;
        }

        /* ì±… ìƒì„¸ í™”ë©´ */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 30px;
            font-size: 0.9rem;
            color: #666;
        }

        .breadcrumb a {
            color: #8B4513;
            text-decoration: none;
            cursor: pointer;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .book-detail-header {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: flex-start;
        }

        .detail-book-cover {
            width: 150px;
            height: 220px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 4rem;
            font-weight: bold;
            flex-shrink: 0;
            background: linear-gradient(45deg, #8B4513, #DEB887);
        }

        .book-info {
            flex: 1;
        }

        .book-info h2 {
            font-size: 2.2rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .book-info .author {
            font-size: 1.2rem;
            color: #8B4513;
            margin-bottom: 20px;
        }

        .book-summary {
            font-size: 1rem;
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .book-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-box .value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #8B4513;
        }

        .stat-box .label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        /* ì±•í„° ê·¸ë¦¬ë“œ */
        .chapters-section {
            margin-top: 40px;
        }

        .chapters-section h3 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 30px;
            text-align: center;
        }

        .chapters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .chapter-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
        }

        .chapter-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .chapter-card.completed {
            border-color: #28a745;
            background: linear-gradient(135deg, #28a74508, #ffffff);
        }

        .chapter-card.current {
            border-color: #8B4513;
            background: linear-gradient(135deg, #8B451308, #ffffff);
        }

        .chapter-card.locked {
            opacity: 0.6;
            background: #f8f9fa;
        }

        .chapter-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .chapter-info h4 {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }

        .chapter-info p {
            font-size: 0.95rem;
            color: #666;
            line-height: 1.5;
        }

        .chapter-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .chapter-status.completed {
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
        }

        .chapter-status.current {
            background: rgba(139, 69, 19, 0.1);
            color: #8B4513;
        }

        .chapter-status.locked {
            background: rgba(108, 117, 125, 0.1);
            color: #6c757d;
        }

        .chapter-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .chapter-btn {
            padding: 12px 16px;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .audio-btn {
            background: linear-gradient(45deg, #8B4513, #DEB887);
            color: white;
        }

        .quiz-btn {
            background: linear-gradient(45deg, #DEB887, #F4A460);
            color: #333;
        }

        .chapter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .chapter-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* í•™ìŠµ í™”ë©´ */
        .learning-screen {
            display: none;
        }

        .learning-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .learning-progress {
            background: #f8f9fa;
            border-radius: 10px;
            height: 8px;
            margin: 20px 0;
            overflow: hidden;
        }

        .learning-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #8B4513, #DEB887);
            transition: width 0.3s ease;
        }

        .question-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
        }

        .passage {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1rem;
            line-height: 1.6;
            color: #444;
        }

        .options {
            display: grid;
            gap: 10px;
        }

        .option {
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option:hover {
            background: #e9ecef;
            border-color: #8B4513;
        }

        .option.selected {
            background: rgba(139, 69, 19, 0.1);
            border-color: #8B4513;
        }

        .learning-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .control-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .next-btn {
            background: linear-gradient(45deg, #8B4513, #DEB887);
            color: white;
        }

        .prev-btn {
            background: #6c757d;
            color: white;
        }

        .submit-btn {
            background: linear-gradient(45deg, #8B4513, #DEB887);
            color: white;
        }

        .control-btn:hover {
            transform: translateY(-2px);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* ê²°ê³¼ í™”ë©´ */
        .result-screen {
            display: none;
            text-align: center;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(45deg, #8B4513, #DEB887);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            font-size: 2rem;
            font-weight: bold;
        }

        .result-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .result-stat {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .result-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        /* ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ ëª¨ë‹¬ */
        .audio-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .audio-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 600px;
            width: 90%;
            position: relative;
        }

        .close-audio {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #666;
        }

        .audio-player {
            width: 100%;
            margin: 20px 0;
            border-radius: 10px;
        }

        .audio-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .audio-control-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .play-pause-btn {
            background: linear-gradient(45deg, #8B4513, #DEB887);
            color: white;
        }

        .speed-btn {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #ddd;
        }

        .download-btn {
            background: #DEB887;
            color: white;
        }

        .audio-info {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            font-size: 0.9rem;
            color: #666;
            transition: all 0.3s ease;
        }

        .audio-info.hidden {
            display: none;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .chapters-grid {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .book-detail-header {
                flex-direction: column;
                text-align: center;
            }

            .book-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .learning-controls {
                flex-direction: column;
            }

            .chapter-actions {
                grid-template-columns: 1fr;
            }

            .audio-controls {
                justify-content: center;
                gap: 10px;
            }

            .audio-content {
                padding: 30px 20px;
            }
        }

        /* Level 3-2 íŠ¹ë³„ ìŠ¤íƒ€ì¼ */
        .level-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: linear-gradient(45deg, #8B4513, #FF6B9D);
            color: white;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">ğŸŒªï¸</div>
                <div class="logo-text">
                    <h1>Twister on Tuesday</h1>
                    <p>Level 3-2 - Mary Pope Osborneì˜ ë§ˆë²•ì˜ ë‚˜ë¬´ì§‘ ì‹œë¦¬ì¦ˆ</p>
                </div>
            </div>
            <div class="nav-buttons">
                <a href="http://www.suelibrary.store/" class="nav-btn">ë©”ì¸ìœ¼ë¡œ</a>
            </div>
        </div>

        <!-- ë©”ì¸ ì½˜í…ì¸  -->
        <div class="main-content">
            <!-- ì±… ìƒì„¸ í™”ë©´ -->
            <div class="book-detail-screen" id="book-detail-screen">
                <div class="level-badge">Level 3-2</div>
                <div class="breadcrumb">
                    <span>Twister on Tuesday</span>
                </div>

                <div class="book-detail-header">
                    <div class="detail-book-cover">ğŸŒªï¸</div>
                    <div class="book-info">
                        <h2>Twister on Tuesday</h2>
                        <div class="author">Mary Pope Osborne</div>
                        <div class="book-summary">
                            An adventure to blow you away! Jack and Annie are whisked back to the 1870s Kansas prairie when the Magic Tree House takes them on their 23rd adventure. They're on a mission to find "something to learn" and discover a one-room schoolhouse where they meet teenage teacher Miss Neely and students Will, Kate, and the challenging bully Jeb. As they experience pioneer life firsthand, they learn about the hardships of frontier living. But when dark storm clouds gather and form a terrifying twister, Jack and Annie must brave the howling winds to warn everyone at the schoolhouse and help them reach safety in the storm cellar below.
                        </div>
                        <div class="book-stats">
                            <div class="stat-box">
                                <div class="value">10</div>
                                <div class="label">ì±•í„°</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">50</div>
                                <div class="label">ì´ ë¬¸ì œ</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">Level 3-2</div>
                                <div class="label">ë ˆë²¨</div>
                            </div>
                            <div class="stat-box">
                                <div class="value" id="progress-value">0%</div>
                                <div class="label">ì§„ë„</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="chapters-section">
                    <h3>ğŸŒªï¸ ì±•í„°ë³„ í•™ìŠµ</h3>
                    <div class="chapters-grid" id="chapters-grid">
                        <!-- ì±•í„° ì¹´ë“œë“¤ -->
                    </div>
                </div>
            </div>

            <!-- í•™ìŠµ í™”ë©´ -->
            <div class="learning-screen" id="learning-screen">
                <div class="breadcrumb">
                    <a onclick="showBookDetail()">Twister on Tuesday</a>
                    <span>></span>
                    <span id="learning-chapter-breadcrumb">Chapter 1</span>
                </div>

                <div class="learning-header">
                    <h2 id="learning-title">Chapter 1</h2>
                    <div class="learning-progress">
                        <div class="learning-progress-bar" id="learning-progress-bar" style="width: 0%"></div>
                    </div>
                    <p id="learning-progress-text">ë¬¸ì œ 1 / 5</p>
                </div>

                <div class="question-container" id="question-container">
                    <!-- ë¬¸ì œê°€ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>

                <div class="learning-controls">
                    <button class="control-btn prev-btn" id="prev-btn" onclick="previousQuestion()" disabled>ì´ì „</button>
                    <button class="control-btn next-btn" id="next-btn" onclick="nextQuestion()">ë‹¤ìŒ</button>
                    <button class="control-btn submit-btn" id="submit-btn" onclick="submitAnswers()" style="display: none;">ì œì¶œ</button>
                </div>
            </div>

            <!-- ê²°ê³¼ í™”ë©´ -->
            <div class="result-screen" id="result-screen">
                <div class="breadcrumb">
                    <a onclick="showBookDetail()">Twister on Tuesday</a>
                    <span>></span>
                    <span>ê²°ê³¼</span>
                </div>

                <div class="result-header">
                    <h2>ğŸ‰ í•™ìŠµ ì™„ë£Œ!</h2>
                    <div class="score-circle" id="score-circle">100%</div>
                    <h3 id="result-message">í›Œë¥­í•©ë‹ˆë‹¤!</h3>
                </div>

                <div class="result-details">
                    <div class="result-stat">
                        <h4>ì´ ë¬¸ì œ</h4>
                        <p id="total-questions">5ë¬¸ì œ</p>
                    </div>
                    <div class="result-stat">
                        <h4>ì •ë‹µ</h4>
                        <p id="correct-answers">5ë¬¸ì œ</p>
                    </div>
                    <div class="result-stat">
                        <h4>ì˜¤ë‹µ</h4>
                        <p id="wrong-answers">0ë¬¸ì œ</p>
                    </div>
                    <div class="result-stat">
                        <h4>ì ìˆ˜</h4>
                        <p id="final-score">100ì </p>
                    </div>
                </div>

                <div class="result-actions">
                    <button class="control-btn prev-btn" onclick="retryChapter()">ë‹¤ì‹œ í’€ê¸°</button>
                    <button class="control-btn next-btn" onclick="nextChapter()">ë‹¤ìŒ ì±•í„°</button>
                    <button class="control-btn submit-btn" onclick="showBookDetail()">ì±•í„° ëª©ë¡</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ ëª¨ë‹¬ -->
    <div class="audio-modal" id="audio-modal">
        <div class="audio-content">
            <button class="close-audio" onclick="closeAudioModal()">Ã—</button>
            <h3 id="audio-chapter-title">Chapter 1</h3>
            <p id="audio-chapter-subtitle">Twister on Tuesday - Mary Pope Osborne</p>

            <audio class="audio-player" id="audio-player" controls preload="metadata">
                <source id="audio-source" src="" type="audio/mpeg">
                ë¸Œë¼ìš°ì €ê°€ ì˜¤ë””ì˜¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
            </audio>

            <div class="audio-controls">
                <button class="audio-control-btn play-pause-btn" onclick="togglePlayPause()">â–¶ï¸ ì¬ìƒ</button>
                <button class="audio-control-btn speed-btn" onclick="changeSpeed()">1.0x</button>
                <button class="audio-control-btn" onclick="resetToChapterStart()" style="background: #28a745; color: white;">ğŸ”„ êµ¬ê°„ì²˜ìŒ</button>
                <button class="audio-control-btn download-btn" onclick="downloadAudio()">ğŸ“¥ ë‹¤ìš´ë¡œë“œ</button>
            </div>

            <div class="audio-info" id="audio-info">
                <div id="audio-status" style="margin-top: 10px; font-weight: bold; color: #8B4513;"></div>
            </div>
        </div>
    </div>

    <script>
        // ğŸ¯ êµ¬ê¸€ í´ë¼ìš°ë“œ ìŠ¤í† ë¦¬ì§€ ì˜¤ë””ì˜¤ URL ì„¤ì •
        const AUDIO_BASE_URL = 'https://storage.googleapis.com/kim-mom-reading-audio/audio/';

        // ğŸ§ Twister on Tuesday íŒŒì¼ ë§¤í•‘ (ê° ì±•í„°ë³„ ê°œë³„ íŒŒì¼)
        const twisterFileMapping = {
            0: { fileName: '001 Tuesday.mp3' },                    // Chapter 1: Tuesday!
            1: { fileName: '002 Signs of Life.mp3' },              // Chapter 2: Signs of Life  
            2: { fileName: '003 One-Room Schoolhouse.mp3' },       // Chapter 3: One-Room Schoolhouse
            3: { fileName: '004 Reading Lesson.mp3' },             // Chapter 4: Reading Lesson
            4: { fileName: '005 Bully.mp3' },                      // Chapter 5: Bully
            5: { fileName: '006 Grasshopper Attack.mp3' },         // Chapter 6: Grasshopper Attack?
            6: { fileName: '007 Twister.mp3' },                    // Chapter 7: Twister!
            7: { fileName: '008 Get Below.mp3' },                  // Chapter 8: Get Below!
            8: { fileName: '009 All Clear.mp3' },                  // Chapter 9: All Safe
            9: { fileName: '010 The Third Writing.mp3' }           // Chapter 10: Try, Try Again
        };

        // ì „ì—­ ë³€ìˆ˜
        let currentChapterIndex = 0;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let questions = [];
        let currentAudio = null;
        let playbackSpeed = 1.0;

        // ğŸ§ Twister on Tuesday ì˜¤ë””ì˜¤ URL ìƒì„± í•¨ìˆ˜ (ê°œë³„ íŒŒì¼ìš©)
        function getAudioUrl(chapterIndex) {
            const audioData = twisterFileMapping[chapterIndex];
            if (!audioData) return null;
            
            return {
                primary: `${AUDIO_BASE_URL}TOT023_Twister_on_Tuesday/${audioData.fileName}`,
                fileName: audioData.fileName,
                alternatives: [`${AUDIO_BASE_URL}TOT023_Twister_on_Tuesday/${audioData.fileName}`]
            };
        }

        // ğŸ§ Twister on Tuesday ì˜¤ë””ì˜¤ ì¬ìƒ í•¨ìˆ˜ (ê°œë³„ íŒŒì¼ìš©)
        function playChapterAudio(chapterIndex) {
            const chapter = bookData.chapterList[chapterIndex];
            const audioData = getAudioUrl(chapterIndex);

            if (!audioData) {
                alert('ì´ ì±•í„°ì˜ ì˜¤ë””ì˜¤ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            document.getElementById('audio-modal').style.display = 'flex';
            document.getElementById('audio-chapter-title').textContent = `Chapter ${chapterIndex + 1}`;
            document.getElementById('audio-chapter-subtitle').textContent = `${bookData.title} - ${bookData.author}`;
            document.getElementById('audio-info').classList.remove('hidden');

            const audioPlayer = document.getElementById('audio-player');
            const audioSource = document.getElementById('audio-source');
            const audioStatus = document.getElementById('audio-status');

            audioStatus.textContent = 'ğŸ”„ ì˜¤ë””ì˜¤ íŒŒì¼ì„ ë¡œë”© ì¤‘...';

            // ê°œë³„ ì˜¤ë””ì˜¤ íŒŒì¼ ë¡œë“œ
            audioSource.src = audioData.primary;
            audioPlayer.load();

            console.log('Loading audio from:', audioData.primary); // ë””ë²„ê¹…ìš©

            const successHandler = function() {
                audioStatus.innerHTML = `âœ… Chapter ${chapterIndex + 1} (${audioData.fileName}) ë¡œë“œ ì™„ë£Œ!`;

                // ğŸ¯ ì±•í„° í´ë¦­ ì¦‰ì‹œ ì¬ìƒ ì‹œë„!
                audioPlayer.play().then(() => {
                    audioStatus.innerHTML = `ğŸµ Chapter ${chapterIndex + 1} ì¬ìƒ ì¤‘!`;
                    document.querySelector('.play-pause-btn').textContent = 'â¸ï¸ ì¼ì‹œì •ì§€';
                }).catch(e => {
                    console.log('ìë™ ì¬ìƒ ì°¨ë‹¨ë¨:', e);
                    audioStatus.innerHTML = `âœ… Chapter ${chapterIndex + 1} ì¤€ë¹„ë¨! â–¶ï¸ ì¬ìƒ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”`;
                });
            };

            const errorHandler = function() {
                console.error('Audio load error for:', audioData.primary);
                audioStatus.innerHTML = 'âŒ ì˜¤ë””ì˜¤ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
            };

            audioPlayer.addEventListener('canplaythrough', successHandler, { once: true });
            audioPlayer.addEventListener('error', errorHandler, { once: true });

            currentAudio = audioPlayer;
            playbackSpeed = 1.0;
        }

        // ğŸ§ êµ¬ê°„ì²˜ìŒìœ¼ë¡œ í•¨ìˆ˜ (ê°œë³„ íŒŒì¼ì´ë¯€ë¡œ ì²˜ìŒë¶€í„° ì¬ìƒ)
        function resetToChapterStart() {
            if (!currentAudio) return;
            
            currentAudio.currentTime = 0;
            console.log('ğŸ”„ ì±•í„° ì²˜ìŒë¶€í„° ì¬ìƒ');
        }

        // ê¸°ë³¸ ì˜¤ë””ì˜¤ ì»¨íŠ¸ë¡¤ í•¨ìˆ˜ë“¤
        function closeAudioModal() {
            document.getElementById('audio-modal').style.display = 'none';
            if (currentAudio) currentAudio.pause();
        }

        function togglePlayPause() {
            if (!currentAudio) return;
            if (currentAudio.paused) {
                currentAudio.play();
                document.querySelector('.play-pause-btn').textContent = 'â¸ï¸ ì¼ì‹œì •ì§€';
            } else {
                currentAudio.pause();
                document.querySelector('.play-pause-btn').textContent = 'â–¶ï¸ ì¬ìƒ';
            }
        }

        function changeSpeed() {
            if (!currentAudio) return;
            const speeds = [0.5, 0.75, 1.0, 1.25, 1.5, 2.0];
            const currentIndex = speeds.indexOf(playbackSpeed);
            playbackSpeed = speeds[(currentIndex + 1) % speeds.length];
            currentAudio.playbackRate = playbackSpeed;
            document.querySelector('.speed-btn').textContent = `${playbackSpeed}x`;
        }

        function downloadAudio() {
            const audioSource = document.getElementById('audio-source');
            if (audioSource.src) {
                const link = document.createElement('a');
                link.href = audioSource.src;
                link.download = `${document.getElementById('audio-chapter-title').textContent}.mp3`;
                link.click();
            }
        }

        // Twister on Tuesday ë„ì„œ ë°ì´í„° (ì •í™•í•œ 10ì±•í„°)
        const bookData = {
            id: 'TOT023',
            title: "Twister on Tuesday",
            author: 'Mary Pope Osborne',
            cover: 'ğŸŒªï¸',
            progress: 0,
            chapters: 10,
            totalQuestions: 50,
            coverColor: 'linear-gradient(45deg, #8B4513, #DEB887)',
            summary: "An adventure to blow you away! Jack and Annie are whisked back to the 1870s Kansas prairie when the Magic Tree House takes them on their 23rd adventure. They're on a mission to find 'something to learn' and discover a one-room schoolhouse where they meet teenage teacher Miss Neely and students Will, Kate, and the challenging bully Jeb. As they experience pioneer life firsthand, they learn about the hardships of frontier living. But when dark storm clouds gather and form a terrifying twister, Jack and Annie must brave the howling winds to warn everyone at the schoolhouse and help them reach safety in the storm cellar below.",
            chapterList: [
                { title: 'Chapter 1: Tuesday!', description: 'Jack and Annie are excited for their Tuesday adventure and head to the Magic Tree House.', status: 'current', questionCount: 5 },
                { title: 'Chapter 2: Signs of Life', description: 'They arrive on the Kansas prairie in the 1870s and see signs of pioneer life.', status: 'current', questionCount: 5 },
                { title: 'Chapter 3: One-Room Schoolhouse', description: 'Jack and Annie discover a dugout schoolhouse built into a hill.', status: 'current', questionCount: 5 },
                { title: 'Chapter 4: Reading Lesson', description: 'They meet teacher Miss Neely and students Will, Kate, and Jeb for a reading lesson.', status: 'current', questionCount: 5 },
                { title: 'Chapter 5: Bully', description: 'Jeb proves to be a difficult bully who makes trouble for Jack and Annie.', status: 'current', questionCount: 5 },
                { title: 'Chapter 6: Grasshopper Attack?', description: 'The children think they see a grasshopper attack, but it turns out to be something else.', status: 'current', questionCount: 5 },
                { title: 'Chapter 7: Twister!', description: 'Dark storm clouds form a dangerous twister heading toward the schoolhouse.', status: 'current', questionCount: 5 },
                { title: 'Chapter 8: Get Below!', description: 'Jack and Annie race back to warn everyone and get them to the storm cellar.', status: 'current', questionCount: 5 },
                { title: 'Chapter 9: All Safe', description: 'Everyone takes shelter in the cellar and waits for the twister to pass.', status: 'current', questionCount: 5 },
                { title: 'Chapter 10: Try, Try Again', description: 'After the storm, Jack and Annie learn about persistence and friendship from their adventure.', status: 'current', questionCount: 5 }
            ]
        };

        // ë¬¸ì œ ë°ì´í„° (ìŠ¤í† ë¦¬ì— ê¸°ë°˜í•œ ìƒ˜í”Œ ë¬¸ì œë“¤)
        const questionsData = {
            0: [ // Chapter 1: Tuesday!
                {
                    passage: "Jack and Annie were excited because it was Tuesday and Morgan had promised them another adventure.",
                    question: "Why were Jack and Annie excited about Tuesday?",
                    options: ["It was their favorite day of the week", "Morgan had promised them another adventure", "They didn't have school", "They were going to visit friends"],
                    correct: 1
                },
                {
                    passage: "They had already collected a list from the Civil War and a letter from the Revolutionary War, and now they needed something to learn.",
                    question: "What did Jack and Annie need to find on this mission?",
                    options: ["Another letter", "Something to learn", "A treasure map", "A magic spell"],
                    correct: 1
                },
                {
                    passage: "In the Magic Tree House, they found a book titled 'Life on the Prairie' which reminded them of their previous adventure with Black Hawk.",
                    question: "What book did they find in the tree house?",
                    options: ["Pioneer Stories", "Life on the Prairie", "Kansas Adventures", "Frontier Tales"],
                    correct: 1
                },
                {
                    passage: "When Annie pointed to the book and wished they could go there, the tree house began to spin as always.",
                    question: "What happened when Annie made her wish?",
                    options: ["Nothing happened", "The tree house began to spin", "The book disappeared", "They heard thunder"],
                    correct: 1
                },
                {
                    passage: "As the tree house spun, their clothes magically changed to match the time period they were visiting.",
                    question: "What happened to their clothes during the journey?",
                    options: ["They stayed the same", "They got wet", "They magically changed to match the time period", "They disappeared"],
                    correct: 2
                }
            ],
            1: [ // Chapter 2: Signs of Life
                {
                    passage: "Jack and Annie found themselves on the Kansas prairie in the 1870s, surrounded by vast grassland.",
                    question: "Where did Jack and Annie land?",
                    options: ["In a forest", "On the Kansas prairie in the 1870s", "In a town", "By a river"],
                    correct: 1
                },
                {
                    passage: "In the distance, they could see several covered wagons moving across the prairie as families traveled west.",
                    question: "What did they see moving across the prairie?",
                    options: ["Wild animals", "Several covered wagons with families traveling west", "Native Americans on horses", "A train"],
                    correct: 1
                },
                {
                    passage: "Annie noticed smoke coming from a pipe that was sticking out of a small hill.",
                    question: "What did Annie notice coming from a hill?",
                    options: ["Fire", "Smoke coming from a pipe", "Water", "Animals"],
                    correct: 1
                },
                {
                    passage: "The smoke indicated that there was some kind of dwelling built into the hillside, which was common on the prairie.",
                    question: "What did the smoke indicate?",
                    options: ["A forest fire", "Some kind of dwelling built into the hillside", "A campfire", "An underground cave"],
                    correct: 1
                },
                {
                    passage: "Jack explained that prairie settlers often built homes into hills because there weren't many trees for lumber.",
                    question: "Why did prairie settlers build homes into hills?",
                    options: ["It was easier to build", "There weren't many trees for lumber", "It was warmer", "It looked better"],
                    correct: 1
                }
            ],
            2: [ // Chapter 3: One-Room Schoolhouse
                {
                    passage: "Jack and Annie discovered that the dwelling was actually a dugout schoolhouse built into the hillside.",
                    question: "What kind of building did Jack and Annie discover?",
                    options: ["A regular house", "A dugout schoolhouse built into the hillside", "A barn", "A store"],
                    correct: 1
                },
                {
                    passage: "The schoolhouse was made of sod bricks and built into the hill for protection from the harsh prairie weather.",
                    question: "What was the schoolhouse made of and why?",
                    options: ["Wood for beauty", "Sod bricks built into the hill for protection from harsh weather", "Stone for strength", "Metal for durability"],
                    correct: 1
                },
                {
                    passage: "Miss Neely, a young woman, answered the door when they knocked. She was the schoolteacher.",
                    question: "Who answered the door when Jack and Annie knocked?",
                    options: ["An old man", "Miss Neely, a young woman who was the schoolteacher", "A child", "No one"],
                    correct: 1
                },
                {
                    passage: "Inside the schoolhouse, they could see it was small but functional, with desks and a blackboard.",
                    question: "What could they see inside the schoolhouse?",
                    options: ["It was empty", "It was small but functional with desks and a blackboard", "It was very large", "It was falling apart"],
                    correct: 1
                },
                {
                    passage: "Jack and Annie told Miss Neely they were traveling to California with their family.",
                    question: "What did Jack and Annie tell Miss Neely?",
                    options: ["They were lost", "They were traveling to California with their family", "They lived nearby", "They were looking for work"],
                    correct: 1
                }
            ]
            // More chapters would continue here with similar structure...
        };

        // ì±… ìƒì„¸ ì •ë³´ í‘œì‹œ
        function showBookDetail() {
            document.getElementById('book-detail-screen').style.display = 'block';
            document.getElementById('learning-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'none';
            generateChapterGrid();
            updateProgress();
        }

        // ì±•í„° ê·¸ë¦¬ë“œ ìƒì„±
        function generateChapterGrid() {
            const grid = document.getElementById('chapters-grid');
            grid.innerHTML = '';

            bookData.chapterList.forEach((chapter, index) => {
                const chapterCard = document.createElement('div');
                chapterCard.className = `chapter-card ${chapter.status}`;

                chapterCard.innerHTML = `
                    <div class="chapter-header">
                        <div class="chapter-info">
                            <h4>${chapter.title}</h4>
                            <p>${chapter.description} (${chapter.questionCount}ë¬¸ì œ)</p>
                        </div>
                        <div class="chapter-status ${chapter.status}">
                            ${chapter.status === 'completed' ? 'âœ… ì™„ë£Œ' :
                              chapter.status === 'current' ? 'ğŸ“– ì§„í–‰ì¤‘' : 'ğŸ”’ ì ê¹€'}
                        </div>
                    </div>
                    <div class="chapter-actions">
                        <button class="chapter-btn audio-btn" onclick="playChapterAudio(${index})"
                                ${chapter.status === 'locked' ? 'disabled' : ''}>
                            ğŸ§ ì˜¤ë””ì˜¤
                        </button>
                        <button class="chapter-btn quiz-btn" onclick="startLearning(${index})"
                                ${chapter.status === 'locked' ? 'disabled' : ''}>
                            ğŸ“ ë¬¸ì œí’€ê¸°
                        </button>
                    </div>
                `;

                grid.appendChild(chapterCard);
            });
        }

        // ì§„ë„ ì—…ë°ì´íŠ¸
        function updateProgress() {
            const completedChapters = bookData.chapterList.filter(chapter => chapter.status === 'completed').length;
            const progressPercent = Math.round((completedChapters / bookData.chapters) * 100);
            document.getElementById('progress-value').textContent = `${progressPercent}%`;
        }

        // í•™ìŠµ ì‹œì‘
        function startLearning(chapterIndex) {
            if (bookData.chapterList[chapterIndex].status === 'locked') return;

            currentChapterIndex = chapterIndex;
            currentQuestionIndex = 0;
            userAnswers = [];
            questions = questionsData[chapterIndex] || [];

            if (questions.length === 0) {
                alert('ì´ ì±•í„°ì˜ ë¬¸ì œê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }

            document.getElementById('book-detail-screen').style.display = 'none';
            document.getElementById('learning-screen').style.display = 'block';
            document.getElementById('result-screen').style.display = 'none';

            const chapter = bookData.chapterList[chapterIndex];
            document.getElementById('learning-title').textContent = chapter.title;
            document.getElementById('learning-chapter-breadcrumb').textContent = chapter.title;

            showQuestion();
        }

        // ë¬¸ì œ í‘œì‹œ
        function showQuestion() {
            if (currentQuestionIndex >= questions.length) {
                submitAnswers();
                return;
            }

            const question = questions[currentQuestionIndex];
            const container = document.getElementById('question-container');

            container.innerHTML = `
                <div class="passage">${question.passage}</div>
                <div class="question-text">${question.question}</div>
                <div class="options">
                    ${question.options.map((option, index) =>
                        `<div class="option" onclick="selectOption(${index})" data-index="${index}">
                            ${String.fromCharCode(65 + index)}. ${option}
                        </div>`
                    ).join('')}
                </div>
            `;

            // ì§„ë„ ë°” ì—…ë°ì´íŠ¸
            const progressPercent = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('learning-progress-bar').style.width = `${progressPercent}%`;
            document.getElementById('learning-progress-text').textContent = `ë¬¸ì œ ${currentQuestionIndex + 1} / ${questions.length}`;

            // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            document.getElementById('prev-btn').disabled = currentQuestionIndex === 0;
            document.getElementById('next-btn').style.display = currentQuestionIndex === questions.length - 1 ? 'none' : 'inline-block';
            document.getElementById('submit-btn').style.display = currentQuestionIndex === questions.length - 1 ? 'inline-block' : 'none';

            // ì´ì „ ë‹µë³€ì´ ìˆë‹¤ë©´ í‘œì‹œ
            if (userAnswers[currentQuestionIndex] !== undefined) {
                const selectedOption = container.querySelector(`[data-index="${userAnswers[currentQuestionIndex]}"]`);
                if (selectedOption) {
                    selectedOption.classList.add('selected');
                }
            }
        }

        // ì˜µì…˜ ì„ íƒ
        function selectOption(index) {
            // ê¸°ì¡´ ì„ íƒ ì œê±°
            document.querySelectorAll('.option').forEach(option => {
                option.classList.remove('selected');
            });

            // ìƒˆ ì„ íƒ ì¶”ê°€
            document.querySelector(`[data-index="${index}"]`).classList.add('selected');
            userAnswers[currentQuestionIndex] = index;
        }

        // ë‹¤ìŒ ë¬¸ì œ
        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                showQuestion();
            }
        }

        // ì´ì „ ë¬¸ì œ
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion();
            }
        }

        // ë‹µì•ˆ ì œì¶œ
        function submitAnswers() {
            let correctCount = 0;
            for (let i = 0; i < questions.length; i++) {
                if (userAnswers[i] === questions[i].correct) {
                    correctCount++;
                }
            }

            const score = Math.round((correctCount / questions.length) * 100);

            // ì±•í„° ìƒíƒœ ì—…ë°ì´íŠ¸
            if (score >= 70) { // 70ì  ì´ìƒì´ë©´ í†µê³¼
                bookData.chapterList[currentChapterIndex].status = 'completed';

                // ë‹¤ìŒ ì±•í„° ì ê¸ˆ í•´ì œ
                if (currentChapterIndex + 1 < bookData.chapterList.length) {
                    if (bookData.chapterList[currentChapterIndex + 1].status === 'locked') {
                        bookData.chapterList[currentChapterIndex + 1].status = 'current';
                    }
                }
            }

            showResult(correctCount, score);
        }

        // ê²°ê³¼ í‘œì‹œ
        function showResult(correctCount, score) {
            document.getElementById('learning-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';

            document.getElementById('score-circle').textContent = `${score}%`;
            document.getElementById('total-questions').textContent = `${questions.length}ë¬¸ì œ`;
            document.getElementById('correct-answers').textContent = `${correctCount}ë¬¸ì œ`;
            document.getElementById('wrong-answers').textContent = `${questions.length - correctCount}ë¬¸ì œ`;
            document.getElementById('final-score').textContent = `${score}ì `;

            let message = '';
            let circleColor = '';

            if (score >= 90) {
                message = 'ğŸŒŸ ì™„ë²½í•©ë‹ˆë‹¤!';
                circleColor = 'linear-gradient(45deg, #8B4513, #DEB887)';
            } else if (score >= 80) {
                message = 'ğŸ‰ í›Œë¥­í•´ìš”!';
                circleColor = 'linear-gradient(45deg, #8B4513, #DEB887)';
            } else if (score >= 70) {
                message = 'ğŸ‘ ì˜í–ˆì–´ìš”!';
                circleColor = 'linear-gradient(45deg, #8B4513, #DEB887)';
            } else {
                message = 'ğŸ’ª ë‹¤ì‹œ ë„ì „í•´ë³´ì„¸ìš”!';
                circleColor = 'linear-gradient(45deg, #ff9800, #f57c00)';
            }

            document.getElementById('result-message').textContent = message;
            document.getElementById('score-circle').style.background = circleColor;
        }

        // ì±•í„° ë‹¤ì‹œ í’€ê¸°
        function retryChapter() {
            startLearning(currentChapterIndex);
        }

        // ë‹¤ìŒ ì±•í„°
        function nextChapter() {
            if (currentChapterIndex + 1 < bookData.chapterList.length) {
                if (bookData.chapterList[currentChapterIndex + 1].status !== 'locked') {
                    startLearning(currentChapterIndex + 1);
                } else {
                    showBookDetail();
                }
            } else {
                showBookDetail();
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('DOMContentLoaded', function() {
            showBookDetail();
        });

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('learning-screen').style.display === 'block') {
                if (e.key === 'ArrowLeft') {
                    previousQuestion();
                } else if (e.key === 'ArrowRight') {
                    nextQuestion();
                } else if (e.key >= '1' && e.key <= '4') {
                    const index = parseInt(e.key) - 1;
                    if (index < questions[currentQuestionIndex]?.options.length) {
                        selectOption(index);
                    }
                }
            }

            if (e.key === 'Escape') {
                closeAudioModal();
            }
        });

        // ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.addEventListener('DOMContentLoaded', function() {
            const audioPlayer = document.getElementById('audio-player');

            audioPlayer.addEventListener('play', function() {
                document.querySelector('.play-pause-btn').textContent = 'â¸ï¸ ì¼ì‹œì •ì§€';
            });

            audioPlayer.addEventListener('pause', function() {
                document.querySelector('.play-pause-btn').textContent = 'â–¶ï¸ ì¬ìƒ';
            });

            audioPlayer.addEventListener('ended', function() {
                document.querySelector('.play-pause-btn').textContent = 'â–¶ï¸ ì¬ìƒ';
            });
        });
    </script>
</body>
</html>
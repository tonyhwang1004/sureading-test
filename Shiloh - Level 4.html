<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shiloh - Level 4-1 - ÏàòÎ¶¨Îî©Ïñ¥ÌïôÏõê</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #2196F3 0%, #03A9F4 50%, #00BCD4 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        /* Ìó§Îçî */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #2196F3, #03A9F4);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .logo-text h1 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
        }

        .logo-text p {
            font-size: 0.9rem;
            color: #666;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
            color: #333;
            text-decoration: none;
        }

        .nav-btn:hover {
            background: #2196F3;
            color: white;
            transform: translateY(-2px);
        }

        /* Î©îÏù∏ ÏΩòÌÖêÏ∏† ÏòÅÏó≠ */
        .main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            min-height: 600px;
        }

        /* Ï±Ö ÏÉÅÏÑ∏ ÌôîÎ©¥ */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 30px;
            font-size: 0.9rem;
            color: #666;
        }

        .breadcrumb a {
            color: #2196F3;
            text-decoration: none;
            cursor: pointer;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .book-detail-header {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: flex-start;
        }

        .detail-book-cover {
            width: 150px;
            height: 220px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 4rem;
            font-weight: bold;
            flex-shrink: 0;
            background: linear-gradient(45deg, #2196F3, #03A9F4);
        }

        .book-info {
            flex: 1;
        }

        .book-info h2 {
            font-size: 2.2rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .book-info .author {
            font-size: 1.2rem;
            color: #2196F3;
            margin-bottom: 20px;
        }

        .book-summary {
            font-size: 1rem;
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .book-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-box .value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2196F3;
        }

        .stat-box .label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        /* Ï±ïÌÑ∞ Í∑∏Î¶¨Îìú */
        .chapters-section {
            margin-top: 40px;
        }

        .chapters-section h3 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 30px;
            text-align: center;
        }

        .chapters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .chapter-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
        }

        .chapter-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .chapter-card.completed {
            border-color: #28a745;
            background: linear-gradient(135deg, #28a74508, #ffffff);
        }

        .chapter-card.current {
            border-color: #2196F3;
            background: linear-gradient(135deg, #2196F308, #ffffff);
        }

        .chapter-card.locked {
            opacity: 0.6;
            background: #f8f9fa;
        }

        .chapter-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .chapter-info h4 {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }

        .chapter-info p {
            font-size: 0.95rem;
            color: #666;
            line-height: 1.5;
        }

        .chapter-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .chapter-status.completed {
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
        }

        .chapter-status.current {
            background: rgba(33, 150, 243, 0.1);
            color: #2196F3;
        }

        .chapter-status.locked {
            background: rgba(108, 117, 125, 0.1);
            color: #6c757d;
        }

        .chapter-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .chapter-btn {
            padding: 12px 16px;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .audio-btn {
            background: linear-gradient(45deg, #2196F3, #03A9F4);
            color: white;
        }

        .quiz-btn {
            background: linear-gradient(45deg, #03A9F4, #00BCD4);
            color: white;
        }

        .chapter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .chapter-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* ÌïôÏäµ ÌôîÎ©¥ */
        .learning-screen {
            display: none;
        }

        .learning-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .learning-progress {
            background: #f8f9fa;
            border-radius: 10px;
            height: 8px;
            margin: 20px 0;
            overflow: hidden;
        }

        .learning-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #2196F3, #03A9F4);
            transition: width 0.3s ease;
        }

        .question-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
        }

        .passage {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1rem;
            line-height: 1.6;
            color: #444;
        }

        .options {
            display: grid;
            gap: 10px;
        }

        .option {
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option:hover {
            background: #e9ecef;
            border-color: #2196F3;
        }

        .option.selected {
            background: rgba(33, 150, 243, 0.1);
            border-color: #2196F3;
        }

        .learning-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .control-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .next-btn {
            background: linear-gradient(45deg, #2196F3, #03A9F4);
            color: white;
        }

        .prev-btn {
            background: #6c757d;
            color: white;
        }

        .submit-btn {
            background: linear-gradient(45deg, #2196F3, #03A9F4);
            color: white;
        }

        .control-btn:hover {
            transform: translateY(-2px);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Í≤∞Í≥º ÌôîÎ©¥ */
        .result-screen {
            display: none;
            text-align: center;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(45deg, #2196F3, #03A9F4);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            font-size: 2rem;
            font-weight: bold;
        }

        .result-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .result-stat {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .result-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        /* Ïò§ÎîîÏò§ ÌîåÎ†àÏù¥Ïñ¥ Î™®Îã¨ */
        .audio-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .audio-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 600px;
            width: 90%;
            position: relative;
        }

        .close-audio {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #666;
        }

        .audio-player {
            width: 100%;
            margin: 20px 0;
            border-radius: 10px;
        }

        .audio-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .audio-control-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .play-pause-btn {
            background: linear-gradient(45deg, #2196F3, #03A9F4);
            color: white;
        }

        .speed-btn {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #ddd;
        }

        .download-btn {
            background: #03A9F4;
            color: white;
        }

        .audio-info {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            font-size: 0.9rem;
            color: #666;
            transition: all 0.3s ease;
        }

        .audio-info.hidden {
            display: none;
        }

        /* Î∞òÏùëÌòï */
        @media (max-width: 768px) {
            .chapters-grid {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .book-detail-header {
                flex-direction: column;
                text-align: center;
            }

            .book-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .learning-controls {
                flex-direction: column;
            }

            .chapter-actions {
                grid-template-columns: 1fr;
            }

            .audio-controls {
                justify-content: center;
                gap: 10px;
            }

            .audio-content {
                padding: 30px 20px;
            }
        }

        .new-book-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: linear-gradient(45deg, #FF6B9D, #C44569);
            color: white;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: 700;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Level 4 ÌäπÎ≥Ñ Ïä§ÌÉÄÏùº */
        .level-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: linear-gradient(45deg, #2196F3, #FF6B9D);
            color: white;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ìó§Îçî -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">üêï</div>
                <div class="logo-text">
                    <h1>Shiloh</h1>
                    <p>Level 4-1 - Phyllis Reynolds NaylorÏùò Îâ¥Î≤†Î¶¨ Î©îÎã¨ ÏàòÏÉÅÏûë</p>
                </div>
            </div>
            <div class="nav-buttons">
                <a href="http://www.suelibrary.store/" class="nav-btn">Î©îÏù∏ÏúºÎ°ú</a>
            </div>
        </div>

        <!-- Î©îÏù∏ ÏΩòÌÖêÏ∏† -->
        <div class="main-content">
            <!-- Ï±Ö ÏÉÅÏÑ∏ ÌôîÎ©¥ -->
            <div class="book-detail-screen" id="book-detail-screen">
                <div class="level-badge">Level 4-1</div>
                <div class="breadcrumb">
                    <span>Shiloh</span>
                </div>

                <div class="book-detail-header">
                    <div class="detail-book-cover">üêï</div>
                    <div class="book-info">
                        <h2>Shiloh</h2>
                        <div class="author">Phyllis Reynolds Naylor</div>
                        <div class="book-summary">
                            When eleven-year-old Marty Preston finds a young beagle on the hills behind his home, it's love at first sight. The dog is being abused by its owner, Judd Travers, and Marty knows he has to protect it. But how can a boy save a dog when the law says it belongs to someone else? Marty's determination to keep Shiloh safe leads him into difficult moral territory where right and wrong aren't always clear.
                        </div>
                        <div class="book-stats">
                            <div class="stat-box">
                                <div class="value">15</div>
                                <div class="label">Ï±ïÌÑ∞</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">75</div>
                                <div class="label">Ï¥ù Î¨∏Ï†ú</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">Level 4-1</div>
                                <div class="label">Î†àÎ≤®</div>
                            </div>
                            <div class="stat-box">
                                <div class="value" id="progress-value">0%</div>
                                <div class="label">ÏßÑÎèÑ</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="chapters-section">
                    <h3>üêï Ï±ïÌÑ∞Î≥Ñ ÌïôÏäµ</h3>
                    <div class="chapters-grid" id="chapters-grid">
                        <!-- Ï±ïÌÑ∞ Ïπ¥ÎìúÎì§ -->
                    </div>
                </div>
            </div>

            <!-- ÌïôÏäµ ÌôîÎ©¥ -->
            <div class="learning-screen" id="learning-screen">
                <div class="breadcrumb">
                    <a onclick="showBookDetail()">Shiloh</a>
                    <span>></span>
                    <span id="learning-chapter-breadcrumb">Chapter 1</span>
                </div>

                <div class="learning-header">
                    <h2 id="learning-title">Chapter 1: Meeting Shiloh</h2>
                    <div class="learning-progress">
                        <div class="learning-progress-bar" id="learning-progress-bar" style="width: 0%"></div>
                    </div>
                    <p id="learning-progress-text">Î¨∏Ï†ú 1 / 5</p>
                </div>

                <div class="question-container" id="question-container">
                    <!-- Î¨∏Ï†úÍ∞Ä ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
                </div>

                <div class="learning-controls">
                    <button class="control-btn prev-btn" id="prev-btn" onclick="previousQuestion()" disabled>Ïù¥Ï†Ñ</button>
                    <button class="control-btn next-btn" id="next-btn" onclick="nextQuestion()">Îã§Ïùå</button>
                    <button class="control-btn submit-btn" id="submit-btn" onclick="submitAnswers()" style="display: none;">Ï†úÏ∂ú</button>
                </div>
            </div>

            <!-- Í≤∞Í≥º ÌôîÎ©¥ -->
            <div class="result-screen" id="result-screen">
                <div class="breadcrumb">
                    <a onclick="showBookDetail()">Shiloh</a>
                    <span>></span>
                    <span>Í≤∞Í≥º</span>
                </div>

                <div class="result-header">
                    <h2>üéâ ÌïôÏäµ ÏôÑÎ£å!</h2>
                    <div class="score-circle" id="score-circle">100%</div>
                    <h3 id="result-message">ÌõåÎ•≠Ìï©ÎãàÎã§!</h3>
                </div>

                <div class="result-details">
                    <div class="result-stat">
                        <h4>Ï¥ù Î¨∏Ï†ú</h4>
                        <p id="total-questions">5Î¨∏Ï†ú</p>
                    </div>
                    <div class="result-stat">
                        <h4>Ï†ïÎãµ</h4>
                        <p id="correct-answers">5Î¨∏Ï†ú</p>
                    </div>
                    <div class="result-stat">
                        <h4>Ïò§Îãµ</h4>
                        <p id="wrong-answers">0Î¨∏Ï†ú</p>
                    </div>
                    <div class="result-stat">
                        <h4>Ï†êÏàò</h4>
                        <p id="final-score">100Ï†ê</p>
                    </div>
                </div>

                <div class="result-actions">
                    <button class="control-btn prev-btn" onclick="retryChapter()">Îã§Ïãú ÌíÄÍ∏∞</button>
                    <button class="control-btn next-btn" onclick="nextChapter()">Îã§Ïùå Ï±ïÌÑ∞</button>
                    <button class="control-btn submit-btn" onclick="showBookDetail()">Ï±ïÌÑ∞ Î™©Î°ù</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ïò§ÎîîÏò§ ÌîåÎ†àÏù¥Ïñ¥ Î™®Îã¨ -->
    <div class="audio-modal" id="audio-modal">
        <div class="audio-content">
            <button class="close-audio" onclick="closeAudioModal()">√ó</button>
            <h3 id="audio-chapter-title">Chapter 1: Meeting Shiloh</h3>
            <p id="audio-chapter-subtitle">Shiloh - Phyllis Reynolds Naylor</p>

            <audio class="audio-player" id="audio-player" controls preload="metadata">
                <source id="audio-source" src="" type="audio/mpeg">
                Î∏åÎùºÏö∞Ï†ÄÍ∞Ä Ïò§ÎîîÏò§Î•º ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.
            </audio>

            <div class="audio-controls">
                <button class="audio-control-btn play-pause-btn" onclick="togglePlayPause()">‚ñ∂Ô∏è Ïû¨ÏÉù</button>
                <button class="audio-control-btn speed-btn" onclick="changeSpeed()">1.0x</button>
                <button class="audio-control-btn" onclick="resetToChapterStart()" style="background: #28a745; color: white;">üîÑ Íµ¨Í∞ÑÏ≤òÏùå</button>
                <button class="audio-control-btn download-btn" onclick="downloadAudio()">üì• Îã§Ïö¥Î°úÎìú</button>
            </div>

            <div class="audio-info" id="audio-info">
                <div id="audio-status" style="margin-top: 10px; font-weight: bold; color: #2196F3;"></div>
            </div>
        </div>
    </div>

    <script>


        // Î¨∏Ï†ú Îç∞Ïù¥ÌÑ∞ (15Ï±ïÌÑ∞)
        const questionsData = {
            0: [ // Chapter 1: Meeting Shiloh
                {
                    passage: "The day Shiloh come, we're having us a big Sunday dinner. I take the .22 rifle Dad had given me in March on my eleventh birthday and set out up the road to see what I can shoot.",
                    question: "What did Marty take with him when he went out?",
                    options: ["His fishing rod", "The .22 rifle Dad gave him for his birthday", "His bicycle", "Some food"],
                    correct: 1
                },
                {
                    passage: "About fifteen yards off, there's this shorthaired dog--white with brown and black spots--not making any kind of noise, just slinking along with his head down, watching me, tail between his legs like he's hardly got the right to breathe.",
                    question: "How did the beagle behave when Marty first saw him?",
                    options: ["Barking loudly at Marty", "Running toward Marty excitedly", "Slinking along with his head down and tail between his legs", "Playing in the grass"],
                    correct: 2
                },
                {
                    passage: "I stop and the dog stops. I whistle. It's like pressing a magic button. The beagle comes barreling toward me, legs going lickety-split, long ears flopping.",
                    question: "What happened when Marty whistled?",
                    options: ["The dog ran away", "The dog came running toward him enthusiastically", "The dog started barking", "Nothing happened"],
                    correct: 1
                },
                {
                    passage: "I name him Shiloh.",
                    question: "What did Marty decide to call the dog?",
                    options: ["Spot", "Shiloh", "Buddy", "Rex"],
                    correct: 1
                },
                {
                    passage: "'Whose dog is that?' Ma asks when I come in. 'Just followed me, is all.' 'Where'd it pick up with you?' Dad asks. 'Up in Shiloh, across the bridge,' I say.",
                    question: "Where did Marty tell his parents he first saw the dog?",
                    options: ["In their yard", "Down by the river", "Up in Shiloh, across the bridge", "At a neighbor's house"],
                    correct: 2
                }
            ],
            1: [ // Chapter 2: Taking Shiloh Back
                {
                    passage: "When Marty's father takes him to Judd's trailer to return Shiloh, Marty sees Judd kick Shiloh and pleads with Judd to stop kicking the dog.",
                    question: "What did Marty witness at Judd's trailer?",
                    options: ["Judd feeding Shiloh", "Judd kicking Shiloh", "Judd playing with Shiloh", "Judd ignoring Shiloh"],
                    correct: 1
                },
                {
                    passage: "Marty can't stop thinking about Shiloh. He decides that he has to buy Shiloh from Judd.",
                    question: "What did Marty decide he had to do?",
                    options: ["Forget about Shiloh", "Buy Shiloh from Judd", "Get another dog", "Tell the authorities about Judd"],
                    correct: 1
                },
                {
                    passage: "Marty starts collecting cans and bottles to try to make some money, but realizes it will take him forever to raise enough money to buy Shiloh.",
                    question: "How did Marty try to earn money for Shiloh?",
                    options: ["By doing chores for neighbors", "By collecting cans and bottles", "By selling his toys", "By working at a store"],
                    correct: 1
                },
                {
                    passage: "Before long, Shiloh runs away from Judd again and ends up at Marty's house.",
                    question: "What happened after Shiloh was returned to Judd?",
                    options: ["Shiloh stayed with Judd happily", "Shiloh ran away and came back to Marty's house", "Shiloh got lost in the woods", "Judd sold Shiloh to someone else"],
                    correct: 1
                },
                {
                    passage: "This time, Marty hides Shiloh in a makeshift pen just off the path that leads up the hill behind his house.",
                    question: "Where did Marty hide Shiloh when he returned?",
                    options: ["In the barn", "In his bedroom", "In a makeshift pen on the hill behind his house", "In the basement"],
                    correct: 2
                }
            ],
            2: [ // Chapter 3: Wanting to Save Shiloh
                {
                    passage: "I don't sleep more than a couple hours that night. When I do, I dream of Shiloh. By five o'clock, when it's growing light, I know pretty much what I have to do: I have to buy that dog from Judd Travers.",
                    question: "What did Marty realize he had to do?",
                    options: ["Return Shiloh immediately", "Buy Shiloh from Judd Travers", "Find Shiloh a new home", "Report Judd to the authorities"],
                    correct: 1
                },
                {
                    passage: "'Can you think of a way I could earn myself some money?' I ask him. Dad takes another bite of cornbread and says exactly what I figure he'd say: 'Collect some bottles, take 'em in for deposit.'",
                    question: "What suggestion did Dad give Marty for earning money?",
                    options: ["Get a paper route", "Collect bottles for deposit", "Mow lawns", "Wash cars"],
                    correct: 1
                },
                {
                    passage: "Must walk five miles that morning, and all I find is seven cans and one bottle.",
                    question: "How successful was Marty's first attempt at collecting bottles and cans?",
                    options: ["Very successful - he found many", "Not very successful - only seven cans and one bottle", "He found nothing", "He found enough to buy Shiloh"],
                    correct: 1
                },
                {
                    passage: "That night I sleep a little bit, wake a bit, sleep a bit, wake some more. About dawn, I know what I got to do.",
                    question: "How was Marty sleeping during this time?",
                    options: ["Very well", "Restlessly, sleeping and waking", "He couldn't sleep at all", "He slept all day"],
                    correct: 1
                },
                {
                    passage: "You once get a dog to look at you the way Shiloh looked at me, you don't forget it.",
                    question: "Why couldn't Marty forget about Shiloh?",
                    options: ["Shiloh was very expensive", "The way Shiloh looked at him was unforgettable", "His parents told him not to", "Shiloh was the only dog in town"],
                    correct: 1
                }
            ],
            3: [ // Chapter 4: Working with Dad
                {
                    passage: "Dad drives his Jeep to the post office in Sistersville, where he cases mail for around two hundred families and delivers it, then comes back to the Friendly post office where he cases mail for two hundred more.",
                    question: "What was Dad's job?",
                    options: ["He was a farmer", "He was a mail carrier", "He was a teacher", "He was a store owner"],
                    correct: 1
                },
                {
                    passage: "I stuff the mail in, turn up the little red flag on the side, if there is one. Some folks even wait down at the box.",
                    question: "What did Marty do to help his father?",
                    options: ["Drive the jeep", "Help deliver mail", "Sort mail at the post office", "Clean the jeep"],
                    correct: 1
                },
                {
                    passage: "All the dogs is chained when we get to his place, so none's waiting for us at the box. But Judd is.",
                    question: "What did they find when they reached Judd's place?",
                    options: ["Dogs running free", "Judd waiting at the mailbox with his chained dogs", "No one was there", "Shiloh waiting for them"],
                    correct: 1
                },
                {
                    passage: "'That dog that followed me home the other day,' I say. 'He okay?' 'He's learnin',' Judd says.",
                    question: "When Marty asked about Shiloh, what did Judd say?",
                    options: ["The dog was fine", "The dog ran away again", "He's learning", "He sold the dog"],
                    correct: 2
                },
                {
                    passage: "'His name's Shiloh,' I say.",
                    question: "What did Marty tell Judd about the dog?",
                    options: ["The dog was sick", "His name was Shiloh", "He wanted to buy the dog", "The dog should be free"],
                    correct: 1
                }
            ],
            4: [ // Chapter 5: The Secret Pen
                {
                    passage: "I hear the softest kind of noise-and right close. I fold the bread up, jelly to the inside, stick it in my pocket, and go out the front door. Shiloh's under the sycamore, head on his paws.",
                    question: "Where did Marty find Shiloh when he returned?",
                    options: ["In the kitchen", "Under the sycamore tree", "In the barn", "By the road"],
                    correct: 1
                },
                {
                    passage: "All I know right then is that I have to get Shiloh away from the house, where none of the family will see him.",
                    question: "What was Marty's immediate concern?",
                    options: ["Feeding Shiloh", "Getting Shiloh away from the house so his family wouldn't see", "Taking Shiloh back to Judd", "Finding a veterinarian"],
                    correct: 1
                },
                {
                    passage: "I string the fencing around the trunks of three small trees, for corner posts, and then back to the pine tree again where I fasten it with wire. Pen measures about six by eight feet.",
                    question: "How big was the pen Marty built for Shiloh?",
                    options: ["Four by six feet", "Six by eight feet", "Eight by ten feet", "Ten by twelve feet"],
                    correct: 1
                },
                {
                    passage: "I take the planks up to Shiloh's pen and make him a lean-to at one end, to protect him from rain.",
                    question: "What did Marty build to protect Shiloh from weather?",
                    options: ["A doghouse", "A lean-to", "A roof", "A shelter"],
                    correct: 1
                },
                {
                    passage: "Like he had the bark beat out of him when he was a pup and it just never come back.",
                    question: "Why was Shiloh so quiet?",
                    options: ["He was naturally quiet", "He was sick", "It seemed like the bark had been beaten out of him", "He was well-trained"],
                    correct: 2
                }
            ],
            5: [ // Chapter 6: Keeping Secrets - Add remaining chapters similarly
                {
                    passage: "The worry part is whether or not he'll stay quiet. I'm hoping he will, 'cause he was a silent dog to begin with, but all the way back down the hill to the house, I put my finger to my lips and turn back. 'Shhh!' I say.",
                    question: "What was Marty most worried about?",
                    options: ["Whether Shiloh would stay quiet", "Whether he had enough food for Shiloh", "Whether the pen was strong enough", "Whether Judd would find Shiloh"],
                    correct: 0
                },
                {
                    passage: "I manage to take a piece of potato and some cornbread up to him before it gets dark. I sit down in his pen with him, and he crawls all over me, licking my face.",
                    question: "How did Shiloh react when Marty visited him?",
                    options: ["He was scared and hid", "He crawled all over Marty, licking his face", "He barked excitedly", "He ignored Marty"],
                    correct: 1
                },
                {
                    passage: "I eat about half my supper, then say, 'I been getting this sort of full feeling at dinner, Ma, and then I'm hungry again before I go to bed.'",
                    question: "How did Marty explain saving food for Shiloh?",
                    options: ["He said he wasn't hungry", "He said he got full at dinner but hungry later", "He said he was on a diet", "He said the food tasted bad"],
                    correct: 1
                },
                {
                    passage: "Easy as falling off a log.",
                    question: "How did Marty feel about deceiving his family?",
                    options: ["It was very difficult", "It was easy as falling off a log", "It made him very sad", "He couldn't do it"],
                    correct: 1
                },
                {
                    passage: "I go into the other room and sit down on the sofa. So far, so good.",
                    question: "How did Marty feel about his plan working?",
                    options: ["Very worried", "Confident that things were going well", "Ready to give up", "Confused about what to do"],
                    correct: 1
                }
            ]
            // Continue with the remaining chapters 7-14...
        };


// Shiloh ÎèÑÏÑú Îç∞Ïù¥ÌÑ∞
const bookData = {
    id: 'SHL001',
    title: "Shiloh",
    author: 'Phyllis Reynolds Naylor',
    cover: 'üêï',
    progress: 0,
    chapters: 15,
    totalQuestions: 75,
    coverColor: 'linear-gradient(45deg, #2196F3, #03A9F4)',
    summary: "When eleven-year-old Marty Preston finds a young beagle on the hills behind his home, it's love at first sight. The dog is being abused by its owner, Judd Travers, and Marty knows he has to protect it. But how can a boy save a dog when the law says it belongs to someone else? Marty's determination to keep Shiloh safe leads him into difficult moral territory where right and wrong aren't always clear.",
    chapterList: [
        { title: 'Meeting Shiloh', description: 'Marty discovers the beagle following him on his walk and names him Shiloh.', status: 'current', questionCount: 5, startTime: 23 },
        { title: 'Taking Shiloh Back', description: 'Marty must return Shiloh to his owner Judd Travers, despite Judd\'s cruel treatment.', status: 'current', questionCount: 5, startTime: 646 },
        { title: 'Wanting to Save Shiloh', description: 'Marty desperately wants to earn money to buy Shiloh from Judd.', status: 'current', questionCount: 5, startTime: 1334 },
        { title: 'Working with Dad', description: 'Marty helps his father deliver mail and learns more about Judd\'s character.', status: 'current', questionCount: 5, startTime: 1995 },
        { title: 'The Secret Pen', description: 'When Shiloh returns, Marty builds a secret pen to hide him in the woods.', status: 'current', questionCount: 5, startTime: 2673 },
        { title: 'Keeping Secrets', description: 'Marty struggles with lying to his family while caring for Shiloh.', status: 'current', questionCount: 5, startTime: 3292 },
        { title: 'Visiting David', description: 'Marty visits his friend David but cannot tell him about Shiloh.', status: 'current', questionCount: 5, startTime: 4151 },
        { title: 'The Snake Story', description: 'Marty tells his sister about dangerous snakes to keep her away from Shiloh.', status: 'current', questionCount: 5, startTime: 4801 },
        { title: 'Ma Discovers the Truth', description: 'Marty\'s mother finds Shiloh and learns about Marty\'s secret.', status: 'current', questionCount: 5, startTime: 5284 },
        { title: 'The Dog Attack', description: 'A German shepherd attacks Shiloh, leaving him badly injured.', status: 'current', questionCount: 5, startTime: 5834 },
        { title: 'Doc Murphy\'s Help', description: 'Doc Murphy treats Shiloh\'s injuries, and the family decides to care for him.', status: 'current', questionCount: 5, startTime: 6371 },
        { title: 'Judd Returns', description: 'Judd Travers comes to claim his dog back from the Preston family.', status: 'current', questionCount: 5, startTime: 6981 },
        { title: 'Marty\'s Confrontation', description: 'Marty decides to confront Judd directly about keeping Shiloh.', status: 'current', questionCount: 5, startTime: 7608 },
        { title: 'The Hunting Incident', description: 'Marty witnesses Judd illegally hunting deer out of season.', status: 'current', questionCount: 5, startTime: 8130 },
        { title: 'Working for Shiloh', description: 'Marty makes a deal with Judd to work for him to earn Shiloh\'s ownership.', status: 'current', questionCount: 5, startTime: 8755 }
    ]
};

// üéØ Íµ¨Í∏Ä ÌÅ¥ÎùºÏö∞Îìú Ïä§ÌÜ†Î¶¨ÏßÄ Ïò§ÎîîÏò§ URL ÏÑ§Ï†ï
const AUDIO_BASE_URL = 'https://storage.googleapis.com/kim-mom-reading-audio/audio/';
const SHILOH_AUDIO_FILE = 'completed_audio.mp3';

// Shiloh Ï±ïÌÑ∞Î≥Ñ ÌÉÄÏûÑÏä§ÌÉ¨ÌîÑ Îß§Ìïë (Í∏∞Ï°¥ ÌòïÌÉú Í∑∏ÎåÄÎ°ú Ïú†ÏßÄ)
const shilohChapterMapping = {
   0: { name: 'Chapter 1', startTime: 23 },
   1: { name: 'Chapter 2', startTime: 646 },
   2: { name: 'Chapter 3', startTime: 1334 },
   3: { name: 'Chapter 4', startTime: 1995 },
   4: { name: 'Chapter 5', startTime: 2673 },
   5: { name: 'Chapter 6', startTime: 3292 },
   6: { name: 'Chapter 7', startTime: 4151 },
   7: { name: 'Chapter 8', startTime: 4801 },
   8: { name: 'Chapter 9', startTime: 5284 },
   9: { name: 'Chapter 10', startTime: 5834 },
   10: { name: 'Chapter 11', startTime: 6371 },
   11: { name: 'Chapter 12', startTime: 6981 },
   12: { name: 'Chapter 13', startTime: 7608 },
   13: { name: 'Chapter 14', startTime: 8130 },
   14: { name: 'Chapter 15', startTime: 8755 }
};

// Ï†ÑÏó≠ Î≥ÄÏàò
let currentChapterIndex = 0;
let currentQuestionIndex = 0;
let userAnswers = [];
let questions = [];
let currentAudio = null;
let playbackSpeed = 1.0;

// Ïò§ÎîîÏò§ URL ÏÉùÏÑ± Ìï®Ïàò (Í∏∞Ï°¥ ÌååÏùºÎ™Ö Í∑∏ÎåÄÎ°ú)
function getShilohAudioUrl() {
    return `${AUDIO_BASE_URL}SHL001_Shiloh/${SHILOH_AUDIO_FILE}`;
}

// ÏãúÍ∞Ñ Ìè¨Îß∑ Ìï®Ïàò
function formatTime(seconds) {
    const hours = Math.floor(seconds / 3600);
    const minutes = Math.floor((seconds % 3600) / 60);
    const secs = Math.floor(seconds % 60);

    if (hours > 0) {
        return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    } else {
        return `${minutes}:${secs.toString().padStart(2, '0')}`;
    }
}

// ÌòÑÏû¨ Ïû¨ÏÉù Ï§ëÏù∏ Ï±ïÌÑ∞ ÌôïÏù∏
function getCurrentChapter(currentTime) {
    let currentChapterNum = 0;
    for (let i = 14; i >= 0; i--) {
        if (currentTime >= shilohChapterMapping[i].startTime) {
            currentChapterNum = i;
            break;
        }
    }
    return currentChapterNum;
}

// üéß ÌÉúÎ∏îÎ¶ø Ìò∏Ìôò Ïò§ÎîîÏò§ Ïû¨ÏÉù Ìï®Ïàò (A Single ShardÏùò Í∞ÑÎã®Ìïú Î∞©Ïãù Ï†ÅÏö©)
function playChapterAudio(chapterIndex) {
    const chapter = shilohChapterMapping[chapterIndex];
    if (!chapter) {
        alert('Ï±ïÌÑ∞ Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
        return;
    }

    document.getElementById('audio-modal').style.display = 'flex';
    document.getElementById('audio-chapter-title').textContent = `Chapter ${chapterIndex + 1}`;
    document.getElementById('audio-chapter-subtitle').textContent = `${bookData.title} - ${bookData.author}`;
    document.getElementById('audio-info').classList.remove('hidden');

    const audioPlayer = document.getElementById('audio-player');
    const audioSource = document.getElementById('audio-source');
    const audioStatus = document.getElementById('audio-status');

    audioStatus.textContent = 'üîÑ Ïò§ÎîîÏò§ ÌååÏùºÏùÑ Î°úÎî© Ï§ë...';

    // A Single Shard Î∞©Ïãù: Í∞ÑÎã®ÌïòÍ≥† ÏßÅÏ†ëÏ†ÅÏù∏ Î°úÎî©
    audioSource.src = getShilohAudioUrl();
    audioPlayer.load();

    const successHandler = function() {
        // ÏãúÍ∞Ñ Ï†êÌîÑ!
        audioPlayer.currentTime = chapter.startTime;

        // ÏãúÍ∞Ñ ÌëúÏãú
        const timeDisplay = formatTime(chapter.startTime);
        audioStatus.innerHTML = `‚úÖ Chapter ${chapterIndex + 1} Î°úÎìú ÏôÑÎ£å! (${timeDisplay}Î∂ÄÌÑ∞)`;

        // üéØ A Single Shard Î∞©Ïãù: Ï±ïÌÑ∞ ÌÅ¥Î¶≠ Ï¶âÏãú Ïû¨ÏÉù ÏãúÎèÑ!
        audioPlayer.play().then(() => {
            audioStatus.innerHTML = `üéµ Chapter ${chapterIndex + 1} Ïû¨ÏÉù Ï§ë! (${timeDisplay}Î∂ÄÌÑ∞)`;
            document.querySelector('.play-pause-btn').textContent = '‚è∏Ô∏è ÏùºÏãúÏ†ïÏßÄ';
        }).catch(e => {
            console.log('ÏûêÎèô Ïû¨ÏÉù Ï∞®Îã®Îê®:', e);
            audioStatus.innerHTML = `‚úÖ Chapter ${chapterIndex + 1} Ï§ÄÎπÑÎê®! ‚ñ∂Ô∏è Ïû¨ÏÉù Î≤ÑÌäºÏùÑ ÎàåÎü¨Ï£ºÏÑ∏Ïöî`;
        });
    };

    const errorHandler = function() {
        audioStatus.innerHTML = '‚ùå Ïò§ÎîîÏò§ ÌååÏùºÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.';
        console.error('Ïò§ÎîîÏò§ Î°úÎìú Ïã§Ìå®:', getShilohAudioUrl());
    };

    audioPlayer.addEventListener('canplaythrough', successHandler, { once: true });
    audioPlayer.addEventListener('error', errorHandler, { once: true });

    currentAudio = audioPlayer;
    currentChapterIndex = chapterIndex;
    playbackSpeed = 1.0;
}

// üéß Íµ¨Í∞ÑÏ≤òÏùåÏúºÎ°ú Ìï®Ïàò (ÌòÑÏû¨ Ï±ïÌÑ∞ ÏãúÏûëÏ†êÏúºÎ°ú)
function resetToChapterStart() {
    if (!currentAudio) return;

    // ÌòÑÏû¨ Ï±ïÌÑ∞ Î≤àÌò∏ Ï∂îÏ∂ú
    const chapterTitle = document.getElementById('audio-chapter-title').textContent;
    const chapterMatch = chapterTitle.match(/Chapter (\d+)/);

    if (chapterMatch) {
        const currentChapterIdx = parseInt(chapterMatch[1]) - 1;
        const startTime = shilohChapterMapping[currentChapterIdx]?.startTime || 0;
        currentAudio.currentTime = startTime;

        console.log(`üîÑ Chapter ${currentChapterIdx + 1} ÏãúÏûëÏ†êÏúºÎ°ú Ïù¥Îèô: ${formatTime(startTime)}`);
    }
}

// üéß Ïù¥Ï†Ñ Ï±ïÌÑ∞Î°ú Ï†êÌîÑ
function jumpToPreviousChapter() {
    const chapterTitle = document.getElementById('audio-chapter-title').textContent;
    const chapterMatch = chapterTitle.match(/Chapter (\d+)/);

    if (chapterMatch) {
        const currentIdx = parseInt(chapterMatch[1]) - 1;
        if (currentIdx > 0) {
            playChapterAudio(currentIdx - 1);
        }
    }
}

// üéß Îã§Ïùå Ï±ïÌÑ∞Î°ú Ï†êÌîÑ
function jumpToNextChapter() {
    const chapterTitle = document.getElementById('audio-chapter-title').textContent;
    const chapterMatch = chapterTitle.match(/Chapter (\d+)/);

    if (chapterMatch) {
        const currentIdx = parseInt(chapterMatch[1]) - 1;
        if (currentIdx + 1 <= 14) { // 15Í∞ú Ï±ïÌÑ∞ (0-14)
            playChapterAudio(currentIdx + 1);
        }
    }
}

// Í∏∞Î≥∏ Ïò§ÎîîÏò§ Ïª®Ìä∏Î°§ Ìï®ÏàòÎì§ (ÌÉúÎ∏îÎ¶ø Ìò∏ÌôòÏÑ± Í∞úÏÑ†)
function closeAudioModal() {
    document.getElementById('audio-modal').style.display = 'none';
    if (currentAudio) {
        currentAudio.pause();
    }
}

function togglePlayPause() {
    if (!currentAudio) return;

    if (currentAudio.paused) {
        currentAudio.play().then(() => {
            document.querySelector('.play-pause-btn').textContent = '‚è∏Ô∏è ÏùºÏãúÏ†ïÏßÄ';
        }).catch(e => {
            console.error('Ïû¨ÏÉù Ïã§Ìå®:', e);
            document.getElementById('audio-status').innerHTML = '‚ùå Ïû¨ÏÉùÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.';
        });
    } else {
        currentAudio.pause();
        document.querySelector('.play-pause-btn').textContent = '‚ñ∂Ô∏è Ïû¨ÏÉù';
    }
}

function changeSpeed() {
    if (!currentAudio) return;
    const speeds = [0.5, 0.75, 1.0, 1.25, 1.5, 2.0];
    const currentIndex = speeds.indexOf(playbackSpeed);
    playbackSpeed = speeds[(currentIndex + 1) % speeds.length];
    currentAudio.playbackRate = playbackSpeed;
    document.querySelector('.speed-btn').textContent = `${playbackSpeed}x`;
}

function downloadAudio() {
    const audioSource = document.getElementById('audio-source');
    if (audioSource.src) {
        const link = document.createElement('a');
        link.href = audioSource.src;
        link.download = `${document.getElementById('audio-chapter-title').textContent}.mp3`;
        link.click();
    }
}

// Ï±Ö ÏÉÅÏÑ∏ Ï†ïÎ≥¥ ÌëúÏãú
function showBookDetail() {
    document.getElementById('book-detail-screen').style.display = 'block';
    document.getElementById('learning-screen').style.display = 'none';
    document.getElementById('result-screen').style.display = 'none';
    generateChapterGrid();
    updateProgress();
}

// Ï±ïÌÑ∞ Í∑∏Î¶¨Îìú ÏÉùÏÑ±
function generateChapterGrid() {
    const grid = document.getElementById('chapters-grid');
    grid.innerHTML = '';

    bookData.chapterList.forEach((chapter, index) => {
        const chapterCard = document.createElement('div');
        chapterCard.className = `chapter-card ${chapter.status}`;

        chapterCard.innerHTML = `
            <div class="chapter-header">
                <div class="chapter-info">
                    <h4>Chapter ${index + 1}: ${chapter.title}</h4>
                    <p>${chapter.description} (${chapter.questionCount}Î¨∏Ï†ú)</p>
                </div>
                <div class="chapter-status ${chapter.status}">
                    ${chapter.status === 'completed' ? '‚úÖ ÏôÑÎ£å' :
                      chapter.status === 'current' ? 'üìñ ÏßÑÌñâÏ§ë' : 'üîí Ïû†ÍπÄ'}
                </div>
            </div>
            <div class="chapter-actions">
                <button class="chapter-btn audio-btn" onclick="playChapterAudio(${index})"
                        ${chapter.status === 'locked' ? 'disabled' : ''}>
                    üéß Ïò§ÎîîÏò§
                </button>
                <button class="chapter-btn quiz-btn" onclick="startLearning(${index})"
                        ${chapter.status === 'locked' ? 'disabled' : ''}>
                    üìù Î¨∏Ï†úÌíÄÍ∏∞
                </button>
            </div>
        `;

        grid.appendChild(chapterCard);
    });
}

// ÏßÑÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
function updateProgress() {
    const completedChapters = bookData.chapterList.filter(chapter => chapter.status === 'completed').length;
    const progressPercent = Math.round((completedChapters / bookData.chapters) * 100);
    document.getElementById('progress-value').textContent = `${progressPercent}%`;
}

// ÌïôÏäµ ÏãúÏûë
function startLearning(chapterIndex) {
    if (bookData.chapterList[chapterIndex].status === 'locked') return;

    currentChapterIndex = chapterIndex;
    currentQuestionIndex = 0;
    userAnswers = [];
    questions = questionsData[chapterIndex] || [];

    if (questions.length === 0) {
        alert('Ïù¥ Ï±ïÌÑ∞Ïùò Î¨∏Ï†úÍ∞Ä Ï§ÄÎπÑÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
        return;
    }

    document.getElementById('book-detail-screen').style.display = 'none';
    document.getElementById('learning-screen').style.display = 'block';
    document.getElementById('result-screen').style.display = 'none';

    const chapter = bookData.chapterList[chapterIndex];
    document.getElementById('learning-title').textContent = `Chapter ${chapterIndex + 1}: ${chapter.title}`;
    document.getElementById('learning-chapter-breadcrumb').textContent = `Chapter ${chapterIndex + 1}`;

    showQuestion();
}

// Î¨∏Ï†ú ÌëúÏãú
function showQuestion() {
    if (currentQuestionIndex >= questions.length) {
        submitAnswers();
        return;
    }

    const question = questions[currentQuestionIndex];
    const container = document.getElementById('question-container');

    container.innerHTML = `
        <div class="passage">${question.passage}</div>
        <div class="question-text">${question.question}</div>
        <div class="options">
            ${question.options.map((option, index) =>
                `<div class="option" onclick="selectOption(${index})" data-index="${index}">
                    ${String.fromCharCode(65 + index)}. ${option}
                </div>`
            ).join('')}
        </div>
    `;

    // ÏßÑÎèÑ Î∞î ÏóÖÎç∞Ïù¥Ìä∏
    const progressPercent = ((currentQuestionIndex + 1) / questions.length) * 100;
    document.getElementById('learning-progress-bar').style.width = `${progressPercent}%`;
    document.getElementById('learning-progress-text').textContent = `Î¨∏Ï†ú ${currentQuestionIndex + 1} / ${questions.length}`;

    // Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
    document.getElementById('prev-btn').disabled = currentQuestionIndex === 0;
    document.getElementById('next-btn').style.display = currentQuestionIndex === questions.length - 1 ? 'none' : 'inline-block';
    document.getElementById('submit-btn').style.display = currentQuestionIndex === questions.length - 1 ? 'inline-block' : 'none';

    // Ïù¥Ï†Ñ ÎãµÎ≥ÄÏù¥ ÏûàÎã§Î©¥ ÌëúÏãú
    if (userAnswers[currentQuestionIndex] !== undefined) {
        const selectedOption = container.querySelector(`[data-index="${userAnswers[currentQuestionIndex]}"]`);
        if (selectedOption) {
            selectedOption.classList.add('selected');
        }
    }
}

// ÏòµÏÖò ÏÑ†ÌÉù
function selectOption(index) {
    // Í∏∞Ï°¥ ÏÑ†ÌÉù Ï†úÍ±∞
    document.querySelectorAll('.option').forEach(option => {
        option.classList.remove('selected');
    });

    // ÏÉà ÏÑ†ÌÉù Ï∂îÍ∞Ä
    document.querySelector(`[data-index="${index}"]`).classList.add('selected');
    userAnswers[currentQuestionIndex] = index;
}

// Îã§Ïùå Î¨∏Ï†ú
function nextQuestion() {
    if (currentQuestionIndex < questions.length - 1) {
        currentQuestionIndex++;
        showQuestion();
    }
}

// Ïù¥Ï†Ñ Î¨∏Ï†ú
function previousQuestion() {
    if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        showQuestion();
    }
}

// ÎãµÏïà Ï†úÏ∂ú
function submitAnswers() {
    let correctCount = 0;
    for (let i = 0; i < questions.length; i++) {
        if (userAnswers[i] === questions[i].correct) {
            correctCount++;
        }
    }

    const score = Math.round((correctCount / questions.length) * 100);

    // Ï±ïÌÑ∞ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
    if (score >= 70) { // 70Ï†ê Ïù¥ÏÉÅÏù¥Î©¥ ÌÜµÍ≥º
        bookData.chapterList[currentChapterIndex].status = 'completed';

        // Îã§Ïùå Ï±ïÌÑ∞ Ïû†Í∏à Ìï¥Ï†ú
        if (currentChapterIndex + 1 < bookData.chapterList.length) {
            if (bookData.chapterList[currentChapterIndex + 1].status === 'locked') {
                bookData.chapterList[currentChapterIndex + 1].status = 'current';
            }
        }
    }

    showResult(correctCount, score);
}

// Í≤∞Í≥º ÌëúÏãú
function showResult(correctCount, score) {
    document.getElementById('learning-screen').style.display = 'none';
    document.getElementById('result-screen').style.display = 'block';

    document.getElementById('score-circle').textContent = `${score}%`;
    document.getElementById('total-questions').textContent = `${questions.length}Î¨∏Ï†ú`;
    document.getElementById('correct-answers').textContent = `${correctCount}Î¨∏Ï†ú`;
    document.getElementById('wrong-answers').textContent = `${questions.length - correctCount}Î¨∏Ï†ú`;
    document.getElementById('final-score').textContent = `${score}Ï†ê`;

    let message = '';
    let circleColor = '';

    if (score >= 90) {
        message = 'üåü ÏôÑÎ≤ΩÌï©ÎãàÎã§!';
        circleColor = 'linear-gradient(45deg, #2196F3, #03A9F4)';
    } else if (score >= 80) {
        message = 'üéâ ÌõåÎ•≠Ìï¥Ïöî!';
        circleColor = 'linear-gradient(45deg, #2196F3, #03A9F4)';
    } else if (score >= 70) {
        message = 'üëç ÏûòÌñàÏñ¥Ïöî!';
        circleColor = 'linear-gradient(45deg, #2196F3, #03A9F4)';
    } else {
        message = 'üí™ Îã§Ïãú ÎèÑÏ†ÑÌï¥Î≥¥ÏÑ∏Ïöî!';
        circleColor = 'linear-gradient(45deg, #ff9800, #f57c00)';
    }

    document.getElementById('result-message').textContent = message;
    document.getElementById('score-circle').style.background = circleColor;
}

// Ï±ïÌÑ∞ Îã§Ïãú ÌíÄÍ∏∞
function retryChapter() {
    startLearning(currentChapterIndex);
}

// Îã§Ïùå Ï±ïÌÑ∞
function nextChapter() {
    if (currentChapterIndex + 1 < bookData.chapterList.length) {
        if (bookData.chapterList[currentChapterIndex + 1].status !== 'locked') {
            startLearning(currentChapterIndex + 1);
        } else {
            showBookDetail();
        }
    } else {
        showBookDetail();
    }
}

// ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
window.addEventListener('DOMContentLoaded', function() {
    showBookDetail();
});

// ÌÇ§Î≥¥Îìú Îã®Ï∂ïÌÇ§
document.addEventListener('keydown', function(e) {
    if (document.getElementById('learning-screen').style.display === 'block') {
        if (e.key === 'ArrowLeft') {
            previousQuestion();
        } else if (e.key === 'ArrowRight') {
            nextQuestion();
        } else if (e.key >= '1' && e.key <= '4') {
            const index = parseInt(e.key) - 1;
            if (index < questions[currentQuestionIndex]?.options.length) {
                selectOption(index);
            }
        }
    }

    if (e.key === 'Escape') {
        closeAudioModal();
    }
});

// Ïò§ÎîîÏò§ ÌîåÎ†àÏù¥Ïñ¥ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà (A Single Shard Î∞©ÏãùÏúºÎ°ú Í∞ÑÏÜåÌôî)
document.addEventListener('DOMContentLoaded', function() {
    const audioPlayer = document.getElementById('audio-player');

    audioPlayer.addEventListener('play', function() {
        document.querySelector('.play-pause-btn').textContent = '‚è∏Ô∏è ÏùºÏãúÏ†ïÏßÄ';
    });

    audioPlayer.addEventListener('pause', function() {
        document.querySelector('.play-pause-btn').textContent = '‚ñ∂Ô∏è Ïû¨ÏÉù';
    });

    audioPlayer.addEventListener('ended', function() {
        document.querySelector('.play-pause-btn').textContent = '‚ñ∂Ô∏è Ïû¨ÏÉù';
    });
});
   </script>
</body>
</html>
